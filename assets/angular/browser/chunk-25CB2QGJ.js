import{a as Me}from"./chunk-P5G66PID.js";import"./chunk-XDAG4MPO.js";import{a as Pe}from"./chunk-3S6K3HFN.js";import{a as Re}from"./chunk-44R4R5AU.js";import{a as Se,b as Ie}from"./chunk-UKGBHEHD.js";import{b as Ee}from"./chunk-P3GASOP5.js";import"./chunk-LRDGIBFV.js";import"./chunk-COLKSTJ6.js";import{b as Ce}from"./chunk-KCTZUZJH.js";import{g as ge,h as xe,k as ie}from"./chunk-PWQJWZZZ.js";import{b as we}from"./chunk-OX7OA6PN.js";import"./chunk-EGRYB44C.js";import"./chunk-5VY7FQQV.js";import{c as be,f as he,k as ye}from"./chunk-ROSYCBC4.js";import{a as R}from"./chunk-JISGPZ2J.js";import{$b as j,Aa as k,Dc as ce,Ea as r,Fc as ue,Gb as oe,Gc as me,Hb as te,Ib as V,Kc as _e,Lb as l,Ma as T,Mb as v,Nb as S,Ob as D,Oc as pe,Ra as ne,Sa as Q,Tb as h,Tc as fe,Ub as y,Uc as ve,Vb as C,Wa as m,Yc as G,Z as U,Zb as F,_ as q,_b as w,ba as H,dc as se,fc as le,ga as _,ha as p,hc as de,ib as d,jb as n,kb as a,lb as f,pb as ae,qb as re,sb as b,vb as g,xb as c}from"./chunk-SPNCLBHB.js";import{a as Z,f as je,m as ee}from"./chunk-GG76335P.js";var Te=je(Re());var N=class N{constructor(t){this.http=t;this.ruta=R.ruta}authHeaders(){let t=localStorage.getItem("token");return new fe({Authorization:`Bearer ${t}`})}obtenerMaterias(){return this.http.get(`${this.ruta}api/v1/perfil/materias`,{headers:this.authHeaders()})}actualizarMateriaDocente(t,e){return this.http.put(`${this.ruta}api/v1/perfil/materias/${t}`,e,{headers:this.authHeaders()})}obtenerDeudas(t){let e=new ve;return t&&(e=e.set("gestion",t)),this.http.get(`${this.ruta}api/v1/perfil/deudas`,{headers:this.authHeaders(),params:e})}};N.\u0275fac=function(e){return new(e||N)(H(G))},N.\u0275prov=U({token:N,factory:N.\u0275fac,providedIn:"root"});var z=N;var L=class L{constructor(t){this.http=t;this.ruta=R.ruta}authHeaders(){return{Authorization:`Bearer ${localStorage.getItem("token")}`}}get2faStatus(){return this.http.get(`${this.ruta}api/v1/security/2fa/status`,{headers:this.authHeaders()})}startEnroll2fa(){return this.http.post(`${this.ruta}api/v1/security/2fa/enroll/start`,{},{headers:this.authHeaders()})}confirmEnroll2fa(t){return this.http.post(`${this.ruta}api/v1/security/2fa/enroll/confirm`,{code:t},{headers:this.authHeaders()})}disable2fa(t){return this.http.post(`${this.ruta}api/v1/security/2fa/disable`,{code:t},{headers:this.authHeaders()})}};L.\u0275fac=function(e){return new(e||L)(H(G))},L.\u0275prov=U({token:L,factory:L.\u0275fac,providedIn:"root"});var J=L;var qe=(i,t)=>({"d-none d-md-block":i,"sidebar-collapsed":t}),B=i=>({active:i}),ke=()=>["/asistenciasestudiantes/permisos"],He=()=>["/asistenciasestudiantes/scan"],X=(i,t)=>({"btn-outline-secondary":i,"btn-secondary":t}),Qe=()=>[],Ve=i=>["/lchaula/materia",i],Fe=()=>["/accionesplanteles/calificaciones"],Ne=i=>({materiaId:i}),Le=i=>["/asistenciasestudiantes/materia",i];function Ge(i,t){i&1&&(n(0,"div",5)(1,"div",6),f(2,"div",7),n(3,"div"),l(4,"Cargando perfil\u2026"),a()()())}function ze(i,t){i&1&&(n(0,"div",5)(1,"div",8),l(2,"No hay sesi\xF3n activa."),a()())}function $e(i,t){if(i&1&&(n(0,"div",35)(1,"div",36),l(2,"Instituci\xF3n"),a(),n(3,"div",37),l(4),a()()),i&2){let e=c(2);r(4),v(e.datasesion.nameInst)}}function Je(i,t){i&1&&(n(0,"span",38),l(1,"Inicio"),a())}function Ke(i,t){i&1&&(n(0,"span",38),l(1,"Cuenta"),a())}function Xe(i,t){i&1&&(n(0,"span",38),l(1,"Seguridad"),a())}function Ye(i,t){i&1&&(n(0,"span",38),l(1,"Mis Materias"),a())}function Ze(i,t){i&1&&(n(0,"span",38),l(1,"Mis Planes"),a())}function et(i,t){if(i&1){let e=b();n(0,"li",19)(1,"button",16),g("click",function(){_(e);let s=c(2);return p(s.setTab("misPlanes"))}),f(2,"i",39),m(3,Ze,2,0,"span",18),a()()}if(i&2){let e=c(2);d("ngClass",w(4,B,e.activeTab==="misPlanes")),r(),V("active",e.activeTab==="misPlanes"),r(2),d("ngIf",e.menuOpen)}}function tt(i,t){i&1&&(n(0,"span",38),l(1,"Mis Deudas"),a())}function it(i,t){if(i&1){let e=b();n(0,"li",19)(1,"button",16),g("click",function(){_(e);let s=c(2);return p(s.setTab("deudas"))}),f(2,"i",40),m(3,tt,2,0,"span",18),a()()}if(i&2){let e=c(2);d("ngClass",w(4,B,e.activeTab==="deudas")),r(),V("active",e.activeTab==="deudas"),r(2),d("ngIf",e.menuOpen)}}function nt(i,t){if(i&1&&(n(0,"div",41),l(1),a()),i&2){let e=c(2);r(),v(e.perfilError)}}function at(i,t){if(i&1){let e=b();n(0,"button",55),g("click",function(){_(e);let s=c(3);return p(s.setTab("deudas"))}),l(1,"Ver Deudas"),a()}}function rt(i,t){i&1&&(n(0,"a",56),f(1,"i",57),l(2," Licencias (Asistencias) "),a()),i&2&&d("routerLink",F(1,ke))}function ot(i,t){if(i&1&&(n(0,"div",36),l(1),a()),i&2){let e=c(3);r(),S(" Deudas: ",(e.deudasPorInstitucion==null?null:e.deudasPorInstitucion.length)||0," instituci\xF3n(es) ")}}function st(i,t){if(i&1){let e=b();n(0,"div")(1,"div",42)(2,"div",43)(3,"div",44)(4,"div",45)(5,"div",46),l(6,"Accesos r\xE1pidos"),a(),n(7,"div",47)(8,"button",48),g("click",function(){_(e);let s=c(2);return p(s.setTab("misMaterias"))}),l(9,"Ver Mis Materias"),a(),n(10,"button",49),g("click",function(){_(e);let s=c(2);return p(s.setTab("cuenta"))}),l(11,"Ver Cuenta"),a(),n(12,"button",50),g("click",function(){_(e);let s=c(2);return p(s.setTab("seguridad"))}),l(13,"Seguridad"),a(),m(14,at,2,0,"button",51)(15,rt,3,2,"a",52),a()()()(),n(16,"div",43)(17,"div",44)(18,"div",45)(19,"div",46),l(20,"Resumen"),a(),n(21,"div",53),l(22),a(),m(23,ot,2,1,"div",54),a()()()()()}if(i&2){let e=c(2);r(14),d("ngIf",e.esEstudiante),r(),d("ngIf",e.esAdministrativo),r(7),S(" Materias cargadas: ",(e.materiasPorInstitucion==null?null:e.materiasPorInstitucion.length)||0," instituci\xF3n(es) "),r(),d("ngIf",e.esEstudiante)}}function lt(i,t){i&1&&(n(0,"div",76)(1,"div",77)(2,"div",65)(3,"div",78)(4,"div")(5,"div",46),l(6,"Asistencias (QR)"),a(),n(7,"div",36),l(8,"Escanea/pega el token del QR para registrar tu asistencia."),a()(),n(9,"a",79),f(10,"i",80),l(11," Ir a escanear "),a()()()()()),i&2&&(r(9),d("routerLink",F(1,He)))}function dt(i,t){i&1&&(n(0,"div",76)(1,"div",77)(2,"div",65)(3,"div",78)(4,"div")(5,"div",46),l(6,"Licencias de Asistencia"),a(),n(7,"div",36),l(8,"Registra permisos para que el docente vea \u201CL\u201D y no pueda modificar esos estudiantes."),a()(),n(9,"a",56),f(10,"i",57),l(11," Gestionar licencias "),a()()()()()),i&2&&(r(9),d("routerLink",F(1,ke)))}function ct(i,t){if(i&1&&(n(0,"div",81),l(1),a()),i&2){let e=c(3);r(),v(e.errorClave)}}function ut(i,t){if(i&1){let e=b();n(0,"div",43)(1,"div",65)(2,"div",45)(3,"div",66),l(4,"Hoja de Vida (vista)"),a(),n(5,"quill-editor",82),C("ngModelChange",function(s){_(e);let u=c(3);return y(u.datasesion.usuario.hojadevida,s)||(u.datasesion.usuario.hojadevida=s),p(s)}),a()()()()}if(i&2){let e=c(3);r(5),d("modules",e._tools.modulesQuillShow),h("ngModel",e.datasesion.usuario.hojadevida)}}function mt(i,t){if(i&1){let e=b();n(0,"div")(1,"div",44)(2,"div",45)(3,"div",42)(4,"div",58),f(5,"img",59),a(),n(6,"div",60)(7,"table",61)(8,"tbody")(9,"tr")(10,"th",62),l(11,"Usuario"),a(),n(12,"td"),l(13),a()(),n(14,"tr")(15,"th"),l(16,"Carnet"),a(),n(17,"td"),l(18),a()(),n(19,"tr")(20,"th"),l(21,"Celular"),a(),n(22,"td"),l(23),a()()()()()(),m(24,lt,12,2,"div",63)(25,dt,12,2,"div",63),f(26,"hr",64),n(27,"div",42)(28,"div",43)(29,"div",65)(30,"div",45)(31,"div",66),l(32,"Cambiar contrase\xF1a"),a(),m(33,ct,2,1,"div",67),n(34,"div",68)(35,"label",69),l(36,"Contrase\xF1a actual"),a(),n(37,"input",70),C("ngModelChange",function(s){_(e);let u=c(2);return y(u.claveActual,s)||(u.claveActual=s),p(s)}),a()(),n(38,"div",68)(39,"label",69),l(40,"Nueva contrase\xF1a"),a(),n(41,"input",71),C("ngModelChange",function(s){_(e);let u=c(2);return y(u.nuevaClave,s)||(u.nuevaClave=s),p(s)}),a()(),n(42,"div",72)(43,"label",69),l(44,"Confirmar nueva contrase\xF1a"),a(),n(45,"input",71),C("ngModelChange",function(s){_(e);let u=c(2);return y(u.confirmarClave,s)||(u.confirmarClave=s),p(s)}),a()(),n(46,"button",73),g("click",function(){_(e);let s=c(2);return p(s.cambiarClave())}),f(47,"i",74),l(48," Cambiar contrase\xF1a "),a()()()(),m(49,ut,6,2,"div",75),a()()()()}if(i&2){let e=c(2);r(5),d("src",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.foto)==null?e.ruta+"fijos/sinperfil.jpg":e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.foto,k),r(8),v((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.usuario)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Usuario)||"\u2014"),r(5),v((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.carnet)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Carnet)||"\u2014"),r(5),v((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.celular)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Celular)||"\u2014"),r(),d("ngIf",e.esEstudiante),r(),d("ngIf",e.esAdministrativo),r(8),d("ngIf",e.errorClave),r(4),h("ngModel",e.claveActual),r(4),h("ngModel",e.nuevaClave),r(4),h("ngModel",e.confirmarClave),r(4),d("ngIf",!e.esEstudiante)}}function _t(i,t){i&1&&(n(0,"div",89),f(1,"div",7),n(2,"div"),l(3,"Procesando\u2026"),a()())}function pt(i,t){if(i&1&&(n(0,"div",94),f(1,"img",97),n(2,"div",53),l(3,"Si no puedes escanear, usa este secreto:"),a(),n(4,"div",98),l(5),a()()),i&2){let e=c(5);r(),d("src",e.twofaQrDataUrl,k),r(4),v(e.twofaSecret||"\u2014")}}function ft(i,t){if(i&1){let e=b();n(0,"div",43)(1,"div",90)(2,"div",45)(3,"div",66),l(4,"Vincular Google Authenticator"),a(),n(5,"ol",91)(6,"li"),l(7,"Instala Google Authenticator en tu celular."),a(),n(8,"li"),l(9,"Presiona \u201CGenerar QR\u201D."),a(),n(10,"li"),l(11,"Escanea el QR y escribe el c\xF3digo de 6 d\xEDgitos para confirmar."),a()(),n(12,"button",92),g("click",function(){_(e);let s=c(4);return p(s.generarQrTwofa())}),l(13," Generar QR "),a(),m(14,pt,6,2,"div",93),n(15,"div",94)(16,"label",69),l(17,"C\xF3digo (6 d\xEDgitos)"),a(),n(18,"input",95),C("ngModelChange",function(s){_(e);let u=c(4);return y(u.twofaCode,s)||(u.twofaCode=s),p(s)}),a()(),n(19,"button",96),g("click",function(){_(e);let s=c(4);return p(s.confirmarVinculoTwofa())}),l(20," Confirmar vinculaci\xF3n "),a()()()()}if(i&2){let e=c(4);r(14),d("ngIf",e.twofaQrDataUrl),r(4),h("ngModel",e.twofaCode),r(),d("disabled",!e.twofaSecret)}}function vt(i,t){if(i&1&&(n(0,"div",36),l(1),se(2,"date"),a()),i&2){let e=c(5);r(),S("Confirmado: ",le(2,1,e.twofaConfirmedAt,"medium"))}}function gt(i,t){i&1&&(n(0,"div",36),l(1,"Confirmado: \u2014"),a())}function xt(i,t){if(i&1){let e=b();n(0,"div",43)(1,"div",90)(2,"div",45)(3,"div",66),l(4,"Google Authenticator vinculado"),a(),m(5,vt,3,4,"div",54)(6,gt,2,0,"div",54),f(7,"hr"),n(8,"div",68)(9,"label",69),l(10,"C\xF3digo para desvincular"),a(),n(11,"input",95),C("ngModelChange",function(s){_(e);let u=c(4);return y(u.twofaDisableCode,s)||(u.twofaDisableCode=s),p(s)}),a()(),n(12,"button",99),g("click",function(){_(e);let s=c(4);return p(s.desvincularTwofa())}),l(13," Desvincular "),a()()()()}if(i&2){let e=c(4);r(5),d("ngIf",e.twofaConfirmedAt),r(),d("ngIf",!e.twofaConfirmedAt),r(5),h("ngModel",e.twofaDisableCode)}}function bt(i,t){if(i&1&&(n(0,"div",42),m(1,ft,21,3,"div",75)(2,xt,14,3,"div",75),a()),i&2){let e=c(3);r(),d("ngIf",!e.twofaEnabled),r(),d("ngIf",e.twofaEnabled)}}function ht(i,t){if(i&1&&(n(0,"div")(1,"div",44)(2,"div",45)(3,"div",83)(4,"div")(5,"div",84),l(6,"Seguridad"),a(),n(7,"div",32),l(8,"Vincula Google Authenticator para recuperar tu contrase\xF1a."),a()(),n(9,"span",85),l(10),a()(),f(11,"hr",86),m(12,_t,4,0,"div",87)(13,bt,3,2,"div",88),a()()()),i&2){let e=c(2);r(9),d("ngClass",e.twofaEnabled?"bg-success":"bg-secondary"),r(),S(" ",e.twofaEnabled?"VINCULADO":"NO VINCULADO"," "),r(2),d("ngIf",e.twofaLoading),r(),d("ngIf",!e.twofaLoading)}}function yt(i,t){if(i&1){let e=b();n(0,"div")(1,"button",119),g("click",function(){let s=_(e).$implicit,u=c(3);return p(u.toggleFilter("curso",s))}),l(2),a()()}if(i&2){let e=t.$implicit,o=c(3);r(),d("ngClass",j(2,X,!o.filterCursos.includes(e),o.filterCursos.includes(e))),r(),v(e)}}function Ct(i,t){if(i&1){let e=b();n(0,"div")(1,"button",119),g("click",function(){let s=_(e).$implicit,u=c(3);return p(u.toggleFilter("paralelo",s))}),l(2),a()()}if(i&2){let e=t.$implicit,o=c(3);r(),d("ngClass",j(2,X,!o.filterParalelos.includes(e),o.filterParalelos.includes(e))),r(),v(e)}}function wt(i,t){if(i&1){let e=b();n(0,"div")(1,"button",119),g("click",function(){let s=_(e).$implicit,u=c(3);return p(u.toggleFilter("turno",s))}),l(2),a()()}if(i&2){let e=t.$implicit,o=c(3);r(),d("ngClass",j(2,X,!o.filterTurnos.includes(e),o.filterTurnos.includes(e))),r(),v(e)}}function St(i,t){if(i&1){let e=b();n(0,"div")(1,"button",119),g("click",function(){let s=_(e).$implicit,u=c(3);return p(u.toggleFilter("docente",s))}),l(2),a()()}if(i&2){let e=t.$implicit,o=c(3);r(),d("ngClass",j(2,X,!o.filterDocentes.includes(e),o.filterDocentes.includes(e))),r(),v(e)}}function Et(i,t){if(i&1&&(n(0,"div",41),l(1),a()),i&2){let e=c(3);r(),v(e.materiasError)}}function It(i,t){i&1&&(n(0,"div",120),f(1,"div",7),n(2,"div"),l(3,"Cargando materias\u2026"),a()())}function Pt(i,t){i&1&&(n(0,"div",121),l(1," No hay materias para mostrar. "),a())}function Mt(i,t){if(i&1&&f(0,"img",127),i&2){let e=c().$implicit,o=c(3);d("src",o.ruta+e.institucion_logo,k)("alt",e==null?null:e.institucion_nombre)}}function Tt(i,t){if(i&1&&(n(0,"span",144),l(1),a()),i&2){let e=c().$implicit;r(),v(e.estado)}}function kt(i,t){if(i&1&&(n(0,"div",145)(1,"div",36),l(2,"Prom: "),n(3,"span",37),l(4),a()(),n(5,"div",36),l(6,"Recup: "),n(7,"span",37),l(8),a()()()),i&2){let e=c().$implicit;r(4),v(e.promedio??"\u2014"),r(4),v(e.recuperacion??"\u2014")}}function Vt(i,t){if(i&1&&(n(0,"a",146),f(1,"i",147),l(2," LChaula "),a()),i&2){let e=c().$implicit;d("routerLink",w(1,Ve,e.raw==null?null:e.raw.materia_id))}}function Ft(i,t){if(i&1&&(n(0,"a",148),f(1,"i",149),l(2," Calificaciones "),a()),i&2){let e=c().$implicit;d("routerLink",F(2,Fe))("queryParams",w(3,Ne,e.raw==null?null:e.raw.materia_id))}}function Nt(i,t){if(i&1&&(n(0,"a",150),f(1,"i",151),l(2," Asistencias "),a()),i&2){let e=c().$implicit;d("routerLink",w(1,Le,e.raw==null?null:e.raw.materia_id))}}function Lt(i,t){if(i&1&&(n(0,"div",132)(1,"div",133)(2,"div",134)(3,"div",135)(4,"div")(5,"div",37),l(6),a(),n(7,"div",36),l(8),a()(),m(9,Tt,2,1,"span",136),a(),n(10,"div",36)(11,"div")(12,"span",37),l(13,"Curso:"),a(),l(14),a(),n(15,"div")(16,"span",37),l(17,"Turno:"),a(),l(18),a()(),n(19,"div",137),f(20,"img",138),n(21,"div",36),l(22,"Docente: "),n(23,"span",37),l(24),a()()(),m(25,kt,9,2,"div",139),n(26,"div",140),m(27,Vt,3,3,"a",141)(28,Ft,3,5,"a",142)(29,Nt,3,3,"a",143),a()()()()),i&2){let e=t.$implicit,o=c(3).$implicit,s=c(3);r(),te("border-left-color",o.color||""),r(5),v(e.materiaNombre),r(2),S("Sigla: ",e.materiaSigla),r(),d("ngIf",e.estado),r(5),D(" ",e.curso," ",e.paralelo),r(4),S(" ",e.turno),r(2),d("src",e.docenteFotoUrl,k),r(4),v(e.docenteNombre),r(),d("ngIf",s.esEstudiante),r(2),d("ngIf",e.acciones.puedeLChaula),r(),d("ngIf",e.acciones.puedeCalificaciones),r(),d("ngIf",e.acciones.puedeAsistencias)}}function At(i,t){if(i&1&&(n(0,"div",42),m(1,Lt,30,14,"div",131),a()),i&2){let e=c().$implicit,o=c(4);r(),d("ngForOf",e.items)("ngForTrackBy",o.trackByMateria)}}function Ot(i,t){i&1&&(n(0,"th",157),l(1,"Notas"),a())}function Dt(i,t){if(i&1&&(n(0,"div",161)(1,"span",144),l(2),a()()),i&2){let e=c().$implicit;r(2),v(e.estado)}}function jt(i,t){if(i&1&&(n(0,"td",157)(1,"div",36),l(2,"Prom: "),n(3,"span",37),l(4),a()(),n(5,"div",36),l(6,"Recup: "),n(7,"span",37),l(8),a()()()),i&2){let e=c().$implicit;r(4),v(e.promedio??"\u2014"),r(4),v(e.recuperacion??"\u2014")}}function Rt(i,t){if(i&1&&(n(0,"a",146),f(1,"i",147),l(2," LChaula "),a()),i&2){let e=c().$implicit;d("routerLink",w(1,Ve,e.raw==null?null:e.raw.materia_id))}}function Bt(i,t){if(i&1&&(n(0,"a",148),f(1,"i",149),l(2," Calificaciones "),a()),i&2){let e=c().$implicit;d("routerLink",F(2,Fe))("queryParams",w(3,Ne,e.raw==null?null:e.raw.materia_id))}}function Wt(i,t){if(i&1&&(n(0,"a",150),f(1,"i",151),l(2," Asistencias "),a()),i&2){let e=c().$implicit;d("routerLink",w(1,Le,e.raw==null?null:e.raw.materia_id))}}function Ut(i,t){if(i&1&&(n(0,"tr")(1,"td")(2,"div",37),l(3),a(),n(4,"div",36),l(5),a(),m(6,Dt,3,1,"div",158),a(),n(7,"td")(8,"div",159),l(9),a()(),n(10,"td")(11,"div",159),l(12),a()(),n(13,"td")(14,"div",137),f(15,"img",138),n(16,"div",159),l(17),a()()(),m(18,jt,9,2,"td",155),n(19,"td",156)(20,"div",160),m(21,Rt,3,3,"a",141)(22,Bt,3,5,"a",142)(23,Wt,3,3,"a",143),a()()()),i&2){let e=t.$implicit,o=c(6);r(3),v(e.materiaNombre),r(2),S("Sigla: ",e.materiaSigla),r(),d("ngIf",e.estado),r(3),D("",e.curso," ",e.paralelo),r(3),v(e.turno),r(3),d("src",e.docenteFotoUrl,k),r(2),v(e.docenteNombre),r(),d("ngIf",o.esEstudiante),r(3),d("ngIf",e.acciones.puedeLChaula),r(),d("ngIf",e.acciones.puedeCalificaciones),r(),d("ngIf",e.acciones.puedeAsistencias)}}function qt(i,t){if(i&1&&(n(0,"div",152)(1,"table",153)(2,"thead",154)(3,"tr")(4,"th"),l(5,"Materia"),a(),n(6,"th"),l(7,"Curso / Paralelo"),a(),n(8,"th"),l(9,"Turno"),a(),n(10,"th"),l(11,"Docente"),a(),m(12,Ot,2,0,"th",155),n(13,"th",156),l(14,"Acciones"),a()()(),n(15,"tbody"),m(16,Ut,24,12,"tr",126),a()()()),i&2){let e=c().$implicit,o=c(4);r(12),d("ngIf",o.esEstudiante),r(4),d("ngForOf",e.items)("ngForTrackBy",o.trackByMateria)}}function Ht(i,t){if(i&1&&(ae(0),n(1,"div",72)(2,"div",128)(3,"div",46),l(4),a(),n(5,"span",129),l(6),a()(),m(7,At,2,2,"div",88)(8,qt,17,3,"div",130),a(),re()),i&2){let e=t.$implicit,o=c(4);r(4),S("Gesti\xF3n: ",e.gestion),r(2),v((e.items||F(4,Qe)).length),r(),d("ngIf",o.materiasViewMode==="bonito"),r(),d("ngIf",o.materiasViewMode==="tabla")}}function Qt(i,t){if(i&1&&(n(0,"div",122)(1,"div",44)(2,"div",123),m(3,Mt,1,2,"img",124),n(4,"div",46),l(5),a(),n(6,"span",125),l(7),a()(),n(8,"div",45),m(9,Ht,9,5,"ng-container",126),a()()()),i&2){let e=t.$implicit,o=c(3);r(2),te("background",e.color||"")("color",e.textColor||""),r(),d("ngIf",e==null?null:e.institucion_logo),r(2),v((e==null?null:e.institucion_nombre)||"INSTITUCI\xD3N"),r(2),v((e==null?null:e.totalItems)||0),r(2),d("ngForOf",e.gestiones)("ngForTrackBy",o.trackByGestion)}}function Gt(i,t){if(i&1){let e=b();n(0,"div")(1,"div",100)(2,"div",101),l(3,"Mis Materias"),a(),n(4,"div",102)(5,"div",103)(6,"button",104),g("click",function(){_(e);let s=c(2);return p(s.materiasViewMode="bonito")}),l(7," Bonito "),a(),n(8,"button",104),g("click",function(){_(e);let s=c(2);return p(s.materiasViewMode="tabla")}),l(9," Tabla "),a()(),n(10,"button",105),g("click",function(){_(e);let s=c(2);return p(s.cargarMaterias())}),l(11,"Recargar"),a()()(),n(12,"div",106)(13,"div",45)(14,"div",107)(15,"div",108)(16,"input",109),C("ngModelChange",function(s){_(e);let u=c(2);return y(u.filterQuery,s)||(u.filterQuery=s),p(s)}),g("ngModelChange",function(){_(e);let s=c(2);return p(s.onFiltersChange())}),a()(),n(17,"div",110)(18,"div",111)(19,"div",112),l(20,"Curso:"),a(),m(21,yt,3,5,"div",113),n(22,"div",114),l(23,"Paralelos:"),a(),m(24,Ct,3,5,"div",113),n(25,"div",114),l(26,"Turnos:"),a(),m(27,wt,3,5,"div",113),n(28,"div",114),l(29,"Docentes:"),a(),m(30,St,3,5,"div",113),n(31,"button",115),g("click",function(){_(e);let s=c(2);return p(s.clearFilters())}),l(32,"Limpiar filtros"),a()()()()()(),m(33,Et,2,1,"div",29)(34,It,4,0,"div",116)(35,Pt,2,0,"div",117)(36,Qt,10,9,"div",118),a()}if(i&2){let e=c(2);r(6),d("ngClass",e.materiasViewMode==="bonito"?"btn-secondary":"btn-outline-secondary"),r(2),d("ngClass",e.materiasViewMode==="tabla"?"btn-secondary":"btn-outline-secondary"),r(2),d("disabled",e.materiasLoading),r(6),h("ngModel",e.filterQuery),r(5),d("ngForOf",e.uniqueCursos),r(3),d("ngForOf",e.uniqueParalelos),r(3),d("ngForOf",e.uniqueTurnos),r(3),d("ngForOf",e.uniqueDocentes),r(3),d("ngIf",e.materiasError),r(),d("ngIf",e.materiasLoading),r(),d("ngIf",!e.materiasLoading&&(!e.materiasRender||e.materiasRender.length===0)),r(),d("ngForOf",e.materiasRender)("ngForTrackBy",e.trackByInstitucion)}}function zt(i,t){if(i&1&&(n(0,"div",41),l(1),a()),i&2){let e=c(3);r(),v(e.deudasError)}}function $t(i,t){i&1&&(n(0,"div",120),f(1,"div",7),n(2,"div"),l(3,"Cargando deudas\u2026"),a()())}function Jt(i,t){i&1&&(n(0,"div",121),l(1," No hay deudas para mostrar. "),a())}function Kt(i,t){if(i&1&&f(0,"img",165),i&2){let e=c().$implicit,o=c(3);d("src",o.ruta+e.institucion_logo,k)("alt",e==null?null:e.institucion_nombre)}}function Xt(i,t){if(i&1&&(n(0,"div",46),l(1),a()),i&2){let e=c().$implicit;r(),S(" ",e==null||e.meses_deuda==null?null:e.meses_deuda.join(", ")," ")}}function Yt(i,t){i&1&&(n(0,"span",170),l(1,"Sin deuda"),a())}function Zt(i,t){if(i&1&&(n(0,"div",167)(1,"div",44)(2,"div",45)(3,"div",32),l(4),a(),n(5,"div",168)(6,"div",36),l(7,"Meses deuda"),a(),m(8,Xt,2,1,"div",169)(9,Yt,2,0,"ng-template",null,0,de),a()()()()),i&2){let e=t.$implicit,o=oe(10);r(4),D("Inscripci\xF3n: #",e==null?null:e.infoestudiantesifas_id," \u2022 Cohorte: ",e==null?null:e.anio_asignacion),r(4),d("ngIf",e==null||e.meses_deuda==null?null:e.meses_deuda.length)("ngIfElse",o)}}function ei(i,t){if(i&1&&(n(0,"div",72)(1,"div",128)(2,"div",46),l(3),a(),n(4,"span",129),l(5),a()(),n(6,"div",42),m(7,Zt,11,4,"div",166),a()()),i&2){let e=t.$implicit,o=c(4);r(3),S("Gesti\xF3n: ",e.gestion),r(2),v(e.items.length),r(2),d("ngForOf",e.items)("ngForTrackBy",o.trackByDeudaItem)}}function ti(i,t){if(i&1&&(n(0,"div",122)(1,"div",162),m(2,Kt,1,2,"img",163),n(3,"div",46),l(4),a()(),m(5,ei,8,4,"div",164),a()),i&2){let e=t.$implicit,o=c(3);r(2),d("ngIf",e==null?null:e.institucion_logo),r(2),v((e==null?null:e.institucion_nombre)||"INSTITUCI\xD3N"),r(),d("ngForOf",e.gestiones)("ngForTrackBy",o.trackByGestion)}}function ii(i,t){if(i&1){let e=b();n(0,"div")(1,"div",100)(2,"div",84),l(3,"Mis Deudas"),a(),n(4,"button",105),g("click",function(){_(e);let s=c(2);return p(s.cargarDeudas())}),l(5,"Recargar"),a()(),m(6,zt,2,1,"div",29)(7,$t,4,0,"div",116)(8,Jt,2,0,"div",117)(9,ti,6,4,"div",118),a()}if(i&2){let e=c(2);r(4),d("disabled",e.deudasLoading),r(2),d("ngIf",e.deudasError),r(),d("ngIf",e.deudasLoading),r(),d("ngIf",!e.deudasLoading&&(!e.deudasPorInstitucion||e.deudasPorInstitucion.length===0)),r(),d("ngForOf",e.deudasRender)("ngForTrackBy",e.trackByInstitucion)}}function ni(i,t){if(i&1&&(n(0,"div"),f(1,"app-bibliotecaarchivoslcch",171),a()),i&2){let e=c(2);r(),d("modoEmbed",!0)("soloPlan",e.esDocente)}}function ai(i,t){if(i&1){let e=b();n(0,"div",9)(1,"div",10)(2,"button",11),g("click",function(){_(e);let s=c();return p(s.toggleMenu())}),l(3,"\u2630"),a(),n(4,"div",12),m(5,$e,5,1,"div",13),n(6,"ul",14)(7,"li",15)(8,"button",16),g("click",function(){_(e);let s=c();return p(s.setTab("home"))}),f(9,"i",17),m(10,Je,2,0,"span",18),a()(),n(11,"li",19)(12,"button",16),g("click",function(){_(e);let s=c();return p(s.setTab("cuenta"))}),f(13,"i",20),m(14,Ke,2,0,"span",18),a()(),n(15,"li",19)(16,"button",16),g("click",function(){_(e);let s=c();return p(s.setTab("seguridad"))}),f(17,"i",21),m(18,Xe,2,0,"span",18),a()(),n(19,"li",19)(20,"button",16),g("click",function(){_(e);let s=c();return p(s.setTab("misMaterias"))}),f(21,"i",22),m(22,Ye,2,0,"span",18),a()(),m(23,et,4,6,"li",23)(24,it,4,6,"li",23),a(),f(25,"hr"),a()(),n(26,"div",24)(27,"button",25),g("click",function(){_(e);let s=c();return p(s.toggleMenu())}),f(28,"i",26),a()(),n(29,"div",27)(30,"div",28),m(31,nt,2,1,"div",29),n(32,"div",30)(33,"div")(34,"div",31),l(35),a(),n(36,"div",32),l(37),a()(),n(38,"span",33),l(39),a()(),m(40,st,24,4,"div",34)(41,mt,50,11,"div",34)(42,ht,14,4,"div",34)(43,Gt,37,13,"div",34)(44,ii,10,6,"div",34)(45,ni,2,2,"div",34),a()()()}if(i&2){let e=c();r(),d("ngClass",j(31,qe,!e.menuOpen,!e.menuOpen)),r(4),d("ngIf",e.datasesion==null?null:e.datasesion.nameInst),r(2),d("ngClass",w(34,B,e.activeTab==="home")),r(),V("active",e.activeTab==="home"),r(2),d("ngIf",e.menuOpen),r(),d("ngClass",w(36,B,e.activeTab==="cuenta")),r(),V("active",e.activeTab==="cuenta"),r(2),d("ngIf",e.menuOpen),r(),d("ngClass",w(38,B,e.activeTab==="seguridad")),r(),V("active",e.activeTab==="seguridad"),r(2),d("ngIf",e.menuOpen),r(),d("ngClass",w(40,B,e.activeTab==="misMaterias")),r(),V("active",e.activeTab==="misMaterias"),r(2),d("ngIf",e.menuOpen),r(),d("ngIf",e.esDocente||e.esAdministrativo||e.esSuper),r(),d("ngIf",e.esEstudiante),r(7),d("ngIf",e.perfilError),r(4),D("",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.nombres)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Nombres)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Nombre)," ",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.apellidos)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Apellidos)||""),r(2),S("Rol: ",e.tipoSesion),r(2),v((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.estado)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Estado)||"ACTIVO"),r(),d("ngIf",e.activeTab==="home"),r(),d("ngIf",e.activeTab==="cuenta"),r(),d("ngIf",e.activeTab==="seguridad"),r(),d("ngIf",e.activeTab==="misMaterias"),r(),d("ngIf",e.activeTab==="deudas"&&e.esEstudiante),r(),d("ngIf",e.activeTab==="misPlanes")}}function ri(i,t){i&1&&f(0,"span",186)}function oi(i,t){if(i&1){let e=b();n(0,"div",172)(1,"div",173)(2,"div",174)(3,"div",175)(4,"h5",176),l(5,"Modificar materia"),a(),n(6,"button",177),g("click",function(){_(e);let s=c();return p(s.cerrarEdicionMateria())}),a()(),n(7,"div",178)(8,"div",68)(9,"div",46),l(10),a(),n(11,"div",32),l(12),a()(),n(13,"div",179)(14,"div",180)(15,"label",69),l(16,"Paralelo"),a(),n(17,"input",181),C("ngModelChange",function(s){_(e);let u=c();return y(u.editMateriaPayload.Paralelo,s)||(u.editMateriaPayload.Paralelo=s),p(s)}),a()(),n(18,"div",180)(19,"label",69),l(20,"Turno"),a(),n(21,"input",181),C("ngModelChange",function(s){_(e);let u=c();return y(u.editMateriaPayload.Turno,s)||(u.editMateriaPayload.Turno=s),p(s)}),a()(),n(22,"div",77)(23,"label",69),l(24,"Modo asistencia"),a(),n(25,"input",181),C("ngModelChange",function(s){_(e);let u=c();return y(u.editMateriaPayload.ModoAsistencia,s)||(u.editMateriaPayload.ModoAsistencia=s),p(s)}),a()(),n(26,"div",77)(27,"label",69),l(28,"Estado habilitaci\xF3n"),a(),n(29,"input",181),C("ngModelChange",function(s){_(e);let u=c();return y(u.editMateriaPayload.EstadoHabilitacion,s)||(u.editMateriaPayload.EstadoHabilitacion=s),p(s)}),a()(),n(30,"div",77)(31,"label",69),l(32,"Estado env\xEDo"),a(),n(33,"input",181),C("ngModelChange",function(s){_(e);let u=c();return y(u.editMateriaPayload.EstadoEnvio,s)||(u.editMateriaPayload.EstadoEnvio=s),p(s)}),a()()()(),n(34,"div",182)(35,"button",183),g("click",function(){_(e);let s=c();return p(s.cerrarEdicionMateria())}),l(36,"Cancelar"),a(),n(37,"button",184),g("click",function(){_(e);let s=c();return p(s.guardarEdicionMateria())}),m(38,ri,1,0,"span",185),l(39," Guardar "),a()()()()()}if(i&2){let e=c();r(10),D("",e.editMateria==null?null:e.editMateria.sigla_materia," \u2014 ",e.editMateria==null?null:e.editMateria.nombre_materia),r(2),v(e.editMateria==null?null:e.editMateria.lvl_curso),r(5),h("ngModel",e.editMateriaPayload.Paralelo),r(4),h("ngModel",e.editMateriaPayload.Turno),r(4),h("ngModel",e.editMateriaPayload.ModoAsistencia),r(4),h("ngModel",e.editMateriaPayload.EstadoHabilitacion),r(4),h("ngModel",e.editMateriaPayload.EstadoEnvio),r(2),d("disabled",e.editSaving),r(2),d("disabled",e.editSaving),r(),d("ngIf",e.editSaving)}}var W=class W{constructor(t,e,o,s,u,x,E){this.router=t;this._auth=e;this._perfil=o;this._tools=s;this._security=u;this._asistencias=x;this._lchaulaAulas=E;this.ruta=R.ruta;this.infoHJVida="";this.apunteSeleccionado="";this.datasesion=null;this.perfilLoading=!0;this.perfilError="";this.activeTab="home";this.menuOpen=!0;this.twofaLoading=!1;this.twofaEnabled=!1;this.twofaConfirmedAt=null;this.twofaSecret="";this.twofaOtpAuthUrl="";this.twofaQrDataUrl="";this.twofaCode="";this.twofaDisableCode="";this.materiasLoading=!1;this.materiasPorInstitucion=[];this.materiasError="";this.materiasViewMode="bonito";this.materiasRender=[];this.uniqueParalelos=[];this.uniqueTurnos=[];this.uniqueCursos=[];this.uniqueDocentes=[];this.deudasLoading=!1;this.deudasPorInstitucion=[];this.deudasError="";this.deudasRender=[];this.editMateriaOpen=!1;this.editMateria=null;this.editMateriaPayload={Paralelo:"",Turno:"",ModoAsistencia:"",EstadoHabilitacion:"",EstadoEnvio:""};this.editSaving=!1;this.filterQuery="";this.filterParalelos=[];this.filterTurnos=[];this.filterCursos=[];this.filterDocentes=[];this.claveActual="";this.nuevaClave="";this.confirmarClave="";this.errorClave="";this.mostrarModalCambioClave=!1}buildMateriaViewItem(t){let e=t,o=this.docenteNombre(e),s=this.fotoUrl(e?.docente_foto),u={puedeCalificaciones:!this.esEstudiante,puedeRegistro:!this.esEstudiante,puedeAsistencias:this.mostrarBtnAsistencias(e),puedeLChaula:this.esDocente||this.esAdministrativo||this.esSuper||this.esEstudiante,puedeModificar:this.esDocente};return{raw:e,materiaNombre:(e?.nombre_materia??"\u2014").toString(),materiaSigla:(e?.sigla_materia??"\u2014").toString(),curso:(e?.lvl_curso??"\u2014").toString(),paralelo:(e?.materia_paralelo??"").toString(),turno:(e?.materia_turno??"\u2014").toString(),estado:(e?.EstadoRegistroMateria??e?.materia_estado_habilitacion??"").toString(),docenteNombre:o,docenteFotoUrl:s,promedio:e?.Promedio??null,recuperacion:e?.PruebaRecuperacion??null,acciones:u,materiaId:Number(e?.materia_id)||null}}ngOnInit(){this.PedirInformacionPerfil()}setTab(t){this.activeTab=t,t==="misMaterias"&&this.cargarMaterias(),t==="deudas"&&this.cargarDeudas()}get tipoSesion(){return(this.datasesion?.tipo??"").toString()}get esDocente(){return this.tipoSesion==="planteldocentes"}get esEstudiante(){return this.tipoSesion==="estudiantesifas"}get esAdministrativo(){return this.tipoSesion==="planteladministrativos"}get esSuper(){return this.tipoSesion==="superlcchs"}normalizarTexto(t){return(t??"").toString().trim()}normModoAsistencia(t){let e=this.normalizarTexto(t);return!e||e.toLowerCase()==="null"||e.toLowerCase()==="undefined"?"NORMAL":e.toUpperCase()}mostrarBtnAsistencias(t){return this.esDocente?this.normModoAsistencia(t?.materia_modo_asistencia)!=="NORMAL":!1}abrirAsistenciasMateria(t){if(!this.esDocente)return;let e=Number(t?.materia_id);if(!e||Number.isNaN(e)||e<=0){this._tools.MensajeInformacion("Materia inv\xE1lida","No se pudo abrir asistencias.","warning");return}if(this.normModoAsistencia(t?.materia_modo_asistencia)==="NORMAL"){this._tools.MensajeInformacion("Modo NORMAL","Esta materia no usa asistencias.","info");return}this.router.navigate(["/asistenciasestudiantes/materia",e])}docenteNombre(t){let e=this.normalizarTexto(t?.docente_nombre);return e!==""?e:"SIN DOCENTE"}fotoUrl(t){let e=this.normalizarTexto(t);if(e===""||e.toLowerCase()==="null"||e.toLowerCase()==="undefined")return this.ruta+"fijos/sinperfil.jpg";let o=e.toLowerCase();return o.startsWith("http://")||o.startsWith("https://")||o.startsWith("data:")?e:this.ruta+e}agruparPorGestion(t){let e=new Map;(t??[]).forEach(s=>{let u=this.normalizarTexto(s?.gestion)||"SIN GESTI\xD3N";e.has(u)||e.set(u,[]),e.get(u).push(s)});let o=Array.from(e.keys());return o.sort((s,u)=>{let x=Number(s),E=Number(u),P=!Number.isNaN(x)&&s!=="SIN GESTI\xD3N",I=!Number.isNaN(E)&&u!=="SIN GESTI\xD3N";return P&&I?E-x:P&&!I?-1:!P&&I?1:s.localeCompare(u)}),o.map(s=>({gestion:s,items:e.get(s)??[]}))}PedirInformacionPerfil(){this.perfilLoading=!0,this.perfilError="",this._auth.pedirPerfil().subscribe({next:t=>{this.datasesion=t,this.infoHJVida=this.datasesion?.usuario?.hojadevida??"",this.perfilLoading=!1,this.cargarTwofaStatus(),this.cargarMaterias(),this.esEstudiante&&this.cargarDeudas()},error:t=>{console.error("Error al obtener el perfil:",t),this.perfilLoading=!1,this.perfilError="No se pudo cargar el perfil."}})}cargarTwofaStatus(){this.datasesion&&(this.twofaLoading||(this.twofaLoading=!0,this._security.get2faStatus().subscribe({next:t=>{this.twofaEnabled=!!t?.enabled,this.twofaConfirmedAt=t?.confirmed_at??null,this.twofaLoading=!1},error:t=>{console.log("Error 2FA status",t),this.twofaLoading=!1}})))}generarQrTwofa(){return ee(this,null,function*(){this.twofaLoading||(this.twofaLoading=!0,this.twofaSecret="",this.twofaOtpAuthUrl="",this.twofaQrDataUrl="",this.twofaCode="",this._security.startEnroll2fa().subscribe({next:t=>ee(this,null,function*(){this.twofaSecret=t?.secret??"",this.twofaOtpAuthUrl=t?.otpauth_url??"";try{this.twofaOtpAuthUrl&&(this.twofaQrDataUrl=yield Te.default.toDataURL(this.twofaOtpAuthUrl,{width:220,margin:1}))}catch(e){console.log("Error generando QR",e),this.twofaQrDataUrl=""}this.twofaLoading=!1,this._tools.MensajeInformacion("Seguridad","QR generado. Escan\xE9alo con Google Authenticator.","info")}),error:t=>{this.twofaLoading=!1;let e=t?.error?.message||"No se pudo generar el QR.";this._tools.MensajeInformacion("Error",e,"error")}}))})}confirmarVinculoTwofa(){if(!this.twofaLoading){if(!this.twofaCode||this.twofaCode.trim()===""){this._tools.MensajeInformacion("Falta c\xF3digo","Ingresa el c\xF3digo de 6 d\xEDgitos.","warning");return}this.twofaLoading=!0,this._security.confirmEnroll2fa(this.twofaCode).subscribe({next:t=>{this.twofaLoading=!1,this.twofaEnabled=!0,this.twofaConfirmedAt=t?.confirmed_at??null,this.twofaCode="",this._tools.MensajeInformacion("\xC9xito","Google Authenticator vinculado.","success")},error:t=>{this.twofaLoading=!1;let e=t?.error?.message||"No se pudo confirmar el c\xF3digo.";this._tools.MensajeInformacion("Error",e,"error")}})}}desvincularTwofa(){if(!this.twofaLoading){if(!this.twofaDisableCode||this.twofaDisableCode.trim()===""){this._tools.MensajeInformacion("Falta c\xF3digo","Ingresa el c\xF3digo para desvincular.","warning");return}this.twofaLoading=!0,this._security.disable2fa(this.twofaDisableCode).subscribe({next:()=>{this.twofaLoading=!1,this.twofaEnabled=!1,this.twofaConfirmedAt=null,this.twofaSecret="",this.twofaOtpAuthUrl="",this.twofaQrDataUrl="",this.twofaDisableCode="",this._tools.MensajeInformacion("OK","Google Authenticator desvinculado.","success")},error:t=>{this.twofaLoading=!1;let e=t?.error?.message||"No se pudo desvincular.";this._tools.MensajeInformacion("Error",e,"error")}})}}toggleMenu(){this.menuOpen=!this.menuOpen}cargarMaterias(){this.datasesion&&(this.materiasLoading||(this.materiasLoading=!0,this.materiasError="",this._perfil.obtenerMaterias().subscribe({next:t=>{this.materiasPorInstitucion=Array.isArray(t?.data)?t.data:[],this.rebuildMateriasOptions(),this.rebuildMateriasRender(),this.materiasLoading=!1},error:t=>{console.log("Error al cargar materias de perfil",t),this.materiasLoading=!1,this.materiasError="No se pudo cargar la lista de materias.",this.materiasPorInstitucion=[],this.materiasRender=[],this.uniqueCursos=[],this.uniqueParalelos=[],this.uniqueTurnos=[],this.uniqueDocentes=[]}})))}cargarDeudas(){!this.datasesion||!this.esEstudiante||this.deudasLoading||(this.deudasLoading=!0,this.deudasError="",this._perfil.obtenerDeudas().subscribe({next:t=>{this.deudasPorInstitucion=Array.isArray(t?.data)?t.data:[],this.rebuildDeudasRender(),this.deudasLoading=!1},error:t=>{console.log("Error al cargar deudas de perfil",t),this.deudasLoading=!1,this.deudasError="No se pudo cargar las deudas.",this.deudasPorInstitucion=[],this.deudasRender=[]}}))}rebuildDeudasRender(){let t=[];(this.deudasPorInstitucion??[]).forEach(e=>{let o=(e?.institucion_nombre||"INSTITUCI\xD3N").toString(),s=e?.institucion_logo?e.institucion_logo:null,u=this.agruparPorGestion(e?.items??[]).map(x=>({gestion:x.gestion,items:x.items??[]}));t.push({institucion_nombre:o,institucion_logo:s,gestiones:u})}),this.deudasRender=t}abrirEdicionMateria(t){this.esDocente&&(this.editMateria=t,this.editMateriaPayload={Paralelo:t?.materia_paralelo??"",Turno:t?.materia_turno??"",ModoAsistencia:t?.materia_modo_asistencia??"",EstadoHabilitacion:t?.materia_estado_habilitacion??"",EstadoEnvio:t?.materia_estado_envio??""},this.editMateriaOpen=!0)}cerrarEdicionMateria(){this.editMateriaOpen=!1,this.editMateria=null,this.editSaving=!1}guardarEdicionMateria(){if(!this.esDocente||!this.editMateria?.materia_id||this.editSaving)return;this.editSaving=!0;let t=Number(this.editMateria.materia_id);this._perfil.actualizarMateriaDocente(t,this.editMateriaPayload).subscribe({next:e=>{let o=e?.data;o&&this.materiasPorInstitucion.forEach(s=>{(s?.items??[]).forEach((u,x)=>{Number(u?.materia_id)===t&&(s.items[x]=Z(Z({},u),o))})}),this.editSaving=!1,this.editMateriaOpen=!1,this._tools.MensajeInformacion("\xC9xito","Materia actualizada.","success")},error:e=>{console.log("Error al actualizar materia",e),this.editSaving=!1;let o=e?.error?.message||"No se pudo actualizar la materia.";this._tools.MensajeInformacion("Error",o,"error")}})}abrirCalificacionesMateria(t){let e=Number(t?.materia_id);if(!e||Number.isNaN(e)||e<=0){this._tools.MensajeInformacion("Materia inv\xE1lida","No se pudo abrir calificaciones.","warning");return}this.router.navigate(["/accionesplanteles/calificaciones"],{queryParams:{materiaId:e}})}abrirLChaulaMateria(t){let e=Number(t?.materia_id);if(!e||Number.isNaN(e)||e<=0){this._tools.MensajeInformacion("Materia inv\xE1lida","No se pudo abrir el aula.","warning");return}let o=this.esDocente||this.esAdministrativo||this.esSuper;this._lchaulaAulas.getByMateria(e,{auto_create:o}).subscribe({next:s=>{let u=Number(s?.aula?.id);if(!u||Number.isNaN(u)||u<=0){this._tools.MensajeInformacion("Error","No se pudo abrir el aula.","error");return}this.router.navigate(["/lchaula/aula",u])},error:s=>{let u=Number(s?.status);if(u===401||u===403){this.router.navigate(["/inicio"]);return}let x=s?.error?.message||"No se pudo abrir el aula.";this._tools.MensajeInformacion("Error",x,"error")}})}abrirRegistroCalificacionesMateria(t){let e=Number(t?.materia_id);if(!e||Number.isNaN(e)||e<=0){this._tools.MensajeInformacion("Materia inv\xE1lida","No se pudo abrir el registro de calificaciones.","warning");return}this.router.navigate(["/accionesplanteles/registrocalificaciones"],{queryParams:{materiaId:e}})}filtrarItems(t){if(!t||t.length===0)return[];let e=(this.filterQuery||"").toString().toLowerCase().trim();return t.filter(o=>{if(this.filterParalelos.length&&!this.filterParalelos.includes((""+(o?.materia_paralelo??"")).toString())||this.filterTurnos.length&&!this.filterTurnos.includes((""+(o?.materia_turno??"")).toString())||this.filterCursos.length&&!this.filterCursos.includes((""+(o?.lvl_curso??"")).toString()))return!1;if(this.filterDocentes.length){let I=this.docenteNombre(o)||"";if(!this.filterDocentes.includes(I))return!1}if(!e)return!0;let s=(o?.nombre_materia??"").toString().toLowerCase(),u=(o?.sigla_materia??"").toString().toLowerCase(),x=(o?.materia_paralelo??"").toString().toLowerCase(),E=(o?.materia_turno??"").toString().toLowerCase(),P=(this.docenteNombre(o)??"").toString().toLowerCase();return s.includes(e)||u.includes(e)||x.includes(e)||E.includes(e)||P.includes(e)})}onFiltersChange(){this.rebuildMateriasRender()}rebuildMateriasOptions(){let t=new Set,e=new Set,o=new Set,s=new Set;(this.materiasPorInstitucion??[]).forEach(u=>{(u?.items??[]).forEach(x=>{let E=(x?.materia_paralelo??"").toString(),P=(x?.materia_turno??"").toString(),I=(x?.lvl_curso??"").toString(),M=this.docenteNombre(x);E&&t.add(E),P&&e.add(P),I&&o.add(I),M&&M!=="SIN DOCENTE"&&s.add(M)})}),this.uniqueParalelos=Array.from(t).sort(),this.uniqueTurnos=Array.from(e).sort(),this.uniqueCursos=Array.from(o).sort(),this.uniqueDocentes=Array.from(s).sort()}rebuildMateriasRender(){let t=[];(this.materiasPorInstitucion??[]).forEach(e=>{let o=(e?.institucion_nombre||"INSTITUCI\xD3N").toString(),s=e?.institucion_logo?e.institucion_logo:null,u=this.getInstitucionColor(e)||"",x=this.getTextColorForBg(u)||"",E=e?.items?.length??0,I=this.agruparPorGestion(e?.items??[]).map(M=>{let Oe=(this.filtrarItems(M.items)??[]).map(De=>this.buildMateriaViewItem(De));return{gestion:M.gestion,items:Oe}}).filter(M=>(M.items??[]).length>0);t.push({institucion_nombre:o,institucion_logo:s,color:u,textColor:x,totalItems:E,gestiones:I})}),this.materiasRender=t}getUniqueParalelos(){let t=new Set;return(this.materiasPorInstitucion??[]).forEach(e=>{(e?.items??[]).forEach(o=>t.add((o?.materia_paralelo??"").toString()))}),Array.from(t).filter(e=>e).sort()}getUniqueCursos(){let t=new Set;return(this.materiasPorInstitucion??[]).forEach(e=>{(e?.items??[]).forEach(o=>t.add((o?.lvl_curso??"").toString()))}),Array.from(t).filter(e=>e).sort()}getUniqueTurnos(){let t=new Set;return(this.materiasPorInstitucion??[]).forEach(e=>{(e?.items??[]).forEach(o=>t.add((o?.materia_turno??"").toString()))}),Array.from(t).filter(e=>e).sort()}getUniqueDocentes(){let t=new Set;return(this.materiasPorInstitucion??[]).forEach(e=>{(e?.items??[]).forEach(o=>t.add(this.docenteNombre(o)))}),Array.from(t).filter(e=>e&&e!=="SIN DOCENTE").sort()}aplicarFiltroPor(t,e){t==="materia"?(this.filterQuery=e??"",this.filterDocentes=[],this.filterParalelos=[],this.filterTurnos=[],this.filterCursos=[]):t==="docente"?(this.toggleFilter("docente",e??""),this.filterQuery=""):t==="paralelo"?this.toggleFilter("paralelo",e??""):t==="turno"&&this.toggleFilter("turno",e??""),this.rebuildMateriasRender()}toggleFilter(t,e){if(!e)return;let o;t==="paralelo"?o=this.filterParalelos:t==="turno"?o=this.filterTurnos:t==="curso"?o=this.filterCursos:o=this.filterDocentes;let s=o.indexOf(e);s>=0?o.splice(s,1):o.push(e),this.rebuildMateriasRender()}clearFilters(){this.filterQuery="",this.filterParalelos=[],this.filterTurnos=[],this.filterCursos=[],this.filterDocentes=[],this.rebuildMateriasRender()}trackByInstitucion(t,e){return e?.institucion_nombre??t}trackByGestion(t,e){return e?.gestion??t}trackByMateria(t,e){return e?.materiaId??e?.raw?.materia_id??e?.raw?.id??t}trackByDeudaItem(t,e){return e?.infoestudiantesifas_id??e?.id??t}getInstitucionColor(t){return t&&(t?.ColorBajo||t?.colorBajo||t?.color_bajo||t?.color||t?.Color)||""}getCardStyle(t){let e=this.getInstitucionColor(t)||"";return e?{"border-left-color":e}:{}}getTextColorForBg(t){if(!t)return"";try{let e=t.trim();if(e.startsWith("#")){let o=e.substring(1),s=0,u=0,x=0;if(o.length===3)s=parseInt(o[0]+o[0],16),u=parseInt(o[1]+o[1],16),x=parseInt(o[2]+o[2],16);else if(o.length===6)s=parseInt(o.slice(0,2),16),u=parseInt(o.slice(2,4),16),x=parseInt(o.slice(4,6),16);else return"";return(.299*s+.587*u+.114*x)/255>.6?"#000":"#fff"}}catch{}return""}cambiarClave(){if(this.errorClave="",!this.claveActual||!this.nuevaClave||!this.confirmarClave){this.errorClave="Todos los campos son obligatorios.";return}if(this.nuevaClave!==this.confirmarClave){this.errorClave="Las contrase\xF1as nuevas no coinciden.";return}if(this.nuevaClave.length<6){this.errorClave="La nueva contrase\xF1a debe tener al menos 6 caracteres.";return}this._auth.cambiarClave({claveActual:this.claveActual,nuevaClave:this.nuevaClave}).subscribe({next:t=>{this.mostrarModalCambioClave=!1,this.claveActual="",this.nuevaClave="",this.confirmarClave="",this.errorClave="",this._tools.MensajeInformacion("\xC9xito","Contrase\xF1a cambiada correctamente.","success")},error:t=>{this.errorClave=t?.error?.mensaje||"Error al cambiar la contrase\xF1a."}})}};W.\u0275fac=function(e){return new(e||W)(T(ge),T(Ce),T(z),T(we),T(J),T(Pe),T(Me))},W.\u0275cmp=ne({type:W,selectors:[["app-perfil"]],standalone:!1,decls:5,vars:4,consts:[["sinDeuda",""],[1,"container-fluid"],["class","p-4",4,"ngIf"],["class","row flex-nowrap",4,"ngIf"],["class","modal d-block","tabindex","-1","style","background: rgba(0,0,0,.5);",4,"ngIf"],[1,"p-4"],[1,"d-flex","align-items-center","gap-2","text-black"],["role","status",1,"spinner-border"],[1,"alert","alert-warning","mb-0"],[1,"row","flex-nowrap"],[1,"col-auto","col-md-3","col-xl-2","px-sm-2","px-0","sidebar",3,"ngClass"],["type","button",1,"navbar-toggler","text-dark","toggle-btn",3,"click"],[1,"d-flex","flex-column","align-items-center","align-items-sm-start","px-3","pt-2","min-vh-100"],["class","w-100 mb-3",4,"ngIf"],["id","menu",1,"nav","nav-pills","flex-column","mb-sm-auto","mb-0","align-items-center","align-items-sm-start"],[1,"nav-item","w-100",3,"ngClass"],[1,"nav-link","align-middle","w-100","text-start","border-0","bg-transparent",2,"width","100%",3,"click"],[1,"fs-4","bi-house"],["class","ms-1 d-sm-inline",4,"ngIf"],[1,"w-100",3,"ngClass"],[1,"fs-4","bi-person"],[1,"fs-4","bi-shield-lock"],[1,"fs-4","bi-journal-bookmark"],["class","w-100",3,"ngClass",4,"ngIf"],["tabindex","-1",1,"d-md-none","position-fixed","top-5","end-0","m-3",2,"z-index","1050"],[1,"btn","btn-primary",2,"border-radius","50%","width","56px","height","56px",3,"click"],[1,"bi","bi-list",2,"font-size","1.5rem"],[1,"col","py-3","bg-light"],[1,"container"],["class","alert alert-danger",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-3"],[1,"h4","mb-0","text-black"],[1,"text-muted","small"],[1,"badge","text-black"],[4,"ngIf"],[1,"w-100","mb-3"],[1,"small","text-muted"],[1,"fw-semibold","text-black"],[1,"ms-1","d-sm-inline"],[1,"fs-4","bi-journal-text"],[1,"fs-4","bi-cash-coin"],[1,"alert","alert-danger"],[1,"row","g-3"],[1,"col-12","col-lg-6"],[1,"card","shadow-sm"],[1,"card-body"],[1,"fw-semibold"],[1,"d-flex","flex-wrap","gap-2","mt-3"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-outline-dark",3,"click"],["class","btn btn-outline-success","type","button",3,"click",4,"ngIf"],["class","btn btn-outline-danger",3,"routerLink",4,"ngIf"],[1,"small","text-muted","mt-2"],["class","small text-muted",4,"ngIf"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"btn","btn-outline-danger",3,"routerLink"],[1,"bi","bi-shield-check","me-1"],[1,"col-12","col-md-4","text-center"],["alt","Foto de perfil",1,"img-fluid","rounded-circle","mb-3",2,"width","140px","height","140px","object-fit","cover",3,"src"],[1,"col-12","col-md-8"],[1,"table","table-bordered","mb-0"],[2,"width","220px"],["class","row g-3 mt-3",4,"ngIf"],[1,"my-4"],[1,"card","border-0","bg-white","shadow-sm"],[1,"fw-semibold","mb-2"],["class","alert alert-danger py-2",4,"ngIf"],[1,"mb-2"],[1,"form-label"],["type","password","autocomplete","current-password",1,"form-control",3,"ngModelChange","ngModel"],["type","password","autocomplete","new-password",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["type","button",1,"btn","btn-warning",3,"click"],[1,"bi","bi-key-fill","me-1"],["class","col-12 col-lg-6",4,"ngIf"],[1,"row","g-3","mt-3"],[1,"col-12"],[1,"card-body","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"btn","btn-outline-primary",3,"routerLink"],[1,"bi","bi-qr-code-scan","me-1"],[1,"alert","alert-danger","py-2"],["disabled","",1,"quill-container-wrapper",3,"ngModelChange","modules","ngModel"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"h5","mb-0"],[1,"badge",3,"ngClass"],[1,"my-3"],["class","d-flex align-items-center gap-2 py-2",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"d-flex","align-items-center","gap-2","py-2"],[1,"card","border-0","bg-white","shadow-sm","h-100"],[1,"small","text-muted","mb-3"],["type","button",1,"btn","btn-primary",3,"click"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["type","text","placeholder","123456",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-success","mt-2",3,"click","disabled"],["alt","QR 2FA",1,"border","rounded",2,"width","220px","height","220px",3,"src"],[1,"fw-semibold",2,"word-break","break-all"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"h5","mb-0","text-black"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],["role","group","aria-label","Vista Mis Materias",1,"btn-group","btn-group-sm"],["type","button",1,"btn",3,"click","ngClass"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"card","mb-3"],[1,"row","g-2","align-items-center"],[1,"col-12","col-md-12","mb-2"],["type","search","placeholder","Buscar (materia, paralelo, docente, turno)",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-12"],[1,"d-flex","flex-wrap","gap-2","align-items-center"],[1,"me-2","small","text-muted"],[4,"ngFor","ngForOf"],[1,"ms-3","me-2","small","text-muted"],["type","button",1,"btn","btn-sm","btn-outline-dark","ms-auto",3,"click"],["class","d-flex align-items-center gap-2 py-3",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"btn","btn-sm",3,"click","ngClass"],[1,"d-flex","align-items-center","gap-2","py-3"],[1,"alert","alert-info"],[1,"mb-4"],[1,"card-header","d-flex","align-items-center","gap-2"],["style","width: 32px; height: 32px; object-fit: contain;",3,"src","alt",4,"ngIf"],[1,"badge","bg-light","text-dark","border","ms-auto"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"width","32px","height","32px","object-fit","contain",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-2"],[1,"badge","bg-light","text-dark","border"],["class","table-responsive",4,"ngIf"],["class","col-12 col-md-6 col-xl-4",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-12","col-md-6","col-xl-4"],[1,"card","h-100","shadow-sm","mis-materias-card"],[1,"card-body","d-flex","flex-column","gap-2"],[1,"d-flex","align-items-start","justify-content-between","gap-2"],["class","badge bg-secondary",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],["alt","Docente",1,"rounded-circle","border",2,"width","28px","height","28px","object-fit","cover",3,"src"],["class","d-flex gap-3 flex-wrap",4,"ngIf"],[1,"mt-auto","d-flex","flex-wrap","gap-2"],["class","btn btn-sm btn-outline-secondary",3,"routerLink",4,"ngIf"],["class","btn btn-sm btn-outline-success",3,"routerLink","queryParams",4,"ngIf"],["class","btn btn-sm btn-outline-warning",3,"routerLink",4,"ngIf"],[1,"badge","bg-secondary"],[1,"d-flex","gap-3","flex-wrap"],[1,"btn","btn-sm","btn-outline-secondary",3,"routerLink"],[1,"bi","bi-easel","me-1"],[1,"btn","btn-sm","btn-outline-success",3,"routerLink","queryParams"],[1,"bi","bi-journal-check","me-1"],[1,"btn","btn-sm","btn-outline-warning",3,"routerLink"],[1,"bi","bi-list-check","me-1"],[1,"table-responsive"],[1,"table","table-sm","align-middle","mb-0","mis-materias-table"],[1,"table-light"],["class","text-center",4,"ngIf"],[1,"text-end"],[1,"text-center"],["class","small",4,"ngIf"],[1,"text-black"],[1,"d-inline-flex","flex-wrap","gap-2","justify-content-end"],[1,"small"],[1,"d-flex","align-items-center","gap-2","mb-2"],["style","width: 28px; height: 28px; object-fit: contain;",3,"src","alt",4,"ngIf"],["class","mb-3",4,"ngFor","ngForOf","ngForTrackBy"],[2,"width","28px","height","28px","object-fit","contain",3,"src","alt"],["class","col-12 col-md-6",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-12","col-md-6"],[1,"mt-2"],["class","fw-semibold",4,"ngIf","ngIfElse"],[1,"badge","bg-success"],[3,"modoEmbed","soloPlan"],["tabindex","-1",1,"modal","d-block",2,"background","rgba(0,0,0,.5)"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-2"],[1,"col-6"],[1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,o){e&1&&(n(0,"div",1),m(1,Ge,5,0,"div",2)(2,ze,3,0,"div",2)(3,ai,46,42,"div",3)(4,oi,40,11,"div",4),a()),e&2&&(r(),d("ngIf",o.perfilLoading),r(),d("ngIf",!o.perfilLoading&&!o.datasesion),r(),d("ngIf",o.datasesion),r(),d("ngIf",o.editMateriaOpen))},dependencies:[ce,ue,me,be,he,ye,xe,Se,_e],styles:[".sidebar[_ngcontent-%COMP%]{border-right:1px solid rgba(var(--color-basico-institucional-rgb),.25);background-color:#f8f9fa;transition:width .3s}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]{width:60px}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .sidebar.sidebar-collapsed[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar.sidebar-expanded[_ngcontent-%COMP%]{width:250px}.sidebar[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]{display:block;margin:1rem;border:none;background:transparent;cursor:pointer;font-size:1.5rem}.sidebar[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]:focus{outline:none}.sidebar[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{color:#343a40}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#343a40;border-radius:.5rem;width:100%;text-align:left}.sidebar[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:rgba(var(--color-basico-institucional-rgb),.12);color:var(--color-basico-institucional);font-weight:600}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--color-basico-institucional);background-color:rgba(var(--color-basico-institucional-rgb),.08)}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:70%}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]{width:60px}.sidebar.sidebar-expanded[_ngcontent-%COMP%]{width:250px}}.mis-materias-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .mis-materias-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.mis-materias-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.mis-materias-card[_ngcontent-%COMP%]{border-left-width:6px;border-left-style:solid;border-left-color:var(--bs-border-color)}"]});var K=W;var si=[{path:"perfil",component:K}],A=class A{};A.\u0275fac=function(e){return new(e||A)},A.\u0275mod=Q({type:A}),A.\u0275inj=q({imports:[ie.forChild(si),ie]});var Y=A;var O=class O{};O.\u0275fac=function(e){return new(e||O)},O.\u0275mod=Q({type:O}),O.\u0275inj=q({imports:[pe,Ee,Y,Ie]});var Ae=O;export{Ae as PrivadosModule};
