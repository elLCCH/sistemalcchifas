import{a as h}from"./chunk-OQPWVW4O.js";import{C as i,K as u,O as p,R as n,dc as c,k as l,kc as g,o as r,q as a}from"./chunk-TNNFIFGQ.js";var o=class o{constructor(t,e){this.http=t;this.router=e;this.ruta=h.ruta;this.loggedInSubject=new l(!1);this.loggedIn$=this.loggedInSubject.asObservable()}loginConLaravel(t){return this.http.post(`${this.ruta}api/v1/auth/login`,t)}setToken(t){localStorage.setItem("token",t),this.loggedInSubject.next(!0)}clearSession(){localStorage.removeItem("token"),this.loggedInSubject.next(!1)}syncSession(){let t=localStorage.getItem("token");return t?this.http.post(`${this.ruta}api/verify-token`,{token:t}).pipe(a(()=>!0),u(e=>this.loggedInSubject.next(e)),i(()=>(this.clearSession(),r(!1)))):(this.loggedInSubject.next(!1),r(!1))}logout(){let t=localStorage.getItem("token");console.log("valorToken: ",t);var e={token:t};this.clearSession(),t?this.http.post(this.ruta+"api/v1/auth/logout",e).subscribe(s=>{this.router.navigate(["/login"])},s=>{console.error("Error al cerrar sesi\xF3n:",s),this.router.navigate(["/login"])}):this.router.navigate(["/login"])}pedirPerfil(){let t=localStorage.getItem("token");return this.http.get(`${this.ruta}api/v1/auth/user`,{headers:{Authorization:`Bearer ${t}`}})}cambiarClave(t){let e=localStorage.getItem("token");return this.http.post(`${this.ruta}api/v1/auth/cambiar-clave`,t,{headers:{Authorization:`Bearer ${e}`}})}resetPass(t){return this.http.post(`${this.ruta}api/reset-password`,t)}revisarSiesAdmin(){let t=localStorage.getItem("token");return t?this.http.post(`${this.ruta}api/verify-token`,{token:t}).pipe(a(e=>!!(e&&e.name!="ESTUDIANTE")),i(e=>r(!1))):r(!1)}revisarSiEsSuperAdmin(){let t=localStorage.getItem("token");return t?this.http.post(`${this.ruta}api/verify-token`,{token:t}).pipe(a(e=>!!(e&&e.name==="LCCH")),i(()=>r(!1))):r(!1)}};o.\u0275fac=function(e){return new(e||o)(n(c),n(g))},o.\u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"});var m=o;export{m as a};
