import{a as xe}from"./chunk-5YOBPPYD.js";import{a as fe}from"./chunk-YBOEBBAE.js";import{a as I}from"./chunk-XDAG4MPO.js";import{b as ge}from"./chunk-P4K6CI26.js";import{a as ue,b as ve}from"./chunk-NHQGIU22.js";import{b as _e}from"./chunk-KCTZUZJH.js";import{e as ne,g as ae,h as re,k as oe}from"./chunk-PWQJWZZZ.js";import"./chunk-5VY7FQQV.js";import{c as le,f as de,k as ce,m as se,u as pe,x as me}from"./chunk-ROSYCBC4.js";import{a as E}from"./chunk-JISGPZ2J.js";import{$b as q,Aa as O,Dc as X,Ea as r,F as x,Fc as Z,Gb as z,Gc as ee,Hb as Y,Ib as J,Lb as d,Ma as C,Mb as S,Mc as te,Nb as u,Ob as U,Oc as ie,Ra as Q,Tb as D,U as b,Ub as R,Vb as $,Wa as _,Yc as B,Z as j,Zb as k,_b as K,ac as H,ba as V,dc as M,fc as A,ga as v,ha as g,i as f,ib as l,jb as n,kb as a,lb as p,sb as y,vb as h,w as W,xb as s}from"./chunk-SPNCLBHB.js";import"./chunk-GG76335P.js";var w=class w{constructor(t){this.http=t;this.base=`${E.apiUrl}${E.apiRoutes.lchaula.base}`}getById(t){return this.http.get(`${this.base}/tareas/${t}`).pipe(I())}update(t,e){return this.http.put(`${this.base}/tareas/${t}`,e).pipe(I())}};w.\u0275fac=function(e){return new(e||w)(V(B))},w.\u0275prov=j({token:w,factory:w.\u0275fac,providedIn:"root"});var N=w;var P=class P{constructor(t){this.http=t;this.base=`${E.apiUrl}${E.apiRoutes.lchaula.base}`}listByTarea(t){return this.http.get(`${this.base}/tareas/${t}/entregas`).pipe(I())}submit(t,e){return this.http.post(`${this.base}/tareas/${t}/entregar`,e).pipe(I())}calificar(t,e){return this.http.post(`${this.base}/entregas/${t}/calificar`,e).pipe(I())}};P.\u0275fac=function(e){return new(e||P)(V(B))},P.\u0275prov=j({token:P,factory:P.\u0275fac,providedIn:"root"});var L=P;var Ie=i=>["/lchaula/aula",i],Te=()=>({standalone:!0}),we=(i,t,e)=>({"bg-success-subtle text-success":i,"bg-warning-subtle text-warning":t,"bg-secondary-subtle text-secondary":e}),he=()=>[],Pe=(i,t)=>({"bg-success text-white":i,"bg-warning text-dark":t}),Fe=(i,t)=>({"bi-check-circle":i,"bi-hourglass-split":t}),ke=(i,t,e)=>({"bg-success":i,"bg-warning":t,"bg-danger":e});function Me(i,t){i&1&&(n(0,"div",5),p(1,"app-spinner-local",6),a())}function Ae(i,t){if(i&1&&(n(0,"a",34),p(1,"i",35),a()),i&2){let e=s(2);l("routerLink",K(1,Ie,e.tarea.publicacion.aulas_virtuales_id))}}function je(i,t){if(i&1&&(n(0,"span"),d(1),a()),i&2){let e=s(3);r(),u(" - ",e.tarea.publicacion.aula.materia_curso)}}function Ve(i,t){if(i&1&&(n(0,"span"),d(1),a()),i&2){let e=s(3);r(),u(" ",e.tarea.publicacion.aula.materia_paralelo)}}function Oe(i,t){if(i&1&&(n(0,"span"),d(1),a()),i&2){let e=s(3);r(),u(" (",e.tarea.publicacion.aula.materia_turno,")")}}function De(i,t){if(i&1&&(n(0,"span",36),p(1,"i",37),d(2),_(3,je,2,1,"span",4)(4,Ve,2,1,"span",4)(5,Oe,2,1,"span",4),a()),i&2){let e=s(2);r(2),u("",e.tarea.publicacion.aula.materia_nombre," "),r(),l("ngIf",e.tarea.publicacion.aula.materia_curso),r(),l("ngIf",e.tarea.publicacion.aula.materia_paralelo),r(),l("ngIf",e.tarea.publicacion.aula.materia_turno)}}function Re(i,t){if(i&1&&(n(0,"span",38),p(1,"i",39),d(2),a()),i&2){let e=s(2);r(2),u("Fecha l\xEDmite: ",e.formatFecha(e.tarea.fecha_entrega)," ")}}function $e(i,t){if(i&1&&(n(0,"span"),d(1),a()),i&2){let e=s(3);r(),u("(",e.tarea.limite_tardia_horas,"h)")}}function Be(i,t){if(i&1&&(n(0,"span",40),p(1,"i",41),d(2,"Entrega tardia permitida "),_(3,$e,2,1,"span",4),a()),i&2){let e=s(2);r(3),l("ngIf",e.tarea==null?null:e.tarea.limite_tardia_horas)}}function Ne(i,t){if(i&1&&p(0,"quill-editor",42),i&2){let e=s(2);l("ngModel",e.tarea.publicacion.descripcion)("modules",e.modulesQuillShow)("readOnly",!0)("ngModelOptions",k(4,Te))}}function Le(i,t){i&1&&(n(0,"div",43),d(1," Sin descripcion. "),a())}function ze(i,t){i&1&&(n(0,"div",29)(1,"div",49),p(2,"i",50),n(3,"div",51),d(4,"Ningun estudiante ha entregado aun."),a()()())}function Ue(i,t){i&1&&(n(0,"div",76),p(1,"i",77),a())}function qe(i,t){if(i&1&&p(0,"img",78),i&2){let e=s().$implicit,o=s(4);l("src",o.publicBaseUrl+e.estudiante_foto,O)}}function He(i,t){if(i&1&&(n(0,"span",79),d(1),a()),i&2){let e=s().$implicit;r(),u("(Estudiante ID: ",e.infoestudiantesifas_id,")")}}function Ge(i,t){if(i&1&&(n(0,"span"),d(1),a()),i&2){let e=s().$implicit;r(),u("Reentregas: ",e.numero_reentrega)}}function We(i,t){if(i&1&&(n(0,"div",83),d(1),a()),i&2){let e=s(2).$implicit;r(),u(" ",e.calificacion.comentario_docente," ")}}function Qe(i,t){if(i&1&&(n(0,"div",80)(1,"div",81),d(2),a(),_(3,We,2,1,"div",82),a()),i&2){let e=s().$implicit,o=s(4);r(2),U(" ",e.calificacion.puntaje_obtenido," / ",o.tarea==null?null:o.tarea.puntaje_maximo," "),r(),l("ngIf",e.calificacion.comentario_docente)}}function Ye(i,t){if(i&1&&(n(0,"div",84)(1,"div",85),p(2,"i",86),d(3,"Comentario:"),a(),n(4,"div",87),d(5),a()()),i&2){let e=s().$implicit;r(5),S(e.comentario_estudiante)}}function Je(i,t){if(i&1&&(n(0,"a",91),p(1,"i",92),n(2,"span",93),d(3),a(),p(4,"i",94),a()),i&2){let e=t.$implicit,o=s(6);l("href",o.publicBaseUrl+((e==null||e.archivo==null?null:e.archivo.ruta)||""),O),r(3),S((e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo")}}function Ke(i,t){if(i&1&&(n(0,"div",84)(1,"div",85),p(2,"i",88),d(3,"Archivos adjuntos:"),a(),n(4,"div",89),_(5,Je,5,2,"a",90),a()()),i&2){let e=s().$implicit,o=s(4);r(5),l("ngForOf",o.archivosEntregaDocente[e.id])}}function Xe(i,t){i&1&&(n(0,"div",84)(1,"div",95),p(2,"i",88),d(3,"Sin archivos adjuntos"),a()())}function Ze(i,t){if(i&1){let e=y();n(0,"div",53)(1,"div",54),_(2,Ue,2,0,"div",55)(3,qe,1,1,"img",56),n(4,"div",11)(5,"div",57),d(6),_(7,He,2,1,"span",58),a(),n(8,"div",59)(9,"span"),p(10,"i",60),d(11),a(),n(12,"span",61),d(13),a(),_(14,Ge,2,1,"span",4),a()(),_(15,Qe,4,3,"div",62),a(),_(16,Ye,6,1,"div",63)(17,Ke,6,1,"div",63)(18,Xe,4,0,"div",63),n(19,"div",64)(20,"div",65)(21,"div",66)(22,"div",67)(23,"input",68),$("ngModelChange",function(c){let m=v(e).$implicit,T=s(4);return R(T.califForm[m.id].puntaje,c)||(T.califForm[m.id].puntaje=c),g(c)}),a(),n(24,"label",69),d(25,"Puntaje"),a()()(),n(26,"div",70)(27,"div",67)(28,"input",71),$("ngModelChange",function(c){let m=v(e).$implicit,T=s(4);return R(T.califForm[m.id].comentario,c)||(T.califForm[m.id].comentario=c),g(c)}),a(),n(29,"label",69),d(30,"Feedback (opcional)"),a()()(),n(31,"div",66)(32,"button",72),h("click",function(){let c=v(e).$implicit,m=s(4);return g(m.calificar(c.id))}),p(33,"i",73),d(34," Calificar "),a()()(),n(35,"div",74),p(36,"i",75),d(37,"Esta calificacion es solo referencial, no afecta el registro oficial. "),a()()()}if(i&2){let e=t.$implicit,o=t.index,c=s(4);J("bg-light",o%2===0),r(2),l("ngIf",!(e!=null&&e.estudiante_foto)),r(),l("ngIf",e==null?null:e.estudiante_foto),r(3),U(" ",(e==null?null:e.estudiante_nombres)||""," ",(e==null?null:e.estudiante_apellidos)||""," "),r(),l("ngIf",!(e!=null&&e.estudiante_nombres)),r(4),S(c.formatFecha(e.fecha_entrega)||"Sin fecha"),r(),l("ngClass",H(22,we,e.estado==="ENTREGADO",e.estado==="PENDIENTE",e.estado!=="ENTREGADO"&&e.estado!=="PENDIENTE")),r(),u(" ",e.estado," "),r(),l("ngIf",e.numero_reentrega),r(),l("ngIf",e==null?null:e.calificacion),r(),l("ngIf",e.comentario_estudiante),r(),l("ngIf",(c.archivosEntregaDocente[e.id]||k(26,he)).length>0),r(),l("ngIf",(c.archivosEntregaDocente[e.id]||k(27,he)).length===0),r(5),l("id","puntaje_"+e.id),D("ngModel",c.califForm[e.id].puntaje),l("max",c.tarea==null?null:c.tarea.puntaje_maximo),r(),l("for","puntaje_"+e.id),r(4),l("id","feedback_"+e.id),D("ngModel",c.califForm[e.id].comentario),r(),l("for","feedback_"+e.id)}}function et(i,t){if(i&1&&(n(0,"div"),_(1,Ze,38,28,"div",52),a()),i&2){let e=s(3);r(),l("ngForOf",e.entregas)}}function tt(i,t){if(i&1&&(n(0,"div",44)(1,"div",45)(2,"h5",27),p(3,"i",46),d(4,"Entregas de estudiantes"),a(),n(5,"span",47),d(6),a()(),_(7,ze,5,0,"div",48)(8,et,2,1,"div",4),a()),i&2){let e=s(2);r(6),S(e.entregas.length),r(),l("ngIf",e.entregas.length===0),r(),l("ngIf",e.entregas.length>0)}}function it(i,t){if(i&1&&(n(0,"div",74),d(1),a()),i&2){let e=s(5);r(),u(' "',e.entregaPropia.calificacion.comentario_docente,'" ')}}function nt(i,t){if(i&1&&(n(0,"div",110)(1,"div",83),d(2,"Tu calificacion"),a(),n(3,"div",111),d(4),n(5,"span",112),d(6),a()(),_(7,it,2,1,"div",113),n(8,"div",114),p(9,"i",75),d(10,"Calificacion referencial "),a()()),i&2){let e=s(4);r(4),u(" ",e.entregaPropia.calificacion.puntaje_obtenido," "),r(2),u("/ ",e.tarea==null?null:e.tarea.puntaje_maximo),r(),l("ngIf",e.entregaPropia.calificacion.comentario_docente)}}function at(i,t){if(i&1&&(n(0,"div",102)(1,"div",108)(2,"span",36),p(3,"i",60),d(4),a(),n(5,"span",36),d(6),a()(),_(7,nt,11,3,"div",109),a()),i&2){let e=s(3);r(4),u("",e.formatFecha(e.entregaPropia.fecha_entrega)||"Sin fecha"," "),r(2),u(" Reentregas: ",e.entregaPropia.numero_reentrega||0," "),r(),l("ngIf",e.entregaPropia==null?null:e.entregaPropia.calificacion)}}function rt(i,t){i&1&&(n(0,"div",115),p(1,"i",75),d(2,"Aun no has entregado esta tarea. "),a())}function ot(i,t){if(i&1){let e=y();n(0,"div",124)(1,"span",125),p(2,"i",92),n(3,"span",126),d(4),a()(),n(5,"span",127)(6,"span",83),d(7),M(8,"number"),a(),n(9,"button",128),h("click",function(){let c=v(e).index,m=s(5);return g(m.removePendingFile(c))}),p(10,"i",129),a()()()}if(i&2){let e=t.$implicit;r(4),S(e.name),r(3),u("",A(8,2,e.size/1024/1024,"1.1-1")," MB")}}function lt(i,t){if(i&1&&(n(0,"div",122),_(1,ot,11,5,"div",123),a()),i&2){let e=s(4);r(),l("ngForOf",e.pendingFiles)}}function dt(i,t){if(i&1&&(n(0,"div",130),d(1),M(2,"number"),a()),i&2){let e=s(4);r(),u(" Total: ",A(2,1,e.getPendingSizeMB(),"1.1-1")," MB / 20 MB ")}}function ct(i,t){if(i&1){let e=y();n(0,"div",102)(1,"div",116),p(2,"i",88),d(3,"Adjuntar archivos"),a(),_(4,lt,2,1,"div",117)(5,dt,3,4,"div",118),n(6,"div",119),h("dragover",function(c){v(e);let m=s(3);return g(m.onDragOver(c))})("dragleave",function(c){v(e);let m=s(3);return g(m.onDragLeave(c))})("drop",function(c){v(e);let m=s(3);return g(m.onDropPending(c))})("click",function(){v(e);let c=z(13);return g(c.click())}),p(7,"i",120),n(8,"div",74),d(9,"Arrastra archivos aqui o haz clic para seleccionar"),a(),n(10,"div",83),d(11,"Maximo 20 MB en total"),a()(),n(12,"input",121,0),h("change",function(c){v(e);let m=s(3);return g(m.addPendingFiles(c))}),a()()}if(i&2){let e=s(3);r(4),l("ngIf",e.pendingFiles.length>0),r(),l("ngIf",e.pendingFiles.length>0)}}function st(i,t){if(i&1&&(n(0,"span",131),d(1),a()),i&2){let e=s(3);r(),u(" ",e.pendingFiles.length," archivo(s) ")}}function pt(i,t){i&1&&(n(0,"div",130),d(1," Sin archivos subidos. "),a())}function mt(i,t){if(i&1&&(n(0,"a",141),p(1,"i",92),n(2,"span",126),d(3),a()()),i&2){let e=s().$implicit,o=s(5);l("href",o.publicBaseUrl+e.archivo.ruta,O),r(3),S((e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo")}}function _t(i,t){if(i&1&&(n(0,"span",83),d(1),M(2,"number"),a()),i&2){let e=s().$implicit;r(),u(" ",A(2,1,e.archivo.tamano/1024/1024,"1.1-1")," MB ")}}function ut(i,t){if(i&1){let e=y();n(0,"div",124),_(1,mt,4,2,"a",138),n(2,"span",127),_(3,_t,3,4,"span",82),n(4,"button",139),h("click",function(){let c=v(e).$implicit,m=s(5);return g(m.deleteArchivoEntrega(c.archivo.id))}),p(5,"i",140),a()()()}if(i&2){let e=t.$implicit;r(),l("ngIf",e==null||e.archivo==null?null:e.archivo.ruta),r(2),l("ngIf",e==null||e.archivo==null?null:e.archivo.tamano)}}function vt(i,t){if(i&1&&(n(0,"div",122),_(1,ut,6,2,"div",123),a()),i&2){let e=s(4);r(),l("ngForOf",e.archivosEntrega)}}function gt(i,t){if(i&1){let e=y();n(0,"div")(1,"div",132)(2,"div",133),p(3,"i",88),d(4,"Tus archivos"),a(),n(5,"span",134),d(6),M(7,"number"),a()(),n(8,"div",135),p(9,"div",136),a(),_(10,pt,2,0,"div",118)(11,vt,2,1,"div",117),n(12,"div",137)(13,"div",119),h("dragover",function(c){v(e);let m=s(3);return g(m.onDragOver(c))})("dragleave",function(c){v(e);let m=s(3);return g(m.onDragLeave(c))})("drop",function(c){v(e);let m=s(3);return g(m.onDropEntrega(m.entregaPropia.id,c))})("click",function(){v(e);let c=z(20);return g(c.click())}),p(14,"i",120),n(15,"div",74),d(16,"Arrastra mas archivos o haz clic para agregar"),a(),n(17,"div",83),d(18,"Maximo 20 MB en total"),a()(),n(19,"input",121,1),h("change",function(c){v(e);let m=s(3);return g(m.onUploadEntregaFiles(m.entregaPropia.id,c))}),a()()()}if(i&2){let e=s(3);r(6),u(" ",A(7,6,e.getUploadSizeMB(),"1.1-1")," / 20 MB "),r(3),Y("width",e.getUploadPercent(),"%"),l("ngClass",H(9,ke,e.getUploadPercent()<70,e.getUploadPercent()>=70&&e.getUploadPercent()<90,e.getUploadPercent()>=90)),r(),l("ngIf",e.archivosEntrega.length===0),r(),l("ngIf",e.archivosEntrega.length>0)}}function ft(i,t){if(i&1){let e=y();n(0,"div",96)(1,"div",97)(2,"div",98)(3,"h5",27),p(4,"i",99),d(5),a()(),n(6,"div",29),_(7,at,8,3,"div",100)(8,rt,3,0,"div",101)(9,ct,14,2,"div",100),n(10,"div",102)(11,"label",103),d(12,"Tu comentario (opcional)"),a(),n(13,"quill-editor",104),$("ngModelChange",function(c){v(e);let m=s(2);return R(m.comentarioEntrega,c)||(m.comentarioEntrega=c),g(c)}),a()(),n(14,"button",105),h("click",function(){v(e);let c=s(2);return g(c.submitEntrega())}),p(15,"i",106),d(16),_(17,st,2,1,"span",107),a(),_(18,gt,21,13,"div",4),a()()()}if(i&2){let e=s(2);r(2),l("ngClass",q(12,Pe,(e.entregaPropia==null?null:e.entregaPropia.estado)==="ENTREGADO",!e.entregaPropia||(e.entregaPropia==null?null:e.entregaPropia.estado)!=="ENTREGADO")),r(2),l("ngClass",q(15,Fe,(e.entregaPropia==null?null:e.entregaPropia.estado)==="ENTREGADO",!e.entregaPropia||(e.entregaPropia==null?null:e.entregaPropia.estado)!=="ENTREGADO")),r(),u(" ",(e.entregaPropia==null?null:e.entregaPropia.estado)==="ENTREGADO"?"Entregado":"Tu trabajo"," "),r(2),l("ngIf",e.entregaPropia),r(),l("ngIf",!e.entregaPropia),r(),l("ngIf",!e.entregaPropia),r(4),D("ngModel",e.comentarioEntrega),l("ngModelOptions",k(18,Te))("modules",e.modulesQuillEdicion),r(3),u(" ",e.entregaPropia?"Reentregar":"Entregar tarea"," "),r(),l("ngIf",!e.entregaPropia&&e.pendingFiles.length>0),r(),l("ngIf",e.entregaPropia)}}function xt(i,t){if(i&1&&(n(0,"div")(1,"div",7)(2,"div",8)(3,"div",9),_(4,Ae,2,3,"a",10),n(5,"div",11)(6,"div",12)(7,"span",13),p(8,"i",14),d(9,"TAREA"),a(),_(10,De,6,4,"span",15),a(),n(11,"h1",16),d(12),a()()(),n(13,"div",17),_(14,Re,3,1,"span",18),n(15,"span",19),p(16,"i",20),d(17),a(),_(18,Be,4,1,"span",21),a(),p(19,"hr",22),a()(),n(20,"div",23)(21,"div",24)(22,"div",25)(23,"div",26)(24,"h5",27),p(25,"i",28),d(26,"Instrucciones"),a()(),n(27,"div",29),_(28,Ne,1,5,"quill-editor",30)(29,Le,2,0,"div",31),a()(),_(30,tt,9,3,"div",32),a(),_(31,ft,19,19,"div",33),a()()),i&2){let e=s();r(4),l("ngIf",e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.aulas_virtuales_id),r(6),l("ngIf",e.tarea==null||e.tarea.publicacion==null||e.tarea.publicacion.aula==null?null:e.tarea.publicacion.aula.materia_nombre),r(2),u(" ",(e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.titulo)||"Tarea #"+(e.tarea==null?null:e.tarea.id)," "),r(2),l("ngIf",e.tarea==null?null:e.tarea.fecha_entrega),r(3),u("Puntaje max: ",e.tarea==null?null:e.tarea.puntaje_maximo," "),r(),l("ngIf",e.tarea==null?null:e.tarea.permitir_entrega_tardia),r(10),l("ngIf",e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.descripcion),r(),l("ngIf",!(!(e.tarea==null||e.tarea.publicacion==null)&&e.tarea.publicacion.descripcion)),r(),l("ngIf",e.isAdminLike),r(),l("ngIf",!e.isAdminLike)}}var F=class F{constructor(t,e,o,c,m,T,G){this.route=t;this.tareasService=e;this.entregasService=o;this.archivosService=c;this.auth=m;this.toast=T;this.router=G;this.publicBaseUrl=E.ruta||E.apiUrl||"";this.loading=!1;this.tareaId=0;this.isAdminLike=!1;this.tarea=null;this.entregas=[];this.comentarioEntrega="";this.entregaPropia=null;this.archivosEntrega=[];this.pendingFiles=[];this.archivosEntregaDocente={};this.modulesQuillEdicion={toolbar:[["bold","italic","underline","strike"],[{align:[]}],[{size:["small",!1,"large"]}],[{color:[]},{background:[]}],[{font:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","video"],["clean"]]};this.modulesQuillShow={toolbar:!1};this.califForm={}}ngOnInit(){if(this.tareaId=Number(this.route.snapshot.paramMap.get("id")||0),!this.tareaId){this.toast.error("Tarea invalida");return}this.auth.revisarSiesAdmin().subscribe({next:t=>{this.isAdminLike=t,this.load()},error:()=>{this.isAdminLike=!1,this.load()}})}load(){this.loading=!0,this.tareasService.getById(this.tareaId).pipe(b(t=>this.tarea=t),x(t=>(this.loading=!1,t.status===403||t.status===401?(this.toast.error("No tienes acceso a esta tarea"),this.router.navigate(["/inicio"])):this.toast.error(t.message),f))).subscribe(()=>this.loadEntregas())}loadEntregas(){this.entregasService.listByTarea(this.tareaId).pipe(b(t=>{this.entregas=t,this.loading=!1,this.isAdminLike?(this.entregaPropia=null,this.archivosEntrega=[],this.entregas.forEach(e=>this.loadArchivosEntregaDocente(e.id))):(this.entregaPropia=this.entregas.length>0?this.entregas[0]:null,this.entregaPropia&&this.loadArchivosEntrega(this.entregaPropia.id)),this.entregas.forEach(e=>{if(!this.califForm[e.id]){let o=e?.calificacion;this.califForm[e.id]={puntaje:o?.puntaje_obtenido??null,comentario:o?.comentario_docente??""}}})}),x(t=>(this.loading=!1,this.toast.error(t.message),f))).subscribe()}addPendingFiles(t){let e=t.target;if(e.files)for(let o=0;o<e.files.length;o++)this.pendingFiles.push(e.files[o]);e.value=""}removePendingFile(t){this.pendingFiles.splice(t,1)}onDropPending(t){t.preventDefault(),t.stopPropagation(),t.currentTarget?.classList.remove("drop-zone-active");let e=t.dataTransfer?.files;if(e&&e.length>0)for(let o=0;o<e.length;o++)this.pendingFiles.push(e[o])}getPendingSizeMB(){let t=0;return this.pendingFiles.forEach(e=>t+=e.size),t/(1024*1024)}submitEntrega(){this.entregasService.submit(this.tareaId,{comentario_estudiante:this.comentarioEntrega}).pipe(b(t=>{this.toast.success("Entrega registrada"),this.entregaPropia=t,this.comentarioEntrega="",this.pendingFiles.length>0&&t?.id&&(this.uploadEntregaFiles(t.id,[...this.pendingFiles]),this.pendingFiles=[]),this.loadEntregas()}),x(t=>(this.toast.error(t.message),f))).subscribe()}calificar(t){let e={puntaje_obtenido:this.califForm[t]?.puntaje,comentario_docente:this.califForm[t]?.comentario};this.entregasService.calificar(t,e).pipe(b(()=>{this.toast.success("Calificacion guardada"),this.loadEntregas()}),x(o=>(this.toast.error(o.message),f))).subscribe()}loadArchivosEntrega(t){this.archivosService.list("ENTREGA",t).pipe(b(e=>this.archivosEntrega=e),x(()=>f)).subscribe()}onUploadEntregaFiles(t,e){let o=e.target;if(!o.files||o.files.length===0)return;let c=Array.from(o.files);this.uploadEntregaFiles(t,c),o.value=""}uploadEntregaFiles(t,e){let o=e.map(c=>this.archivosService.upload(c,"ENTREGA",t));W(o).pipe(b(()=>{this.toast.success(e.length+" archivo(s) subido(s)"),this.loadArchivosEntrega(t)}),x(c=>(this.toast.error(c.message||"Error al subir. Verifica el limite de 20MB."),this.loadArchivosEntrega(t),f))).subscribe()}onDragOver(t){t.preventDefault(),t.stopPropagation(),t.currentTarget?.classList.add("drop-zone-active")}onDragLeave(t){t.preventDefault(),t.stopPropagation(),t.currentTarget?.classList.remove("drop-zone-active")}onDropEntrega(t,e){e.preventDefault(),e.stopPropagation(),e.currentTarget?.classList.remove("drop-zone-active");let o=e.dataTransfer?.files;o&&o.length>0&&this.uploadEntregaFiles(t,Array.from(o))}formatFecha(t){if(!t)return"";let e=new Date(t);if(isNaN(e.getTime()))return String(t);let o=String(e.getDate()).padStart(2,"0"),c=String(e.getMonth()+1).padStart(2,"0"),m=e.getFullYear(),T=String(e.getHours()).padStart(2,"0"),G=String(e.getMinutes()).padStart(2,"0");return`${o}/${c}/${m} ${T}:${G}`}getUploadSizeMB(){let t=0;return this.archivosEntrega.forEach(e=>{e?.archivo?.tamano&&(t+=Number(e.archivo.tamano))}),t/(1024*1024)}getUploadPercent(){return Math.min(100,this.getUploadSizeMB()/20*100)}deleteArchivoEntrega(t){if(!confirm("\xBFEliminar este archivo?"))return;let e=this.entregaPropia?.id;this.archivosService.deleteArchivo(t).pipe(b(()=>{this.toast.success("Archivo eliminado"),e&&this.loadArchivosEntrega(e)}),x(o=>(this.toast.error(o.message||"Error al eliminar archivo"),f))).subscribe()}loadArchivosEntregaDocente(t){this.archivosService.list("ENTREGA",t).pipe(b(e=>this.archivosEntregaDocente[t]=e),x(()=>f)).subscribe()}};F.\u0275fac=function(e){return new(e||F)(C(ne),C(N),C(L),C(xe),C(_e),C(ge),C(ae))},F.\u0275cmp=Q({type:F,selectors:[["app-lchaula-tarea"]],decls:3,vars:2,consts:[["pendingFileInput",""],["entregaFileInput",""],[1,"container","mt-4"],["class","py-4 text-black",4,"ngIf"],[4,"ngIf"],[1,"py-4","text-black"],["textShow","Cargando tarea..."],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","align-items-center","gap-3","mb-2"],["class","btn btn-sm btn-outline-secondary rounded-circle","title","Volver al aula",3,"routerLink",4,"ngIf"],[1,"flex-grow-1"],[1,"d-flex","align-items-center","gap-2","mb-1"],[1,"badge","bg-warning","text-dark"],[1,"bi","bi-journal-check","me-1"],["class","badge bg-light text-dark border",4,"ngIf"],[1,"display-6","fw-bold","titulosGlobales","mb-0"],[1,"d-flex","flex-wrap","gap-2","ms-5","ps-2"],["class","badge bg-danger-subtle text-danger border",4,"ngIf"],[1,"badge","bg-warning-subtle","text-warning","border"],[1,"bi","bi-star","me-1"],["class","badge bg-info-subtle text-info border",4,"ngIf"],[1,"mt-3","mb-0"],[1,"row","g-4"],[1,"col-12","col-lg-8"],[1,"card","shadow-sm","border-0"],[1,"card-header","bg-light","border-0"],[1,"mb-0"],[1,"bi","bi-file-text","me-2"],[1,"card-body"],["class","quill-readonly-wrapper",3,"ngModel","modules","readOnly","ngModelOptions",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","card shadow-sm border-0 mt-4",4,"ngIf"],["class","col-12 col-lg-4",4,"ngIf"],["title","Volver al aula",1,"btn","btn-sm","btn-outline-secondary","rounded-circle",3,"routerLink"],[1,"bi","bi-arrow-left"],[1,"badge","bg-light","text-dark","border"],[1,"bi","bi-book","me-1"],[1,"badge","bg-danger-subtle","text-danger","border"],[1,"bi","bi-calendar-event","me-1"],[1,"badge","bg-info-subtle","text-info","border"],[1,"bi","bi-clock-history","me-1"],[1,"quill-readonly-wrapper",3,"ngModel","modules","readOnly","ngModelOptions"],[1,"text-muted"],[1,"card","shadow-sm","border-0","mt-4"],[1,"card-header","bg-light","border-0","d-flex","align-items-center","justify-content-between"],[1,"bi","bi-people","me-2"],[1,"badge","bg-primary"],["class","card-body",4,"ngIf"],[1,"text-center","py-4"],[1,"bi","bi-inbox","display-4","text-muted","opacity-50"],[1,"text-muted","mt-2"],["class","border-bottom p-3",3,"bg-light",4,"ngFor","ngForOf"],[1,"border-bottom","p-3"],[1,"d-flex","align-items-center","gap-3","mb-3"],["class",`student-avatar rounded-circle bg-primary-subtle text-primary
                            d-flex align-items-center justify-content-center flex-shrink-0`,4,"ngIf"],["class","student-avatar rounded-circle object-fit-cover flex-shrink-0","alt","foto",3,"src",4,"ngIf"],[1,"fw-bold"],["class","text-muted fw-normal",4,"ngIf"],[1,"d-flex","flex-wrap","gap-2","small","text-muted"],[1,"bi","bi-clock","me-1"],[1,"badge",3,"ngClass"],["class","text-end",4,"ngIf"],["class","mb-3 ms-5 ps-2",4,"ngIf"],[1,"ms-5","ps-2"],[1,"row","g-2","align-items-end"],[1,"col-md-3"],[1,"form-floating"],["type","number","placeholder","Puntaje",1,"form-control","form-control-sm",3,"ngModelChange","id","ngModel","max"],[3,"for"],[1,"col-md-6"],["type","text","placeholder","Feedback",1,"form-control","form-control-sm",3,"ngModelChange","id","ngModel"],[1,"btn","btn-success","w-100",3,"click"],[1,"bi","bi-check-lg","me-1"],[1,"small","text-muted","mt-1"],[1,"bi","bi-info-circle","me-1"],[1,"student-avatar","rounded-circle","bg-primary-subtle","text-primary","d-flex","align-items-center","justify-content-center","flex-shrink-0"],[1,"bi","bi-person-fill",2,"font-size","1.3rem"],["alt","foto",1,"student-avatar","rounded-circle","object-fit-cover","flex-shrink-0",3,"src"],[1,"text-muted","fw-normal"],[1,"text-end"],[1,"badge","bg-success","fs-6"],["class","text-muted small",4,"ngIf"],[1,"text-muted","small"],[1,"mb-3","ms-5","ps-2"],[1,"small","text-muted","mb-1"],[1,"bi","bi-chat-left-text","me-1"],[1,"small","bg-white","rounded","p-2","border"],[1,"bi","bi-paperclip","me-1"],[1,"d-flex","flex-wrap","gap-2"],["class","btn btn-sm btn-outline-secondary d-inline-flex align-items-center gap-1","target","_blank","rel","noopener",3,"href",4,"ngFor","ngForOf"],["target","_blank","rel","noopener",1,"btn","btn-sm","btn-outline-secondary","d-inline-flex","align-items-center","gap-1",3,"href"],[1,"bi","bi-file-earmark"],[1,"text-truncate",2,"max-width","180px"],[1,"bi","bi-download"],[1,"small","text-muted"],[1,"col-12","col-lg-4"],[1,"card","shadow-sm","border-0","sticky-top",2,"top","1rem"],[1,"card-header","border-0",3,"ngClass"],[1,"bi","me-2",3,"ngClass"],["class","mb-3",4,"ngIf"],["class","alert alert-light border small mb-3",4,"ngIf"],[1,"mb-3"],[1,"form-label","small","text-muted"],["placeholder","Escribe un comentario...",1,"quill-container-wrapper",3,"ngModelChange","ngModel","ngModelOptions","modules"],[1,"btn","btn-primary","w-100","mb-3",3,"click"],[1,"bi","bi-send","me-1"],["class","badge bg-light text-dark ms-1",4,"ngIf"],[1,"d-flex","flex-wrap","gap-2","small"],["class","mt-3 p-3 bg-success-subtle rounded-3 text-center",4,"ngIf"],[1,"mt-3","p-3","bg-success-subtle","rounded-3","text-center"],[1,"display-6","fw-bold","text-success"],[1,"fs-5","text-muted"],["class","small text-muted mt-1",4,"ngIf"],[1,"text-muted","small","mt-2"],[1,"alert","alert-light","border","small","mb-3"],[1,"fw-semibold","small","mb-2"],["class","list-group list-group-flush mb-2",4,"ngIf"],["class","text-muted small mb-2",4,"ngIf"],[1,"drop-zone","p-3","text-center","rounded-3",3,"dragover","dragleave","drop","click"],[1,"bi","bi-cloud-arrow-up","fs-4","text-primary"],["type","file","multiple","",1,"d-none",3,"change"],[1,"list-group","list-group-flush","mb-2"],["class","list-group-item px-0 d-flex align-items-center justify-content-between",4,"ngFor","ngForOf"],[1,"list-group-item","px-0","d-flex","align-items-center","justify-content-between"],[1,"text-truncate","d-flex","align-items-center","gap-1"],[1,"text-truncate",2,"max-width","160px"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-outline-danger","px-1","py-0",3,"click"],[1,"bi","bi-x-lg"],[1,"text-muted","small","mb-2"],[1,"badge","bg-light","text-dark","ms-1"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"fw-semibold","small"],[1,"badge","bg-light","text-dark","border","small"],[1,"progress","mb-2",2,"height","6px"],[1,"progress-bar",3,"ngClass"],[1,"mt-2"],["target","_blank","rel","noopener","class","text-truncate text-decoration-none d-flex align-items-center gap-1",3,"href",4,"ngIf"],["title","Eliminar archivo",1,"btn","btn-sm","btn-outline-danger","px-1","py-0",3,"click"],[1,"bi","bi-trash"],["target","_blank","rel","noopener",1,"text-truncate","text-decoration-none","d-flex","align-items-center","gap-1",3,"href"]],template:function(e,o){e&1&&(n(0,"div",2),_(1,Me,2,0,"div",3)(2,xt,32,10,"div",4),a()),e&2&&(r(),l("ngIf",o.loading),r(),l("ngIf",!o.loading&&o.tarea))},dependencies:[ie,X,Z,ee,me,le,se,de,pe,ce,oe,re,fe,ve,ue,te],styles:["[_nghost-%COMP%]{display:block}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #dee2e6;cursor:pointer;transition:border-color .2s,background-color .2s}.drop-zone[_ngcontent-%COMP%]:hover{border-color:var(--bs-primary);background-color:rgba(var(--bs-primary-rgb),.04)}.drop-zone-active[_ngcontent-%COMP%]{border-color:var(--bs-primary)!important;background-color:rgba(var(--bs-primary-rgb),.08)!important}.student-avatar[_ngcontent-%COMP%]{width:44px;height:44px;min-width:44px}.quill-readonly-wrapper[_ngcontent-%COMP%]     .ql-container{border:none!important}.quill-readonly-wrapper[_ngcontent-%COMP%]     .ql-editor{padding:0;min-height:auto}.quill-container-wrapper[_ngcontent-%COMP%]     .ql-toolbar{border-radius:.375rem .375rem 0 0}.quill-container-wrapper[_ngcontent-%COMP%]     .ql-container{border-radius:0 0 .375rem .375rem;min-height:80px}"]});var Ee=F;export{Ee as TareaComponent};
