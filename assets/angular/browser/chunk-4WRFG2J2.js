import{g as b}from"./chunk-LEW5N4EV.js";import{a as o}from"./chunk-5RMZ5E5A.js";import{F as c,S as f,U as u,Xc as v,Z as p,ba as g,g as d,k as i,q as l}from"./chunk-SGF3PIFW.js";var n=class n{constructor(){this.storageKey="theme.colorInstitucional";this.defaultHex="#890000";this.defaultRgb="137, 0, 0"}init(){let e=localStorage.getItem(this.storageKey);if(e&&this.isValidHexColor(e)){this.applyColor(e);return}this.applyColor(this.defaultHex)}setInstitutionColor(e){if(!e||!this.isValidHexColor(e)){this.resetToDefault();return}let t=this.normalizeHex(e);localStorage.setItem(this.storageKey,t),this.applyColor(t)}resetToDefault(){localStorage.removeItem(this.storageKey),this.applyColor(this.defaultHex)}applyColor(e){let t=document.documentElement;t.style.setProperty("--color-basico-institucional",e);let r=this.hexToRgbCsv(e)??this.defaultRgb;t.style.setProperty("--color-basico-institucional-rgb",r)}isValidHexColor(e){let t=e.trim();return/^#?([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(t)}normalizeHex(e){let t=e.trim();return t.startsWith("#")?t:`#${t}`}hexToRgbCsv(e){let t=this.normalizeHex(e).replace("#","");if(t.length===3){let r=parseInt(t[0]+t[0],16),s=parseInt(t[1]+t[1],16),m=parseInt(t[2]+t[2],16);return`${r}, ${s}, ${m}`}if(t.length===6){let r=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),m=parseInt(t.slice(4,6),16);return`${r}, ${s}, ${m}`}return null}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"});var h=n;var a=class a{constructor(e,t,r){this.http=e;this.router=t;this.theme=r;this.ruta=o.ruta;this.loggedInSubject=new d(!1);this.loggedIn$=this.loggedInSubject.asObservable();this.SESSION_401_SHOWN_KEY="auth401Shown";this.brandingLoaded=!1}loginConLaravel(e){return this.http.post(`${this.ruta}api/v1/auth/login`,e)}setToken(e){localStorage.setItem("token",e),this.loggedInSubject.next(!0),this.brandingLoaded=!1;try{sessionStorage.removeItem(this.SESSION_401_SHOWN_KEY)}catch{}}clearSession(){localStorage.removeItem("token"),this.loggedInSubject.next(!1),this.theme.resetToDefault();try{o.ifa="",o.logo="",o.ministerio="",o.ministerioEscudo=""}catch{}this.brandingLoaded=!1;try{sessionStorage.removeItem(this.SESSION_401_SHOWN_KEY)}catch{}}aplicarBrandingEnEnvironment(e,t){let r=(t?.nameInst||e?.nameInst||"").toString();try{o.ifa=r,t?.logo&&(o.logo=t.logo),t?.ministerio&&(o.ministerio=t.ministerio),t?.ministerioEscudo&&(o.ministerioEscudo=t.ministerioEscudo)}catch{}}syncSession(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(()=>!0),u(t=>this.loggedInSubject.next(t)),c(()=>(this.clearSession(),i(!1)))):(this.loggedInSubject.next(!1),i(!1))}logout(){let e=localStorage.getItem("token");console.log("valorToken: ",e);var t={token:e};this.clearSession(),e?this.http.post(this.ruta+"api/v1/auth/logout",t).subscribe(r=>{this.router.navigate(["/login"])},r=>{console.error("Error al cerrar sesi\xF3n:",r),this.router.navigate(["/login"])}):this.router.navigate(["/login"])}pedirPerfil(){let e=localStorage.getItem("token");if(!e||String(e).trim()===""||String(e).toLowerCase()==="null")return i(null);let t={Authorization:`Bearer ${e}`};return this.http.get(`${this.ruta}api/v1/auth/user`,{headers:t}).pipe(u(r=>{this.aplicarBrandingEnEnvironment(r,null)}),f(r=>this.brandingLoaded?i(r):this.http.get(`${this.ruta}api/v1/branding/assets`,{headers:t}).pipe(u(s=>{this.brandingLoaded=!0,this.aplicarBrandingEnEnvironment(r,s)}),l(()=>r),c(()=>i(r)))))}cambiarClave(e){let t=localStorage.getItem("token");return this.http.post(`${this.ruta}api/v1/auth/cambiar-clave`,e,{headers:{Authorization:`Bearer ${t}`}})}resetPass(e){return this.http.post(`${this.ruta}api/reset-password`,e)}revisarSiesAdmin(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(t=>!!(t&&t.name!="ESTUDIANTE")),c(t=>i(!1))):i(!1)}revisarSiEsSuperAdmin(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(t=>!!(t&&t.name==="LCCH")),c(()=>i(!1))):i(!1)}};a.\u0275fac=function(t){return new(t||a)(g(v),g(b),g(h))},a.\u0275prov=p({token:a,factory:a.\u0275fac,providedIn:"root"});var S=a;export{h as a,S as b};
