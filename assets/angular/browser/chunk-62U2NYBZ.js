import{a as He}from"./chunk-NMHT2G7O.js";import{a as We}from"./chunk-CXRBEYBU.js";import"./chunk-ZVVL3HDK.js";import{a as Ue}from"./chunk-CLL7BRQX.js";import"./chunk-XLXCS43A.js";import{a as Ge}from"./chunk-UTFZNMGL.js";import{a as ze}from"./chunk-NFLRO45J.js";import{a as Fe}from"./chunk-CZWDWMMQ.js";import{a as $e}from"./chunk-KDPIXYM3.js";import{b as Le}from"./chunk-4WRFG2J2.js";import{b as Be}from"./chunk-IOZ5TDSV.js";import"./chunk-N4MEOVMH.js";import"./chunk-5KBF566K.js";import"./chunk-NCIXDP2C.js";import{e as Te,k as he}from"./chunk-LEW5N4EV.js";import{b as je}from"./chunk-YB5XT4DU.js";import{g as Ke}from"./chunk-OXGEW5OA.js";import{b as se,c as W,f as G,g as ke,j as be,k as U,l as Re,m as le,o as Oe,p as Ne,q as Ve,r as H,s as q,t as Q,u as De,v as ce}from"./chunk-TKGN7DBU.js";import{a as Ae}from"./chunk-5RMZ5E5A.js";import{Bb as fe,Cb as _e,Cc as Me,Db as ge,Ea as s,Ec as B,Fc as z,Gb as Ee,Hb as we,Ib as O,Lb as l,Ma as k,Mb as S,Nb as E,Nc as Ie,Ob as $,Pb as re,Ra as j,Sa as ae,Sb as I,Tb as P,Ub as T,Wa as x,Xc as Pe,Z as ve,_ as oe,ab as V,ba as xe,ga as g,gc as te,ha as h,ib as u,jb as a,kb as o,lb as R,pb as Ce,qb as Se,sb as M,ua as ye,vb as _,xb as m}from"./chunk-SGF3PIFW.js";import{a as A,b as ne,m as D}from"./chunk-GG76335P.js";function Ze(c,t){if(c&1&&(a(0,"span"),l(1),o()),c&2){let e=m(2);s(),E(" | Paralelo: ",e.materia.MateriaParalelo)}}function Je(c,t){if(c&1&&(a(0,"span"),l(1),o()),c&2){let e=m(2);s(),E("",e.materia.SiglaMateria," - ")}}function et(c,t){if(c&1&&(a(0,"div"),l(1),o()),c&2){let e=m(2);s(),E("A\xF1o: ",e.materia.Anio)}}function tt(c,t){if(c&1&&(a(0,"div"),l(1),o()),c&2){let e=m(2);s(),E("Docentes: ",e.docentesLabel())}}function it(c,t){if(c&1&&(a(0,"div",31)(1,"div")(2,"strong"),l(3),o(),x(4,Ze,2,1,"span",32),o(),a(5,"div"),x(6,Je,2,1,"span",32),l(7),o(),x(8,et,2,1,"div",32)(9,tt,2,1,"div",32),o()),c&2){let e=m();s(3),S(e.materia.LvlCurso||"Curso"),s(),u("ngIf",e.materia.MateriaParalelo),s(2),u("ngIf",e.materia.SiglaMateria),s(),E("",e.materia.NombreMateria||"Materia"," "),s(),u("ngIf",e.materia.Anio),s(),u("ngIf",e.docentes==null?null:e.docentes.length)}}function nt(c,t){if(c&1&&(a(0,"div",33),l(1),o()),c&2){let e=m();s(),S(e.loadError)}}function ot(c,t){if(c&1&&(a(0,"div",33),l(1),o()),c&2){let e=m();s(),S(e.saveError)}}function at(c,t){if(c&1&&(a(0,"div",34),l(1),o()),c&2){let e=m();s(),S(e.saveOk)}}function rt(c,t){if(c&1){let e=M();a(0,"div",35)(1,"div",36),l(2),o(),a(3,"div",37)(4,"button",38),_("click",function(){g(e);let n=m();return h(n.prev())}),l(5,"Anterior"),o(),a(6,"button",38),_("click",function(){g(e);let n=m();return h(n.next())}),l(7,"Siguiente"),o()()()}if(c&2){let e=m();s(2),re("Mostrando ",e.meta.from||0,"-",e.meta.to||0," de ",e.meta.total),s(2),u("disabled",!e.tienePrev()||e.isLoading),s(2),u("disabled",!e.tieneNext()||e.isLoading)}}function st(c,t){if(c&1&&(a(0,"th"),l(1),o()),c&2){let e=t.$implicit;O("sep-after",e.sepAfter),s(),S(e.label)}}function lt(c,t){if(c&1){let e=M();Ce(0),a(1,"input",49),_("ngModelChange",function(n){g(e);let r=m(),d=r.$implicit,p=r.index,f=m().index,b=m(2);return h(b.onCellChange(f,p,d.key,n))})("focus",function(){g(e);let n=m().index,r=m().index,d=m(2);return h(d.onFocusCell(r,n))})("paste",function(n){g(e);let r=m().index,d=m().index,p=m(2);return h(p.onPaste(n,d,r))}),o(),Se()}if(c&2){let e=m(),i=e.$implicit,n=e.index,r=m(),d=r.$implicit,p=r.index,f=m(2);s(),u("readOnly",i.readonly||!f.canEdit(i.key))("ngModel",d[i.key]),V("data-row",p)("data-col",n)}}function ct(c,t){if(c&1){let e=M();a(0,"input",50),_("focus",function(){g(e);let n=m().index,r=m().index,d=m(2);return h(d.onFocusCell(r,n))}),o()}if(c&2){let e=m(),i=e.$implicit,n=e.index,r=m(),d=r.$implicit,p=r.index,f=m(2);u("readOnly",!0)("ngModel",f.sumValueForKey(d,i.key)),V("data-row",p)("data-col",n)}}function dt(c,t){if(c&1&&(a(0,"td"),x(1,lt,2,4,"ng-container",48)(2,ct,1,4,"ng-template",null,0,te),o()),c&2){let e=t.$implicit,i=Ee(3),n=m().$implicit,r=m(2);O("sep-after",e.sepAfter)("cell-danger",r.isCellDanger(n,e.key)),s(),u("ngIf",!r.isSumColumn(e.key))("ngIfElse",i)}}function ut(c,t){if(c&1&&(a(0,"tr")(1,"td",42)(2,"div",46),l(3),o()(),a(4,"td",43),l(5),o(),x(6,dt,4,6,"td",47),o()),c&2){let e=t.$implicit,i=t.index,n=m(2);O("table-danger",n.isDanger(e))("active-row",i===n.activeRow),s(3),S(n.nombreCompleto(e)),s(2),S(e.CI||""),s(),u("ngForOf",n.columns)}}function mt(c,t){if(c&1&&(a(0,"div",39)(1,"table",40)(2,"thead",41)(3,"tr")(4,"th",42),l(5,"Estudiante"),o(),a(6,"th",43),l(7,"CI"),o(),x(8,st,2,3,"th",44),o()(),a(9,"tbody"),x(10,ut,7,7,"tr",45),o()()()),c&2){let e=m();s(8),u("ngForOf",e.columns),s(2),u("ngForOf",e.rows)}}function pt(c,t){c&1&&(a(0,"div",51),l(1," No hay calificaciones asignadas a esta materia. "),o())}var X=class X{constructor(t,e){this.hostEl=t;this._calif=e;this.materiaId=4;this.PASSING_SCORE=61;this.materia=null;this.docentes=[];this.rows=[];this.columns=[];this.isLoading=!1;this.loadError=null;this.saveError=null;this.saveOk=null;this.isSaving=!1;this.meta=null;this.page=1;this.perPage=200;this.maxTeorico=30;this.maxPractico=70;this.avgEvalCount=4;this.viewMode="intercalado";this.editableEvaluations=!0;this.showSumColumns=!1;this.evalEnabled=[!0,!0,!0,!0];this.originalById=new Map;this.dirtyIds=new Set;this.activeRow=0;this.activeCol=0;this.undoStack=[];this.redoStack=[];this.MAX_HISTORY=50;this.isBatchEdit=!1}ngOnInit(){this.rebuildColumns(),this.cargarCalificaciones(1)}cargarCalificaciones(t=1){this.isLoading||(this.isLoading=!0,this.loadError=null,this.saveError=null,this.saveOk=null,this._calif.ObtenerCalificacionesPorMateriaPaginado(this.materiaId,{page:t,per_page:this.perPage}).subscribe({next:e=>{let i=Array.isArray(e?.data)?e.data:[];this.rows=i.map(r=>A({},r)),this.materia=e?.materia??null,this.docentes=Array.isArray(e?.docentes)?e.docentes:[],this.meta=e?.meta??null,this.page=this.meta?.current_page??t;let n=this.materia?.CantidadEvaluaciones??null;(n===1||n===2||n===3||n===4)&&(this.avgEvalCount=n),this.rebuildColumns(),this.captureBaseline(),this.dirtyIds.clear(),this.activeRow=0,this.activeCol=0},error:e=>{console.error("Error al cargar calificaciones por materia:",e),this.rows=[],this.meta=null,this.loadError="No se pudieron cargar las calificaciones de la materia."},complete:()=>{this.isLoading=!1}}))}recargarTabla(){this.cargarCalificaciones(this.page||1)}tienePrev(){return!!this.meta&&(this.meta.current_page??1)>1}tieneNext(){return!!this.meta&&(this.meta.current_page??1)<(this.meta.last_page??1)}prev(){this.tienePrev()&&this.cargarCalificaciones((this.meta.current_page??1)-1)}next(){this.tieneNext()&&this.cargarCalificaciones((this.meta.current_page??1)+1)}captureBaseline(){this.originalById.clear();for(let t of this.rows)this.originalById.set(t.id,A({},t))}snapshotRows(){let t={};for(let e of this.rows)t[e.id]={Teorico1:e.Teorico1??null,Teorico2:e.Teorico2??null,Teorico3:e.Teorico3??null,Teorico4:e.Teorico4??null,Practico1:e.Practico1??null,Practico2:e.Practico2??null,Practico3:e.Practico3??null,Practico4:e.Practico4??null,PromTeorico:e.PromTeorico??null,PromPractico:e.PromPractico??null,Promedio:e.Promedio??null,PruebaRecuperacion:e.PruebaRecuperacion??null};return t}restoreSnapshot(t){this.isBatchEdit=!0;try{this.dirtyIds.clear();for(let e of this.rows){let i=t[e.id];i&&(e.Teorico1=i.Teorico1??null,e.Teorico2=i.Teorico2??null,e.Teorico3=i.Teorico3??null,e.Teorico4=i.Teorico4??null,e.Practico1=i.Practico1??null,e.Practico2=i.Practico2??null,e.Practico3=i.Practico3??null,e.Practico4=i.Practico4??null,e.PruebaRecuperacion=i.PruebaRecuperacion??null,e.__cascadeActive=!1,e.__cascadeLockFrom=null,e.__cascadeBackup=null,this.recalcPromedios(e),this.recomputeDirtyForRow(e))}}finally{this.isBatchEdit=!1}}beginUserChange(){this.isBatchEdit||(this.undoStack.push(this.snapshotRows()),this.undoStack.length>this.MAX_HISTORY&&this.undoStack.shift(),this.redoStack=[])}undo(){if(this.undoStack.length===0)return;let t=this.snapshotRows(),e=this.undoStack.pop();this.redoStack.push(t),this.restoreSnapshot(e)}redo(){if(this.redoStack.length===0)return;let t=this.snapshotRows(),e=this.redoStack.pop();this.undoStack.push(t),this.restoreSnapshot(e)}recomputeDirtyForRow(t){let e=this.originalById.get(t.id);if(!e)return;["Teorico1","Practico1","Teorico2","Practico2","Teorico3","Practico3","Teorico4","Practico4","PruebaRecuperacion"].some(r=>(t[r]??null)!==(e[r]??null))?this.dirtyIds.add(t.id):this.dirtyIds.delete(t.id)}rebuildColumns(){let t=[],e=[1,2,3,4].slice(0,this.avgEvalCount),i=n=>{t.push({key:`Teorico${n}`,label:`Teo${n}`,widthClass:"w-80"}),t.push({key:`Practico${n}`,label:`Prac${n}`,widthClass:"w-80",sepAfter:!this.showSumColumns}),this.showSumColumns&&t.push({key:`Sum${n}`,label:`Sum${n}`,widthClass:"w-80",readonly:!0,sepAfter:!0})};if(this.viewMode==="intercalado")for(let n of e)i(n);else{for(let n of e)t.push({key:`Teorico${n}`,label:`Teo${n}`,widthClass:"w-80"});t[t.length-1].sepAfter=!0;for(let n of e)t.push({key:`Practico${n}`,label:`Prac${n}`,widthClass:"w-80"}),this.showSumColumns?t.push({key:`Sum${n}`,label:`Sum${n}`,widthClass:"w-80",readonly:!0,sepAfter:!0}):t[t.length-1].sepAfter=!0}t.push({key:"PromTeorico",label:"Prom Teo",readonly:!0,widthClass:"w-90"}),t.push({key:"PromPractico",label:"Prom Prac",readonly:!0,widthClass:"w-90"}),t.push({key:"Promedio",label:"Prom",readonly:!0,widthClass:"w-80",sepAfter:!0}),t.push({key:"PruebaRecuperacion",label:"Recup",widthClass:"w-80"}),this.columns=t}onShowSumColumnsChange(t){this.showSumColumns=!!t,this.rebuildColumns()}onEvalEnabledChange(t,e){t<0||t>3||(this.evalEnabled[t]=!!e)}setAllEvaluations(t){this.evalEnabled=[t,t,t,t]}nombreCompleto(t){let e=(t.Ap_Paterno??"").trim(),i=(t.Ap_Materno??"").trim(),n=(t.Nombres??"").trim();return[e,i,n].filter(Boolean).join(" ").trim()||"(Sin nombre)"}docentesLabel(){return this.docentes?.length?this.docentes.map(t=>`${(t.Apellidos??"").trim()} ${(t.Nombres??"").trim()}`.trim()).filter(Boolean).join(", "):""}isDanger(t){let e=t.Promedio;return typeof e=="number"&&e<=60}isSumKey(t){return typeof t=="string"&&t.startsWith("Sum")}isSumColumn(t){return this.isSumKey(t)}evalIndexFromKey(t){switch(t){case"Teorico1":case"Practico1":return 1;case"Teorico2":case"Practico2":return 2;case"Teorico3":case"Practico3":return 3;case"Teorico4":case"Practico4":return 4;default:return null}}evalIndexFromColumnKey(t){if(this.isSumKey(t)){let e=Number(t.replace("Sum",""));return e>=1&&e<=4?e:null}return this.evalIndexFromKey(t)}sumValue(t,e){let i=t[`Teorico${e}`],n=t[`Practico${e}`];return typeof i=="number"&&typeof n=="number"?i+n:null}sumValueForKey(t,e){let i=this.evalIndexFromColumnKey(e);return i===null?null:this.sumValue(t,i)}isCellDanger(t,e){let i=this.evalIndexFromColumnKey(e);if(i!==null){let n=this.sumValue(t,i);return typeof n=="number"&&n<this.PASSING_SCORE}return e==="PromTeorico"?t.PromTeorico===null||t.PromTeorico===void 0?!1:t.PromTeorico*100<this.PASSING_SCORE*this.maxTeorico:e==="PromPractico"?t.PromPractico===null||t.PromPractico===void 0?!1:t.PromPractico*100<this.PASSING_SCORE*this.maxPractico:e==="Promedio"?t.Promedio!==null&&t.Promedio!==void 0&&t.Promedio<this.PASSING_SCORE:e==="PruebaRecuperacion"?t.PruebaRecuperacion!==null&&t.PruebaRecuperacion!==void 0&&t.PruebaRecuperacion<this.PASSING_SCORE:!1}clampNum(t,e,i){return Number.isNaN(t)||t<e?e:t>i?i:t}parseNullableInt(t){if(t==null)return null;let e=String(t).trim();if(e==="")return null;let i=parseInt(e,10);return Number.isFinite(i)?i:null}isTeoricoKey(t){return t==="Teorico1"||t==="Teorico2"||t==="Teorico3"||t==="Teorico4"}isPracticoKey(t){return t==="Practico1"||t==="Practico2"||t==="Practico3"||t==="Practico4"}recalcPromedios(t){let e=this.findZeroCascadeIndex(t),i=t,n=!!i.__cascadeActive,r=i.__cascadeLockFrom??null;if(e!==null){n||(i.__cascadeBackup={1:{teo:t.Teorico1??null,prac:t.Practico1??null},2:{teo:t.Teorico2??null,prac:t.Practico2??null},3:{teo:t.Teorico3??null,prac:t.Practico3??null},4:{teo:t.Teorico4??null,prac:t.Practico4??null}}),i.__cascadeActive=!0,i.__cascadeLockFrom=e;for(let v=e;v<=4;v++)t[`Teorico${v}`]=0,t[`Practico${v}`]=0}else if(n){let v=i.__cascadeBackup,y=r??1;if(v)for(let C=y+1;C<=4;C++){let w=v[C];if(!w)continue;let N=t[`Teorico${C}`],ee=t[`Practico${C}`];typeof N=="number"&&typeof ee=="number"&&N===0&&ee===0&&(t[`Teorico${C}`]=w.teo,t[`Practico${C}`]=w.prac)}i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null}if(e!==null){t.PromTeorico=0,t.PromPractico=0,t.Promedio=0;return}let d=[1,2,3,4].slice(0,this.avgEvalCount),p=v=>{let y=v.filter(w=>typeof w=="number");if(y.length===0)return null;let C=y.reduce((w,N)=>w+N,0);return Math.round(C/y.length)},f=d.map(v=>t[`Teorico${v}`]),b=d.map(v=>t[`Practico${v}`]);if(t.PromTeorico=p(f),t.PromPractico=p(b),t.PromTeorico===null&&t.PromPractico===null)t.Promedio=null;else{let v=(t.PromTeorico??0)+(t.PromPractico??0);t.Promedio=this.clampNum(Math.round(v),0,100)}}findZeroCascadeIndex(t){let e=t,i=!!e.__cascadeActive,n=e.__cascadeLockFrom??null;if(i&&n){for(let r=1;r<=n;r=r+1){let d=t[`Teorico${r}`],p=t[`Practico${r}`];if(typeof d=="number"&&typeof p=="number"&&d===0&&p===0)return r}return null}for(let r=1;r<=4;r=r+1){let d=t[`Teorico${r}`],p=t[`Practico${r}`];if(typeof d=="number"&&typeof p=="number"&&d===0&&p===0)return r}return null}canEdit(t){if(!this.editableEvaluations||this.isSumKey(t)||t==="PromTeorico"||t==="PromPractico"||t==="Promedio")return!1;let e=this.evalIndexFromColumnKey(t);return e!==null?!!this.evalEnabled[e-1]:!0}onFocusCell(t,e){this.activeRow=t,this.activeCol=e}onCellChange(t,e,i,n){let r=this.rows[t];if(!r||!this.canEdit(i)||this.isSumKey(i))return;this.beginUserChange();let d=this.parseNullableInt(n);if(d===null)r[i]=null;else{let p=d;this.isTeoricoKey(i)?p=this.clampNum(p,0,this.maxTeorico):this.isPracticoKey(i)?p=this.clampNum(p,0,this.maxPractico):p=this.clampNum(p,0,100),r[i]=p}this.recalcPromedios(r),this.recomputeDirtyForRow(r),this.activeRow=t,this.activeCol=e}onPaste(t,e,i){if(!t.clipboardData)return;let n=t.clipboardData.getData("text");if(!n)return;let r=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(d=>d.length>0).map(d=>d.split("	"));if(r.length!==0){t.preventDefault(),this.beginUserChange(),this.isBatchEdit=!0;try{for(let d=0;d<r.length&&this.rows[e+d];d++)for(let f=0;f<r[d].length;f++){let b=this.columns[i+f];if(!b)break;let v=b.key;this.canEdit(v)&&this.onCellChange(e+d,i+f,v,r[d][f])}}finally{this.isBatchEdit=!1}}}focusCell(t,e){let i=this.hostEl.nativeElement.querySelector(`input[data-row="${t}"][data-col="${e}"]`);i?.focus(),i?.select()}onKeydown(t){if(t.ctrlKey||t.metaKey){let v=t.key.toLowerCase();if(v==="z"&&!t.shiftKey){t.preventDefault(),this.undo();return}if(v==="y"||v==="z"&&t.shiftKey){t.preventDefault(),this.redo();return}}let e=t.key;if(e!=="ArrowUp"&&e!=="ArrowDown"&&e!=="ArrowLeft"&&e!=="ArrowRight")return;let i=document.activeElement;if(!i||i.tagName!=="INPUT")return;let n=i.dataset.row,r=i.dataset.col;if(n===void 0||r===void 0)return;let d=parseInt(n,10),p=parseInt(r,10);if(!Number.isFinite(d)||!Number.isFinite(p))return;t.preventDefault();let f=d,b=p;e==="ArrowUp"&&(f=Math.max(0,d-1)),e==="ArrowDown"&&(f=Math.min(this.rows.length-1,d+1)),e==="ArrowLeft"&&(b=Math.max(0,p-1)),e==="ArrowRight"&&(b=Math.min(this.columns.length-1,p+1)),this.activeRow=f,this.activeCol=b,setTimeout(()=>this.focusCell(f,b))}copiarTodo(){return D(this,null,function*(){let t=this.buildTsvExport();try{yield navigator.clipboard.writeText(t),this.saveOk="Copiado al portapapeles.",setTimeout(()=>this.saveOk=null,1500)}catch{let i=document.createElement("textarea");i.value=t,i.style.position="fixed",i.style.left="-9999px",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),this.saveOk="Copiado al portapapeles.",setTimeout(()=>this.saveOk=null,1500)}})}buildTsvExport(){let t=[{key:"Teorico1",label:"Teo1"},{key:"Practico1",label:"Prac1"},{key:"Teorico2",label:"Teo2"},{key:"Practico2",label:"Prac2"},{key:"Teorico3",label:"Teo3"},{key:"Practico3",label:"Prac3"},{key:"Teorico4",label:"Teo4"},{key:"Practico4",label:"Prac4"},{key:"PromTeorico",label:"Prom Teo"},{key:"PromPractico",label:"Prom Prac"},{key:"Promedio",label:"Prom"},{key:"PruebaRecuperacion",label:"Recup"}],e=["Ap_Paterno","Ap_Materno","Nombres","CI",...t.map(n=>n.label)].join("	"),i=this.rows.map(n=>{let r=[n.Ap_Paterno??"",n.Ap_Materno??"",n.Nombres??"",n.CI??""],d=t.map(p=>n[p.key]??"");return[...r,...d].join("	")});return[e,...i].join(`
`)}guardarCambios(){if(this.isSaving)return;if(this.saveError=null,this.saveOk=null,Array.from(this.dirtyIds.values()).length===0){this.saveOk="No hay cambios para guardar.",setTimeout(()=>this.saveOk=null,1500);return}let e=this.rows.filter(i=>this.dirtyIds.has(i.id)).map(i=>({id:i.id,Teorico1:i.Teorico1??null,Teorico2:i.Teorico2??null,Teorico3:i.Teorico3??null,Teorico4:i.Teorico4??null,Practico1:i.Practico1??null,Practico2:i.Practico2??null,Practico3:i.Practico3??null,Practico4:i.Practico4??null,PruebaRecuperacion:i.PruebaRecuperacion??null}));this.isSaving=!0,this._calif.GuardarCalificacionesBulkMateria({materias_id:this.materiaId,avg_eval_count:this.avgEvalCount,items:e}).subscribe({next:i=>{let n=i?.data?.updated??null;this.saveOk=typeof n=="number"?`Guardado: ${n} filas.`:"Guardado.",this.captureBaseline(),this.dirtyIds.clear(),setTimeout(()=>this.saveOk=null,2e3)},error:i=>{console.error("Error al guardar cambios:",i),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}onAvgEvalCountChange(t){let e=parseInt(String(t),10);if(e===1||e===2||e===3||e===4){this.avgEvalCount=e;for(let i of this.rows)this.recalcPromedios(i);this.rebuildColumns()}}};X.\u0275fac=function(e){return new(e||X)(k(ye),k(He))},X.\u0275cmp=j({type:X,selectors:[["app-calificaciones"]],hostBindings:function(e,i){e&1&&_("keydown",function(r){return i.onKeydown(r)})},standalone:!1,decls:76,vars:24,consts:[["sumCell",""],[1,"container-fluid","py-3"],[1,"d-flex","align-items-start","justify-content-between","gap-3","flex-wrap"],[1,"mb-1"],["class","text-muted small",4,"ngIf"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"input-group","input-group-sm",2,"width","170px"],[1,"input-group-text"],[1,"form-select",3,"ngModelChange","ngModel"],["value","intercalado"],["value","agrupado"],[1,"form-check","form-check-inline","small","mb-0"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label"],[1,"d-flex","align-items-center","gap-2","small"],[1,"text-body-secondary"],[1,"form-check","form-check-inline","mb-0"],["role","group","aria-label","Habilitar evaluaciones",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"input-group","input-group-sm",2,"width","160px"],[3,"ngValue"],[1,"input-group","input-group-sm",2,"width","140px"],["type","number","min","0","max","100",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"mt-2"],["class","alert alert-danger py-2",4,"ngIf"],["class","alert alert-success py-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between mt-2",4,"ngIf"],["class","table-responsive mt-2 grid-wrap",4,"ngIf"],["class","text-muted small mt-2",4,"ngIf"],[1,"text-muted","small"],[4,"ngIf"],[1,"alert","alert-danger","py-2"],[1,"alert","alert-success","py-2"],[1,"d-flex","align-items-center","justify-content-between","mt-2"],[1,"small","text-muted"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"table-responsive","mt-2","grid-wrap"],[1,"table","table-sm","table-bordered","align-middle","mb-0","grid-table"],[1,"table-light"],[1,"sticky-col","name-col"],[1,"sticky-col","name-col-2"],[3,"sep-after",4,"ngFor","ngForOf"],[3,"table-danger","active-row",4,"ngFor","ngForOf"],[1,"fw-semibold"],[3,"sep-after","cell-danger",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["inputmode","numeric",1,"form-control","form-control-sm","cell",3,"ngModelChange","focus","paste","readOnly","ngModel"],["inputmode","numeric",1,"form-control","form-control-sm","cell",3,"focus","readOnly","ngModel"],[1,"text-muted","small","mt-2"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"div",2)(2,"div")(3,"h5",3),l(4,"Calificaciones por materia"),o(),x(5,it,10,6,"div",4),o(),a(6,"div",5)(7,"div",6)(8,"span",7),l(9,"Modo"),o(),a(10,"select",8),T("ngModelChange",function(r){return P(i.viewMode,r)||(i.viewMode=r),r}),_("ngModelChange",function(){return i.rebuildColumns()}),a(11,"option",9),l(12,"Intercalado"),o(),a(13,"option",10),l(14,"Agrupado"),o()()(),a(15,"label",11)(16,"input",12),_("ngModelChange",function(r){return i.onShowSumColumnsChange(r)}),o(),a(17,"span",13),l(18,"Mostrar sumas"),o()(),a(19,"div",14)(20,"span",15),l(21,"Evaluaciones"),o(),a(22,"label",16)(23,"input",12),_("ngModelChange",function(r){return i.onEvalEnabledChange(0,r)}),o(),a(24,"span",13),l(25,"1"),o()(),a(26,"label",16)(27,"input",12),_("ngModelChange",function(r){return i.onEvalEnabledChange(1,r)}),o(),a(28,"span",13),l(29,"2"),o()(),a(30,"label",16)(31,"input",12),_("ngModelChange",function(r){return i.onEvalEnabledChange(2,r)}),o(),a(32,"span",13),l(33,"3"),o()(),a(34,"label",16)(35,"input",12),_("ngModelChange",function(r){return i.onEvalEnabledChange(3,r)}),o(),a(36,"span",13),l(37,"4"),o()()(),a(38,"div",17)(39,"button",18),_("click",function(){return i.setAllEvaluations(!0)}),l(40,"Todas"),o(),a(41,"button",18),_("click",function(){return i.setAllEvaluations(!1)}),l(42,"Ninguna"),o()(),a(43,"div",19)(44,"span",7),l(45,"Prom"),o(),a(46,"select",8),_("ngModelChange",function(r){return i.onAvgEvalCountChange(r)}),a(47,"option",20),l(48,"1 eval"),o(),a(49,"option",20),l(50,"2 eval"),o(),a(51,"option",20),l(52,"3 eval"),o(),a(53,"option",20),l(54,"4 eval"),o()()(),a(55,"div",21)(56,"span",7),l(57,"Teo \u2264"),o(),a(58,"input",22),T("ngModelChange",function(r){return P(i.maxTeorico,r)||(i.maxTeorico=r),r}),o()(),a(59,"div",21)(60,"span",7),l(61,"Prac \u2264"),o(),a(62,"input",22),T("ngModelChange",function(r){return P(i.maxPractico,r)||(i.maxPractico=r),r}),o()(),a(63,"button",23),_("click",function(){return i.recargarTabla()}),l(64,"Recargar"),o(),a(65,"button",23),_("click",function(){return i.copiarTodo()}),l(66,"Copiar todo"),o(),a(67,"button",24),_("click",function(){return i.guardarCambios()}),l(68),o()()(),a(69,"div",25),x(70,nt,2,1,"div",26)(71,ot,2,1,"div",26)(72,at,2,1,"div",27),o(),x(73,rt,8,5,"div",28)(74,mt,11,2,"div",29)(75,pt,2,0,"div",30),o()),e&2&&(s(5),u("ngIf",i.materia),s(5),I("ngModel",i.viewMode),s(6),u("ngModel",i.showSumColumns),s(7),u("ngModel",i.evalEnabled[0]),s(4),u("ngModel",i.evalEnabled[1]),s(4),u("ngModel",i.evalEnabled[2]),s(4),u("ngModel",i.evalEnabled[3]),s(11),u("ngModel",i.avgEvalCount),s(),u("ngValue",1),s(2),u("ngValue",2),s(2),u("ngValue",3),s(2),u("ngValue",4),s(5),I("ngModel",i.maxTeorico),s(4),I("ngModel",i.maxPractico),s(),u("disabled",i.isLoading||i.isSaving),s(2),u("disabled",i.isLoading||i.rows.length===0),s(2),u("disabled",i.isLoading||i.isSaving||i.dirtyIds.size===0),s(),E(" Guardar cambios (",i.dirtyIds.size,") "),s(2),u("ngIf",i.loadError),s(),u("ngIf",i.saveError),s(),u("ngIf",i.saveOk),s(),u("ngIf",i.meta),s(),u("ngIf",i.rows.length),s(),u("ngIf",!i.isLoading&&!i.rows.length))},dependencies:[B,z,q,Q,W,le,se,H,G,ce,De,U],styles:[".grid-wrap[_ngcontent-%COMP%]{max-height:calc(100vh - 220px)}.grid-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .grid-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.name-col[_ngcontent-%COMP%]{min-width:260px}.name-col-2[_ngcontent-%COMP%]{left:260px;min-width:120px;z-index:2;background:var(--bs-body-bg)}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.sticky-col[_ngcontent-%COMP%]{z-index:3;background:var(--bs-table-bg)}.cell[_ngcontent-%COMP%]{min-width:76px;padding:.15rem .35rem}td.sep-after[_ngcontent-%COMP%], th.sep-after[_ngcontent-%COMP%]{border-right-width:3px}td.cell-danger[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{color:var(--bs-danger);font-weight:600}tr.active-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{outline:1px solid rgba(13,110,253,.35);outline-offset:-1px}"]});var de=X;var F=class F{constructor(t){this.http=t;this.ruta=Ae.ruta}ObtenerRegistroPorMateriaPaginado(t,e,i){let n=new URLSearchParams;n.set("eval",String(e)),i?.page&&n.set("page",String(i.page)),i?.per_page&&n.set("per_page",String(i.per_page));let r=n.toString(),d=this.ruta+"api/registrocalificaciones/materia/"+t+(r?`?${r}`:"");return this.http.get(d)}CrearRubro(t){return this.http.post(this.ruta+"api/registrocalificaciones/rubros",t)}ActualizarRubro(t,e){return this.http.put(this.ruta+"api/registrocalificaciones/rubros/"+t,e)}EliminarRubro(t){return this.http.delete(this.ruta+"api/registrocalificaciones/rubros/"+t)}GuardarNotasBulk(t){return this.http.post(this.ruta+"api/registrocalificaciones/bulk-save",t)}ActualizarEvaluacionModo(t){return this.http.put(this.ruta+"api/registrocalificaciones/evaluacion",t)}};F.\u0275fac=function(e){return new(e||F)(xe(Pe))},F.\u0275prov=ve({token:F,factory:F.\u0275fac,providedIn:"root"});var ue=F;function _t(c,t){c&1&&(a(0,"span",42),l(1,"Cargando"),o())}function gt(c,t){if(c&1&&(a(0,"span",43),l(1),o()),c&2){let e=m();s(),E("",e.dirty.size," cambios")}}function ht(c,t){if(c&1&&(a(0,"span"),l(1),o()),c&2){let e=m(2);s(),E(" | Paralelo: ",e.materia.MateriaParalelo)}}function bt(c,t){if(c&1&&(a(0,"span"),l(1),o()),c&2){let e=m(2);s(),E(" | A\xF1o: ",e.materia.Anio)}}function vt(c,t){if(c&1&&(a(0,"span"),l(1),o()),c&2){let e=m(2);s(),E("",e.materia.SiglaMateria," - ")}}function xt(c,t){if(c&1&&(a(0,"div",44)(1,"div")(2,"strong"),l(3),o(),x(4,ht,2,1,"span",45)(5,bt,2,1,"span",45),o(),a(6,"div"),x(7,vt,2,1,"span",45),l(8),o()()),c&2){let e=m();s(3),S(e.materia.LvlCurso||"Curso"),s(),u("ngIf",e.materia.MateriaParalelo),s(),u("ngIf",e.materia.Anio),s(2),u("ngIf",e.materia.SiglaMateria),s(),E("",e.materia.NombreMateria||"Materia"," ")}}function yt(c,t){if(c&1&&(a(0,"div",49),l(1),o()),c&2){let e=m(2);s(),S(e.loadError)}}function Ct(c,t){if(c&1&&(a(0,"div",49),l(1),o()),c&2){let e=m(2);s(),S(e.saveError)}}function St(c,t){if(c&1&&(a(0,"div",50),l(1),o()),c&2){let e=m(2);s(),S(e.saveOk)}}function Et(c,t){if(c&1&&(a(0,"div",46),x(1,yt,2,1,"div",47)(2,Ct,2,1,"div",47)(3,St,2,1,"div",48),o()),c&2){let e=m();s(),u("ngIf",e.loadError),s(),u("ngIf",e.saveError),s(),u("ngIf",e.saveOk)}}function wt(c,t){if(c&1){let e=M();a(0,"div",51)(1,"div",52),l(2),o(),a(3,"div",53)(4,"button",14),_("click",function(){g(e);let n=m();return h(n.prev())}),l(5,"Anterior"),o(),a(6,"button",14),_("click",function(){g(e);let n=m();return h(n.next())}),l(7,"Siguiente"),o()()()}if(c&2){let e=m();s(2),re("Mostrando ",e.meta.from||0,"-",e.meta.to||0," de ",e.meta.total),s(2),u("disabled",!e.tienePrev()||e.isLoading),s(2),u("disabled",!e.tieneNext()||e.isLoading)}}function Mt(c,t){if(c&1&&(a(0,"th",69),l(1,"Te\xF3ricas"),o()),c&2){let e=m(2);V("colspan",e.rubrosTeo.length)}}function It(c,t){if(c&1&&(a(0,"th",69),l(1,"Pr\xE1cticas"),o()),c&2){let e=m(2);V("colspan",e.rubrosPra.length)}}function Pt(c,t){if(c&1){let e=M();a(0,"th",69)(1,"div",70)(2,"div",71),l(3),o(),a(4,"div",72)(5,"button",39),_("click",function(){let n=g(e).$implicit,r=m(2);return h(r.editarRubro(n))}),l(6,"E"),o(),a(7,"button",73),_("click",function(){let n=g(e).$implicit,r=m(2);return h(r.eliminarRubro(n))}),l(8,"X"),o()()()()}if(c&2){let e=t.$implicit;s(3),$("",e.nombre," (",e.max_puntos,")")}}function Tt(c,t){if(c&1){let e=M();a(0,"th",69)(1,"div",70)(2,"div",71),l(3),o(),a(4,"div",72)(5,"button",39),_("click",function(){let n=g(e).$implicit,r=m(2);return h(r.editarRubro(n))}),l(6,"E"),o(),a(7,"button",73),_("click",function(){let n=g(e).$implicit,r=m(2);return h(r.eliminarRubro(n))}),l(8,"X"),o()()()()}if(c&2){let e=t.$implicit;s(3),$("",e.nombre," (",e.max_puntos,")")}}function At(c,t){if(c&1){let e=M();a(0,"td")(1,"input",82),_("ngModelChange",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.setNota(d.infoestudiantesifas_id,r.id,n))})("id",function(){let n=g(e).$implicit,r=m().$implicit,d=m(2);return h(d.cellId(r.infoestudiantesifas_id,n.id))})("paste",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onPaste(n,d.infoestudiantesifas_id,r.id))})("keydown",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onKeydown(n,d.infoestudiantesifas_id,r.id))})("mousedown",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onCellMouseDown(n,d.infoestudiantesifas_id,r.id))}),o()()}if(c&2){let e=t.$implicit,i=m().$implicit,n=m(2);O("cell-selected",n.isCellSelected(i.infoestudiantesifas_id,e.id)),s(),u("ngModel",n.getNota(i.infoestudiantesifas_id,e.id))("data-row",i.infoestudiantesifas_id)("data-col",e.id),V("max",e.max_puntos)}}function kt(c,t){if(c&1){let e=M();a(0,"td")(1,"input",82),_("ngModelChange",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.setNota(d.infoestudiantesifas_id,r.id,n))})("id",function(){let n=g(e).$implicit,r=m().$implicit,d=m(2);return h(d.cellId(r.infoestudiantesifas_id,n.id))})("paste",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onPaste(n,d.infoestudiantesifas_id,r.id))})("keydown",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onKeydown(n,d.infoestudiantesifas_id,r.id))})("mousedown",function(n){let r=g(e).$implicit,d=m().$implicit,p=m(2);return h(p.onCellMouseDown(n,d.infoestudiantesifas_id,r.id))}),o()()}if(c&2){let e=t.$implicit,i=m().$implicit,n=m(2);O("cell-selected",n.isCellSelected(i.infoestudiantesifas_id,e.id)),s(),u("ngModel",n.getNota(i.infoestudiantesifas_id,e.id))("data-row",i.infoestudiantesifas_id)("data-col",e.id),V("max",e.max_puntos)}}function Rt(c,t){if(c&1&&(a(0,"tr")(1,"td",74)(2,"div",75),l(3),o()(),a(4,"td",76),l(5),o(),x(6,At,2,6,"td",77),R(7,"td",78),a(8,"td",79),l(9),o(),x(10,kt,2,6,"td",77),R(11,"td",78),a(12,"td",80),l(13),o(),a(14,"td",81),l(15),o()()),c&2){let e=t.$implicit,i=m(2);s(3),S(i.nombreCompleto(e)),s(2),S(e.CI||""),s(),u("ngForOf",i.rubrosTeo),s(3),S(i.getTeo(e)??""),s(),u("ngForOf",i.rubrosPra),s(3),S(i.getPra(e)??""),s(2),S(i.getSum(e)??"")}}function Ot(c,t){if(c&1){let e=M();a(0,"div",54)(1,"table",55)(2,"thead",56)(3,"tr")(4,"th",57),l(5,"Estudiante"),o(),a(6,"th",58),l(7,"CI"),o(),x(8,Mt,2,1,"th",59),a(9,"th",60)(10,"button",61),_("click",function(){g(e);let n=m();return h(n.abrirModalRubro("TEO"))}),l(11,"+"),o()(),a(12,"th",62),l(13),o(),x(14,It,2,1,"th",59),a(15,"th",60)(16,"button",63),_("click",function(){g(e);let n=m();return h(n.abrirModalRubro("PRA"))}),l(17,"+"),o()(),a(18,"th",64),l(19),o(),a(20,"th",65),l(21),o()(),a(22,"tr"),x(23,Pt,9,2,"th",66),a(24,"th",60)(25,"span",67),l(26,"\xA0"),o()(),x(27,Tt,9,2,"th",66),a(28,"th",60)(29,"span",67),l(30,"\xA0"),o()()()(),a(31,"tbody"),x(32,Rt,16,7,"tr",68),o()()()}if(c&2){let e=m();s(8),u("ngIf",e.rubrosTeo.length),s(2),u("disabled",e.isLoading||e.isSaving),s(3),E("Teo ",e.evalNum),s(),u("ngIf",e.rubrosPra.length),s(2),u("disabled",e.isLoading||e.isSaving),s(3),E("Prac ",e.evalNum),s(2),E("Sum ",e.evalNum),s(2),u("ngForOf",e.rubrosTeo),s(4),u("ngForOf",e.rubrosPra),s(5),u("ngForOf",e.rows)}}function Nt(c,t){c&1&&(a(0,"div",37),l(1,"No hay estudiantes asignados a esta materia."),o())}function Vt(c,t){c&1&&R(0,"div",83)}var Y=class Y{constructor(t){this.api=t;this.materiaId=4;this.evalNum=1;this.isLoading=!1;this.isSaving=!1;this.loadError=null;this.saveError=null;this.saveOk=null;this.materia=null;this.evaluacion=null;this.modoEval=3;this.rubros=[];this.rows=[];this.meta=null;this.page=1;this.perPage=30;this.notas=new Map;this.dirty=new Set;this.modalVisible=!1;this.modalTipo="TEO";this.modalModo="create";this.modalRubroId=null;this.nuevoNombre="";this.nuevoMax=10;this.nuevoOrden=1;this.anchor=null;this.cursor=null;this.undoStack=[];this.redoStack=[];this.isRestoring=!1;this.isBatching=!1}ngOnInit(){this.cargar(1)}get rubrosTeo(){return this.rubros.filter(t=>t.tipo==="TEO")}get rubrosPra(){return this.rubros.filter(t=>t.tipo==="PRA")}key(t,e){return`${t}__${e}`}nombreCompleto(t){let e=(t.Ap_Paterno??"").trim(),i=(t.Ap_Materno??"").trim(),n=(t.Nombres??"").trim();return[e,i,n].filter(Boolean).join(" ").trim()||"(Sin nombre)"}setEval(t){this.evalNum!==t&&(this.evalNum=t,this.cargar(1))}onModoChange(t){let e=Number(t);(e===1||e===2||e===3)&&this.api.ActualizarEvaluacionModo({materias_id:this.materiaId,numero_eval:this.evalNum,modo_eval:e}).subscribe({next:i=>{let n=Number(i?.evaluacion?.modo_eval??e);this.modoEval=n===1||n===2||n===3?n:e,this.saveOk="Modo actualizado.",setTimeout(()=>this.saveOk=null,1200),this.recargar()},error:i=>{console.error("Error actualizando modo:",i),this.saveError="No se pudo actualizar el modo.",this.recargar()}})}tienePrev(){return!!this.meta&&(this.meta.current_page??1)>1}tieneNext(){return!!this.meta&&(this.meta.current_page??1)<(this.meta.last_page??1)}prev(){this.tienePrev()&&this.cargar((this.meta.current_page??1)-1)}next(){this.tieneNext()&&this.cargar((this.meta.current_page??1)+1)}recargar(){this.cargar(this.page||1)}abrirModalRubro(t){this.modalModo="create",this.modalRubroId=null,this.modalTipo=t,this.nuevoNombre="",this.nuevoMax=10;let e=t==="TEO"?this.rubrosTeo:this.rubrosPra;this.nuevoOrden=(e.reduce((i,n)=>Math.max(i,n.orden??1),0)||0)+1,this.modalVisible=!0,setTimeout(()=>{let i=document.querySelector(".modal input.form-control");i?.focus(),i?.select()},0)}cerrarModal(){this.modalVisible=!1}onModalBackdrop(t){t.target?.classList?.contains("modal")&&this.cerrarModal()}confirmarModal(){this.modalModo==="create"?this.crearRubroDesdeModal():this.actualizarRubroDesdeModal()}editarRubro(t){this.modalModo="edit",this.modalRubroId=t.id,this.modalTipo=t.tipo,this.nuevoNombre=t.nombre,this.nuevoMax=t.max_puntos,this.nuevoOrden=t.orden,this.modalVisible=!0,setTimeout(()=>{let e=document.querySelector(".modal input.form-control");e?.focus(),e?.select()},0)}eliminarRubro(t){window.confirm(`\xBFEliminar el rubro "${t.nombre}"?`)&&this.api.EliminarRubro(t.id).subscribe({next:()=>{this.saveOk="Rubro eliminado.",setTimeout(()=>this.saveOk=null,1500),this.recargar()},error:i=>{console.error("Error eliminando rubro:",i),this.saveError="No se pudo eliminar el rubro."}})}cargar(t=1){this.isLoading||(this.isLoading=!0,this.loadError=null,this.saveError=null,this.saveOk=null,this.api.ObtenerRegistroPorMateriaPaginado(this.materiaId,this.evalNum,{page:t,per_page:this.perPage}).subscribe({next:e=>{this.materia=e?.materia??null,this.evaluacion=e?.evaluacion??null;let i=Number(this.evaluacion?.modo_eval??this.evaluacion?.modoEval??3);this.modoEval=i===1||i===2||i===3?i:3,this.rubros=Array.isArray(e?.rubros)?e.rubros:[],this.rows=Array.isArray(e?.data)?e.data:[],this.meta=e?.meta??null,this.page=this.meta?.current_page??t,this.notas.clear(),this.dirty.clear();let n=Array.isArray(e?.notas)?e.notas:[];for(let r of n)this.notas.set(this.key(r.infoestudiantesifas_id,r.rubro_id),r.nota??null)},error:e=>{console.error("Error al cargar registrocalificaciones:",e),this.rows=[],this.rubros=[],this.meta=null,this.loadError="No se pudo cargar el registro de calificaciones."},complete:()=>{this.isLoading=!1}}))}getNota(t,e){return this.notas.get(this.key(t,e))??null}setNota(t,e,i,n){!this.isRestoring&&!this.isBatching&&!n?.skipUndo&&this.pushUndoSnapshot();let r=this.key(t,e),d=String(i??"").trim(),p=null;if(d!==""){let v=Number(d);Number.isFinite(v)?p=Math.round(v):p=null}let f=this.rubros.find(v=>v.id===e);p!==null&&f&&(p<0&&(p=0),p>f.max_puntos&&(p=f.max_puntos)),(this.notas.get(r)??null)!==p&&(this.notas.set(r,p),this.dirty.add(r))}onCellMouseDown(t,e,i){if(t.shiftKey&&this.anchor){this.cursor={infoId:e,rubroId:i};return}this.anchor={infoId:e,rubroId:i},this.cursor={infoId:e,rubroId:i}}isCellSelected(t,e){if(!this.anchor||!this.cursor)return!1;let i=this.rowIndexOf(this.anchor.infoId),n=this.rubroIndexOf(this.anchor.rubroId),r=this.rowIndexOf(this.cursor.infoId),d=this.rubroIndexOf(this.cursor.rubroId);if(i<0||n<0||r<0||d<0)return!1;let p=Math.min(i,r),f=Math.max(i,r),b=Math.min(n,d),v=Math.max(n,d),y=this.rowIndexOf(t),C=this.rubroIndexOf(e);return y>=p&&y<=f&&C>=b&&C<=v}buildSelectionTSV(){if(!this.anchor||!this.cursor)return null;let t=this.rowIndexOf(this.anchor.infoId),e=this.rubroIndexOf(this.anchor.rubroId),i=this.rowIndexOf(this.cursor.infoId),n=this.rubroIndexOf(this.cursor.rubroId);if(t<0||e<0||i<0||n<0)return null;let r=Math.min(t,i),d=Math.max(t,i),p=Math.min(e,n),f=Math.max(e,n),b=[];for(let v=r;v<=d;v++){let y=this.rows[v];if(!y)continue;let C=[];for(let w=p;w<=f;w++){let N=this.rubros[w];if(!N)continue;let ee=this.getNota(y.infoestudiantesifas_id,N.id);C.push(ee===null?"":String(Math.trunc(ee)))}b.push(C.join("	"))}return b.join(`
`)}copyText(t){return D(this,null,function*(){try{yield navigator.clipboard.writeText(t);return}catch{let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}finally{document.body.removeChild(e)}}})}pushUndoSnapshot(){let t={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?A({},this.anchor):null,cursor:this.cursor?A({},this.cursor):null};this.undoStack.push(t),this.undoStack.length>50&&this.undoStack.shift(),this.redoStack.length=0}restoreSnapshot(t){this.isRestoring=!0;try{this.notas.clear();for(let[e,i]of t.notas)this.notas.set(e,i);this.dirty=new Set(t.dirty),this.anchor=t.anchor,this.cursor=t.cursor}finally{this.isRestoring=!1}}undo(){let t=this.undoStack.pop();if(!t)return;let e={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?A({},this.anchor):null,cursor:this.cursor?A({},this.cursor):null};this.redoStack.push(e),this.restoreSnapshot(t)}redo(){let t=this.redoStack.pop();if(!t)return;let e={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?A({},this.anchor):null,cursor:this.cursor?A({},this.cursor):null};this.undoStack.push(e),this.restoreSnapshot(t)}crearRubroDesdeModal(){let t=this.nuevoNombre.trim();if(!t)return;let e=Math.max(1,Math.trunc(Number(this.nuevoMax)||1)),i=Math.max(1,Math.trunc(Number(this.nuevoOrden)||1));this.modoEval===1?e=100:this.modoEval===2&&(e=this.modalTipo==="TEO"?30:70),this.api.CrearRubro({materias_id:this.materiaId,numero_eval:this.evalNum,tipo:this.modalTipo,nombre:t,max_puntos:e,orden:i}).subscribe({next:()=>{this.saveOk="Rubro creado.",setTimeout(()=>this.saveOk=null,1500),this.cerrarModal(),this.recargar()},error:n=>{console.error("Error creando rubro:",n),this.saveError="No se pudo crear el rubro."}})}actualizarRubroDesdeModal(){let t=this.modalRubroId;if(!t)return;let e=this.nuevoNombre.trim();if(!e)return;let i=Math.max(1,Math.trunc(Number(this.nuevoMax)||1)),n=Math.max(1,Math.trunc(Number(this.nuevoOrden)||1));this.modoEval===1?i=100:this.modoEval===2&&(i=this.modalTipo==="TEO"?30:70),this.api.ActualizarRubro(t,{tipo:this.modalTipo,nombre:e,max_puntos:i,orden:n}).subscribe({next:()=>{this.saveOk="Rubro actualizado.",setTimeout(()=>this.saveOk=null,1500),this.cerrarModal(),this.recargar()},error:r=>{console.error("Error actualizando rubro:",r),this.saveError="No se pudo actualizar el rubro."}})}getTeo(t){let e=this.getVirtualEval(t.infoestudiantesifas_id)?.teo;if(e!==null)return e;let i=`Teorico${this.evalNum}`,n=t[i];return typeof n=="number"?Math.trunc(n):n??null}getPra(t){let e=this.getVirtualEval(t.infoestudiantesifas_id)?.pra;if(e!==null)return e;let i=`Practico${this.evalNum}`,n=t[i];return typeof n=="number"?Math.trunc(n):n??null}getSum(t){let e=this.getTeo(t),i=this.getPra(t);if(e===null&&i===null)return null;let n=(e??0)+(i??0);return Math.trunc(n)}getVirtualEval(t){if(!this.rubros?.length)return null;let e=Math.trunc(Number(this.evaluacion?.limite_teorico??30)),i=Math.trunc(Number(this.evaluacion?.limite_practico??70)),n=[],r=[],d=null;for(let v of this.rubros){let y=this.getNota(t,v.id);if(y==null)continue;let C=Math.round(Number(y));if(!Number.isFinite(C))continue;let w=Math.trunc(Number(v.max_puntos??0));C<0&&(C=0),w>0&&C>w&&(C=w);let N=v.es_asistencia===1||v.es_asistencia===!0;v.tipo==="TEO"?N?d=C:n.push(C):r.push(C)}let p=this.modoEval,f=null,b=null;if(p===1){let v=null;if(n.length>0){let y=n.reduce((C,w)=>C+w,0)/n.length;v=Math.round(y/100*20)}if((v!==null||d!==null)&&(f=Math.round((v??0)+(d??0)),f<0&&(f=0),f>e&&(f=e)),r.length>0){let y=r.reduce((C,w)=>C+w,0)/r.length;b=Math.round(y/100*i),b<0&&(b=0),b>i&&(b=i)}}else if(p===2){let v=null;if(n.length>0){let y=n.reduce((C,w)=>C+w,0)/n.length;v=Math.round(y/30*20)}if((v!==null||d!==null)&&(f=Math.round((v??0)+(d??0)),f<0&&(f=0),f>e&&(f=e)),r.length>0){let y=r.reduce((C,w)=>C+w,0)/r.length;b=Math.round(y/70*i),b<0&&(b=0),b>i&&(b=i)}}else{let v=n.reduce((C,w)=>C+w,0)+(d??0),y=r.reduce((C,w)=>C+w,0);(n.length>0||d!==null)&&(f=Math.round(v),f<0&&(f=0),f>e&&(f=e)),r.length>0&&(b=Math.round(y),b<0&&(b=0),b>i&&(b=i))}return{teo:f,pra:b}}cellId(t,e){return`rc_${t}_${e}`}focusCell(t,e){let i=document.getElementById(this.cellId(t,e));i&&(i.focus(),i.select())}rubroIndexOf(t){return this.rubros.findIndex(e=>e.id===t)}rowIndexOf(t){return this.rows.findIndex(e=>e.infoestudiantesifas_id===t)}onKeydown(t,e,i){let n=t.key.toLowerCase();if(t.ctrlKey&&!t.shiftKey&&n==="z"){t.preventDefault(),this.undo();return}if(t.ctrlKey&&n==="y"||t.ctrlKey&&t.shiftKey&&n==="z"){t.preventDefault(),this.redo();return}if(t.ctrlKey&&n==="c"){let C=this.buildSelectionTSV();C!==null&&(t.preventDefault(),this.copyText(C));return}let r=t.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","Tab"].includes(r))return;let d=this.rowIndexOf(e),p=this.rubroIndexOf(i);if(d<0||p<0)return;let f=d,b=p;r==="ArrowLeft"&&(b-=1),r==="ArrowRight"&&(b+=1),r==="ArrowUp"&&(f-=1),r==="ArrowDown"&&(f+=1),r==="Enter"&&(f+=t.shiftKey?-1:1),r==="Tab"&&(b+=t.shiftKey?-1:1),f<0&&(f=0),f>=this.rows.length&&(f=this.rows.length-1),b<0&&(b=0),b>=this.rubros.length&&(b=this.rubros.length-1),t.preventDefault();let v=this.rows[f]?.infoestudiantesifas_id,y=this.rubros[b]?.id;v&&y&&(t.shiftKey?(this.anchor||(this.anchor={infoId:e,rubroId:i}),this.cursor={infoId:v,rubroId:y}):(this.anchor={infoId:v,rubroId:y},this.cursor={infoId:v,rubroId:y}),this.focusCell(v,y))}onPaste(t,e,i){let n=t.clipboardData?.getData("text/plain");if(!n)return;this.isRestoring||this.pushUndoSnapshot();let r=this.rowIndexOf(e),d=this.rubroIndexOf(i);if(r<0||d<0)return;let p=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(f=>f.length>0);if(p.length){t.preventDefault(),this.isBatching=!0;for(let f=0;f<p.length;f++){let b=p[f].split("	"),v=this.rows[r+f];if(!v)break;for(let y=0;y<b.length;y++){let C=this.rubros[d+y];if(!C)break;let w=b[y].trim();if(w===""){this.setNota(v.infoestudiantesifas_id,C.id,null,{skipUndo:!0});continue}this.setNota(v.infoestudiantesifas_id,C.id,w,{skipUndo:!0})}}this.isBatching=!1}}guardarCambios(){if(this.isSaving)return;if(this.dirty.size===0){this.saveOk="No hay cambios para guardar.",setTimeout(()=>this.saveOk=null,1500);return}let t=[];for(let i of this.dirty.values()){let[n,r]=i.split("__"),d=Number(n),p=Number(r);!Number.isFinite(d)||!Number.isFinite(p)||t.push({infoestudiantesifas_id:d,rubro_id:p,nota:this.notas.get(i)??null})}this.isSaving=!0,this.saveError=null,this.saveOk=null;let e=this.materia?.CantidadEvaluaciones??4;this.api.GuardarNotasBulk({materias_id:this.materiaId,numero_eval:this.evalNum,avg_eval_count:e,items:t}).subscribe({next:()=>{this.saveOk="Guardado.",this.dirty.clear(),setTimeout(()=>this.saveOk=null,1500),this.recargar()},error:i=>{console.error("Error guardando notas:",i),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}};Y.\u0275fac=function(e){return new(e||Y)(k(ue))},Y.\u0275cmp=j({type:Y,selectors:[["app-registroscalificaciones"]],standalone:!1,decls:74,vars:35,consts:[[1,"container-fluid","py-3"],[1,"card","shadow-sm"],[1,"card-header","bg-body"],[1,"d-flex","align-items-start","justify-content-between","gap-3","flex-wrap"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"mb-0"],["class","badge text-bg-secondary",4,"ngIf"],["class","badge text-bg-warning",4,"ngIf"],["class","text-muted small mt-1",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],[1,"text-muted","small"],[1,"form-select","form-select-sm",2,"width","240px",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],["role","group","aria-label","Acciones",1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],["class","mt-2",4,"ngIf"],["role","tablist",1,"nav","nav-pills","nav-fill","mt-3"],["role","presentation",1,"nav-item"],["type","button",1,"nav-link",3,"click"],[1,"card-body","pt-2"],["class","d-flex align-items-center justify-content-between mt-2",4,"ngIf"],["class","table-responsive mt-2",4,"ngIf"],["class","text-muted small mt-2",4,"ngIf"],["tabindex","-1",1,"modal","fade",3,"click"],[1,"modal-dialog","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-2"],[1,"form-label","form-label-sm"],["placeholder","Ej: Prueba corta",1,"form-control","form-control-sm",3,"ngModelChange","keydown.enter","ngModel"],[1,"row","g-2"],[1,"col-6"],["type","number","min","1","step","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-muted","small","mt-2"],[1,"modal-footer"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","disabled"],["class","modal-backdrop fade show",4,"ngIf"],[1,"badge","text-bg-secondary"],[1,"badge","text-bg-warning"],[1,"text-muted","small","mt-1"],[4,"ngIf"],[1,"mt-2"],["class","alert alert-danger py-2 mb-2",4,"ngIf"],["class","alert alert-success py-2 mb-0",4,"ngIf"],[1,"alert","alert-danger","py-2","mb-2"],[1,"alert","alert-success","py-2","mb-0"],[1,"d-flex","align-items-center","justify-content-between","mt-2"],[1,"small","text-muted"],[1,"btn-group","btn-group-sm"],[1,"table-responsive","mt-2"],[1,"table","table-sm","table-bordered","table-hover","table-striped","align-middle","mb-0","reg-grid"],[1,"table-light"],["rowspan","2",1,"sticky-col","col-meta"],["rowspan","2",1,"sticky-col","col-meta-2"],["class","text-center",4,"ngIf"],[1,"text-center","col-add"],["type","button","title","Agregar rubro te\xF3rico",1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],["rowspan","2",1,"text-center","col-teo"],["type","button","title","Agregar rubro pr\xE1ctico",1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],["rowspan","2",1,"text-center","col-pra"],["rowspan","2",1,"text-center","col-sum"],["class","text-center",4,"ngFor","ngForOf"],[1,"text-muted"],[4,"ngFor","ngForOf"],[1,"text-center"],[1,"rubro-head-wrap"],[1,"rubro-head"],[1,"rubro-actions"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"sticky-col","col-meta"],[1,"fw-semibold"],[1,"sticky-col","col-meta-2"],[3,"cell-selected",4,"ngFor","ngForOf"],[1,"col-add"],[1,"col-teo","text-center"],[1,"col-pra","text-center"],[1,"col-sum","text-center"],["type","number","min","0","step","1","inputmode","numeric",1,"form-control","form-control-sm",3,"ngModelChange","id","paste","keydown","mousedown","ngModel","data-row","data-col"],[1,"modal-backdrop","fade","show"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"div",4)(6,"h5",5),l(7,"Registro de calificaciones"),o(),x(8,_t,2,0,"span",6)(9,gt,2,1,"span",7),o(),x(10,xt,9,5,"div",8),o(),a(11,"div",4)(12,"div",9)(13,"span",10),l(14,"Modo:"),o(),a(15,"select",11),T("ngModelChange",function(r){return P(i.modoEval,r)||(i.modoEval=r),r}),_("ngModelChange",function(r){return i.onModoChange(r)}),a(16,"option",12),l(17,"Promediar sobre 100 \u2192 Teo20 + Asist10 / Prac70"),o(),a(18,"option",12),l(19,"Promediar sobre 30/70 (Asist10 fijo)"),o(),a(20,"option",12),l(21,"Sumatoria (Asist10 fijo)"),o()()(),a(22,"div",13)(23,"button",14),_("click",function(){return i.recargar()}),l(24,"Recargar"),o(),a(25,"button",15),_("click",function(){return i.guardarCambios()}),l(26," Guardar "),o()()()(),x(27,Et,4,3,"div",16),a(28,"ul",17)(29,"li",18)(30,"button",19),_("click",function(){return i.setEval(1)}),l(31,"Eval 1"),o()(),a(32,"li",18)(33,"button",19),_("click",function(){return i.setEval(2)}),l(34,"Eval 2"),o()(),a(35,"li",18)(36,"button",19),_("click",function(){return i.setEval(3)}),l(37,"Eval 3"),o()(),a(38,"li",18)(39,"button",19),_("click",function(){return i.setEval(4)}),l(40,"Eval 4"),o()()()(),a(41,"div",20),x(42,wt,8,5,"div",21)(43,Ot,33,10,"div",22)(44,Nt,2,0,"div",23),o()(),a(45,"div",24),_("click",function(r){return i.onModalBackdrop(r)}),a(46,"div",25),_("click",function(r){return r.stopPropagation()}),a(47,"div",26)(48,"div",27)(49,"h5",28),l(50),o(),a(51,"button",29),_("click",function(){return i.cerrarModal()}),o()(),a(52,"div",30)(53,"div",31)(54,"label",32),l(55,"Nombre"),o(),a(56,"input",33),T("ngModelChange",function(r){return P(i.nuevoNombre,r)||(i.nuevoNombre=r),r}),_("keydown.enter",function(){return i.confirmarModal()}),o()(),a(57,"div",34)(58,"div",35)(59,"label",32),l(60,"Max puntos"),o(),a(61,"input",36),T("ngModelChange",function(r){return P(i.nuevoMax,r)||(i.nuevoMax=r),r}),o()(),a(62,"div",35)(63,"label",32),l(64,"Orden"),o(),a(65,"input",36),T("ngModelChange",function(r){return P(i.nuevoOrden,r)||(i.nuevoOrden=r),r}),o()()(),a(66,"div",37),l(67,"Notas: todo se guarda como n\xFAmero entero (redondeado)."),o()(),a(68,"div",38)(69,"button",39),_("click",function(){return i.cerrarModal()}),l(70,"Cancelar"),o(),a(71,"button",40),_("click",function(){return i.confirmarModal()}),l(72),o()()()()(),x(73,Vt,1,0,"div",41),o()),e&2&&(s(8),u("ngIf",i.isLoading),s(),u("ngIf",!i.isLoading&&i.dirty.size>0),s(),u("ngIf",i.materia),s(5),I("ngModel",i.modoEval),u("disabled",i.isLoading||i.isSaving),s(),u("ngValue",1),s(2),u("ngValue",2),s(2),u("ngValue",3),s(3),u("disabled",i.isLoading||i.isSaving),s(2),u("disabled",i.isLoading||i.isSaving||i.dirty.size===0),s(2),u("ngIf",i.loadError||i.saveError||i.saveOk),s(3),O("active",i.evalNum===1),s(3),O("active",i.evalNum===2),s(3),O("active",i.evalNum===3),s(3),O("active",i.evalNum===4),s(3),u("ngIf",i.meta),s(),u("ngIf",i.rows.length),s(),u("ngIf",!i.isLoading&&!i.rows.length),s(),we("display",i.modalVisible?"block":"none"),O("show",i.modalVisible),V("aria-hidden",!i.modalVisible),s(5),$("",i.modalModo==="create"?"Agregar":"Editar"," rubro ",i.modalTipo==="TEO"?"te\xF3rico":"pr\xE1ctico"),s(6),I("ngModel",i.nuevoNombre),s(5),I("ngModel",i.nuevoMax),s(4),I("ngModel",i.nuevoOrden),s(6),u("disabled",!i.nuevoNombre.trim()||i.isLoading||i.isSaving),s(),S(i.modalModo==="create"?"Agregar":"Guardar"),s(),u("ngIf",i.modalVisible))},dependencies:[B,z,q,Q,W,le,H,G,ce,U],styles:["[_nghost-%COMP%]{display:block}.reg-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.reg-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:3;background:var(--bs-tertiary-bg)}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.col-meta[_ngcontent-%COMP%]{min-width:260px}.col-meta-2[_ngcontent-%COMP%]{left:260px;min-width:120px;z-index:2}.col-teo[_ngcontent-%COMP%], .col-pra[_ngcontent-%COMP%], .col-sum[_ngcontent-%COMP%]{min-width:90px}.col-add[_ngcontent-%COMP%]{width:42px;min-width:42px;max-width:42px}.reg-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .reg-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.rubro-head[_ngcontent-%COMP%]{writing-mode:vertical-lr;text-orientation:mixed;white-space:normal;line-height:1.1;font-weight:600;max-height:180px;overflow:hidden;margin:0 auto}.rubro-head-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px}.rubro-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.reg-grid[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{padding:.15rem .35rem;text-align:center}.reg-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.cell-selected[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{outline:2px solid var(--bs-primary);outline-offset:-1px}"]});var me=Y;var Dt=["modalEditarInscripcion"],Ft=["modalReporte"];function Lt(c,t){c&1&&(a(0,"span",53),l(1,"INACTIVO"),o())}function Kt(c,t){if(c&1){let e=M();a(0,"button",50),_("click",function(){let n=g(e).$implicit,r=m(2);return h(r.seleccionarDocente(n))}),a(1,"span"),l(2),o(),a(3,"span",51)(4,"span",52),l(5),o(),x(6,Lt,2,0,"span",15),o()()}if(c&2){let e=t.$implicit,i=m(2);u("disabled",i.docenteInactivo(e)),s(2),S(i.getNombreCompletoDocente(e)),s(3),S(i.getConteoAsignadosDocente(e)),s(),u("ngIf",i.docenteInactivo(e))}}function jt(c,t){if(c&1&&(a(0,"div",48),x(1,Kt,7,4,"button",49),o()),c&2){let e=m();s(),u("ngForOf",e.docentesFiltrados)}}function $t(c,t){if(c&1&&(a(0,"span",54),l(1),o()),c&2){let e=m();s(),E("Asignados: ",e.conteoAsignados)}}function Bt(c,t){if(c&1&&(a(0,"span",53),l(1),o()),c&2){let e=m();s(),E("Mostrando: ",e.collectionSize)}}function zt(c,t){if(c&1){let e=M();a(0,"button",55),_("click",function(){g(e);let n=m();return h(n.refrescarPantalla())}),l(1,"Refrescar"),o()}}function Wt(c,t){if(c&1){let e=M();a(0,"button",56),_("click",function(){g(e);let n=m();return h(n.limpiarDocente())}),l(1,"Limpiar"),o()}}function Gt(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e.id),s(),S(e.Nombre)}}function Ut(c,t){if(c&1){let e=M();a(0,"div",19)(1,"div",10)(2,"select",20),T("ngModelChange",function(n){g(e);let r=m();return P(r.institucionesFiltroId,n)||(r.institucionesFiltroId=n),h(n)}),_("change",function(){g(e);let n=m();return h(n.onFiltroChange())}),a(3,"option",23),l(4,"(Todas)"),o(),x(5,Gt,2,2,"option",21),o(),a(6,"label"),l(7,"Instituci\xF3n"),o()()()}if(c&2){let e=m();s(2),I("ngModel",e.institucionesFiltroId),s(),u("ngValue",null),s(2),u("ngForOf",e.instituciones)}}function Ht(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e.id),s(),S(e.Anio)}}function qt(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e.value),s(),S(e.label)}}function Qt(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e),s(),E("",e," por p\xE1gina")}}function Xt(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e.label),s(),S(e.label)}}function Yt(c,t){if(c&1&&(a(0,"option",23),l(1),o()),c&2){let e=t.$implicit;u("ngValue",e.label),s(),S(e.label)}}function Zt(c,t){c&1&&(a(0,"tr")(1,"td",57)(2,"div",58)(3,"span",59),l(4,"Cargando..."),o()()()())}function Jt(c,t){c&1&&(a(0,"tr")(1,"td",60),l(2,"Selecciona un docente para ver sus estudiantes."),o()())}function ei(c,t){c&1&&(a(0,"tr")(1,"td",57),l(2,"No hay estudiantes con los filtros actuales."),o()())}function ti(c,t){if(c&1){let e=M();a(0,"button",65),_("click",function(){g(e);let n=m().$implicit,r=m();return h(r.quitarDocenteAsignado(n))}),l(1," Quitar doc "),o()}}function ii(c,t){if(c&1){let e=M();a(0,"button",66),_("click",function(){g(e);let n=m().$implicit,r=m();return h(r.asignarADocenteSeleccionado(n))}),l(1," Asignar doc "),o()}}function ni(c,t){if(c&1&&(a(0,"tr")(1,"td",43),l(2),o(),a(3,"td")(4,"span",61),l(5),o()(),a(6,"td"),l(7),o(),a(8,"td"),l(9),o(),a(10,"td"),l(11),o(),a(12,"td"),l(13),o(),a(14,"td"),l(15),o(),a(16,"td"),l(17),o(),a(18,"td"),l(19),o(),a(20,"td",43),l(21),o(),a(22,"td"),l(23),o(),a(24,"td",62),x(25,ti,2,0,"button",63)(26,ii,2,0,"button",64),o()()),c&2){let e=t.$implicit,i=t.index,n=m();s(2),S((n.pagina-1)*n.pageSize+(i+1)),s(2),u("ngClass",n.getDocenteActualRow(e)&&n.getDocenteActualRow(e)!=0?"bg-success":"bg-secondary"),s(),E(" ",n.getDocenteNombreById(n.getDocenteActualRow(e))," "),s(2),$("",e.Ap_Paterno," ",e.Ap_Materno),s(2),S(e.Nombre),s(2),S(e.Celular),s(2),S(e.NumCelP),s(2),S(e.NumCelM),s(2),S(n.cursoSolicitadoLabel(e)),s(2),S(n.getInstrumentoRow(e)),s(2),S(e.Anio),s(2),S(n.cursoAsignadoLabel(e)),s(2),u("ngIf",n.docenteSeleccionado&&n.getDocenteActualRow(e)&&n.getDocenteActualRow(e)!=0),s(),u("ngIf",n.docenteSeleccionado&&(!n.getDocenteActualRow(e)||n.getDocenteActualRow(e)==0))}}function oi(c,t){if(c&1){let e=M();a(0,"div",67)(1,"ngb-pagination",68),T("pageChange",function(n){g(e);let r=m();return P(r.pagina,n)||(r.pagina=n),h(n)}),_("pageChange",function(){g(e);let n=m();return h(n.cargarEstudiantes())}),o()()}if(c&2){let e=m();s(),I("page",e.pagina),u("collectionSize",e.collectionSize)("pageSize",e.pageSize)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0)}}function ai(c,t){if(c&1){let e=M();a(0,"button",50),_("click",function(){let n=g(e).$implicit,r=m(3);return h(r.seleccionarDocenteEdicion(n))}),a(1,"span"),l(2),o(),a(3,"span",61),l(4),o()()}if(c&2){let e=t.$implicit,i=m(3);u("disabled",i.docenteInactivo(e)),s(2),S(i.getNombreCompletoDocente(e)),s(),u("ngClass",i.docenteInactivo(e)?"bg-secondary":"bg-primary"),s(),S(i.docenteInactivo(e)?"INACTIVO":"OK")}}function ri(c,t){if(c&1&&(a(0,"div",93),x(1,ai,5,4,"button",49),o()),c&2){let e=m(2);s(),u("ngForOf",e.docentesFiltradosEdit)}}function si(c,t){c&1&&(a(0,"span"),l(1,"Guardar"),o())}function li(c,t){c&1&&(a(0,"span"),l(1,"Guardando..."),o())}function ci(c,t){if(c&1){let e=M();a(0,"div",69)(1,"h5",70),l(2,"Editar inscripci\xF3n (cambiar docente / datos clave)"),o(),a(3,"button",71),_("click",function(){let n=g(e).$implicit;return h(n.dismiss("close"))}),o()(),a(4,"div",72)(5,"form",73)(6,"div",3)(7,"div",74)(8,"div",9)(9,"div",10)(10,"input",11),_("focus",function(){g(e);let n=m();return h(n.onDocenteEditFocus())})("blur",function(){g(e);let n=m();return h(n.onDocenteEditBlur())}),o(),a(11,"label"),l(12),o()(),x(13,ri,2,1,"div",75),o(),a(14,"div",76),l(15,"Si est\xE1 vac\xEDo, quedar\xE1 sin docente asignado."),o()(),a(16,"div",74)(17,"div",10),R(18,"input",77),a(19,"label"),l(20,"Fecha inscripci\xF3n"),o()()()(),a(21,"div",78)(22,"div",79)(23,"div",10),R(24,"input",80),a(25,"label"),l(26,"Curso solicitado"),o()()(),a(27,"div",79)(28,"div",10),R(29,"input",81),a(30,"label"),l(31,"Paralelo solicitado"),o()()(),a(32,"div",79)(33,"div",10),R(34,"input",82),a(35,"label"),l(36,"Turno"),o()()()(),a(37,"div",78)(38,"div",74)(39,"div",10),R(40,"input",83),a(41,"label"),l(42,"Instrumento musical"),o()()(),a(43,"div",74)(44,"div",10),R(45,"input",84),a(46,"label"),l(47,"Instrumento musical (sec.)"),o()()()(),a(48,"div",78)(49,"div",79)(50,"div",10),R(51,"input",85),a(52,"label"),l(53,"Categor\xEDa"),o()()(),a(54,"div",79)(55,"div",10),R(56,"input",86),a(57,"label"),l(58,"Verificaci\xF3n"),o()()(),a(59,"div",79)(60,"div",10),R(61,"input",87),a(62,"label"),l(63,"Matr\xEDcula"),o()()()(),a(64,"div",78)(65,"div",88)(66,"div",10),R(67,"textarea",89),a(68,"label"),l(69,"Observaci\xF3n"),o()()()()()(),a(70,"div",90)(71,"button",91),_("click",function(){let n=g(e).$implicit;return h(n.dismiss("cancel"))}),l(72,"Cancelar"),o(),a(73,"button",92),_("click",function(){g(e);let n=m();return h(n.guardarInscripcion())}),x(74,si,2,0,"span",45)(75,li,2,0,"span",45),o()()}if(c&2){let e=m();s(5),u("formGroup",e.newinfoestudiantesifas),s(5),u("formControl",e.docEditInput),s(2),E("Docente (",e.tituloModo,")"),s(),u("ngIf",e.mostrarListaDocentesEdit&&e.docentesFiltradosEdit.length>0),s(60),u("disabled",e.isSaving),s(),u("ngIf",!e.isSaving),s(),u("ngIf",e.isSaving)}}function di(c,t){if(c&1&&(a(0,"div",97)(1,"div")(2,"strong"),l(3,"Docente:"),o(),l(4),o(),a(5,"div")(6,"strong"),l(7,"Modo:"),o(),l(8),o(),a(9,"div")(10,"strong"),l(11,"Instituci\xF3n:"),o(),l(12),o(),a(13,"div")(14,"strong"),l(15,"A\xF1o:"),o(),l(16),o(),a(17,"div")(18,"strong"),l(19,"Especialidad:"),o(),l(20),o(),a(21,"div")(22,"strong"),l(23,"Curso solicitado:"),o(),l(24),o(),a(25,"div")(26,"strong"),l(27,"Curso asignado:"),o(),l(28),o(),a(29,"div")(30,"strong"),l(31,"Buscar:"),o(),l(32),o(),a(33,"div")(34,"strong"),l(35,"Orden:"),o(),l(36),o(),a(37,"div")(38,"strong"),l(39,"Filas en la tabla (p\xE1gina actual):"),o(),l(40),o(),a(41,"div")(42,"strong"),l(43,"Total filtrado:"),o(),l(44),o()()),c&2){let e=m(2);s(4),E(" ",e.reporteResumen.docente),s(4),E(" ",e.tituloModo),s(4),E(" ",e.reporteResumen.institucion),s(4),E(" ",e.reporteResumen.anio_id),s(4),E(" ",e.reporteResumen.especialidad),s(4),E(" ",e.reporteResumen.cursoSolicitado),s(4),E(" ",e.reporteResumen.cursoAsignado),s(4),E(" ",e.reporteResumen.buscar),s(4),E(" ",e.reporteResumen.orden),s(4),E(" ",e.reporteResumen.filas),s(4),E(" ",e.reporteResumen.totalFiltrado)}}function ui(c,t){c&1&&(a(0,"div",98),l(1,"No hay informaci\xF3n del reporte."),o())}function mi(c,t){if(c&1){let e=M();a(0,"div",69)(1,"h5",70),l(2,"Generar reporte (PDF) - tabla actual"),o(),a(3,"button",71),_("click",function(){let n=g(e).$implicit;return h(n.dismiss("close"))}),o()(),a(4,"div",72),x(5,di,45,11,"div",94)(6,ui,2,0,"div",95),o(),a(7,"div",90)(8,"button",91),_("click",function(){let n=g(e).$implicit;return h(n.dismiss("cancel"))}),l(9,"Cancelar"),o(),a(10,"button",96),_("click",function(){g(e);let n=m();return h(n.generarReportePdfActual())}),l(11," Generar PDF "),o()()}if(c&2){let e=m();s(5),u("ngIf",e.reporteResumen),s(),u("ngIf",!e.reporteResumen),s(4),u("disabled",!e.estudiantes||e.estudiantes.length===0)}}var Z=class Z{constructor(t,e,i,n,r,d,p,f,b){this._infoest=t;this._planteldoc=e;this._anios=i;this._controles=n;this._inst=r;this._auth=d;this._tools=p;this._reportes=f;this.route=b;this.modo="especialidad";this.docenteFieldKey="planteldocadmins_id";this.instrumentoFieldKey="InstrumentoMusical";this.tituloModo="Especialidad";this.esSuperAdmin=!1;this.instituciones=[];this.institucionesFiltroId=null;this.anios=[];this.selectedAnioId=null;this.especialidadOptions=[];this.especialidadSecundariaOptions=[];this.especialidadSeleccionada="";this.cursoOptions=[];this.cursoSolicitadoSeleccionado="";this.cursoAsignadoSeleccionado="";this.sortBy="NombreEstudiante";this.sortDir="asc";this.includeSinDocente=!1;this.filterTxt="";this.plantelDocentes=[];this.docenteInput=new be("");this.docentesFiltrados=[];this.mostrarListaDocentes=!1;this.docenteSeleccionado=null;this.estudiantes=[];this.isLoading=!1;this.pagina=1;this.pageSize=100;this.pageSizeOptions=[10,20,50,100,200];this.collectionSize=0;this.conteoAsignados=0;this.docenteConteoMap={};this.isLoadingConteoDocentes=!1;this.isLoadingCursosOptions=!1;this.cursoSolicitadoOptionsDocente=[];this.cursoAsignadoOptionsDocente=[];this.isSaving=!1;this.reporteResumen=null;this.docEditInput=new be("");this.docentesFiltradosEdit=[];this.mostrarListaDocentesEdit=!1;this.newinfoestudiantesifas=this._infoest.createFormGroupinfoestudiantesifas()}ngOnInit(){this.route.data.subscribe(t=>{let e=t?.modo??"especialidad";this.setModo(e)}),this._auth.revisarSiEsSuperAdmin().subscribe(t=>{this.esSuperAdmin=t,t&&this.cargarInstituciones()}),this.cargarAnios(),this.cargarOptionsInstrumentos(),this.cargarPlantelDocentes(),this.setupBuscadorDocentes(),this.setupBuscadorDocentesEdicion()}setModo(t){if(this.modo=t,t==="complementario"){this.docenteFieldKey="planteldocadmins_idOtros",this.instrumentoFieldKey="InstrumentoMusicalSecundario",this.tituloModo="Complementario";return}if(t==="practicaconjuntos"){this.docenteFieldKey="planteldocadmins_idPC",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModo="Pr\xE1ctica de conjuntos";return}this.docenteFieldKey="planteldocadmins_id",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModo="Especialidad"}get instrumentoOptions(){return this.instrumentoFieldKey==="InstrumentoMusicalSecundario"?this.especialidadSecundariaOptions||[]:this.especialidadOptions||[]}get instrumentoFiltroLabel(){return this.instrumentoFieldKey==="InstrumentoMusicalSecundario"?"Especialidad secundaria":"Especialidad"}normalizar(t){return(t??"").toString().trim().toUpperCase()}onDocenteFocus(){this.mostrarListaDocentes=!0}onDocenteBlur(){window.setTimeout(()=>{this.mostrarListaDocentes=!1},150)}onDocenteEditFocus(){this.mostrarListaDocentesEdit=!0}onDocenteEditBlur(){window.setTimeout(()=>{this.mostrarListaDocentesEdit=!1},150)}normalizarPayloadDocenteIds(t){let e=A({},t??{});return["planteldocadmins_id","planteldocadmins_idPC","planteldocadmins_idOtros"].forEach(n=>{if(!(n in e))return;let r=e[n];if(r===""||r===void 0){e[n]=null;return}let d=Number(r);if(!Number.isFinite(d)||d<=0){e[n]=null;return}e[n]=d}),e}getInstitucionFiltroId(){if(!this.esSuperAdmin)return null;let t=Number(this.institucionesFiltroId??0);return Number.isFinite(t)&&t>0?t:null}cargarInstituciones(){this._inst.Obtenerinstituciones().subscribe({next:t=>{this.instituciones=t?.data||[]},error:()=>{this.instituciones=[]}})}cargarAnios(){this._anios.ObtenerAniosConPredeterminado().subscribe({next:({anios:t,predeterminado:e})=>{this.anios=t||[];let i=Number(e?.id??0);this.selectedAnioId=Number.isFinite(i)&&i>0?i:this.anios?.[0]?.id??null,this.cargarConteoDocentes()},error:()=>{this.anios=[],this.selectedAnioId=null}})}cargarOptionsInstrumentos(){let t=["LVLCURSO","ESPECIALIDAD","ESPECIALIDAD SECUNDARIA"];this._controles.ObtenerOptionsSelectPorCategorias(t).subscribe({next:e=>{this.cursoOptions=e?.LVLCURSO||[],this.especialidadOptions=e?.ESPECIALIDAD||[],this.especialidadSecundariaOptions=e?.["ESPECIALIDAD SECUNDARIA"]||[]},error:()=>{this.cursoOptions=[],this.especialidadOptions=[],this.especialidadSecundariaOptions=[]}})}cargarPlantelDocentes(){this._planteldoc.Obtenerplanteldocentes().subscribe({next:t=>{let e=t?.data||[];this.plantelDocentes=e.filter(i=>this.normalizar(i?.Visibilidad)!=="OCULTO").sort((i,n)=>this.getNombreCompletoDocente(i).localeCompare(this.getNombreCompletoDocente(n))),this.cargarConteoDocentes()},error:()=>{this.plantelDocentes=[]}})}getConteoAsignadosDocente(t){let e=String(t?.id??"").trim();if(!e)return 0;let i=Number(this.docenteConteoMap?.[e]??0);return Number.isFinite(i)&&i>0?i:0}getNombreCompletoDocente(t){let e=(t?.Nombres??"").toString().trim(),i=(t?.Apellidos??"").toString().trim();return`${e} ${i}`.trim()}getDocenteNombreById(t){let e=String(t??"").trim();if(!e||e==="0")return"SIN ASIGNAR";let i=(this.plantelDocentes||[]).find(n=>String(n?.id)===e);return i?this.getNombreCompletoDocente(i):`ID ${e}`}getDocenteActualRow(t){return t?.[this.docenteFieldKey]}getInstrumentoRow(t){return t?.[this.instrumentoFieldKey]}docenteInactivo(t){return this.normalizar(t?.Estado)==="INACTIVO"}filtrarPlantelDocentes(t,e=!1){let i=this.getInstitucionFiltroId(),n=(this.plantelDocentes||[]).filter(r=>i?Number(r?.instituciones_id??0)===i:!0);return e?n.slice(0,50):t?n.filter(r=>this.getNombreCompletoDocente(r).toLowerCase().includes(t)).slice(0,25):[]}setupBuscadorDocentes(){this.docenteInput.valueChanges.subscribe(t=>{let e=(t??"").toString();if(e===""){this.docentesFiltrados=[],this.docenteSeleccionado=null;return}if(e.trim()===""){this.docentesFiltrados=this.filtrarPlantelDocentes("",!0);return}this.docenteSeleccionado=null,this.docentesFiltrados=this.filtrarPlantelDocentes(e.toLowerCase().trim())})}seleccionarDocente(t){!t||this.docenteInactivo(t)||(this.docenteSeleccionado=t,this.docenteInput.setValue(this.getNombreCompletoDocente(t),{emitEvent:!1}),this.mostrarListaDocentes=!1,this.docentesFiltrados=[],this.pagina=1,this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta())}limpiarDocente(){this.docenteSeleccionado=null,this.docenteInput.setValue("",{emitEvent:!1}),this.docentesFiltrados=[],this.estudiantes=[],this.collectionSize=0,this.conteoAsignados=0,this.cursoSolicitadoSeleccionado="",this.cursoAsignadoSeleccionado="",this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[]}setupBuscadorDocentesEdicion(){this.docEditInput.valueChanges.subscribe(t=>{let e=(t??"").toString();if(e===""){this.docentesFiltradosEdit=[],this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:""});return}if(e.trim()===""){this.docentesFiltradosEdit=this.filtrarPlantelDocentes("",!0);return}this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:""}),this.docentesFiltradosEdit=this.filtrarPlantelDocentes(e.toLowerCase().trim())})}seleccionarDocenteEdicion(t){!t||this.docenteInactivo(t)||(this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:t?.id??""}),this.docEditInput.setValue(this.getNombreCompletoDocente(t),{emitEvent:!1}),this.mostrarListaDocentesEdit=!1,this.docentesFiltradosEdit=[])}syncDocenteEdicionConForm(){let t=this.newinfoestudiantesifas.get(this.docenteFieldKey)?.value,e=(this.plantelDocentes||[]).find(i=>String(i?.id)===String(t));this.docEditInput.setValue(e?this.getNombreCompletoDocente(e):"",{emitEvent:!1})}buildParams(t){let e=Number(this.docenteSeleccionado?.id??0),i=(this.especialidadSeleccionada??"").trim()||void 0,n=A({page:this.pagina,per_page:this.pageSize,anio_id:this.selectedAnioId??void 0,search:(this.filterTxt??"").trim()||void 0,search_mode:"any",relevance:0,include_sin_docente:this.includeSinDocente?1:0,sort_by:this.sortBy||void 0,sort_dir:this.sortDir||void 0},t||{});n.include_sin_asignar=1,n.anio_scope="default",e>0&&(n[this.docenteFieldKey]=e),i&&(n[this.instrumentoFieldKey]=i);let r=(this.cursoSolicitadoSeleccionado??"").trim();if(r){let f=(this.cursoSolicitadoOptionsDocente||[]).find(b=>String(b?.label??"").trim()===r);if(f)n.Curso_Solicitado=(f.curso??"").trim(),n.Paralelo_Solicitado=(f.paralelo??"").trim();else{let b=r.split(" ").filter(Boolean);n.Curso_Solicitado=b.slice(0,-1).join(" ")||r,n.Paralelo_Solicitado=b.length>1?b[b.length-1]:""}}let d=(this.cursoAsignadoSeleccionado??"").trim();if(d){let f=(this.cursoAsignadoOptionsDocente||[]).find(b=>String(b?.label??"").trim()===d);if(f)n.CursoAsignado=(f.curso??"").trim(),n.ParaleloAsignado=(f.paralelo??"").trim();else{let b=d.split(" ").filter(Boolean);n.CursoAsignado=b.slice(0,-1).join(" ")||d,n.ParaleloAsignado=b.length>1?b[b.length-1]:""}}let p=this.getInstitucionFiltroId();return p&&(n.instituciones_id=p),n}buildParamsSinCursos(t){let e=Number(this.docenteSeleccionado?.id??0),i=(this.especialidadSeleccionada??"").trim()||void 0,n=A({page:this.pagina,per_page:this.pageSize,anio_id:this.selectedAnioId??void 0,search:(this.filterTxt??"").trim()||void 0,search_mode:"any",relevance:0,include_sin_docente:this.includeSinDocente?1:0,sort_by:this.sortBy||void 0,sort_dir:this.sortDir||void 0},t||{});n.include_sin_asignar=1,n.anio_scope="default",e>0&&(n[this.docenteFieldKey]=e),i&&(n[this.instrumentoFieldKey]=i);let r=this.getInstitucionFiltroId();return r&&(n.instituciones_id=r),n}recalcularCursosOptionsDesdeRows(t){let e=new Map,i=new Map;(t||[]).forEach(n=>{let r=String(n?.Curso_Solicitado??"").trim(),d=String(n?.Paralelo_Solicitado??"").trim(),p=`${r} ${d}`.replace(/\s+/g," ").trim();r&&e.set(p,{label:p,curso:r,paralelo:d});let f=String(n?.CursoAsignado??"").trim(),b=String(n?.ParaleloAsignado??"").trim(),v=`${f} ${b}`.replace(/\s+/g," ").trim();f&&f.toUpperCase()!=="SIN ASIGNAR"&&i.set(v,{label:v,curso:f,paralelo:b})}),this.cursoSolicitadoOptionsDocente=Array.from(e.values()).sort((n,r)=>n.label.localeCompare(r.label)),this.cursoAsignadoOptionsDocente=Array.from(i.values()).sort((n,r)=>n.label.localeCompare(r.label)),this.cursoSolicitadoSeleccionado&&!(this.cursoSolicitadoOptionsDocente||[]).some(n=>n.label===this.cursoSolicitadoSeleccionado)&&(this.cursoSolicitadoSeleccionado=""),this.cursoAsignadoSeleccionado&&!(this.cursoAsignadoOptionsDocente||[]).some(n=>n.label===this.cursoAsignadoSeleccionado)&&(this.cursoAsignadoSeleccionado="")}cargarCursosOptionsDesdeTablaCompleta(){if(!this.docenteSeleccionado?.id){this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[];return}this.isLoadingCursosOptions=!0;let t=this.buildParamsSinCursos({page:1,per_page:5e3,search:void 0});this._infoest.Obtenerinfoestudiantesifas(t).subscribe({next:e=>{let i=e?.data||[];this.recalcularCursosOptionsDesdeRows(i),this.isLoadingCursosOptions=!1},error:()=>{this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[],this.isLoadingCursosOptions=!1}})}buildDocenteScopedParamsBase(){let t=Number(this.docenteSeleccionado?.id??0),e=(this.especialidadSeleccionada??"").trim()||void 0,i={anio_id:this.selectedAnioId??void 0,include_sin_asignar:1,include_sin_docente:this.includeSinDocente?1:0,anio_scope:"default"},n=this.getInstitucionFiltroId();return n&&(i.instituciones_id=n),t>0&&(i[this.docenteFieldKey]=t),e&&(i[this.instrumentoFieldKey]=e),i}cargarConteoDocentes(){this.isLoadingConteoDocentes=!0;let t=ne(A({},this.buildDocenteScopedParamsBase()),{docente_field:this.docenteFieldKey});delete t[this.docenteFieldKey],this._infoest.ObtenerConteoDocentes(t).subscribe({next:e=>{let i=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],n={};(i||[]).forEach(r=>{let d=String(r?.docente_id??r?.docenteId??r?.id??"").trim();if(!d||d==="0")return;let p=Number(r?.total??r?.cantidad??r?.count??0);n[d]=Number.isFinite(p)&&p>0?p:0}),this.docenteConteoMap=n,this.isLoadingConteoDocentes=!1},error:()=>{this.docenteConteoMap={},this.isLoadingConteoDocentes=!1}})}normalizarSexo(t){let e=(t??"").toString().trim().toUpperCase();return e?e==="M"||e.startsWith("MAS")?"M":e==="F"||e.startsWith("FEM")?"F":e.includes("MASC")?"M":e.includes("FEM")?"F":"":""}copyTextToClipboard(t){return D(this,null,function*(){try{if(navigator?.clipboard?.writeText){yield navigator.clipboard.writeText(t);return}}catch{}let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}copiarTablaParaExcelPlantilla(){return D(this,null,function*(){let t=this.estudiantes||[];if(!t.length){this._tools.MostrarMensaje("info","No hay filas para copiar");return}let i=t.map(n=>{let r=`${(n?.Ap_Paterno??"").toString().trim()} ${(n?.Ap_Materno??"").toString().trim()} ${(n?.Nombre??"").toString().trim()}`.replace(/\s+/g," ").trim(),d=(n?.CI??"").toString().trim(),p=(this.getInstrumentoRow(n)??"").toString().trim(),f=this.normalizarSexo(n?.Sexo),b=f==="F"?"X":"",v=f==="M"?"X":"",y=new Array(5).fill("");return y[0]=r,y[1]=d,y[2]=p,y[3]=v,y[4]=b,y.join("	")}).join(`
`);this._tools.MostrarMensajeLoading();try{yield this.copyTextToClipboard(i),this._tools.MostrarMensajeSuccess()}catch(n){console.error(n),this._tools.MostrarMensajeError()}})}refrescarTodo(){this.docenteSeleccionado?.id&&(this.cargarConteoAsignados(),this.cargarEstudiantes())}refrescarPantalla(){this.cargarPlantelDocentes(),this.cargarConteoDocentes(),this.docenteSeleccionado?.id&&(this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta())}onFiltroChange(){this.pagina=1,this.refrescarTodo(),this.cargarConteoDocentes(),this.cargarCursosOptionsDesdeTablaCompleta()}onCursoFilterChange(){this.pagina=1,this.refrescarTodo()}onCursoSolicitadoChange(){(this.cursoSolicitadoSeleccionado??"").trim()&&(this.cursoAsignadoSeleccionado=""),this.pagina=1,this.refrescarTodo()}onCursoAsignadoChange(){(this.cursoAsignadoSeleccionado??"").trim()&&(this.cursoSolicitadoSeleccionado=""),this.pagina=1,this.refrescarTodo()}onPageSizeChange(){this.pagina=1,this.cargarEstudiantes()}abrirModalReporteActual(){if(!this.docenteSeleccionado?.id)return;let t=this.getInstitucionFiltroId(),e=t?(this.instituciones||[]).find(i=>Number(i?.id??0)===Number(t))?.Nombre:null;this.reporteResumen={titulo:`Estudiantes por docente (${this.tituloModo})`,docente:this.getNombreCompletoDocente(this.docenteSeleccionado),anio_id:this.selectedAnioId,instituciones_id:t,institucion:e||"(seg\xFAn perfil)",especialidad:(this.especialidadSeleccionada??"").trim()||"(todas)",buscar:(this.filterTxt??"").trim()||"(sin texto)",incluirSinDocente:this.includeSinDocente?"S\xED":"No",cursoSolicitado:(this.cursoSolicitadoSeleccionado??"").trim()||"(todos)",cursoAsignado:(this.cursoAsignadoSeleccionado??"").trim()||"(todos)",orden:`${this.sortBy} ${this.sortDir}`.trim(),pagina:this.pagina,pageSize:this.pageSize,filas:(this.estudiantes||[]).length,totalFiltrado:this.collectionSize,fecha:new Date},this.modalReporteRef=this._tools.openModal(this.modalReporte,"lg")}generarReportePdfActual(){return D(this,null,function*(){if(!this.docenteSeleccionado?.id)return;let t=this.estudiantes||[];if(!t.length){this._tools.MostrarMensaje("info","No hay filas para reportar con los filtros actuales");return}try{this._tools.MostrarMensajeLoading?.()}catch{}try{yield this._reportes.GenerarListaEstudiantesPorDocenteTablaActual(t,this.reporteResumen);try{this._tools.OcultarMensajeLoading?.()}catch{}this._tools.closeModal(this.modalReporteRef)}catch(e){console.error(e);try{this._tools.OcultarMensajeLoading?.()}catch{}this._tools.MostrarMensaje("error","No se pudo generar el reporte")}})}cargarEstudiantes(){if(!this.docenteSeleccionado?.id){this.estudiantes=[],this.collectionSize=0;return}this.isLoading=!0;let t=this.buildParams();this._infoest.Obtenerinfoestudiantesifas(t).subscribe({next:e=>{this.estudiantes=e?.data||[],this.collectionSize=Number(e?.meta?.total??this.estudiantes.length??0),this.isLoading=!1},error:e=>{console.error("Error al cargar estudiantes",e),this.estudiantes=[],this.collectionSize=0,this.isLoading=!1}})}cargarConteoAsignados(){if(!this.docenteSeleccionado?.id){this.conteoAsignados=0;return}let t=this.buildParams({page:1,per_page:1,include_sin_docente:0});this._infoest.Obtenerinfoestudiantesifas(t).subscribe({next:e=>{this.conteoAsignados=Number(e?.meta?.total??0)},error:()=>{this.conteoAsignados=0}})}abrirEditarInscripcion(t){let e=Number(t?.id??0);!Number.isFinite(e)||e<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(e).subscribe({next:i=>{let n=i?.data??null;if(!n){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}Object.keys(this.newinfoestudiantesifas.controls).forEach(r=>{r in n&&this.newinfoestudiantesifas.get(r)?.setValue(n[r])}),this.syncDocenteEdicionConForm(),this.modalEditarInscripcionRef=this._tools.openModal(this.modalEditarInscripcion,"xl"),this._tools.MostrarMensajeSuccess()},error:i=>{console.error(i),this._tools.MostrarMensajeError()}}))}guardarInscripcion(){if(this.newinfoestudiantesifas.invalid){Object.values(this.newinfoestudiantesifas.controls).forEach(i=>{i.markAsTouched(),i.markAsDirty()}),this._tools.MostrarMensajeFrmIncompleto();return}let t=Number(this.newinfoestudiantesifas.get("id")?.value??0);if(!Number.isFinite(t)||t<=0)return;this.isSaving=!0,this._tools.MostrarMensajeLoading();let e=this.normalizarPayloadDocenteIds(this.newinfoestudiantesifas.value);this._infoest.Modificarinfoestudiantesifas(e,t).subscribe({next:()=>{this.isSaving=!1,this._tools.closeModal(this.modalEditarInscripcionRef),this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:i=>{console.error(i),this.isSaving=!1,this._tools.MostrarMensajeError()}})}asignarADocenteSeleccionado(t){let e=Number(this.docenteSeleccionado?.id??0),i=Number(t?.id??0);!Number.isFinite(e)||e<=0||!Number.isFinite(i)||i<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(i).subscribe({next:n=>{let r=n?.data??null;if(!r){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}let d=this.normalizarPayloadDocenteIds(ne(A({},r),{[this.docenteFieldKey]:e}));this._infoest.Modificarinfoestudiantesifas(d,i).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:p=>{console.error(p),this._tools.MostrarMensajeError()}})},error:n=>{console.error(n),this._tools.MostrarMensajeError()}}))}quitarDocenteAsignado(t){let e=Number(t?.id??0);!Number.isFinite(e)||e<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(e).subscribe({next:i=>{let n=i?.data??null;if(!n){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}let r=this.normalizarPayloadDocenteIds(ne(A({},n),{[this.docenteFieldKey]:null}));this._infoest.Modificarinfoestudiantesifas(r,e).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:d=>{console.error(d),this._tools.MostrarMensajeError()}})},error:i=>{console.error(i),this._tools.MostrarMensajeError()}}))}cursoSolicitadoLabel(t){let e=(t?.Curso_Solicitado??"").toString().trim(),i=(t?.Paralelo_Solicitado??"").toString().trim();return`${e} ${i}`.trim()}cursoAsignadoLabel(t){let e=(t?.CursoAsignado??"").toString().trim(),i=(t?.ParaleloAsignado??"").toString().trim(),n=`${e} ${i}`.trim();return n||"SIN ASIGNAR"}};Z.\u0275fac=function(e){return new(e||Z)(k(Ue),k(Ge),k(ze),k($e),k(Fe),k(Le),k(je),k(We),k(Te))},Z.\u0275cmp=j({type:Z,selectors:[["app-estudiantesxdocentesespecialidad"]],viewQuery:function(e,i){if(e&1&&(fe(Dt,7),fe(Ft,7)),e&2){let n;_e(n=ge())&&(i.modalEditarInscripcion=n.first),_e(n=ge())&&(i.modalReporte=n.first)}},standalone:!1,decls:133,vars:42,consts:[["modalEditarInscripcion",""],["modalReporte",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","align-items-end",2,"gap","12px"],[1,"col-12","col-lg-5"],[1,"position-relative"],[1,"form-floating"],["type","text","placeholder","Docente",1,"form-control",3,"focus","blur","formControl"],["class","list-group shadow","style","position: absolute; z-index: 2000; left: 0; right: 0; max-height: 40vh; overflow: auto;",4,"ngIf"],[1,"mt-2","d-flex","align-items-center",2,"gap","10px","flex-wrap","wrap"],["class","badge bg-info",4,"ngIf"],["class","badge bg-secondary",4,"ngIf"],["class","btn btn-outline-secondary btn-sm","type","button","title","Refrescar docentes, conteos y tabla",3,"click",4,"ngIf"],["class","btn btn-outline-secondary btn-sm","type","button",3,"click",4,"ngIf"],["class","col-12 col-lg-2",4,"ngIf"],[1,"col-12","col-lg-2"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-12","col-lg-3"],[3,"ngValue"],[1,"row","mt-3","align-items-center"],[1,"input-group"],[1,"input-group-text"],["type","text","placeholder","Apellidos, nombres, CI, curso...","title","Presiona Enter para buscar",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"col-12","col-lg-4","mt-2","mt-lg-0"],[1,"form-check"],["type","checkbox","id","chkSinDoc",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","chkSinDoc",1,"form-check-label","text-black"],[1,"col-12","col-lg-3","d-flex","justify-content-lg-end","mt-2","mt-lg-0",2,"gap","8px","flex-wrap","wrap"],["type","button",1,"btn","btn-outline-danger",3,"click","disabled"],["type","button",1,"btn","btn-outline-success",3,"click","disabled"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[1,"row","mt-2","align-items-end",2,"gap","12px"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center",2,"width","45px"],[1,"text-center"],[1,"text-center",2,"width","180px"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","d-flex justify-content-center mt-3",4,"ngIf"],[1,"list-group","shadow",2,"position","absolute","z-index","2000","left","0","right","0","max-height","40vh","overflow","auto"],["type","button","class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"disabled","click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click","disabled"],[1,"d-flex","align-items-center",2,"gap","8px"],["title","Cantidad de estudiantes asignados",1,"badge","bg-info"],[1,"badge","bg-secondary"],[1,"badge","bg-info"],["type","button","title","Refrescar docentes, conteos y tabla",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["colspan","12",1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["colspan","12",1,"text-center","text-muted"],[1,"badge",3,"ngClass"],[1,"text-center",2,"gap","6px"],["class","btn btn-outline-danger btn-sm","type","button","title","Quitar docente asignado",3,"click",4,"ngIf"],["class","btn btn-outline-primary btn-sm","type","button","title","Asignar a docente seleccionado",3,"click",4,"ngIf"],["type","button","title","Quitar docente asignado",1,"btn","btn-outline-danger","btn-sm",3,"click"],["type","button","title","Asignar a docente seleccionado",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"d-flex","justify-content-center","mt-3"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],[1,"col-12","col-lg-6"],["class","list-group shadow","style","position: absolute; z-index: 2100; left: 0; right: 0; max-height: 40vh; overflow: auto;",4,"ngIf"],[1,"form-text"],["type","date","formControlName","FechInsc","placeholder","",1,"form-control"],[1,"row","mt-3"],[1,"col-12","col-lg-4"],["type","text","formControlName","Curso_Solicitado","placeholder","",1,"form-control"],["type","text","formControlName","Paralelo_Solicitado","placeholder","",1,"form-control"],["type","text","formControlName","Turno","placeholder","",1,"form-control"],["type","text","formControlName","InstrumentoMusical","placeholder","",1,"form-control"],["type","text","formControlName","InstrumentoMusicalSecundario","placeholder","",1,"form-control"],["type","text","formControlName","Categoria","placeholder","",1,"form-control"],["type","text","formControlName","Verificacion","placeholder","",1,"form-control"],["type","text","formControlName","Matricula","placeholder","",1,"form-control"],[1,"col-12"],["formControlName","Observacion","placeholder","",1,"form-control",2,"height","100px"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"list-group","shadow",2,"position","absolute","z-index","2100","left","0","right","0","max-height","40vh","overflow","auto"],["class","alert alert-info",4,"ngIf"],["class","text-muted",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click","disabled"],[1,"alert","alert-info"],[1,"text-muted"]],template:function(e,i){if(e&1){let n=M();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),l(4),o(),a(5,"p",6),l(6,"Busca un docente, revisa sus estudiantes y reasigna inscripciones"),o()()()(),a(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10)(11,"input",11),_("focus",function(){return g(n),h(i.onDocenteFocus())})("blur",function(){return g(n),h(i.onDocenteBlur())}),o(),a(12,"label"),l(13,"Buscar docente"),o()(),x(14,jt,2,1,"div",12),o(),a(15,"div",13),x(16,$t,2,1,"span",14)(17,Bt,2,1,"span",15)(18,zt,2,0,"button",16)(19,Wt,2,0,"button",17),o()(),x(20,Ut,8,3,"div",18),a(21,"div",19)(22,"div",10)(23,"select",20),T("ngModelChange",function(d){return g(n),P(i.selectedAnioId,d)||(i.selectedAnioId=d),h(d)}),_("change",function(){return g(n),h(i.onFiltroChange())}),x(24,Ht,2,2,"option",21),o(),a(25,"label"),l(26,"A\xF1o"),o()()(),a(27,"div",22)(28,"div",10)(29,"select",20),T("ngModelChange",function(d){return g(n),P(i.especialidadSeleccionada,d)||(i.especialidadSeleccionada=d),h(d)}),_("change",function(){return g(n),h(i.onFiltroChange())}),a(30,"option",23),l(31,"(Todas las especialidades)"),o(),x(32,qt,2,2,"option",21),o(),a(33,"label"),l(34),o()()()(),a(35,"div",24)(36,"div",8)(37,"div",25)(38,"span",26),l(39,"Buscar"),o(),a(40,"input",27),T("ngModelChange",function(d){return g(n),P(i.filterTxt,d)||(i.filterTxt=d),h(d)}),_("keyup.enter",function(){return g(n),h(i.onFiltroChange())}),o(),a(41,"button",28),_("click",function(){return g(n),h(i.onFiltroChange())}),l(42,"Filtrar"),o()()(),a(43,"div",29)(44,"div",30)(45,"input",31),T("ngModelChange",function(d){return g(n),P(i.includeSinDocente,d)||(i.includeSinDocente=d),h(d)}),_("change",function(){return g(n),h(i.onFiltroChange())}),o(),a(46,"label",32),l(47,"Incluir estudiantes sin docente asignado"),o()()(),a(48,"div",33)(49,"button",34),_("click",function(){return g(n),h(i.abrirModalReporteActual())}),l(50," Generar reporte "),o(),a(51,"button",35),_("click",function(){return g(n),h(i.copiarTablaParaExcelPlantilla())}),l(52," Copiar a Excel "),o(),a(53,"select",36),T("ngModelChange",function(d){return g(n),P(i.pageSize,d)||(i.pageSize=d),h(d)}),_("change",function(){return g(n),h(i.onPageSizeChange())}),x(54,Qt,2,2,"option",21),o()()(),a(55,"div",37)(56,"div",22)(57,"div",10)(58,"select",38),T("ngModelChange",function(d){return g(n),P(i.cursoSolicitadoSeleccionado,d)||(i.cursoSolicitadoSeleccionado=d),h(d)}),_("change",function(){return g(n),h(i.onCursoSolicitadoChange())}),a(59,"option",23),l(60,"(Curso solicitado: todos)"),o(),x(61,Xt,2,2,"option",21),o(),a(62,"label"),l(63,"Curso solicitado"),o()()(),a(64,"div",22)(65,"div",10)(66,"select",38),T("ngModelChange",function(d){return g(n),P(i.cursoAsignadoSeleccionado,d)||(i.cursoAsignadoSeleccionado=d),h(d)}),_("change",function(){return g(n),h(i.onCursoAsignadoChange())}),a(67,"option",23),l(68,"(Curso asignado: todos)"),o(),x(69,Yt,2,2,"option",21),o(),a(70,"label"),l(71,"Curso asignado"),o()()(),a(72,"div",22)(73,"div",10)(74,"select",20),T("ngModelChange",function(d){return g(n),P(i.sortBy,d)||(i.sortBy=d),h(d)}),_("change",function(){return g(n),h(i.onFiltroChange())}),a(75,"option",23),l(76,"Orden: Ap.Paterno/Ap.Materno/Nombre"),o(),a(77,"option",23),l(78,"Orden: Curso solicitado"),o(),a(79,"option",23),l(80,"Orden: Curso asignado"),o(),a(81,"option",23),l(82,"Orden: A\xF1o"),o()(),a(83,"label"),l(84,"Ordenar por"),o()()(),a(85,"div",22)(86,"div",10)(87,"select",20),T("ngModelChange",function(d){return g(n),P(i.sortDir,d)||(i.sortDir=d),h(d)}),_("change",function(){return g(n),h(i.onFiltroChange())}),a(88,"option",23),l(89,"Ascendente"),o(),a(90,"option",23),l(91,"Descendente"),o()(),a(92,"label"),l(93,"Direcci\xF3n"),o()()()(),a(94,"div",39)(95,"div",40)(96,"table",41)(97,"thead")(98,"tr")(99,"th",42),l(100,"#"),o(),a(101,"th"),l(102,"Docente actual"),o(),a(103,"th"),l(104,"Apellidos"),o(),a(105,"th"),l(106,"Nombres"),o(),a(107,"th"),l(108,"Celular"),o(),a(109,"th"),l(110,"Cel. Pap\xE1"),o(),a(111,"th"),l(112,"Cel. Mam\xE1"),o(),a(113,"th"),l(114,"Curso solicitado"),o(),a(115,"th"),l(116),o(),a(117,"th",43),l(118,"A\xF1o"),o(),a(119,"th"),l(120,"Curso asignado"),o(),a(121,"th",44),l(122,"Acciones"),o()()(),a(123,"tbody"),x(124,Zt,5,0,"tr",45)(125,Jt,3,0,"tr",45)(126,ei,3,0,"tr",45)(127,ni,27,15,"tr",46),o()()(),x(128,oi,2,7,"div",47),o(),x(129,ci,76,7,"ng-template",null,0,te)(131,mi,12,3,"ng-template",null,1,te)}e&2&&(s(4),E("Estudiantes por docente (",i.tituloModo,")"),s(7),u("formControl",i.docenteInput),s(3),u("ngIf",i.mostrarListaDocentes&&i.docentesFiltrados.length>0),s(2),u("ngIf",i.docenteSeleccionado),s(),u("ngIf",i.docenteSeleccionado),s(),u("ngIf",i.docenteSeleccionado),s(),u("ngIf",i.docenteSeleccionado),s(),u("ngIf",i.esSuperAdmin),s(3),I("ngModel",i.selectedAnioId),s(),u("ngForOf",i.anios),s(5),I("ngModel",i.especialidadSeleccionada),s(),u("ngValue",""),s(2),u("ngForOf",i.instrumentoOptions),s(2),S(i.instrumentoFiltroLabel),s(6),I("ngModel",i.filterTxt),s(5),I("ngModel",i.includeSinDocente),s(4),u("disabled",!i.docenteSeleccionado||i.isLoading||!i.estudiantes||i.estudiantes.length===0),s(2),u("disabled",!i.docenteSeleccionado||i.isLoading),s(2),I("ngModel",i.pageSize),s(),u("ngForOf",i.pageSizeOptions),s(4),I("ngModel",i.cursoSolicitadoSeleccionado),u("disabled",!i.docenteSeleccionado||i.isLoadingCursosOptions),s(),u("ngValue",""),s(2),u("ngForOf",i.cursoSolicitadoOptionsDocente),s(5),I("ngModel",i.cursoAsignadoSeleccionado),u("disabled",!i.docenteSeleccionado||i.isLoadingCursosOptions),s(),u("ngValue",""),s(2),u("ngForOf",i.cursoAsignadoOptionsDocente),s(5),I("ngModel",i.sortBy),s(),u("ngValue","NombreEstudiante"),s(2),u("ngValue","Curso_Solicitado"),s(2),u("ngValue","CursoAsignado"),s(2),u("ngValue","Anio"),s(6),I("ngModel",i.sortDir),s(),u("ngValue","asc"),s(2),u("ngValue","desc"),s(26),S(i.instrumentoFiltroLabel),s(8),u("ngIf",i.isLoading),s(),u("ngIf",!i.isLoading&&!i.docenteSeleccionado),s(),u("ngIf",!i.isLoading&&i.docenteSeleccionado&&(!i.estudiantes||i.estudiantes.length===0)),s(),u("ngForOf",i.estudiantes),s(),u("ngIf",i.docenteSeleccionado))},dependencies:[Me,B,z,Re,q,Q,W,se,H,G,ke,U,Oe,Ne,Ve,Ke],styles:["[_nghost-%COMP%]{display:block}.list-group[_ngcontent-%COMP%]{border-radius:10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var J=Z;var pi=[{path:"calificaciones",component:de},{path:"registrocalificaciones",component:me},{path:"docespecialidadxestudiante",component:J,data:{modo:"especialidad"}},{path:"doccomplementarioxestudiante",component:J,data:{modo:"complementario"}},{path:"docpracticaconjuntosxestudiante",component:J,data:{modo:"practicaconjuntos"}}],L=class L{};L.\u0275fac=function(e){return new(e||L)},L.\u0275mod=ae({type:L}),L.\u0275inj=oe({imports:[he.forChild(pi),he]});var pe=L;var K=class K{};K.\u0275fac=function(e){return new(e||K)},K.\u0275mod=ae({type:K}),K.\u0275inj=oe({imports:[Ie,Be,pe]});var Ye=K;export{Ye as DocentesModule};
