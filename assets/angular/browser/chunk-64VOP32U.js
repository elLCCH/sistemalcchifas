import{b as re}from"./chunk-ZPE3UOEJ.js";import"./chunk-IOMHTJQE.js";import{k as W}from"./chunk-O3DH7IF3.js";import{g as ae}from"./chunk-XJCOF3T3.js";import{c as Z,f as $,k as ee,r as te,s as ie,t as ne}from"./chunk-RY6BQWSI.js";import{a as j}from"./chunk-JISGPZ2J.js";import{Dc as H,Ea as r,Fc as J,Gc as G,Lb as n,Lc as K,Ma as V,Mb as p,Nb as R,Ob as F,Oc as Q,Ra as k,Sa as C,Tb as m,Ub as u,Uc as X,Vb as g,Wa as T,Yc as Y,Z as N,_ as S,ba as O,bc as z,dc as b,ec as y,ga as I,ha as w,ib as s,jb as t,kb as i,lb as q,pb as B,qb as U,sb as D,vb as v,xb as f}from"./chunk-K6WFP5KF.js";import"./chunk-GG76335P.js";var _=class _{constructor(l){this.http=l;this.baseUrl=j.ruta||j.apiUrl||""}listar(l){let e=new X;return l&&Object.entries(l).forEach(([a,d])=>{d==null||String(d).trim()===""||(e=e.set(a,String(d)))}),this.http.get(`${this.baseUrl}api/infoauditoria`,{params:e})}ver(l){return this.http.get(`${this.baseUrl}api/infoauditoria/${l}`)}};_.\u0275fac=function(e){return new(e||_)(O(Y))},_.\u0275prov=N({token:_,factory:_.\u0275fac,providedIn:"root"});var M=_;var de=(c,l,e,a)=>({"text-bg-success":c,"text-bg-warning":l,"text-bg-danger":e,"text-bg-secondary":a});function se(c,l){c&1&&(t(0,"tr")(1,"td",37),n(2,"No hay registros."),i()())}function pe(c,l){if(c&1&&(t(0,"tr")(1,"td",43)(2,"div",44)(3,"div",45)(4,"div",46),n(5,"Request body"),i(),t(6,"pre",47),n(7),b(8,"json"),i()(),t(9,"div",45)(10,"div",46),n(11,"Headers (sin Authorization)"),i(),t(12,"pre",47),n(13),b(14,"json"),i()(),t(15,"div",45)(16,"div",46),n(17,"Old values (antes)"),i(),t(18,"pre",47),n(19),b(20,"json"),i()(),t(21,"div",45)(22,"div",46),n(23,"New values (despu\xE9s)"),i(),t(24,"pre",47),n(25),b(26,"json"),i()()()()()),c&2){let e=f().$implicit;r(7),p(y(8,4,e.request_body)),r(6),p(y(14,6,e.request_headers)),r(6),p(y(20,8,e.old_values)),r(6),p(y(26,10,e.new_values))}}function ce(c,l){if(c&1){let e=D();B(0),t(1,"tr")(2,"td"),n(3),i(),t(4,"td"),n(5),i(),t(6,"td")(7,"span",38),n(8),i()(),t(9,"td")(10,"div",39),n(11),i(),t(12,"small",3),n(13),i()(),t(14,"td")(15,"div",39),n(16),i(),t(17,"small",3),n(18),i()(),t(19,"td",40),n(20),i(),t(21,"td"),n(22),i(),t(23,"td",41)(24,"button",42),v("click",function(){let d=I(e).$implicit,o=f();return w(o.toggleDetalle(d))}),n(25),i()()(),T(26,pe,27,12,"tr",34),U()}if(c&2){let e=l.$implicit,a=f();r(3),p(e.id),r(2),p(e.created_at),r(2),s("ngClass",z(13,de,e.accion==="CREATE",e.accion==="UPDATE",e.accion==="DELETE",e.accion!=="CREATE"&&e.accion!=="UPDATE"&&e.accion!=="DELETE")),r(),p(e.accion),r(3),p(e.actor_nombrecompleto||"ID "+e.actor_id),r(2),F("",e.actor_pertenencia||""," ",e.actor_permisos?"| "+e.actor_permisos:""),r(3),p(e.recurso||"-"),r(2),p(e.recurso_id||""),r(2),p(e.url),r(2),p(e.status_code||"-"),r(3),R(" ",a.selectedId===e.id?"Ocultar":"Detalle"," "),r(),s("ngIf",a.selectedId===e.id)}}function me(c,l){if(c&1){let e=D();t(0,"div",48)(1,"ngb-pagination",49),g("pageChange",function(d){I(e);let o=f();return u(o.page,d)||(o.page=d),w(d)}),v("pageChange",function(d){I(e);let o=f();return w(o.cargar(d))}),i()()}if(c&2){let e=f();r(),s("collectionSize",e.total()),m("page",e.page),s("pageSize",e.per_page)("maxSize",5)("boundaryLinks",!0)}}var E=class E{constructor(l){this.api=l;this.loading=!1;this.rows=[];this.paginator=null;this.q="";this.accion="";this.recurso="";this.date_from="";this.date_to="";this.page=1;this.per_page=30;this.selectedId=null}ngOnInit(){this.cargar()}cargar(l){l&&(this.page=l),this.loading=!0,this.api.listar({q:this.q,accion:this.accion,recurso:this.recurso,date_from:this.date_from,date_to:this.date_to,per_page:this.per_page,page:this.page}).subscribe({next:e=>{this.paginator=e,this.rows=e?.data??[],this.page=e?.current_page??this.page,this.per_page=e?.per_page??this.per_page,this.loading=!1},error:()=>{this.loading=!1}})}limpiar(){this.q="",this.accion="",this.recurso="",this.date_from="",this.date_to="",this.page=1,this.cargar()}toggleDetalle(l){this.selectedId=this.selectedId===l.id?null:l.id}total(){return this.paginator?.total??0}lastPage(){return this.paginator?.last_page??1}};E.\u0275fac=function(e){return new(e||E)(V(M))},E.\u0275cmp=k({type:E,selectors:[["app-infoauditoria"]],standalone:!1,decls:85,vars:17,consts:[[1,"container-fluid","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],[1,"text-muted"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],[1,"card","mb-3"],[1,"card-body"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-4"],[1,"form-label"],["placeholder","Usuario, URL, recurso\u2026",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-6","col-md-2"],[1,"form-select",3,"ngModelChange","ngModel"],["value",""],["value","CREATE"],["value","UPDATE"],["value","DELETE"],["placeholder","anios, materias\u2026",1,"form-control",3,"ngModelChange","ngModel"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"card"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"d-flex","align-items-center","gap-2"],[1,"form-select","form-select-sm",2,"width","110px",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[1,"table-responsive"],[1,"table","table-hover","table-sm","align-middle"],[2,"width","85px"],[2,"width","180px"],[2,"width","120px"],[2,"width","170px"],[2,"width","90px"],[2,"width","110px"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","d-flex justify-content-end",4,"ngIf"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"badge",3,"ngClass"],[1,"fw-semibold"],[1,"text-truncate",2,"max-width","420px"],[1,"text-end"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],["colspan","8"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"fw-semibold","mb-1"],[1,"audit-pre"],[1,"d-flex","justify-content-end"],[3,"pageChange","collectionSize","page","pageSize","maxSize","boundaryLinks"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h4",2),n(4,"Auditor\xEDa del sistema"),i(),t(5,"small",3),n(6,"Registra altas, ediciones y eliminaciones (API)"),i()(),t(7,"div",4)(8,"button",5),v("click",function(){return a.limpiar()}),n(9," Limpiar "),i(),t(10,"button",6),v("click",function(){return a.cargar(1)}),n(11),i()()(),t(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"label",11),n(17,"Buscar"),i(),t(18,"input",12),g("ngModelChange",function(o){return u(a.q,o)||(a.q=o),o}),i()(),t(19,"div",13)(20,"label",11),n(21,"Acci\xF3n"),i(),t(22,"select",14),g("ngModelChange",function(o){return u(a.accion,o)||(a.accion=o),o}),t(23,"option",15),n(24,"Todas"),i(),t(25,"option",16),n(26,"CREATE"),i(),t(27,"option",17),n(28,"UPDATE"),i(),t(29,"option",18),n(30,"DELETE"),i()()(),t(31,"div",13)(32,"label",11),n(33,"Recurso"),i(),t(34,"input",19),g("ngModelChange",function(o){return u(a.recurso,o)||(a.recurso=o),o}),i()(),t(35,"div",13)(36,"label",11),n(37,"Desde"),i(),t(38,"input",20),g("ngModelChange",function(o){return u(a.date_from,o)||(a.date_from=o),o}),i()(),t(39,"div",13)(40,"label",11),n(41,"Hasta"),i(),t(42,"input",20),g("ngModelChange",function(o){return u(a.date_to,o)||(a.date_to=o),o}),i()()()()(),t(43,"div",21)(44,"div",8)(45,"div",22)(46,"div",3),n(47," Total: "),t(48,"strong"),n(49),i()(),t(50,"div",23)(51,"label",3),n(52,"Por p\xE1gina"),i(),t(53,"select",24),g("ngModelChange",function(o){return u(a.per_page,o)||(a.per_page=o),o}),v("change",function(){return a.cargar(1)}),t(54,"option",25),n(55,"10"),i(),t(56,"option",25),n(57,"30"),i(),t(58,"option",25),n(59,"50"),i(),t(60,"option",25),n(61,"100"),i()()()(),t(62,"div",26)(63,"table",27)(64,"thead")(65,"tr")(66,"th",28),n(67,"ID"),i(),t(68,"th",29),n(69,"Fecha"),i(),t(70,"th",30),n(71,"Acci\xF3n"),i(),t(72,"th"),n(73,"Usuario"),i(),t(74,"th",31),n(75,"Recurso"),i(),t(76,"th"),n(77,"URL"),i(),t(78,"th",32),n(79,"Status"),i(),q(80,"th",33),i()(),t(81,"tbody"),T(82,se,3,0,"tr",34)(83,ce,27,18,"ng-container",35),i()()(),T(84,me,2,5,"div",36),i()()()),e&2&&(r(8),s("disabled",a.loading),r(2),s("disabled",a.loading),r(),R(" ",a.loading?"Cargando\u2026":"Buscar"," "),r(7),m("ngModel",a.q),r(4),m("ngModel",a.accion),r(12),m("ngModel",a.recurso),r(4),m("ngModel",a.date_from),r(4),m("ngModel",a.date_to),r(7),p(a.total()),r(4),m("ngModel",a.per_page),r(),s("ngValue",10),r(2),s("ngValue",30),r(2),s("ngValue",50),r(2),s("ngValue",100),r(22),s("ngIf",!a.loading&&a.rows.length===0),r(),s("ngForOf",a.rows),r(),s("ngIf",a.lastPage()>1))},dependencies:[H,J,G,ie,ne,Z,te,$,ee,ae,K],styles:[".audit-pre[_ngcontent-%COMP%]{background:#0b1020;color:#d7e2ff;padding:12px;border-radius:8px;max-height:260px;overflow:auto;font-size:12px}"]});var P=E;var ue=[{path:"infoauditoria",component:P}],h=class h{};h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=C({type:h}),h.\u0275inj=S({imports:[W.forChild(ue),W]});var L=h;var x=class x{};x.\u0275fac=function(e){return new(e||x)},x.\u0275mod=C({type:x}),x.\u0275inj=S({imports:[Q,re,L]});var oe=x;export{oe as InformacionsistemawebModule};
