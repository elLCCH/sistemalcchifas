import{a as nt}from"./chunk-3KLMOQKQ.js";import{a as it}from"./chunk-FK662B4C.js";import{a as Ze}from"./chunk-MYCZOKUI.js";import"./chunk-AINANROM.js";import{a as tt}from"./chunk-GKBKEJCN.js";import"./chunk-633ZKBKW.js";import{a as Ye}from"./chunk-SDTEYBFQ.js";import{a as et}from"./chunk-YJY6DP6Y.js";import{a as Ge}from"./chunk-XILPAHEE.js";import{a as Qe}from"./chunk-SVDENQU6.js";import{b as xe}from"./chunk-ZODOWL6N.js";import{b as Je}from"./chunk-ZPE3UOEJ.js";import{b as He}from"./chunk-IOMHTJQE.js";import"./chunk-GXCTSUUI.js";import"./chunk-NCIXDP2C.js";import{e as X,g as Le,k as we}from"./chunk-O3DH7IF3.js";import{b as qe}from"./chunk-L3EZDEDO.js";import{g as Xe}from"./chunk-XJCOF3T3.js";import{b as _e,c as q,f as Q,g as $e,j as Te,k as J,l as Ke,m as he,o as Be,p as ze,q as We,r as Y,s as Z,t as ee,u as Ue,v as be}from"./chunk-RY6BQWSI.js";import{a as je}from"./chunk-JISGPZ2J.js";import{Aa as de,Bb as me,Cb as pe,Db as fe,Dc as ke,Ea as l,F as re,Fc as G,Gb as Ne,Gc as H,Hb as De,Ib as F,Lb as c,Ma as R,Mb as S,Nb as E,Ob as L,Oc as Ve,Pb as ge,Ra as W,Sa as ue,Tb as T,Ub as P,Vb as A,Wa as v,Yc as Fe,Z as Ae,_ as ce,ab as V,ba as Re,ga as g,ha as _,hc as U,ib as u,jb as r,k as ae,kb as a,lb as w,o as z,pb as Me,qb as Ie,sb as I,ua as Oe,vb as x,w as Pe,xb as m}from"./chunk-K6WFP5KF.js";import{a as N,b as le,m as k}from"./chunk-GG76335P.js";function dt(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2);l(),E(" | Paralelo: ",e.materia.MateriaParalelo)}}function ut(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2);l(),E("",e.materia.SiglaMateria," - ")}}function mt(s,i){if(s&1&&(r(0,"div"),c(1),a()),s&2){let e=m(2);l(),E("A\xF1o: ",e.materia.Anio)}}function pt(s,i){if(s&1&&(r(0,"div"),c(1),a()),s&2){let e=m(2);l(),E("Docentes: ",e.docentesLabel())}}function ft(s,i){if(s&1&&(r(0,"div",23)(1,"div")(2,"strong"),c(3),a(),v(4,dt,2,1,"span",14),a(),r(5,"div"),v(6,ut,2,1,"span",14),c(7),a(),v(8,mt,2,1,"div",14)(9,pt,2,1,"div",14),r(10,"div",24)(11,"strong"),c(12),a(),r(13,"span",25),c(14),a(),r(15,"span",25),c(16),a()()()),s&2){let e=m();l(3),S(e.materia.LvlCurso||"Curso"),l(),u("ngIf",e.materia.MateriaParalelo),l(2),u("ngIf",e.materia.SiglaMateria),l(),E("",e.materia.NombreMateria||"Materia"," "),l(),u("ngIf",e.materia.Anio),l(),u("ngIf",e.docentes==null?null:e.docentes.length),l(3),S(e.estadoEdicionLabel()),l(2),L("Teo \u2264 ",e.maxTeorico,", Prac \u2264 ",e.maxPractico),l(2),L("Aprobaci\xF3n \u2265 ",e.passingScore,", Revalida \u2265 ",e.minRevalida)}}function gt(s,i){if(s&1){let e=I();r(0,"label",35)(1,"input",12),x("ngModelChange",function(n){g(e);let o=m(2);return _(o.onEvalEnabledChange(0,n))}),a(),r(2,"span",13),c(3,"1"),a()()}if(s&2){let e=m(2);l(),u("ngModel",e.evalEnabled[0])}}function _t(s,i){if(s&1){let e=I();r(0,"label",35)(1,"input",12),x("ngModelChange",function(n){g(e);let o=m(2);return _(o.onEvalEnabledChange(1,n))}),a(),r(2,"span",13),c(3,"2"),a()()}if(s&2){let e=m(2);l(),u("ngModel",e.evalEnabled[1])}}function ht(s,i){if(s&1){let e=I();r(0,"label",35)(1,"input",12),x("ngModelChange",function(n){g(e);let o=m(2);return _(o.onEvalEnabledChange(2,n))}),a(),r(2,"span",13),c(3,"3"),a()()}if(s&2){let e=m(2);l(),u("ngModel",e.evalEnabled[2])}}function bt(s,i){if(s&1){let e=I();r(0,"label",35)(1,"input",12),x("ngModelChange",function(n){g(e);let o=m(2);return _(o.onEvalEnabledChange(3,n))}),a(),r(2,"span",13),c(3,"4"),a()()}if(s&2){let e=m(2);l(),u("ngModel",e.evalEnabled[3])}}function xt(s,i){if(s&1&&(r(0,"option",36),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e),l(),E("",e," eval")}}function vt(s,i){if(s&1){let e=I();Me(0),r(1,"div",26)(2,"span",27),c(3,"Evaluaciones"),a(),v(4,gt,4,1,"label",28)(5,_t,4,1,"label",28)(6,ht,4,1,"label",28)(7,bt,4,1,"label",28),a(),r(8,"div",29)(9,"button",30),x("click",function(){g(e);let n=m();return _(n.setAllEvaluations(!0))}),c(10,"Todas"),a(),r(11,"button",30),x("click",function(){g(e);let n=m();return _(n.setAllEvaluations(!1))}),c(12,"Ninguna"),a()(),r(13,"div",31)(14,"span",7),c(15,"Prom"),a(),r(16,"select",8),x("ngModelChange",function(n){g(e);let o=m();return _(o.onAvgEvalCountChange(n))}),v(17,xt,2,2,"option",32),a()(),r(18,"div",33)(19,"span",7),c(20,"Teo \u2264"),a(),r(21,"input",34),A("ngModelChange",function(n){g(e);let o=m();return P(o.maxTeorico,n)||(o.maxTeorico=n),_(n)}),a()(),r(22,"div",33)(23,"span",7),c(24,"Prac \u2264"),a(),r(25,"input",34),A("ngModelChange",function(n){g(e);let o=m();return P(o.maxPractico,n)||(o.maxPractico=n),_(n)}),a()(),Ie()}if(s&2){let e=m();l(4),u("ngIf",e.evalCountMax>=1),l(),u("ngIf",e.evalCountMax>=2),l(),u("ngIf",e.evalCountMax>=3),l(),u("ngIf",e.evalCountMax>=4),l(9),u("ngModel",e.avgEvalCount),l(),u("ngForOf",e.evalOptions()),l(4),T("ngModel",e.maxTeorico),u("readOnly",!0),l(4),T("ngModel",e.maxPractico),u("readOnly",!0)}}function yt(s,i){if(s&1&&(r(0,"div",37),c(1),a()),s&2){let e=m();l(),S(e.loadError)}}function Ct(s,i){if(s&1&&(r(0,"div",37),c(1),a()),s&2){let e=m();l(),S(e.saveError)}}function St(s,i){if(s&1&&(r(0,"div",38),c(1),a()),s&2){let e=m();l(),S(e.saveOk)}}function Et(s,i){if(s&1){let e=I();r(0,"div",39)(1,"div",40),c(2),a(),r(3,"div",41)(4,"button",42),x("click",function(){g(e);let n=m();return _(n.prev())}),c(5,"Anterior"),a(),r(6,"button",42),x("click",function(){g(e);let n=m();return _(n.next())}),c(7,"Siguiente"),a()()()}if(s&2){let e=m();l(2),ge("Mostrando ",e.meta.from||0,"-",e.meta.to||0," de ",e.meta.total),l(2),u("disabled",!e.tienePrev()||e.isLoading),l(2),u("disabled",!e.tieneNext()||e.isLoading)}}function Mt(s,i){if(s&1&&(r(0,"th"),c(1),a()),s&2){let e=i.$implicit;F("sep-after",e.sepAfter),l(),S(e.label)}}function It(s,i){if(s&1&&(r(0,"div"),c(1),a()),s&2){let e=m(2).$implicit;l(),E("Inst: ",e.InstrumentoMusical)}}function wt(s,i){if(s&1&&(r(0,"div"),c(1),a()),s&2){let e=m(2).$implicit;l(),E("Sec: ",e.InstrumentoMusicalSecundario)}}function Tt(s,i){if(s&1&&(r(0,"div",23),v(1,It,2,1,"div",14)(2,wt,2,1,"div",14),a()),s&2){let e=m().$implicit;l(),u("ngIf",e.InstrumentoMusical),l(),u("ngIf",e.InstrumentoMusicalSecundario)}}function Pt(s,i){if(s&1&&(r(0,"div",24),w(1,"img",53),a()),s&2){let e=m().$implicit,t=m(2);l(),u("src",t.fotoUrl(e.Foto),de)}}function At(s,i){if(s&1){let e=I();Me(0),r(1,"input",55),x("ngModelChange",function(n){g(e);let o=m(),d=o.$implicit,p=o.index,f=m().index,h=m(2);return _(h.onCellChange(f,p,d.key,n))})("focus",function(){g(e);let n=m().index,o=m().index,d=m(2);return _(d.onFocusCell(o,n))})("paste",function(n){g(e);let o=m().index,d=m().index,p=m(2);return _(p.onPaste(n,d,o))}),a(),Ie()}if(s&2){let e=m(),t=e.$implicit,n=e.index,o=m(),d=o.$implicit,p=o.index,f=m(2);l(),u("readOnly",t.readonly||!f.canEdit(t.key))("ngModel",d[t.key]),V("data-row",p)("data-col",n)}}function Rt(s,i){if(s&1){let e=I();r(0,"input",56),x("focus",function(){g(e);let n=m().index,o=m().index,d=m(2);return _(d.onFocusCell(o,n))}),a()}if(s&2){let e=m(),t=e.$implicit,n=e.index,o=m(),d=o.$implicit,p=o.index,f=m(2);u("readOnly",!0)("ngModel",f.sumValueForKey(d,t.key)),V("data-row",p)("data-col",n)}}function Ot(s,i){if(s&1&&(r(0,"td"),v(1,At,2,4,"ng-container",54)(2,Rt,1,4,"ng-template",null,0,U),a()),s&2){let e=i.$implicit,t=Ne(3),n=m().$implicit,o=m(2);F("sep-after",e.sepAfter)("cell-danger",o.isCellDanger(n,e.key)),l(),u("ngIf",!o.isSumColumn(e.key))("ngIfElse",t)}}function Nt(s,i){if(s&1){let e=I();r(0,"tr")(1,"td",46)(2,"div",50),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.toggleFoto(n))}),c(3),a(),v(4,Tt,3,2,"div",4)(5,Pt,2,1,"div",51),a(),r(6,"td",47),c(7),a(),v(8,Ot,4,6,"td",52),a()}if(s&2){let e=i.$implicit,t=i.index,n=m(2);F("table-danger",n.isDanger(e))("active-row",t===n.activeRow),l(3),S(n.nombreCompleto(e)),l(),u("ngIf",e.InstrumentoMusical||e.InstrumentoMusicalSecundario),l(),u("ngIf",n.fotoAbierta(e)),l(2),S(e.CI||""),l(),u("ngForOf",n.columns)}}function Dt(s,i){if(s&1&&(r(0,"div",43)(1,"table",44)(2,"thead",45)(3,"tr")(4,"th",46),c(5,"Estudiante"),a(),r(6,"th",47),c(7,"CI"),a(),v(8,Mt,2,3,"th",48),a()(),r(9,"tbody"),v(10,Nt,9,9,"tr",49),a()()()),s&2){let e=m();l(8),u("ngForOf",e.columns),l(2),u("ngForOf",e.rows)}}function kt(s,i){s&1&&(r(0,"div",57),c(1," No hay calificaciones asignadas a esta materia. "),a())}var te=class te{constructor(i,e,t,n,o){this.hostEl=i;this._calif=e;this._auth=t;this.route=n;this.router=o;this.materiaId=null;this.tipoSesion="";this.isAdminUser=!1;this.passingScore=61;this.minRevalida=40;this.materia=null;this.docentes=[];this.rows=[];this.columns=[];this.isLoading=!1;this.loadError=null;this.saveError=null;this.saveOk=null;this.isSaving=!1;this.meta=null;this.page=1;this.perPage=200;this.maxTeorico=30;this.maxPractico=70;this.avgEvalCount=4;this.viewMode="intercalado";this.editableEvaluations=!0;this.configLocked=!0;this.evalCountMax=4;this.showSumColumns=!1;this.evalEnabled=[!0,!0,!0,!0];this.openFotoInfoId=null;this.originalById=new Map;this.dirtyIds=new Set;this.activeRow=0;this.activeCol=0;this.undoStack=[];this.redoStack=[];this.MAX_HISTORY=50;this.isBatchEdit=!1}ngOnInit(){this.rebuildColumns(),this._auth.pedirPerfil().subscribe({next:i=>{this.tipoSesion=(i?.tipo??"").toString(),this.isAdminUser=this.tipoSesion==="planteladministrativos"||this.tipoSesion==="usuarioslcchs"||this.tipoSesion==="superlcchs",this.configLocked=!this.isAdminUser,this.materia&&(this.applyConfigFromMateria(),this.rebuildColumns())},error:()=>{}}),this.route.queryParamMap.subscribe(i=>{let e=i.get("materiaId")??i.get("materias_id")??"",t=Number(e);if(!e||Number.isNaN(t)||t<=0){this.materiaId=null,this.rows=[],this.meta=null,this.materia=null,this.docentes=[],this.loadError='Falta seleccionar una materia. Vuelve a "Mis Materias" y abre calificaciones desde ah\xED.';return}let n=this.materiaId!==t;this.materiaId=t,n&&(this.page=1,this.cargarCalificaciones(1))})}get showAdminControls(){return this.isAdminUser}normalizarTexto(i){return(i??"").toString().trim()}fotoUrl(i){let e=this.normalizarTexto(i);if(e===""||e.toLowerCase()==="null"||e.toLowerCase()==="undefined")return this._calif.ruta+"fijos/sinperfil.jpg";let t=e.toLowerCase();return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?e:this._calif.ruta+e}toggleFoto(i){let e=Number(i?.infoestudiantesifas_id);!e||Number.isNaN(e)||(this.openFotoInfoId=this.openFotoInfoId===e?null:e)}fotoAbierta(i){let e=Number(i?.infoestudiantesifas_id);return!!e&&this.openFotoInfoId===e}cargarCalificaciones(i=1){if(!this.materiaId){this.loadError="Materia inv\xE1lida.";return}this.isLoading||(this.isLoading=!0,this.loadError=null,this.saveError=null,this.saveOk=null,this._calif.ObtenerCalificacionesPorMateriaPaginado(this.materiaId,{page:i,per_page:this.perPage}).subscribe({next:e=>{let t=Array.isArray(e?.data)?e.data:[];this.rows=t.map(n=>N({},n)),this.materia=e?.materia??null,this.docentes=Array.isArray(e?.docentes)?e.docentes:[],this.meta=e?.meta??null,this.page=this.meta?.current_page??i,this.applyConfigFromMateria(),this.rebuildColumns(),this.captureBaseline(),this.dirtyIds.clear(),this.activeRow=0,this.activeCol=0},error:e=>{console.error("Error al cargar calificaciones por materia:",e),this.rows=[],this.meta=null,this.loadError="No se pudieron cargar las calificaciones de la materia."},complete:()=>{this.isLoading=!1}}))}applyConfigFromMateria(){let i=p=>{let h=(p??"").toString().match(/(\d+)/),b=Number(h?h[1]:p);return b===1||b===2||b===3||b===4?b:4},e=Number(this.materia?.LimiteMaxTeorico);!Number.isNaN(e)&&e>0&&(this.maxTeorico=Math.min(100,Math.max(0,e)));let t=Number(this.materia?.LimiteMaxPractico);!Number.isNaN(t)&&t>0&&(this.maxPractico=Math.min(100,Math.max(0,t)));let n=Number(this.materia?.NotaAprobacion);!Number.isNaN(n)&&n>0&&(this.passingScore=Math.min(100,Math.max(0,n)));let o=Number(this.materia?.NotaMinRevalida);!Number.isNaN(o)&&o>=0&&(this.minRevalida=Math.min(100,Math.max(0,o))),this.evalCountMax=i(this.materia?.CantidadEvaluaciones),this.avgEvalCount=this.evalCountMax;let d=this.parseEnabledEvaluations(this.materia?.EstadoHabilitacion,this.evalCountMax);this.evalEnabled=[d.has(1),d.has(2),d.has(3),d.has(4)];for(let p=this.evalCountMax;p<4;p++)this.evalEnabled[p]=!1;this.editableEvaluations=this.evalEnabled.some(Boolean)}evalOptions(){return[1,2,3,4].slice(0,this.evalCountMax)}parseEnabledEvaluations(i,e){let t=new Set,n=(i??"").toString().trim();if(!n)return t;let o=n.toUpperCase();if(o.includes("DESHABIL"))return t;if(o.includes("HABILIT")||o.includes("TODAS")||o.includes("TODO")){for(let d=1;d<=Math.max(1,Math.min(4,e));d++)t.add(d);return t}return(o.includes("PRIMERA")||/\b1\b/.test(o))&&t.add(1),(o.includes("SEGUNDA")||/\b2\b/.test(o))&&t.add(2),(o.includes("TERCERA")||/\b3\b/.test(o))&&t.add(3),(o.includes("CUARTA")||/\b4\b/.test(o))&&t.add(4),t}estadoEdicionLabel(){let i=(this.materia?.EstadoHabilitacion??"").toString().trim(),e=this.evalEnabled.map((t,n)=>t?n+1:null).filter(t=>typeof t=="number");return this.isAdminUser?e.length?`Edici\xF3n habilitada: ${e.join(", ")} (Admin)`:"Edici\xF3n deshabilitada":i?this.editableEvaluations?e.length?`Edici\xF3n habilitada: ${e.join(", ")} (${i})`:`Edici\xF3n deshabilitada (${i})`:`Edici\xF3n deshabilitada (${i})`:"Edici\xF3n deshabilitada"}recargarTabla(){this.cargarCalificaciones(this.page||1)}tienePrev(){return!!this.meta&&(this.meta.current_page??1)>1}tieneNext(){return!!this.meta&&(this.meta.current_page??1)<(this.meta.last_page??1)}prev(){this.tienePrev()&&this.cargarCalificaciones((this.meta.current_page??1)-1)}next(){this.tieneNext()&&this.cargarCalificaciones((this.meta.current_page??1)+1)}captureBaseline(){this.originalById.clear();for(let i of this.rows)this.originalById.set(i.id,N({},i))}snapshotRows(){let i={};for(let e of this.rows)i[e.id]={Teorico1:e.Teorico1??null,Teorico2:e.Teorico2??null,Teorico3:e.Teorico3??null,Teorico4:e.Teorico4??null,Practico1:e.Practico1??null,Practico2:e.Practico2??null,Practico3:e.Practico3??null,Practico4:e.Practico4??null,PromTeorico:e.PromTeorico??null,PromPractico:e.PromPractico??null,Promedio:e.Promedio??null,PruebaRecuperacion:e.PruebaRecuperacion??null};return i}restoreSnapshot(i){this.isBatchEdit=!0;try{this.dirtyIds.clear();for(let e of this.rows){let t=i[e.id];t&&(e.Teorico1=t.Teorico1??null,e.Teorico2=t.Teorico2??null,e.Teorico3=t.Teorico3??null,e.Teorico4=t.Teorico4??null,e.Practico1=t.Practico1??null,e.Practico2=t.Practico2??null,e.Practico3=t.Practico3??null,e.Practico4=t.Practico4??null,e.PruebaRecuperacion=t.PruebaRecuperacion??null,e.__cascadeActive=!1,e.__cascadeLockFrom=null,e.__cascadeBackup=null,this.recalcPromedios(e),this.recomputeDirtyForRow(e))}}finally{this.isBatchEdit=!1}}beginUserChange(){this.isBatchEdit||(this.undoStack.push(this.snapshotRows()),this.undoStack.length>this.MAX_HISTORY&&this.undoStack.shift(),this.redoStack=[])}undo(){if(this.undoStack.length===0)return;let i=this.snapshotRows(),e=this.undoStack.pop();this.redoStack.push(i),this.restoreSnapshot(e)}redo(){if(this.redoStack.length===0)return;let i=this.snapshotRows(),e=this.redoStack.pop();this.undoStack.push(i),this.restoreSnapshot(e)}recomputeDirtyForRow(i){let e=this.originalById.get(i.id);if(!e)return;["Teorico1","Practico1","Teorico2","Practico2","Teorico3","Practico3","Teorico4","Practico4","PruebaRecuperacion"].some(o=>(i[o]??null)!==(e[o]??null))?this.dirtyIds.add(i.id):this.dirtyIds.delete(i.id)}rebuildColumns(){let i=[],e=[1,2,3,4].slice(0,this.avgEvalCount),t=n=>{i.push({key:`Teorico${n}`,label:`Teo${n}`,widthClass:"w-80"}),i.push({key:`Practico${n}`,label:`Prac${n}`,widthClass:"w-80",sepAfter:!this.showSumColumns}),this.showSumColumns&&i.push({key:`Sum${n}`,label:`Sum${n}`,widthClass:"w-80",readonly:!0,sepAfter:!0})};if(this.viewMode==="intercalado")for(let n of e)t(n);else{for(let n of e)i.push({key:`Teorico${n}`,label:`Teo${n}`,widthClass:"w-80"});i[i.length-1].sepAfter=!0;for(let n of e)i.push({key:`Practico${n}`,label:`Prac${n}`,widthClass:"w-80"}),this.showSumColumns?i.push({key:`Sum${n}`,label:`Sum${n}`,widthClass:"w-80",readonly:!0,sepAfter:!0}):i[i.length-1].sepAfter=!0}i.push({key:"PromTeorico",label:"Prom Teo",readonly:!0,widthClass:"w-90"}),i.push({key:"PromPractico",label:"Prom Prac",readonly:!0,widthClass:"w-90"}),i.push({key:"Promedio",label:"Prom",readonly:!0,widthClass:"w-80",sepAfter:!0}),i.push({key:"PruebaRecuperacion",label:"Recup",widthClass:"w-80"}),this.columns=i}onShowSumColumnsChange(i){this.showSumColumns=!!i,this.rebuildColumns()}onEvalEnabledChange(i,e){if(this.configLocked||i<0||i>3||i+1>this.evalCountMax)return;this.evalEnabled[i]=!!e,this.editableEvaluations=this.evalEnabled.some(Boolean);let t=this.evalEnabled.map((n,o)=>n?o+1:0).reduce((n,o)=>Math.max(n,o),0);if(t>=1&&this.avgEvalCount<t){this.avgEvalCount=Math.min(this.evalCountMax,t);for(let n of this.rows)this.recalcPromedios(n);this.rebuildColumns()}}setAllEvaluations(i){if(!this.configLocked){this.evalEnabled=[!1,!1,!1,!1];for(let e=0;e<this.evalCountMax;e++)this.evalEnabled[e]=!!i;if(this.editableEvaluations=this.evalEnabled.some(Boolean),i){this.avgEvalCount=this.evalCountMax;for(let e of this.rows)this.recalcPromedios(e);this.rebuildColumns()}}}nombreCompleto(i){let e=(i.Ap_Paterno??"").trim(),t=(i.Ap_Materno??"").trim(),n=(i.Nombres??"").trim();return[e,t,n].filter(Boolean).join(" ").trim()||"(Sin nombre)"}docentesLabel(){return this.docentes?.length?this.docentes.map(i=>`${(i.Apellidos??"").trim()} ${(i.Nombres??"").trim()}`.trim()).filter(Boolean).join(", "):""}isDanger(i){let e=i.Promedio;return typeof e=="number"&&e<this.passingScore}isSumKey(i){return typeof i=="string"&&i.startsWith("Sum")}isSumColumn(i){return this.isSumKey(i)}evalIndexFromKey(i){switch(i){case"Teorico1":case"Practico1":return 1;case"Teorico2":case"Practico2":return 2;case"Teorico3":case"Practico3":return 3;case"Teorico4":case"Practico4":return 4;default:return null}}evalIndexFromColumnKey(i){if(this.isSumKey(i)){let e=Number(i.replace("Sum",""));return e>=1&&e<=4?e:null}return this.evalIndexFromKey(i)}sumValue(i,e){let t=i[`Teorico${e}`],n=i[`Practico${e}`];return typeof t=="number"&&typeof n=="number"?t+n:null}sumValueForKey(i,e){let t=this.evalIndexFromColumnKey(e);return t===null?null:this.sumValue(i,t)}isCellDanger(i,e){let t=this.evalIndexFromColumnKey(e);if(t!==null){let n=this.sumValue(i,t);return typeof n=="number"&&n<this.passingScore}return e==="PromTeorico"?i.PromTeorico===null||i.PromTeorico===void 0?!1:i.PromTeorico*100<this.passingScore*this.maxTeorico:e==="PromPractico"?i.PromPractico===null||i.PromPractico===void 0?!1:i.PromPractico*100<this.passingScore*this.maxPractico:e==="Promedio"?i.Promedio!==null&&i.Promedio!==void 0&&i.Promedio<this.passingScore:e==="PruebaRecuperacion"?i.PruebaRecuperacion!==null&&i.PruebaRecuperacion!==void 0&&i.PruebaRecuperacion<this.passingScore:!1}clampNum(i,e,t){return Number.isNaN(i)||i<e?e:i>t?t:i}parseNullableInt(i){if(i==null)return null;let e=String(i).trim();if(e==="")return null;let t=parseInt(e,10);return Number.isFinite(t)?t:null}isTeoricoKey(i){return i==="Teorico1"||i==="Teorico2"||i==="Teorico3"||i==="Teorico4"}isPracticoKey(i){return i==="Practico1"||i==="Practico2"||i==="Practico3"||i==="Practico4"}recalcPromedios(i){let e=this.findZeroCascadeIndex(i),t=i,n=!!t.__cascadeActive,o=t.__cascadeLockFrom??null;if(e!==null){n||(t.__cascadeBackup={1:{teo:i.Teorico1??null,prac:i.Practico1??null},2:{teo:i.Teorico2??null,prac:i.Practico2??null},3:{teo:i.Teorico3??null,prac:i.Practico3??null},4:{teo:i.Teorico4??null,prac:i.Practico4??null}}),t.__cascadeActive=!0,t.__cascadeLockFrom=e;for(let b=e;b<=4;b++)i[`Teorico${b}`]=0,i[`Practico${b}`]=0}else if(n){let b=t.__cascadeBackup,y=o??1;if(b)for(let C=y+1;C<=4;C++){let M=b[C];if(!M)continue;let D=i[`Teorico${C}`],O=i[`Practico${C}`];typeof D=="number"&&typeof O=="number"&&D===0&&O===0&&(i[`Teorico${C}`]=M.teo,i[`Practico${C}`]=M.prac)}t.__cascadeActive=!1,t.__cascadeLockFrom=null,t.__cascadeBackup=null}if(e!==null){i.PromTeorico=0,i.PromPractico=0,i.Promedio=0;return}let d=[1,2,3,4].slice(0,this.avgEvalCount),p=b=>{let y=b.filter(M=>typeof M=="number");if(y.length===0)return null;let C=y.reduce((M,D)=>M+D,0);return Math.round(C/y.length)},f=d.map(b=>i[`Teorico${b}`]),h=d.map(b=>i[`Practico${b}`]);if(i.PromTeorico=p(f),i.PromPractico=p(h),i.PromTeorico===null&&i.PromPractico===null)i.Promedio=null;else{let b=(i.PromTeorico??0)+(i.PromPractico??0);i.Promedio=this.clampNum(Math.round(b),0,100)}}findZeroCascadeIndex(i){let e=i,t=!!e.__cascadeActive,n=e.__cascadeLockFrom??null;if(t&&n){for(let o=1;o<=n;o=o+1){let d=i[`Teorico${o}`],p=i[`Practico${o}`];if(typeof d=="number"&&typeof p=="number"&&d===0&&p===0)return o}return null}for(let o=1;o<=4;o=o+1){let d=i[`Teorico${o}`],p=i[`Practico${o}`];if(typeof d=="number"&&typeof p=="number"&&d===0&&p===0)return o}return null}canEdit(i){if(!this.editableEvaluations||this.isSumKey(i)||i==="PromTeorico"||i==="PromPractico"||i==="Promedio")return!1;let e=this.evalIndexFromColumnKey(i);return e!==null?!!this.evalEnabled[e-1]:!0}onFocusCell(i,e){this.activeRow=i,this.activeCol=e}onCellChange(i,e,t,n){let o=this.rows[i];if(!o||!this.canEdit(t)||this.isSumKey(t))return;this.beginUserChange();let d=this.parseNullableInt(n);if(d===null)o[t]=null;else{let p=d;this.isTeoricoKey(t)?p=this.clampNum(p,0,this.maxTeorico):this.isPracticoKey(t)?p=this.clampNum(p,0,this.maxPractico):p=this.clampNum(p,0,100),o[t]=p}this.recalcPromedios(o),this.recomputeDirtyForRow(o),this.activeRow=i,this.activeCol=e}onPaste(i,e,t){if(!i.clipboardData)return;let n=i.clipboardData.getData("text");if(!n)return;let o=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(d=>d.length>0).map(d=>d.split("	"));if(o.length!==0){i.preventDefault(),this.beginUserChange(),this.isBatchEdit=!0;try{for(let d=0;d<o.length&&this.rows[e+d];d++)for(let f=0;f<o[d].length;f++){let h=this.columns[t+f];if(!h)break;let b=h.key;this.canEdit(b)&&this.onCellChange(e+d,t+f,b,o[d][f])}}finally{this.isBatchEdit=!1}}}focusCell(i,e){let t=this.hostEl.nativeElement.querySelector(`input[data-row="${i}"][data-col="${e}"]`);t?.focus(),t?.select()}onKeydown(i){if(i.ctrlKey||i.metaKey){let b=i.key.toLowerCase();if(b==="z"&&!i.shiftKey){i.preventDefault(),this.undo();return}if(b==="y"||b==="z"&&i.shiftKey){i.preventDefault(),this.redo();return}}let e=i.key;if(e!=="ArrowUp"&&e!=="ArrowDown"&&e!=="ArrowLeft"&&e!=="ArrowRight")return;let t=document.activeElement;if(!t||t.tagName!=="INPUT")return;let n=t.dataset.row,o=t.dataset.col;if(n===void 0||o===void 0)return;let d=parseInt(n,10),p=parseInt(o,10);if(!Number.isFinite(d)||!Number.isFinite(p))return;i.preventDefault();let f=d,h=p;e==="ArrowUp"&&(f=Math.max(0,d-1)),e==="ArrowDown"&&(f=Math.min(this.rows.length-1,d+1)),e==="ArrowLeft"&&(h=Math.max(0,p-1)),e==="ArrowRight"&&(h=Math.min(this.columns.length-1,p+1)),this.activeRow=f,this.activeCol=h,setTimeout(()=>this.focusCell(f,h))}copiarTodo(){return k(this,null,function*(){let i=this.buildTsvExport();try{yield navigator.clipboard.writeText(i),this.saveOk="Copiado al portapapeles.",setTimeout(()=>this.saveOk=null,1500)}catch{let t=document.createElement("textarea");t.value=i,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.saveOk="Copiado al portapapeles.",setTimeout(()=>this.saveOk=null,1500)}})}buildTsvExport(){let i=[{key:"Teorico1",label:"Teo1"},{key:"Practico1",label:"Prac1"},{key:"Teorico2",label:"Teo2"},{key:"Practico2",label:"Prac2"},{key:"Teorico3",label:"Teo3"},{key:"Practico3",label:"Prac3"},{key:"Teorico4",label:"Teo4"},{key:"Practico4",label:"Prac4"},{key:"PromTeorico",label:"Prom Teo"},{key:"PromPractico",label:"Prom Prac"},{key:"Promedio",label:"Prom"},{key:"PruebaRecuperacion",label:"Recup"}],e=["Ap_Paterno","Ap_Materno","Nombres","CI",...i.map(n=>n.label)].join("	"),t=this.rows.map(n=>{let o=[n.Ap_Paterno??"",n.Ap_Materno??"",n.Nombres??"",n.CI??""],d=i.map(p=>n[p.key]??"");return[...o,...d].join("	")});return[e,...t].join(`
`)}guardarCambios(){if(!this.materiaId){this.saveError="Materia inv\xE1lida.";return}if(this.isSaving)return;if(this.saveError=null,this.saveOk=null,Array.from(this.dirtyIds.values()).length===0){this.saveOk="No hay cambios para guardar.",setTimeout(()=>this.saveOk=null,1500);return}let e=this.rows.filter(t=>this.dirtyIds.has(t.id)).map(t=>({id:t.id,Teorico1:t.Teorico1??null,Teorico2:t.Teorico2??null,Teorico3:t.Teorico3??null,Teorico4:t.Teorico4??null,Practico1:t.Practico1??null,Practico2:t.Practico2??null,Practico3:t.Practico3??null,Practico4:t.Practico4??null,PruebaRecuperacion:t.PruebaRecuperacion??null}));this.isSaving=!0,this._calif.GuardarCalificacionesBulkMateria({materias_id:this.materiaId,avg_eval_count:this.avgEvalCount,enabled_evals:this.evalEnabled,items:e}).subscribe({next:t=>{let n=t?.data?.updated??null;this.saveOk=typeof n=="number"?`Guardado: ${n} filas.`:"Guardado.",this.captureBaseline(),this.dirtyIds.clear(),setTimeout(()=>this.saveOk=null,2e3)},error:t=>{console.error("Error al guardar cambios:",t),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}onAvgEvalCountChange(i){if(this.configLocked)return;let e=parseInt(String(i),10);if(e===1||e===2||e===3||e===4){this.avgEvalCount=Math.min(this.evalCountMax,Math.max(1,e));for(let t=this.avgEvalCount;t<4;t++)this.evalEnabled[t]=!1;this.editableEvaluations=this.evalEnabled.some(Boolean);for(let t of this.rows)this.recalcPromedios(t);this.rebuildColumns()}}};te.\u0275fac=function(e){return new(e||te)(R(Oe),R(nt),R(xe),R(X),R(Le))},te.\u0275cmp=W({type:te,selectors:[["app-calificaciones"]],hostBindings:function(e,t){e&1&&x("keydown",function(o){return t.onKeydown(o)})},standalone:!1,decls:33,vars:14,consts:[["sumCell",""],[1,"container-fluid","py-3"],[1,"d-flex","align-items-start","justify-content-between","gap-3","flex-wrap"],[1,"mb-1"],["class","text-muted small",4,"ngIf"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"input-group","input-group-sm",2,"width","170px"],[1,"input-group-text"],[1,"form-select",3,"ngModelChange","ngModel"],["value","intercalado"],["value","agrupado"],[1,"form-check","form-check-inline","small","mb-0"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label"],[4,"ngIf"],[1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"mt-2"],["class","alert alert-danger py-2",4,"ngIf"],["class","alert alert-success py-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between mt-2",4,"ngIf"],["class","table-responsive mt-2 grid-wrap",4,"ngIf"],["class","text-muted small mt-2",4,"ngIf"],[1,"text-muted","small"],[1,"mt-1"],[1,"ms-2"],[1,"d-flex","align-items-center","gap-2","small"],[1,"text-body-secondary"],["class","form-check form-check-inline mb-0",4,"ngIf"],["role","group","aria-label","Habilitar evaluaciones",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"input-group","input-group-sm",2,"width","160px"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"input-group","input-group-sm",2,"width","140px"],["type","number","min","0","max","100",1,"form-control",3,"ngModelChange","ngModel","readOnly"],[1,"form-check","form-check-inline","mb-0"],[3,"ngValue"],[1,"alert","alert-danger","py-2"],[1,"alert","alert-success","py-2"],[1,"d-flex","align-items-center","justify-content-between","mt-2"],[1,"small","text-muted"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"table-responsive","mt-2","grid-wrap"],[1,"table","table-sm","table-bordered","align-middle","mb-0","grid-table"],[1,"table-light"],[1,"sticky-col","name-col"],[1,"sticky-col","name-col-2"],[3,"sep-after",4,"ngFor","ngForOf"],[3,"table-danger","active-row",4,"ngFor","ngForOf"],["role","button",1,"student-name","fw-semibold",3,"click"],["class","mt-1",4,"ngIf"],[3,"sep-after","cell-danger",4,"ngFor","ngForOf"],["alt","Foto estudiante",1,"img-thumbnail",2,"max-width","140px",3,"src"],[4,"ngIf","ngIfElse"],["inputmode","numeric",1,"form-control","form-control-sm","cell",3,"ngModelChange","focus","paste","readOnly","ngModel"],["inputmode","numeric",1,"form-control","form-control-sm","cell",3,"focus","readOnly","ngModel"],[1,"text-muted","small","mt-2"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"h5",3),c(4,"Calificaciones por materia"),a(),v(5,ft,17,11,"div",4),a(),r(6,"div",5)(7,"div",6)(8,"span",7),c(9,"Modo"),a(),r(10,"select",8),A("ngModelChange",function(o){return P(t.viewMode,o)||(t.viewMode=o),o}),x("ngModelChange",function(){return t.rebuildColumns()}),r(11,"option",9),c(12,"Intercalado"),a(),r(13,"option",10),c(14,"Agrupado"),a()()(),r(15,"label",11)(16,"input",12),x("ngModelChange",function(o){return t.onShowSumColumnsChange(o)}),a(),r(17,"span",13),c(18,"Mostrar sumas"),a()(),v(19,vt,26,10,"ng-container",14),r(20,"button",15),x("click",function(){return t.recargarTabla()}),c(21,"Recargar"),a(),r(22,"button",15),x("click",function(){return t.copiarTodo()}),c(23,"Copiar todo"),a(),r(24,"button",16),x("click",function(){return t.guardarCambios()}),c(25),a()()(),r(26,"div",17),v(27,yt,2,1,"div",18)(28,Ct,2,1,"div",18)(29,St,2,1,"div",19),a(),v(30,Et,8,5,"div",20)(31,Dt,11,2,"div",21)(32,kt,2,0,"div",22),a()),e&2&&(l(5),u("ngIf",t.materia),l(5),T("ngModel",t.viewMode),l(6),u("ngModel",t.showSumColumns),l(3),u("ngIf",t.showAdminControls),l(),u("disabled",t.isLoading||t.isSaving),l(2),u("disabled",t.isLoading||t.rows.length===0),l(2),u("disabled",t.isLoading||t.isSaving||t.dirtyIds.size===0||!t.editableEvaluations),l(),E(" Guardar cambios (",t.dirtyIds.size,") "),l(2),u("ngIf",t.loadError),l(),u("ngIf",t.saveError),l(),u("ngIf",t.saveOk),l(),u("ngIf",t.meta),l(),u("ngIf",t.rows.length),l(),u("ngIf",!t.isLoading&&!t.rows.length))},dependencies:[G,H,Z,ee,q,he,_e,Y,Q,be,Ue,J],styles:[".grid-wrap[_ngcontent-%COMP%]{max-height:calc(100vh - 220px)}.grid-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .grid-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.name-col[_ngcontent-%COMP%]{min-width:260px}.name-col-2[_ngcontent-%COMP%]{left:260px;min-width:120px;z-index:2;background:var(--bs-body-bg)}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.sticky-col[_ngcontent-%COMP%]{z-index:3;background:var(--bs-table-bg)}.cell[_ngcontent-%COMP%]{min-width:76px;padding:.15rem .35rem}td.sep-after[_ngcontent-%COMP%], th.sep-after[_ngcontent-%COMP%]{border-right-width:3px}td.cell-danger[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{color:var(--bs-danger);font-weight:600}tr.active-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{outline:1px solid rgba(13,110,253,.35);outline-offset:-1px}.student-name[_ngcontent-%COMP%]{cursor:pointer}.student-name[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});var ve=te;var $=class ${constructor(i){this.http=i;this.ruta=je.ruta}ObtenerRegistroPorMateriaPaginado(i,e,t){let n=new URLSearchParams;n.set("eval",String(e)),t?.page&&n.set("page",String(t.page)),t?.per_page&&n.set("per_page",String(t.per_page));let o=n.toString(),d=this.ruta+"api/registrocalificaciones/materia/"+i+(o?`?${o}`:"");return this.http.get(d)}CrearRubro(i){return this.http.post(this.ruta+"api/registrocalificaciones/rubros",i)}ActualizarRubro(i,e){return this.http.put(this.ruta+"api/registrocalificaciones/rubros/"+i,e)}EliminarRubro(i){return this.http.delete(this.ruta+"api/registrocalificaciones/rubros/"+i)}GuardarNotasBulk(i){return this.http.post(this.ruta+"api/registrocalificaciones/bulk-save",i)}ActualizarEvaluacionModo(i){return this.http.put(this.ruta+"api/registrocalificaciones/evaluacion",i)}};$.\u0275fac=function(e){return new(e||$)(Re(Fe))},$.\u0275prov=Ae({token:$,factory:$.\u0275fac,providedIn:"root"});var ye=$;function Ft(s,i){s&1&&(r(0,"span",41),c(1,"Cargando"),a())}function Lt(s,i){if(s&1&&(r(0,"span",42),c(1),a()),s&2){let e=m();l(),E("",e.dirty.size," cambios")}}function jt(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2);l(),E(" | Paralelo: ",e.materia.MateriaParalelo)}}function $t(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2);l(),E(" | A\xF1o: ",e.materia.Anio)}}function Kt(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2);l(),E("",e.materia.SiglaMateria," - ")}}function Bt(s,i){if(s&1&&(r(0,"div",43)(1,"div")(2,"strong"),c(3),a(),v(4,jt,2,1,"span",44)(5,$t,2,1,"span",44),a(),r(6,"div"),v(7,Kt,2,1,"span",44),c(8),a()()),s&2){let e=m();l(3),S(e.materia.LvlCurso||"Curso"),l(),u("ngIf",e.materia.MateriaParalelo),l(),u("ngIf",e.materia.Anio),l(2),u("ngIf",e.materia.SiglaMateria),l(),E("",e.materia.NombreMateria||"Materia"," ")}}function zt(s,i){if(s&1&&(r(0,"div",48),c(1),a()),s&2){let e=m(2);l(),S(e.loadError)}}function Wt(s,i){if(s&1&&(r(0,"div",48),c(1),a()),s&2){let e=m(2);l(),S(e.saveError)}}function Ut(s,i){if(s&1&&(r(0,"div",49),c(1),a()),s&2){let e=m(2);l(),S(e.saveOk)}}function Gt(s,i){if(s&1&&(r(0,"div",45),v(1,zt,2,1,"div",46)(2,Wt,2,1,"div",46)(3,Ut,2,1,"div",47),a()),s&2){let e=m();l(),u("ngIf",e.loadError),l(),u("ngIf",e.saveError),l(),u("ngIf",e.saveOk)}}function Ht(s,i){if(s&1){let e=I();r(0,"li",50)(1,"button",51),x("click",function(){let n=g(e).$implicit,o=m();return _(o.setEval(n))}),c(2),a()()}if(s&2){let e=i.$implicit,t=m();l(),F("active",t.evalNum===e),l(),E("Eval ",e)}}function Xt(s,i){if(s&1){let e=I();r(0,"div",52)(1,"div",53),c(2),a(),r(3,"div",54)(4,"button",14),x("click",function(){g(e);let n=m();return _(n.prev())}),c(5,"Anterior"),a(),r(6,"button",14),x("click",function(){g(e);let n=m();return _(n.next())}),c(7,"Siguiente"),a()()()}if(s&2){let e=m();l(2),ge("Mostrando ",e.meta.from||0,"-",e.meta.to||0," de ",e.meta.total),l(2),u("disabled",!e.tienePrev()||e.isLoading),l(2),u("disabled",!e.tieneNext()||e.isLoading)}}function qt(s,i){if(s&1&&(r(0,"th",70),c(1,"Te\xF3ricas"),a()),s&2){let e=m(2);V("colspan",e.rubrosTeo.length)}}function Qt(s,i){if(s&1&&(r(0,"th",70),c(1,"Pr\xE1cticas"),a()),s&2){let e=m(2);V("colspan",e.rubrosPra.length)}}function Jt(s,i){if(s&1){let e=I();r(0,"th",70)(1,"div",71)(2,"div",72),c(3),a(),r(4,"div",73)(5,"button",38),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.editarRubro(n))}),c(6,"E"),a(),r(7,"button",74),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.eliminarRubro(n))}),c(8,"X"),a()()()()}if(s&2){let e=i.$implicit;l(3),L("",e.nombre," (",e.max_puntos,")")}}function Yt(s,i){if(s&1){let e=I();r(0,"th",70)(1,"div",71)(2,"div",72),c(3),a(),r(4,"div",73)(5,"button",38),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.editarRubro(n))}),c(6,"E"),a(),r(7,"button",74),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.eliminarRubro(n))}),c(8,"X"),a()()()()}if(s&2){let e=i.$implicit;l(3),L("",e.nombre," (",e.max_puntos,")")}}function Zt(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2).$implicit;l(),S(e.InstrumentoMusical)}}function ei(s,i){s&1&&(r(0,"span"),c(1," \xB7 "),a())}function ti(s,i){if(s&1&&(r(0,"span"),c(1),a()),s&2){let e=m(2).$implicit;l(),S(e.InstrumentoMusicalSecundario)}}function ii(s,i){if(s&1&&(r(0,"div",53),v(1,Zt,2,1,"span",44)(2,ei,2,0,"span",44)(3,ti,2,1,"span",44),a()),s&2){let e=m().$implicit,t=m(2);l(),u("ngIf",t.normalizarTexto(e.InstrumentoMusical)),l(),u("ngIf",t.normalizarTexto(e.InstrumentoMusical)&&t.normalizarTexto(e.InstrumentoMusicalSecundario)),l(),u("ngIf",t.normalizarTexto(e.InstrumentoMusicalSecundario))}}function ni(s,i){if(s&1&&(r(0,"div",45),w(1,"img",84),a()),s&2){let e=m().$implicit,t=m(2);l(),u("src",t.fotoUrl(e.Foto),de)}}function oi(s,i){if(s&1){let e=I();r(0,"td")(1,"input",85),x("ngModelChange",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.setNota(d.infoestudiantesifas_id,o.id,n))})("id",function(){let n=g(e).$implicit,o=m().$implicit,d=m(2);return _(d.cellId(o.infoestudiantesifas_id,n.id))})("paste",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onPaste(n,d.infoestudiantesifas_id,o.id))})("keydown",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onKeydown(n,d.infoestudiantesifas_id,o.id))})("mousedown",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onCellMouseDown(n,d.infoestudiantesifas_id,o.id))}),a()()}if(s&2){let e=i.$implicit,t=m().$implicit,n=m(2);F("cell-selected",n.isCellSelected(t.infoestudiantesifas_id,e.id)),l(),u("ngModel",n.getNota(t.infoestudiantesifas_id,e.id))("data-row",t.infoestudiantesifas_id)("data-col",e.id),V("max",e.max_puntos)}}function ai(s,i){if(s&1){let e=I();r(0,"td")(1,"input",85),x("ngModelChange",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.setNota(d.infoestudiantesifas_id,o.id,n))})("id",function(){let n=g(e).$implicit,o=m().$implicit,d=m(2);return _(d.cellId(o.infoestudiantesifas_id,n.id))})("paste",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onPaste(n,d.infoestudiantesifas_id,o.id))})("keydown",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onKeydown(n,d.infoestudiantesifas_id,o.id))})("mousedown",function(n){let o=g(e).$implicit,d=m().$implicit,p=m(2);return _(p.onCellMouseDown(n,d.infoestudiantesifas_id,o.id))}),a()()}if(s&2){let e=i.$implicit,t=m().$implicit,n=m(2);F("cell-selected",n.isCellSelected(t.infoestudiantesifas_id,e.id)),l(),u("ngModel",n.getNota(t.infoestudiantesifas_id,e.id))("data-row",t.infoestudiantesifas_id)("data-col",e.id),V("max",e.max_puntos)}}function ri(s,i){if(s&1){let e=I();r(0,"tr")(1,"td",75)(2,"div",76),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.toggleFoto(n))}),c(3),a(),v(4,ii,4,3,"div",77)(5,ni,2,1,"div",16),a(),r(6,"td",78),c(7),a(),v(8,oi,2,6,"td",79),w(9,"td",80),r(10,"td",81),c(11),a(),v(12,ai,2,6,"td",79),w(13,"td",80),r(14,"td",82),c(15),a(),r(16,"td",83),c(17),a()()}if(s&2){let e=i.$implicit,t=m(2);l(3),S(t.nombreCompleto(e)),l(),u("ngIf",t.normalizarTexto(e.InstrumentoMusical)||t.normalizarTexto(e.InstrumentoMusicalSecundario)),l(),u("ngIf",t.fotoAbierta(e)),l(2),S(e.CI||""),l(),u("ngForOf",t.rubrosTeo),l(3),S(t.getTeo(e)??""),l(),u("ngForOf",t.rubrosPra),l(3),S(t.getPra(e)??""),l(2),S(t.getSum(e)??"")}}function si(s,i){if(s&1){let e=I();r(0,"div",55)(1,"table",56)(2,"thead",57)(3,"tr")(4,"th",58),c(5,"Estudiante"),a(),r(6,"th",59),c(7,"CI"),a(),v(8,qt,2,1,"th",60),r(9,"th",61)(10,"button",62),x("click",function(){g(e);let n=m();return _(n.abrirModalRubro("TEO"))}),c(11,"+"),a()(),r(12,"th",63),c(13),a(),v(14,Qt,2,1,"th",60),r(15,"th",61)(16,"button",64),x("click",function(){g(e);let n=m();return _(n.abrirModalRubro("PRA"))}),c(17,"+"),a()(),r(18,"th",65),c(19),a(),r(20,"th",66),c(21),a()(),r(22,"tr"),v(23,Jt,9,2,"th",67),r(24,"th",61)(25,"span",68),c(26,"\xA0"),a()(),v(27,Yt,9,2,"th",67),r(28,"th",61)(29,"span",68),c(30,"\xA0"),a()()()(),r(31,"tbody"),v(32,ri,18,9,"tr",69),a()()()}if(s&2){let e=m();l(8),u("ngIf",e.rubrosTeo.length),l(2),u("disabled",e.isLoading||e.isSaving),l(3),E("Teo ",e.evalNum),l(),u("ngIf",e.rubrosPra.length),l(2),u("disabled",e.isLoading||e.isSaving),l(3),E("Prac ",e.evalNum),l(2),E("Sum ",e.evalNum),l(2),u("ngForOf",e.rubrosTeo),l(4),u("ngForOf",e.rubrosPra),l(5),u("ngForOf",e.rows)}}function li(s,i){s&1&&(r(0,"div",36),c(1,"No hay estudiantes asignados a esta materia."),a())}function ci(s,i){s&1&&w(0,"div",86)}var ie=class ie{constructor(i,e){this.api=i;this.route=e;this.materiaId=null;this.evalCountMax=4;this.openFotoInfoId=null;this.evalNum=1;this.isLoading=!1;this.isSaving=!1;this.loadError=null;this.saveError=null;this.saveOk=null;this.materia=null;this.evaluacion=null;this.modoEval=3;this.rubros=[];this.rows=[];this.meta=null;this.page=1;this.perPage=30;this.notas=new Map;this.dirty=new Set;this.modalVisible=!1;this.modalTipo="TEO";this.modalModo="create";this.modalRubroId=null;this.nuevoNombre="";this.nuevoMax=10;this.nuevoOrden=1;this.anchor=null;this.cursor=null;this.undoStack=[];this.redoStack=[];this.isRestoring=!1;this.isBatching=!1}ngOnInit(){this.route.queryParamMap.subscribe(i=>{let e=i.get("materiaId")??i.get("materias_id")??"",t=Number(e);if(!e||Number.isNaN(t)||t<=0){this.materiaId=null,this.rows=[],this.rubros=[],this.meta=null,this.materia=null,this.loadError='Falta seleccionar una materia. Vuelve a "Mis Materias" y abre el registro desde ah\xED.';return}let n=this.materiaId!==t;this.materiaId=t,n&&(this.evalNum=1,this.page=1,this.cargar(1))})}normalizarTexto(i){return(i??"").toString().trim()}fotoUrl(i){let e=this.normalizarTexto(i);if(e===""||e.toLowerCase()==="null"||e.toLowerCase()==="undefined")return this.api.ruta+"fijos/sinperfil.jpg";let t=e.toLowerCase();return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?e:this.api.ruta+e}toggleFoto(i){let e=Number(i?.infoestudiantesifas_id);!e||Number.isNaN(e)||(this.openFotoInfoId=this.openFotoInfoId===e?null:e)}fotoAbierta(i){let e=Number(i?.infoestudiantesifas_id);return!!e&&this.openFotoInfoId===e}parseEvalCount(i){let t=(i??"").toString().match(/(\d+)/),n=Number(t?t[1]:i);return n===1||n===2||n===3||n===4?n:4}evalTabs(){return[1,2,3,4].slice(0,this.evalCountMax)}get rubrosTeo(){return this.rubros.filter(i=>i.tipo==="TEO")}get rubrosPra(){return this.rubros.filter(i=>i.tipo==="PRA")}key(i,e){return`${i}__${e}`}nombreCompleto(i){let e=(i.Ap_Paterno??"").trim(),t=(i.Ap_Materno??"").trim(),n=(i.Nombres??"").trim();return[e,t,n].filter(Boolean).join(" ").trim()||"(Sin nombre)"}setEval(i){this.evalNum!==i&&(this.evalNum=i,this.cargar(1))}onModoChange(i){let e=Number(i);(e===1||e===2||e===3)&&this.materiaId&&this.api.ActualizarEvaluacionModo({materias_id:this.materiaId,numero_eval:this.evalNum,modo_eval:e}).subscribe({next:t=>{let n=Number(t?.evaluacion?.modo_eval??e);this.modoEval=n===1||n===2||n===3?n:e,this.saveOk="Modo actualizado.",setTimeout(()=>this.saveOk=null,1200),this.recargar()},error:t=>{console.error("Error actualizando modo:",t),this.saveError="No se pudo actualizar el modo.",this.recargar()}})}tienePrev(){return!!this.meta&&(this.meta.current_page??1)>1}tieneNext(){return!!this.meta&&(this.meta.current_page??1)<(this.meta.last_page??1)}prev(){this.tienePrev()&&this.cargar((this.meta.current_page??1)-1)}next(){this.tieneNext()&&this.cargar((this.meta.current_page??1)+1)}recargar(){this.cargar(this.page||1)}abrirModalRubro(i){this.modalModo="create",this.modalRubroId=null,this.modalTipo=i,this.nuevoNombre="",this.nuevoMax=10;let e=i==="TEO"?this.rubrosTeo:this.rubrosPra;this.nuevoOrden=(e.reduce((t,n)=>Math.max(t,n.orden??1),0)||0)+1,this.modalVisible=!0,setTimeout(()=>{let t=document.querySelector(".modal input.form-control");t?.focus(),t?.select()},0)}cerrarModal(){this.modalVisible=!1}onModalBackdrop(i){i.target?.classList?.contains("modal")&&this.cerrarModal()}confirmarModal(){this.modalModo==="create"?this.crearRubroDesdeModal():this.actualizarRubroDesdeModal()}editarRubro(i){this.modalModo="edit",this.modalRubroId=i.id,this.modalTipo=i.tipo,this.nuevoNombre=i.nombre,this.nuevoMax=i.max_puntos,this.nuevoOrden=i.orden,this.modalVisible=!0,setTimeout(()=>{let e=document.querySelector(".modal input.form-control");e?.focus(),e?.select()},0)}eliminarRubro(i){window.confirm(`\xBFEliminar el rubro "${i.nombre}"?`)&&this.api.EliminarRubro(i.id).subscribe({next:()=>{this.saveOk="Rubro eliminado.",setTimeout(()=>this.saveOk=null,1500),this.recargar()},error:t=>{console.error("Error eliminando rubro:",t),this.saveError="No se pudo eliminar el rubro."}})}cargar(i=1){if(!this.materiaId){this.loadError="Materia inv\xE1lida.";return}this.isLoading||(this.isLoading=!0,this.loadError=null,this.saveError=null,this.saveOk=null,this.api.ObtenerRegistroPorMateriaPaginado(this.materiaId,this.evalNum,{page:i,per_page:this.perPage}).subscribe({next:e=>{this.materia=e?.materia??null,this.evalCountMax=this.parseEvalCount(this.materia?.CantidadEvaluaciones),this.evalNum>this.evalCountMax&&(this.evalNum=1),this.evaluacion=e?.evaluacion??null;let t=Number(this.evaluacion?.modo_eval??this.evaluacion?.modoEval??3);this.modoEval=t===1||t===2||t===3?t:3,this.rubros=Array.isArray(e?.rubros)?e.rubros:[],this.rows=Array.isArray(e?.data)?e.data:[],this.meta=e?.meta??null,this.page=this.meta?.current_page??i,this.notas.clear(),this.dirty.clear();let n=Array.isArray(e?.notas)?e.notas:[];for(let o of n)this.notas.set(this.key(o.infoestudiantesifas_id,o.rubro_id),o.nota??null)},error:e=>{console.error("Error al cargar registrocalificaciones:",e),this.rows=[],this.rubros=[],this.meta=null,this.loadError="No se pudo cargar el registro de calificaciones."},complete:()=>{this.isLoading=!1}}))}getNota(i,e){return this.notas.get(this.key(i,e))??null}setNota(i,e,t,n){!this.isRestoring&&!this.isBatching&&!n?.skipUndo&&this.pushUndoSnapshot();let o=this.key(i,e),d=String(t??"").trim(),p=null;if(d!==""){let b=Number(d);Number.isFinite(b)?p=Math.round(b):p=null}let f=this.rubros.find(b=>b.id===e);p!==null&&f&&(p<0&&(p=0),p>f.max_puntos&&(p=f.max_puntos)),(this.notas.get(o)??null)!==p&&(this.notas.set(o,p),this.dirty.add(o))}onCellMouseDown(i,e,t){if(i.shiftKey&&this.anchor){this.cursor={infoId:e,rubroId:t};return}this.anchor={infoId:e,rubroId:t},this.cursor={infoId:e,rubroId:t}}isCellSelected(i,e){if(!this.anchor||!this.cursor)return!1;let t=this.rowIndexOf(this.anchor.infoId),n=this.rubroIndexOf(this.anchor.rubroId),o=this.rowIndexOf(this.cursor.infoId),d=this.rubroIndexOf(this.cursor.rubroId);if(t<0||n<0||o<0||d<0)return!1;let p=Math.min(t,o),f=Math.max(t,o),h=Math.min(n,d),b=Math.max(n,d),y=this.rowIndexOf(i),C=this.rubroIndexOf(e);return y>=p&&y<=f&&C>=h&&C<=b}buildSelectionTSV(){if(!this.anchor||!this.cursor)return null;let i=this.rowIndexOf(this.anchor.infoId),e=this.rubroIndexOf(this.anchor.rubroId),t=this.rowIndexOf(this.cursor.infoId),n=this.rubroIndexOf(this.cursor.rubroId);if(i<0||e<0||t<0||n<0)return null;let o=Math.min(i,t),d=Math.max(i,t),p=Math.min(e,n),f=Math.max(e,n),h=[];for(let b=o;b<=d;b++){let y=this.rows[b];if(!y)continue;let C=[];for(let M=p;M<=f;M++){let D=this.rubros[M];if(!D)continue;let O=this.getNota(y.infoestudiantesifas_id,D.id);C.push(O===null?"":String(Math.trunc(O)))}h.push(C.join("	"))}return h.join(`
`)}copyText(i){return k(this,null,function*(){try{yield navigator.clipboard.writeText(i);return}catch{let e=document.createElement("textarea");e.value=i,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}finally{document.body.removeChild(e)}}})}pushUndoSnapshot(){let i={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?N({},this.anchor):null,cursor:this.cursor?N({},this.cursor):null};this.undoStack.push(i),this.undoStack.length>50&&this.undoStack.shift(),this.redoStack.length=0}restoreSnapshot(i){this.isRestoring=!0;try{this.notas.clear();for(let[e,t]of i.notas)this.notas.set(e,t);this.dirty=new Set(i.dirty),this.anchor=i.anchor,this.cursor=i.cursor}finally{this.isRestoring=!1}}undo(){let i=this.undoStack.pop();if(!i)return;let e={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?N({},this.anchor):null,cursor:this.cursor?N({},this.cursor):null};this.redoStack.push(e),this.restoreSnapshot(i)}redo(){let i=this.redoStack.pop();if(!i)return;let e={notas:Array.from(this.notas.entries()),dirty:Array.from(this.dirty.values()),anchor:this.anchor?N({},this.anchor):null,cursor:this.cursor?N({},this.cursor):null};this.undoStack.push(e),this.restoreSnapshot(i)}crearRubroDesdeModal(){let i=this.nuevoNombre.trim();if(!i)return;let e=Math.max(1,Math.trunc(Number(this.nuevoMax)||1)),t=Math.max(1,Math.trunc(Number(this.nuevoOrden)||1));this.modoEval===1?e=100:this.modoEval===2&&(e=this.modalTipo==="TEO"?30:70),this.materiaId&&this.api.CrearRubro({materias_id:this.materiaId,numero_eval:this.evalNum,tipo:this.modalTipo,nombre:i,max_puntos:e,orden:t}).subscribe({next:()=>{this.saveOk="Rubro creado.",setTimeout(()=>this.saveOk=null,1500),this.cerrarModal(),this.recargar()},error:n=>{console.error("Error creando rubro:",n),this.saveError="No se pudo crear el rubro."}})}actualizarRubroDesdeModal(){let i=this.modalRubroId;if(!i)return;let e=this.nuevoNombre.trim();if(!e)return;let t=Math.max(1,Math.trunc(Number(this.nuevoMax)||1)),n=Math.max(1,Math.trunc(Number(this.nuevoOrden)||1));this.modoEval===1?t=100:this.modoEval===2&&(t=this.modalTipo==="TEO"?30:70),this.api.ActualizarRubro(i,{tipo:this.modalTipo,nombre:e,max_puntos:t,orden:n}).subscribe({next:()=>{this.saveOk="Rubro actualizado.",setTimeout(()=>this.saveOk=null,1500),this.cerrarModal(),this.recargar()},error:o=>{console.error("Error actualizando rubro:",o),this.saveError="No se pudo actualizar el rubro."}})}getTeo(i){let e=this.getVirtualEval(i.infoestudiantesifas_id)?.teo;if(e!==null)return e;let t=`Teorico${this.evalNum}`,n=i[t];return typeof n=="number"?Math.trunc(n):n??null}getPra(i){let e=this.getVirtualEval(i.infoestudiantesifas_id)?.pra;if(e!==null)return e;let t=`Practico${this.evalNum}`,n=i[t];return typeof n=="number"?Math.trunc(n):n??null}getSum(i){let e=this.getTeo(i),t=this.getPra(i);if(e===null&&t===null)return null;let n=(e??0)+(t??0);return Math.trunc(n)}getVirtualEval(i){if(!this.rubros?.length)return null;let e=Math.trunc(Number(this.evaluacion?.limite_teorico??30)),t=Math.trunc(Number(this.evaluacion?.limite_practico??70)),n=[],o=[],d=null;for(let b of this.rubros){let y=this.getNota(i,b.id);if(y==null)continue;let C=Math.round(Number(y));if(!Number.isFinite(C))continue;let M=Math.trunc(Number(b.max_puntos??0));C<0&&(C=0),M>0&&C>M&&(C=M);let D=b.es_asistencia===1||b.es_asistencia===!0;b.tipo==="TEO"?D?d=C:n.push(C):o.push(C)}let p=this.modoEval,f=null,h=null;if(p===1){let b=null;if(n.length>0){let y=n.reduce((C,M)=>C+M,0)/n.length;b=Math.round(y/100*20)}if((b!==null||d!==null)&&(f=Math.round((b??0)+(d??0)),f<0&&(f=0),f>e&&(f=e)),o.length>0){let y=o.reduce((C,M)=>C+M,0)/o.length;h=Math.round(y/100*t),h<0&&(h=0),h>t&&(h=t)}}else if(p===2){let b=null;if(n.length>0){let y=n.reduce((C,M)=>C+M,0)/n.length;b=Math.round(y/30*20)}if((b!==null||d!==null)&&(f=Math.round((b??0)+(d??0)),f<0&&(f=0),f>e&&(f=e)),o.length>0){let y=o.reduce((C,M)=>C+M,0)/o.length;h=Math.round(y/70*t),h<0&&(h=0),h>t&&(h=t)}}else{let b=n.reduce((C,M)=>C+M,0)+(d??0),y=o.reduce((C,M)=>C+M,0);(n.length>0||d!==null)&&(f=Math.round(b),f<0&&(f=0),f>e&&(f=e)),o.length>0&&(h=Math.round(y),h<0&&(h=0),h>t&&(h=t))}return{teo:f,pra:h}}cellId(i,e){return`rc_${i}_${e}`}focusCell(i,e){let t=document.getElementById(this.cellId(i,e));t&&(t.focus(),t.select())}rubroIndexOf(i){return this.rubros.findIndex(e=>e.id===i)}rowIndexOf(i){return this.rows.findIndex(e=>e.infoestudiantesifas_id===i)}onKeydown(i,e,t){let n=i.key.toLowerCase();if(i.ctrlKey&&!i.shiftKey&&n==="z"){i.preventDefault(),this.undo();return}if(i.ctrlKey&&n==="y"||i.ctrlKey&&i.shiftKey&&n==="z"){i.preventDefault(),this.redo();return}if(i.ctrlKey&&n==="c"){let C=this.buildSelectionTSV();C!==null&&(i.preventDefault(),this.copyText(C));return}let o=i.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","Tab"].includes(o))return;let d=this.rowIndexOf(e),p=this.rubroIndexOf(t);if(d<0||p<0)return;let f=d,h=p;o==="ArrowLeft"&&(h-=1),o==="ArrowRight"&&(h+=1),o==="ArrowUp"&&(f-=1),o==="ArrowDown"&&(f+=1),o==="Enter"&&(f+=i.shiftKey?-1:1),o==="Tab"&&(h+=i.shiftKey?-1:1),f<0&&(f=0),f>=this.rows.length&&(f=this.rows.length-1),h<0&&(h=0),h>=this.rubros.length&&(h=this.rubros.length-1),i.preventDefault();let b=this.rows[f]?.infoestudiantesifas_id,y=this.rubros[h]?.id;b&&y&&(i.shiftKey?(this.anchor||(this.anchor={infoId:e,rubroId:t}),this.cursor={infoId:b,rubroId:y}):(this.anchor={infoId:b,rubroId:y},this.cursor={infoId:b,rubroId:y}),this.focusCell(b,y))}onPaste(i,e,t){let n=i.clipboardData?.getData("text/plain");if(!n)return;this.isRestoring||this.pushUndoSnapshot();let o=this.rowIndexOf(e),d=this.rubroIndexOf(t);if(o<0||d<0)return;let p=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(f=>f.length>0);if(p.length){i.preventDefault(),this.isBatching=!0;for(let f=0;f<p.length;f++){let h=p[f].split("	"),b=this.rows[o+f];if(!b)break;for(let y=0;y<h.length;y++){let C=this.rubros[d+y];if(!C)break;let M=h[y].trim();if(M===""){this.setNota(b.infoestudiantesifas_id,C.id,null,{skipUndo:!0});continue}this.setNota(b.infoestudiantesifas_id,C.id,M,{skipUndo:!0})}}this.isBatching=!1}}guardarCambios(){if(this.isSaving)return;if(!this.materiaId){this.saveError="Materia inv\xE1lida.";return}if(this.dirty.size===0){this.saveOk="No hay cambios para guardar.",setTimeout(()=>this.saveOk=null,1500);return}let i=[];for(let t of this.dirty.values()){let[n,o]=t.split("__"),d=Number(n),p=Number(o);!Number.isFinite(d)||!Number.isFinite(p)||i.push({infoestudiantesifas_id:d,rubro_id:p,nota:this.notas.get(t)??null})}this.isSaving=!0,this.saveError=null,this.saveOk=null;let e=this.materia?.CantidadEvaluaciones??4;this.api.GuardarNotasBulk({materias_id:this.materiaId,numero_eval:this.evalNum,avg_eval_count:e,items:i}).subscribe({next:()=>{this.saveOk="Guardado.",this.dirty.clear(),setTimeout(()=>this.saveOk=null,1500),this.recargar()},error:t=>{console.error("Error guardando notas:",t),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}};ie.\u0275fac=function(e){return new(e||ie)(R(ye),R(X))},ie.\u0275cmp=W({type:ie,selectors:[["app-registroscalificaciones"]],standalone:!1,decls:63,vars:28,consts:[[1,"container-fluid","py-3"],[1,"card","shadow-sm"],[1,"card-header","bg-body"],[1,"d-flex","align-items-start","justify-content-between","gap-3","flex-wrap"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"mb-0"],["class","badge text-bg-secondary",4,"ngIf"],["class","badge text-bg-warning",4,"ngIf"],["class","text-muted small mt-1",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],[1,"text-muted","small"],[1,"form-select","form-select-sm",2,"width","240px",3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],["role","group","aria-label","Acciones",1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],["class","mt-2",4,"ngIf"],["role","tablist",1,"nav","nav-pills","nav-fill","mt-3"],["class","nav-item","role","presentation",4,"ngFor","ngForOf"],[1,"card-body","pt-2"],["class","d-flex align-items-center justify-content-between mt-2",4,"ngIf"],["class","table-responsive mt-2",4,"ngIf"],["class","text-muted small mt-2",4,"ngIf"],["tabindex","-1",1,"modal","fade",3,"click"],[1,"modal-dialog","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-2"],[1,"form-label","form-label-sm"],["placeholder","Ej: Prueba corta",1,"form-control","form-control-sm",3,"ngModelChange","keydown.enter","ngModel"],[1,"row","g-2"],[1,"col-6"],["type","number","min","1","step","1",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"text-muted","small","mt-2"],[1,"modal-footer"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","disabled"],["class","modal-backdrop fade show",4,"ngIf"],[1,"badge","text-bg-secondary"],[1,"badge","text-bg-warning"],[1,"text-muted","small","mt-1"],[4,"ngIf"],[1,"mt-2"],["class","alert alert-danger py-2 mb-2",4,"ngIf"],["class","alert alert-success py-2 mb-0",4,"ngIf"],[1,"alert","alert-danger","py-2","mb-2"],[1,"alert","alert-success","py-2","mb-0"],["role","presentation",1,"nav-item"],["type","button",1,"nav-link",3,"click"],[1,"d-flex","align-items-center","justify-content-between","mt-2"],[1,"small","text-muted"],[1,"btn-group","btn-group-sm"],[1,"table-responsive","mt-2"],[1,"table","table-sm","table-bordered","table-hover","table-striped","align-middle","mb-0","reg-grid"],[1,"table-light"],["rowspan","2",1,"sticky-col","col-meta"],["rowspan","2",1,"sticky-col","col-meta-2"],["class","text-center",4,"ngIf"],[1,"text-center","col-add"],["type","button","title","Agregar rubro te\xF3rico",1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],["rowspan","2",1,"text-center","col-teo"],["type","button","title","Agregar rubro pr\xE1ctico",1,"btn","btn-sm","btn-outline-primary",3,"click","disabled"],["rowspan","2",1,"text-center","col-pra"],["rowspan","2",1,"text-center","col-sum"],["class","text-center",4,"ngFor","ngForOf"],[1,"text-muted"],[4,"ngFor","ngForOf"],[1,"text-center"],[1,"rubro-head-wrap"],[1,"rubro-head"],[1,"rubro-actions"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"sticky-col","col-meta"],[1,"fw-semibold","student-name",3,"click"],["class","small text-muted",4,"ngIf"],[1,"sticky-col","col-meta-2"],[3,"cell-selected",4,"ngFor","ngForOf"],[1,"col-add"],[1,"col-teo","text-center"],[1,"col-pra","text-center"],[1,"col-sum","text-center"],["alt","Foto",2,"max-width","140px","height","auto",3,"src"],["type","number","min","0","step","1","inputmode","numeric",1,"form-control","form-control-sm",3,"ngModelChange","id","paste","keydown","mousedown","ngModel","data-row","data-col"],[1,"modal-backdrop","fade","show"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"div",4)(6,"h5",5),c(7,"Registro de calificaciones"),a(),v(8,Ft,2,0,"span",6)(9,Lt,2,1,"span",7),a(),v(10,Bt,9,5,"div",8),a(),r(11,"div",4)(12,"div",9)(13,"span",10),c(14,"Modo:"),a(),r(15,"select",11),A("ngModelChange",function(o){return P(t.modoEval,o)||(t.modoEval=o),o}),x("ngModelChange",function(o){return t.onModoChange(o)}),r(16,"option",12),c(17,"Promediar sobre 100 \u2192 Teo20 + Asist10 / Prac70"),a(),r(18,"option",12),c(19,"Promediar sobre 30/70 (Asist10 fijo)"),a(),r(20,"option",12),c(21,"Sumatoria (Asist10 fijo)"),a()()(),r(22,"div",13)(23,"button",14),x("click",function(){return t.recargar()}),c(24,"Recargar"),a(),r(25,"button",15),x("click",function(){return t.guardarCambios()}),c(26," Guardar "),a()()()(),v(27,Gt,4,3,"div",16),r(28,"ul",17),v(29,Ht,3,3,"li",18),a()(),r(30,"div",19),v(31,Xt,8,5,"div",20)(32,si,33,10,"div",21)(33,li,2,0,"div",22),a()(),r(34,"div",23),x("click",function(o){return t.onModalBackdrop(o)}),r(35,"div",24),x("click",function(o){return o.stopPropagation()}),r(36,"div",25)(37,"div",26)(38,"h5",27),c(39),a(),r(40,"button",28),x("click",function(){return t.cerrarModal()}),a()(),r(41,"div",29)(42,"div",30)(43,"label",31),c(44,"Nombre"),a(),r(45,"input",32),A("ngModelChange",function(o){return P(t.nuevoNombre,o)||(t.nuevoNombre=o),o}),x("keydown.enter",function(){return t.confirmarModal()}),a()(),r(46,"div",33)(47,"div",34)(48,"label",31),c(49,"Max puntos"),a(),r(50,"input",35),A("ngModelChange",function(o){return P(t.nuevoMax,o)||(t.nuevoMax=o),o}),a()(),r(51,"div",34)(52,"label",31),c(53,"Orden"),a(),r(54,"input",35),A("ngModelChange",function(o){return P(t.nuevoOrden,o)||(t.nuevoOrden=o),o}),a()()(),r(55,"div",36),c(56,"Notas: todo se guarda como n\xFAmero entero (redondeado)."),a()(),r(57,"div",37)(58,"button",38),x("click",function(){return t.cerrarModal()}),c(59,"Cancelar"),a(),r(60,"button",39),x("click",function(){return t.confirmarModal()}),c(61),a()()()()(),v(62,ci,1,0,"div",40),a()),e&2&&(l(8),u("ngIf",t.isLoading),l(),u("ngIf",!t.isLoading&&t.dirty.size>0),l(),u("ngIf",t.materia),l(5),T("ngModel",t.modoEval),u("disabled",t.isLoading||t.isSaving),l(),u("ngValue",1),l(2),u("ngValue",2),l(2),u("ngValue",3),l(3),u("disabled",t.isLoading||t.isSaving),l(2),u("disabled",t.isLoading||t.isSaving||t.dirty.size===0),l(2),u("ngIf",t.loadError||t.saveError||t.saveOk),l(2),u("ngForOf",t.evalTabs()),l(2),u("ngIf",t.meta),l(),u("ngIf",t.rows.length),l(),u("ngIf",!t.isLoading&&!t.rows.length),l(),De("display",t.modalVisible?"block":"none"),F("show",t.modalVisible),V("aria-hidden",!t.modalVisible),l(5),L("",t.modalModo==="create"?"Agregar":"Editar"," rubro ",t.modalTipo==="TEO"?"te\xF3rico":"pr\xE1ctico"),l(6),T("ngModel",t.nuevoNombre),l(5),T("ngModel",t.nuevoMax),l(4),T("ngModel",t.nuevoOrden),l(6),u("disabled",!t.nuevoNombre.trim()||t.isLoading||t.isSaving),l(),S(t.modalModo==="create"?"Agregar":"Guardar"),l(),u("ngIf",t.modalVisible))},dependencies:[G,H,Z,ee,q,he,Y,Q,be,J],styles:["[_nghost-%COMP%]{display:block}.student-name[_ngcontent-%COMP%]{cursor:pointer}.student-name[_ngcontent-%COMP%]:hover{text-decoration:underline}.reg-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.reg-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:3;background:var(--bs-tertiary-bg)}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.col-meta[_ngcontent-%COMP%]{min-width:260px}.col-meta-2[_ngcontent-%COMP%]{left:260px;min-width:120px;z-index:2}.col-teo[_ngcontent-%COMP%], .col-pra[_ngcontent-%COMP%], .col-sum[_ngcontent-%COMP%]{min-width:90px}.col-add[_ngcontent-%COMP%]{width:42px;min-width:42px;max-width:42px}.reg-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .reg-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.rubro-head[_ngcontent-%COMP%]{writing-mode:vertical-lr;text-orientation:mixed;white-space:normal;line-height:1.1;font-weight:600;max-height:180px;overflow:hidden;margin:0 auto}.rubro-head-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:6px}.rubro-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.reg-grid[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{padding:.15rem .35rem;text-align:center}.reg-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.cell-selected[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{outline:2px solid var(--bs-primary);outline-offset:-1px}"]});var Ce=ie;var di=["modalEditarInscripcion"],ui=["modalReporte"],mi=["modalSeleccionPlantillaExcel"];function pi(s,i){s&1&&(r(0,"span",61),c(1,"INACTIVO"),a())}function fi(s,i){if(s&1){let e=I();r(0,"button",58),x("click",function(){let n=g(e).$implicit,o=m(2);return _(o.seleccionarDocente(n))}),r(1,"span"),c(2),a(),r(3,"span",59)(4,"span",60),c(5),a(),v(6,pi,2,0,"span",16),a()()}if(s&2){let e=i.$implicit,t=m(2);u("disabled",t.docenteInactivo(e)),l(2),S(t.getNombreCompletoDocente(e)),l(3),S(t.getConteoAsignadosDocente(e)),l(),u("ngIf",t.docenteInactivo(e))}}function gi(s,i){if(s&1&&(r(0,"div",56),v(1,fi,7,4,"button",57),a()),s&2){let e=m();l(),u("ngForOf",e.docentesFiltrados)}}function _i(s,i){if(s&1&&(r(0,"span",62),c(1),a()),s&2){let e=m();l(),E("Asignados: ",e.conteoAsignados)}}function hi(s,i){if(s&1&&(r(0,"span",61),c(1),a()),s&2){let e=m();l(),E("Mostrando: ",e.collectionSize)}}function bi(s,i){if(s&1){let e=I();r(0,"button",63),x("click",function(){g(e);let n=m();return _(n.refrescarPantalla())}),c(1,"Refrescar"),a()}}function xi(s,i){if(s&1){let e=I();r(0,"button",64),x("click",function(){g(e);let n=m();return _(n.limpiarDocente())}),c(1,"Limpiar"),a()}}function vi(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.id),l(),S(e.Nombre)}}function yi(s,i){if(s&1){let e=I();r(0,"div",20)(1,"div",11)(2,"select",21),A("ngModelChange",function(n){g(e);let o=m();return P(o.institucionesFiltroId,n)||(o.institucionesFiltroId=n),_(n)}),x("change",function(){g(e);let n=m();return _(n.onFiltroChange())}),r(3,"option",24),c(4,"(Todas)"),a(),v(5,vi,2,2,"option",22),a(),r(6,"label"),c(7,"Instituci\xF3n"),a()()()}if(s&2){let e=m();l(2),T("ngModel",e.institucionesFiltroId),l(),u("ngValue",null),l(2),u("ngForOf",e.instituciones)}}function Ci(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.id),l(),S(e.Anio)}}function Si(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.value),l(),S(e.label)}}function Ei(s,i){if(s&1){let e=I();r(0,"div",65)(1,"input",66),A("ngModelChange",function(n){g(e);let o=m();return P(o.includeSinDocente,n)||(o.includeSinDocente=n),_(n)}),x("change",function(){g(e);let n=m();return _(n.onFiltroChange())}),a(),r(2,"label",67),c(3,"Incluir est. sin docente asignado"),a()()}if(s&2){let e=m();l(),T("ngModel",e.includeSinDocente)}}function Mi(s,i){s&1&&(r(0,"span"),c(1,"COPIAR"),a())}function Ii(s,i){s&1&&(r(0,"span"),w(1,"span",68),c(2," COPIANDO... "),a())}function wi(s,i){s&1&&(r(0,"span"),c(1,"GENERAR EXCEL"),a())}function Ti(s,i){s&1&&(r(0,"span"),w(1,"span",68),c(2," GENERANDO... "),a())}function Pi(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e),l(),E("",e," por p\xE1gina")}}function Ai(s,i){if(s&1){let e=I();r(0,"button",77),x("click",function(){let n=g(e).$implicit,o=m(2).$implicit;return _(o.close(n))}),r(1,"span"),c(2),a(),r(3,"small",78),c(4),a()()}if(s&2){let e=i.$implicit;l(2),S((e==null?null:e.ParaI)||"Plantilla"),l(2),S(e==null?null:e.Categoria)}}function Ri(s,i){if(s&1&&(r(0,"div",75),v(1,Ai,5,2,"button",76),a()),s&2){let e=m(2);l(),u("ngForOf",e.plantillasExcelDisponibles)}}function Oi(s,i){s&1&&(r(0,"div",78),c(1,"No hay plantillas disponibles."),a())}function Ni(s,i){if(s&1){let e=I();r(0,"div",69)(1,"h5",70),c(2,"Seleccionar plantilla Excel"),a(),r(3,"button",71),x("click",function(){let n=g(e).$implicit;return _(n.dismiss("close"))}),a()(),r(4,"div",72),v(5,Ri,2,1,"div",73)(6,Oi,2,0,"div",74),a()}if(s&2){let e=m();l(5),u("ngIf",e.plantillasExcelDisponibles&&e.plantillasExcelDisponibles.length),l(),u("ngIf",!e.plantillasExcelDisponibles||e.plantillasExcelDisponibles.length===0)}}function Di(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.label),l(),S(e.label)}}function ki(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.label),l(),S(e.label)}}function Vi(s,i){if(s&1&&(r(0,"option",24),c(1),a()),s&2){let e=i.$implicit;u("ngValue",e.label),l(),S(e.label)}}function Fi(s,i){s&1&&(r(0,"th",79),c(1,"Acciones"),a())}function Li(s,i){if(s&1&&(r(0,"tr")(1,"td",52)(2,"div",80)(3,"span",81),c(4,"Cargando..."),a()()()()),s&2){let e=m();l(),V("colspan",e.esDocente?11:12)}}function ji(s,i){if(s&1&&(r(0,"tr")(1,"td",82),c(2,"Selecciona un docente para ver sus estudiantes."),a()()),s&2){let e=m();l(),V("colspan",e.esDocente?11:12)}}function $i(s,i){if(s&1&&(r(0,"tr")(1,"td",52),c(2,"No hay estudiantes con los filtros actuales."),a()()),s&2){let e=m();l(),V("colspan",e.esDocente?11:12)}}function Ki(s,i){if(s&1){let e=I();r(0,"button",88),x("click",function(){g(e);let n=m(2).$implicit,o=m();return _(o.quitarDocenteAsignado(n))}),c(1," Quitar doc "),a()}}function Bi(s,i){if(s&1){let e=I();r(0,"button",89),x("click",function(){g(e);let n=m(2).$implicit,o=m();return _(o.asignarADocenteSeleccionado(n))}),c(1," Asignar doc "),a()}}function zi(s,i){if(s&1&&(r(0,"td",85),v(1,Ki,2,0,"button",86)(2,Bi,2,0,"button",87),a()),s&2){let e=m().$implicit,t=m();l(),u("ngIf",t.docenteSeleccionado&&t.getDocenteActualRow(e)&&t.getDocenteActualRow(e)!=0),l(),u("ngIf",t.docenteSeleccionado&&(!t.getDocenteActualRow(e)||t.getDocenteActualRow(e)==0))}}function Wi(s,i){if(s&1&&(r(0,"tr")(1,"td",52),c(2),a(),r(3,"td")(4,"span",83),c(5),a()(),r(6,"td"),c(7),a(),r(8,"td"),c(9),a(),r(10,"td"),c(11),a(),r(12,"td"),c(13),a(),r(14,"td"),c(15),a(),r(16,"td"),c(17),a(),r(18,"td"),c(19),a(),r(20,"td",52),c(21),a(),r(22,"td"),c(23),a(),v(24,zi,3,2,"td",84),a()),s&2){let e=i.$implicit,t=i.index,n=m();l(2),S((n.pagina-1)*n.pageSize+(t+1)),l(2),u("ngClass",n.getDocenteActualRow(e)&&n.getDocenteActualRow(e)!=0?"bg-success":"bg-secondary"),l(),E(" ",n.getDocenteNombreById(n.getDocenteActualRow(e))," "),l(2),L("",e.Ap_Paterno," ",e.Ap_Materno),l(2),S(e.Nombre),l(2),S(e.Celular),l(2),S(e.NumCelP),l(2),S(e.NumCelM),l(2),S(n.cursoSolicitadoLabel(e)),l(2),S(n.getInstrumentoRow(e)),l(2),S(e.Anio),l(2),S(n.cursoAsignadoLabel(e)),l(),u("ngIf",!n.esDocente)}}function Ui(s,i){if(s&1){let e=I();r(0,"div",90)(1,"ngb-pagination",91),A("pageChange",function(n){g(e);let o=m();return P(o.pagina,n)||(o.pagina=n),_(n)}),x("pageChange",function(){g(e);let n=m();return _(n.cargarEstudiantes())}),a()()}if(s&2){let e=m();l(),T("page",e.pagina),u("collectionSize",e.collectionSize)("pageSize",e.pageSize)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0)}}function Gi(s,i){if(s&1){let e=I();r(0,"button",58),x("click",function(){let n=g(e).$implicit,o=m(3);return _(o.seleccionarDocenteEdicion(n))}),r(1,"span"),c(2),a(),r(3,"span",83),c(4),a()()}if(s&2){let e=i.$implicit,t=m(3);u("disabled",t.docenteInactivo(e)),l(2),S(t.getNombreCompletoDocente(e)),l(),u("ngClass",t.docenteInactivo(e)?"bg-secondary":"bg-primary"),l(),S(t.docenteInactivo(e)?"INACTIVO":"OK")}}function Hi(s,i){if(s&1&&(r(0,"div",111),v(1,Gi,5,4,"button",57),a()),s&2){let e=m(2);l(),u("ngForOf",e.docentesFiltradosEdit)}}function Xi(s,i){s&1&&(r(0,"span"),c(1,"Guardar"),a())}function qi(s,i){s&1&&(r(0,"span"),c(1,"Guardando..."),a())}function Qi(s,i){if(s&1){let e=I();r(0,"div",69)(1,"h5",70),c(2,"Editar inscripci\xF3n (cambiar docente / datos clave)"),a(),r(3,"button",71),x("click",function(){let n=g(e).$implicit;return _(n.dismiss("close"))}),a()(),r(4,"div",72)(5,"form",92)(6,"div",4)(7,"div",47)(8,"div",10)(9,"div",11)(10,"input",93),x("focus",function(){g(e);let n=m();return _(n.onDocenteEditFocus())})("blur",function(){g(e);let n=m();return _(n.onDocenteEditBlur())}),a(),r(11,"label"),c(12),a()(),v(13,Hi,2,1,"div",94),a(),r(14,"div",95),c(15,"Si est\xE1 vac\xEDo, quedar\xE1 sin docente asignado."),a()(),r(16,"div",47)(17,"div",11),w(18,"input",96),r(19,"label"),c(20,"Fecha inscripci\xF3n"),a()()()(),r(21,"div",97)(22,"div",41)(23,"div",11),w(24,"input",98),r(25,"label"),c(26,"Curso solicitado"),a()()(),r(27,"div",41)(28,"div",11),w(29,"input",99),r(30,"label"),c(31,"Paralelo solicitado"),a()()(),r(32,"div",41)(33,"div",11),w(34,"input",100),r(35,"label"),c(36,"Turno"),a()()()(),r(37,"div",97)(38,"div",47)(39,"div",11),w(40,"input",101),r(41,"label"),c(42,"Instrumento musical"),a()()(),r(43,"div",47)(44,"div",11),w(45,"input",102),r(46,"label"),c(47,"Instrumento musical (sec.)"),a()()()(),r(48,"div",97)(49,"div",41)(50,"div",11),w(51,"input",103),r(52,"label"),c(53,"Categor\xEDa"),a()()(),r(54,"div",41)(55,"div",11),w(56,"input",104),r(57,"label"),c(58,"Verificaci\xF3n"),a()()(),r(59,"div",41)(60,"div",11),w(61,"input",105),r(62,"label"),c(63,"Matr\xEDcula"),a()()()(),r(64,"div",97)(65,"div",106)(66,"div",11),w(67,"textarea",107),r(68,"label"),c(69,"Observaci\xF3n"),a()()()()()(),r(70,"div",108)(71,"button",109),x("click",function(){let n=g(e).$implicit;return _(n.dismiss("cancel"))}),c(72,"Cancelar"),a(),r(73,"button",110),x("click",function(){g(e);let n=m();return _(n.guardarInscripcion())}),v(74,Xi,2,0,"span",36)(75,qi,2,0,"span",36),a()()}if(s&2){let e=m();l(5),u("formGroup",e.newinfoestudiantesifas),l(5),u("formControl",e.docEditInput),l(2),E("Docente (",e.tituloModo,")"),l(),u("ngIf",e.mostrarListaDocentesEdit&&e.docentesFiltradosEdit.length>0),l(60),u("disabled",e.isSaving),l(),u("ngIf",!e.isSaving),l(),u("ngIf",e.isSaving)}}function Ji(s,i){if(s&1&&(r(0,"div",114)(1,"div")(2,"strong"),c(3,"Docente:"),a(),c(4),a(),r(5,"div")(6,"strong"),c(7,"Modo:"),a(),c(8),a(),r(9,"div")(10,"strong"),c(11,"Instituci\xF3n:"),a(),c(12),a(),r(13,"div")(14,"strong"),c(15,"A\xF1o:"),a(),c(16),a(),r(17,"div")(18,"strong"),c(19,"Especialidad:"),a(),c(20),a(),r(21,"div")(22,"strong"),c(23,"Curso solicitado:"),a(),c(24),a(),r(25,"div")(26,"strong"),c(27,"Curso asignado:"),a(),c(28),a(),r(29,"div")(30,"strong"),c(31,"Buscar:"),a(),c(32),a(),r(33,"div")(34,"strong"),c(35,"Orden:"),a(),c(36),a(),r(37,"div")(38,"strong"),c(39,"Filas en la tabla (p\xE1gina actual):"),a(),c(40),a(),r(41,"div")(42,"strong"),c(43,"Total filtrado:"),a(),c(44),a()()),s&2){let e=m(2);l(4),E(" ",e.reporteResumen.docente),l(4),E(" ",e.tituloModo),l(4),E(" ",e.reporteResumen.institucion),l(4),E(" ",e.reporteResumen.anio_id),l(4),E(" ",e.reporteResumen.especialidad),l(4),E(" ",e.reporteResumen.cursoSolicitado),l(4),E(" ",e.reporteResumen.cursoAsignado),l(4),E(" ",e.reporteResumen.buscar),l(4),E(" ",e.reporteResumen.orden),l(4),E(" ",e.reporteResumen.filas),l(4),E(" ",e.reporteResumen.totalFiltrado)}}function Yi(s,i){s&1&&(r(0,"div",78),c(1,"No hay informaci\xF3n del reporte."),a())}function Zi(s,i){if(s&1){let e=I();r(0,"div",69)(1,"h5",70),c(2,"Generar reporte (PDF) - tabla actual"),a(),r(3,"button",71),x("click",function(){let n=g(e).$implicit;return _(n.dismiss("close"))}),a()(),r(4,"div",72),v(5,Ji,45,11,"div",112)(6,Yi,2,0,"div",74),a(),r(7,"div",108)(8,"button",109),x("click",function(){let n=g(e).$implicit;return _(n.dismiss("cancel"))}),c(9,"Cancelar"),a(),r(10,"button",113),x("click",function(){g(e);let n=m();return _(n.generarReportePdfActual())}),c(11," Generar PDF "),a()()}if(s&2){let e=m();l(5),u("ngIf",e.reporteResumen),l(),u("ngIf",!e.reporteResumen),l(4),u("disabled",!e.estudiantes||e.estudiantes.length===0)}}var ne=class ne{constructor(i,e,t,n,o,d,p,f,h,b){this._infoest=i;this._planteldoc=e;this._anios=t;this._controles=n;this._inst=o;this._auth=d;this._tools=p;this._reportes=f;this._plantillasExcel=h;this.route=b;this.esDocente=!1;this.esPlantelAdministrativo=!1;this.docenteIdPerfil=null;this.perfilCargado=!1;this.modo="especialidad";this.docenteFieldKey="planteldocadmins_id";this.instrumentoFieldKey="InstrumentoMusical";this.tituloModo="Especialidad";this.esSuperAdmin=!1;this.instituciones=[];this.institucionesFiltroId=null;this.anios=[];this.selectedAnioId=null;this.especialidadOptions=[];this.especialidadSecundariaOptions=[];this.especialidadSeleccionada="";this.cursoOptions=[];this.cursoSolicitadoSeleccionado="";this.cursoAsignadoSeleccionado="";this.cursoMixtoSeleccionado="";this.sortBy="NombreEstudiante";this.sortDir="asc";this.includeSinDocente=!1;this.filterTxt="";this.plantelDocentes=[];this.docenteInput=new Te("");this.docentesFiltrados=[];this.mostrarListaDocentes=!1;this.docenteSeleccionado=null;this.estudiantes=[];this.isLoading=!1;this.pagina=1;this.pageSize=100;this.pageSizeOptions=[10,20,50,100,200];this.collectionSize=0;this.conteoAsignados=0;this.docenteConteoMap={};this.isLoadingConteoDocentes=!1;this.isLoadingCursosOptions=!1;this.cursoSolicitadoOptionsDocente=[];this.cursoAsignadoOptionsDocente=[];this.cursoMixtoOptionsDocente=[];this.isSaving=!1;this.reporteResumen=null;this.plantillasExcelDisponibles=[];this.generandoExcel=!1;this.docEditInput=new Te("");this.docentesFiltradosEdit=[];this.mostrarListaDocentesEdit=!1;this.newinfoestudiantesifas=this._infoest.createFormGroupinfoestudiantesifas()}ngOnInit(){this.route.data.subscribe(i=>{let e=i?.modo??"especialidad";this.setModo(e)}),this._auth.revisarSiEsSuperAdmin().subscribe(i=>{this.esSuperAdmin=i,i&&this.cargarInstituciones()}),this.cargarAnios(),this.cargarOptionsInstrumentos(),this.setupBuscadorDocentes(),this.setupBuscadorDocentesEdicion(),this.cargarPerfilYDocente()}cargarPerfilYDocente(){this._auth.pedirPerfil().subscribe({next:i=>{let e=i?.usuario??i?.data?.usuario??i??{},t=(e?.Cargo??"").toString().toUpperCase().trim();this.esPlantelAdministrativo=t.includes("SECRETARIO")||t.includes("ADMINISTRATIVO"),this.esDocente=t.includes("DOCENTE")&&!this.esPlantelAdministrativo;let n=Number(e?.id??0);if(this.docenteIdPerfil=Number.isFinite(n)&&n>0?n:null,this.perfilCargado=!0,this.esDocente&&this.docenteIdPerfil){this.autoCargarDocentePerfil(this.docenteIdPerfil);return}this.cargarPlantelDocentes()},error:()=>{this.esDocente=!1,this.esPlantelAdministrativo=!1,this.docenteIdPerfil=null,this.perfilCargado=!0,this.cargarPlantelDocentes()}})}autoCargarDocentePerfil(i){let e=Number(i??0);if(!Number.isFinite(e)||e<=0){this.plantelDocentes=[];return}this._planteldoc.Seleccionarplanteldocentes(e).subscribe({next:t=>{let n=t?.data??t??null;this.plantelDocentes=n?[n]:[],n&&(this.docenteSeleccionado=n,this.docenteInput.setValue(this.getNombreCompletoDocente(n),{emitEvent:!1}),this.docenteInput.disable({emitEvent:!1}),this.mostrarListaDocentes=!1,this.docentesFiltrados=[],this.pagina=1,this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta(),this.cargarConteoDocentes())},error:()=>{this.plantelDocentes=[],this.docenteSeleccionado=null}})}setModo(i){if(this.modo=i,i==="complementario"){this.docenteFieldKey="planteldocadmins_idOtros",this.instrumentoFieldKey="InstrumentoMusicalSecundario",this.tituloModo="Complementario";return}if(i==="practicaconjuntos"){this.docenteFieldKey="planteldocadmins_idPC",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModo="Pr\xE1ctica de conjuntos";return}this.docenteFieldKey="planteldocadmins_id",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModo="Especialidad"}get instrumentoOptions(){return this.instrumentoFieldKey==="InstrumentoMusicalSecundario"?this.especialidadSecundariaOptions||[]:this.especialidadOptions||[]}get instrumentoFiltroLabel(){return this.instrumentoFieldKey==="InstrumentoMusicalSecundario"?"Especialidad secundaria":"Especialidad"}normalizar(i){return(i??"").toString().trim().toUpperCase()}onDocenteFocus(){this.esDocente||(this.mostrarListaDocentes=!0)}onDocenteBlur(){window.setTimeout(()=>{this.mostrarListaDocentes=!1},150)}onDocenteEditFocus(){this.mostrarListaDocentesEdit=!0}onDocenteEditBlur(){window.setTimeout(()=>{this.mostrarListaDocentesEdit=!1},150)}normalizarPayloadDocenteIds(i){let e=N({},i??{});return["planteldocadmins_id","planteldocadmins_idPC","planteldocadmins_idOtros"].forEach(n=>{if(!(n in e))return;let o=e[n];if(o===""||o===void 0){e[n]=null;return}let d=Number(o);if(!Number.isFinite(d)||d<=0){e[n]=null;return}e[n]=d}),e}getInstitucionFiltroId(){if(!this.esSuperAdmin)return null;let i=Number(this.institucionesFiltroId??0);return Number.isFinite(i)&&i>0?i:null}cargarInstituciones(){this._inst.Obtenerinstituciones().subscribe({next:i=>{this.instituciones=i?.data||[]},error:()=>{this.instituciones=[]}})}cargarAnios(){this._anios.ObtenerAniosConPredeterminado().subscribe({next:({anios:i,predeterminado:e})=>{this.anios=i||[];let t=Number(e?.id??0);this.selectedAnioId=Number.isFinite(t)&&t>0?t:this.anios?.[0]?.id??null,this.cargarConteoDocentes()},error:()=>{this.anios=[],this.selectedAnioId=null}})}cargarOptionsInstrumentos(){let i=["LVLCURSO","ESPECIALIDAD","ESPECIALIDAD SECUNDARIA"];this._controles.ObtenerOptionsSelectPorCategorias(i).subscribe({next:e=>{this.cursoOptions=e?.LVLCURSO||[],this.especialidadOptions=e?.ESPECIALIDAD||[],this.especialidadSecundariaOptions=e?.["ESPECIALIDAD SECUNDARIA"]||[]},error:()=>{this.cursoOptions=[],this.especialidadOptions=[],this.especialidadSecundariaOptions=[]}})}cargarPlantelDocentes(){if(this.esDocente&&this.docenteIdPerfil){this._planteldoc.Seleccionarplanteldocentes(this.docenteIdPerfil).subscribe({next:i=>{let e=i?.data??i??null,t=e?[e]:[];this.plantelDocentes=t.filter(n=>this.normalizar(n?.Visibilidad)!=="OCULTO").sort((n,o)=>this.getNombreCompletoDocente(n).localeCompare(this.getNombreCompletoDocente(o))),this.autoSeleccionarDocentePerfil(),this.cargarConteoDocentes()},error:()=>{this.plantelDocentes=[]}});return}this._planteldoc.Obtenerplanteldocentes().subscribe({next:i=>{let e=i?.data||[];this.plantelDocentes=e.filter(t=>this.normalizar(t?.Visibilidad)!=="OCULTO").sort((t,n)=>this.getNombreCompletoDocente(t).localeCompare(this.getNombreCompletoDocente(n))),this.cargarConteoDocentes()},error:()=>{this.plantelDocentes=[]}})}autoSeleccionarDocentePerfil(){if(!this.esDocente||!this.docenteIdPerfil)return;let i=(this.plantelDocentes||[]).find(e=>Number(e?.id??0)===Number(this.docenteIdPerfil));i&&(this.docenteSeleccionado=i,this.docenteInput.setValue(this.getNombreCompletoDocente(i),{emitEvent:!1}),this.docenteInput.disable({emitEvent:!1}),this.mostrarListaDocentes=!1,this.docentesFiltrados=[],this.pagina=1,this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta())}getConteoAsignadosDocente(i){let e=String(i?.id??"").trim();if(!e)return 0;let t=Number(this.docenteConteoMap?.[e]??0);return Number.isFinite(t)&&t>0?t:0}getNombreCompletoDocente(i){let e=(i?.Nombres??"").toString().trim(),t=(i?.Apellidos??"").toString().trim();return`${e} ${t}`.trim()}getDocenteNombreById(i){let e=String(i??"").trim();if(!e||e==="0")return"SIN ASIGNAR";let t=(this.plantelDocentes||[]).find(n=>String(n?.id)===e);return t?this.getNombreCompletoDocente(t):`ID ${e}`}getDocenteActualRow(i){return i?.[this.docenteFieldKey]}getInstrumentoRow(i){return i?.[this.instrumentoFieldKey]}docenteInactivo(i){return this.normalizar(i?.Estado)==="INACTIVO"}filtrarPlantelDocentes(i,e=!1){let t=this.getInstitucionFiltroId(),n=(this.plantelDocentes||[]).filter(o=>t?Number(o?.instituciones_id??0)===t:!0);return e?n.slice(0,50):i?n.filter(o=>this.getNombreCompletoDocente(o).toLowerCase().includes(i)).slice(0,25):[]}setupBuscadorDocentes(){this.docenteInput.valueChanges.subscribe(i=>{if(this.esDocente){this.docentesFiltrados=[],this.mostrarListaDocentes=!1;return}let e=(i??"").toString();if(e===""){this.docentesFiltrados=[],this.docenteSeleccionado=null;return}if(e.trim()===""){this.docentesFiltrados=this.filtrarPlantelDocentes("",!0);return}this.docenteSeleccionado=null,this.docentesFiltrados=this.filtrarPlantelDocentes(e.toLowerCase().trim())})}seleccionarDocente(i){!i||this.docenteInactivo(i)||(this.docenteSeleccionado=i,this.docenteInput.setValue(this.getNombreCompletoDocente(i),{emitEvent:!1}),this.mostrarListaDocentes=!1,this.docentesFiltrados=[],this.pagina=1,this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta())}limpiarDocente(){this.docenteSeleccionado=null,this.docenteInput.setValue("",{emitEvent:!1}),this.docentesFiltrados=[],this.estudiantes=[],this.collectionSize=0,this.conteoAsignados=0,this.cursoSolicitadoSeleccionado="",this.cursoAsignadoSeleccionado="",this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[]}setupBuscadorDocentesEdicion(){this.docEditInput.valueChanges.subscribe(i=>{let e=(i??"").toString();if(e===""){this.docentesFiltradosEdit=[],this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:""});return}if(e.trim()===""){this.docentesFiltradosEdit=this.filtrarPlantelDocentes("",!0);return}this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:""}),this.docentesFiltradosEdit=this.filtrarPlantelDocentes(e.toLowerCase().trim())})}seleccionarDocenteEdicion(i){!i||this.docenteInactivo(i)||(this.newinfoestudiantesifas.patchValue({[this.docenteFieldKey]:i?.id??""}),this.docEditInput.setValue(this.getNombreCompletoDocente(i),{emitEvent:!1}),this.mostrarListaDocentesEdit=!1,this.docentesFiltradosEdit=[])}syncDocenteEdicionConForm(){let i=this.newinfoestudiantesifas.get(this.docenteFieldKey)?.value,e=(this.plantelDocentes||[]).find(t=>String(t?.id)===String(i));this.docEditInput.setValue(e?this.getNombreCompletoDocente(e):"",{emitEvent:!1})}buildParams(i){let e=Number(this.docenteSeleccionado?.id??0),t=(this.especialidadSeleccionada??"").trim()||void 0,n=N({page:this.pagina,per_page:this.pageSize,anio_id:this.selectedAnioId??void 0,search:(this.filterTxt??"").trim()||void 0,search_mode:"any",relevance:0,include_sin_docente:this.esDocente?0:this.includeSinDocente?1:0,sort_by:this.sortBy||void 0,sort_dir:this.sortDir||void 0},i||{});n.include_sin_asignar=1,n.anio_scope="default",e>0&&(n[this.docenteFieldKey]=e),t&&(n[this.instrumentoFieldKey]=t);let o=(this.cursoSolicitadoSeleccionado??"").trim();if(o){let f=(this.cursoSolicitadoOptionsDocente||[]).find(h=>String(h?.label??"").trim()===o);if(f)n.Curso_Solicitado=(f.curso??"").trim(),n.Paralelo_Solicitado=(f.paralelo??"").trim();else{let h=o.split(" ").filter(Boolean);n.Curso_Solicitado=h.slice(0,-1).join(" ")||o,n.Paralelo_Solicitado=h.length>1?h[h.length-1]:""}}let d=(this.cursoAsignadoSeleccionado??"").trim();if(d){let f=(this.cursoAsignadoOptionsDocente||[]).find(h=>String(h?.label??"").trim()===d);if(f)n.CursoAsignado=(f.curso??"").trim(),n.ParaleloAsignado=(f.paralelo??"").trim();else{let h=d.split(" ").filter(Boolean);n.CursoAsignado=h.slice(0,-1).join(" ")||d,n.ParaleloAsignado=h.length>1?h[h.length-1]:""}}let p=this.getInstitucionFiltroId();return p&&(n.instituciones_id=p),n}buildParamsSinCursos(i){let e=Number(this.docenteSeleccionado?.id??0),t=(this.especialidadSeleccionada??"").trim()||void 0,n=N({page:this.pagina,per_page:this.pageSize,anio_id:this.selectedAnioId??void 0,search:(this.filterTxt??"").trim()||void 0,search_mode:"any",relevance:0,include_sin_docente:this.esDocente?0:this.includeSinDocente?1:0,sort_by:this.sortBy||void 0,sort_dir:this.sortDir||void 0},i||{});n.include_sin_asignar=1,n.anio_scope="default",e>0&&(n[this.docenteFieldKey]=e),t&&(n[this.instrumentoFieldKey]=t);let o=this.getInstitucionFiltroId();return o&&(n.instituciones_id=o),n}recalcularCursosOptionsDesdeRows(i){let e=new Map,t=new Map;(i||[]).forEach(o=>{let d=String(o?.Curso_Solicitado??"").trim(),p=String(o?.Paralelo_Solicitado??"").trim(),f=`${d} ${p}`.replace(/\s+/g," ").trim();d&&e.set(f,{label:f,curso:d,paralelo:p});let h=String(o?.CursoAsignado??"").trim(),b=String(o?.ParaleloAsignado??"").trim(),y=`${h} ${b}`.replace(/\s+/g," ").trim();h&&h.toUpperCase()!=="SIN ASIGNAR"&&t.set(y,{label:y,curso:h,paralelo:b})}),this.cursoSolicitadoOptionsDocente=Array.from(e.values()).sort((o,d)=>o.label.localeCompare(d.label)),this.cursoAsignadoOptionsDocente=Array.from(t.values()).sort((o,d)=>o.label.localeCompare(d.label));let n=new Map;this.cursoSolicitadoOptionsDocente.forEach(o=>n.set(o.label,o)),this.cursoAsignadoOptionsDocente.forEach(o=>n.set(o.label,o)),this.cursoMixtoOptionsDocente=Array.from(n.values()).sort((o,d)=>o.label.localeCompare(d.label)),this.cursoSolicitadoSeleccionado&&!(this.cursoSolicitadoOptionsDocente||[]).some(o=>o.label===this.cursoSolicitadoSeleccionado)&&(this.cursoSolicitadoSeleccionado=""),this.cursoAsignadoSeleccionado&&!(this.cursoAsignadoOptionsDocente||[]).some(o=>o.label===this.cursoAsignadoSeleccionado)&&(this.cursoAsignadoSeleccionado=""),this.cursoMixtoSeleccionado&&!(this.cursoMixtoOptionsDocente||[]).some(o=>o.label===this.cursoMixtoSeleccionado)&&(this.cursoMixtoSeleccionado="")}cargarCursosOptionsDesdeTablaCompleta(){if(!this.docenteSeleccionado?.id){this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[];return}this.isLoadingCursosOptions=!0;let i=this.buildParamsSinCursos({page:1,per_page:5e3,search:void 0});this._infoest.Obtenerinfoestudiantesifas(i).subscribe({next:e=>{let t=e?.data||[];this.recalcularCursosOptionsDesdeRows(t),this.isLoadingCursosOptions=!1},error:()=>{this.cursoSolicitadoOptionsDocente=[],this.cursoAsignadoOptionsDocente=[],this.isLoadingCursosOptions=!1}})}buildDocenteScopedParamsBase(){let i=Number(this.docenteSeleccionado?.id??0),e=(this.especialidadSeleccionada??"").trim()||void 0,t={anio_id:this.selectedAnioId??void 0,include_sin_asignar:1,include_sin_docente:this.includeSinDocente?1:0,anio_scope:"default"},n=this.getInstitucionFiltroId();return n&&(t.instituciones_id=n),i>0&&(t[this.docenteFieldKey]=i),e&&(t[this.instrumentoFieldKey]=e),t}cargarConteoDocentes(){this.isLoadingConteoDocentes=!0;let i=le(N({},this.buildDocenteScopedParamsBase()),{docente_field:this.docenteFieldKey});delete i[this.docenteFieldKey],this._infoest.ObtenerConteoDocentes(i).subscribe({next:e=>{let t=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[],n={};(t||[]).forEach(o=>{let d=String(o?.docente_id??o?.docenteId??o?.id??"").trim();if(!d||d==="0")return;let p=Number(o?.total??o?.cantidad??o?.count??0);n[d]=Number.isFinite(p)&&p>0?p:0}),this.docenteConteoMap=n,this.isLoadingConteoDocentes=!1},error:()=>{this.docenteConteoMap={},this.isLoadingConteoDocentes=!1}})}normalizarSexo(i){let e=(i??"").toString().trim().toUpperCase();return e?e==="M"||e.startsWith("MAS")?"M":e==="F"||e.startsWith("FEM")?"F":e.includes("MASC")?"M":e.includes("FEM")?"F":"":""}copyTextToClipboard(i){return k(this,null,function*(){try{if(navigator?.clipboard?.writeText){yield navigator.clipboard.writeText(i);return}}catch{}let e=document.createElement("textarea");e.value=i,e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}copiarTablaParaExcelPlantilla(){return k(this,null,function*(){let i=this.estudiantes||[];if(!i.length){this._tools.MostrarMensaje("info","No hay filas para copiar");return}let t=i.map(n=>{let o=`${(n?.Ap_Paterno??"").toString().trim()} ${(n?.Ap_Materno??"").toString().trim()} ${(n?.Nombre??"").toString().trim()}`.replace(/\s+/g," ").trim(),d=(n?.CI??"").toString().trim(),p=(this.getInstrumentoRow(n)??"").toString().trim(),f=this.normalizarSexo(n?.Sexo),h=f==="F"?"X":"",b=f==="M"?"X":"",y=new Array(5).fill("");return y[0]=o,y[1]=d,y[2]=p,y[3]=b,y[4]=h,y.join("	")}).join(`
`);this._tools.MostrarMensajeLoading();try{yield this.copyTextToClipboard(t),this._tools.MostrarMensajeSuccess()}catch(n){console.error(n),this._tools.MostrarMensajeError()}})}getModoCategoriaPlantillaExcel(){return this.modo==="especialidad"?"MODO INSTRUMENTOS DE ESPECIALIDAD":this.modo==="practicaconjuntos"?"MODO PRACTICA DE CONJUNTOS":this.modo==="complementario"?"MODO INSTRUMENTO COMPLEMENTARIO":null}pedirPlantillaExcelParaModoActual(){return k(this,null,function*(){let i=this.getModoCategoriaPlantillaExcel();if(!i)return null;let t=(yield z(this._plantillasExcel.ObtenerPlantillas(i,!1)))?.data||[];if(t.length===0)return null;if(t.length===1)return t[0];this.plantillasExcelDisponibles=t,this.modalSeleccionPlantillaExcelRef=this._tools.openModal(this.modalSeleccionPlantillaExcel,"lg",{scrollable:!0});try{return(yield this.modalSeleccionPlantillaExcelRef.result)??null}catch{return null}})}getGestionTextoSeleccionada(){return((this.anios||[]).find(e=>Number(e?.id??0)===Number(this.selectedAnioId??0))?.Anio??"").toString().trim()}getCursoFiltroTexto(){let i=(this.cursoSolicitadoSeleccionado??"").toString().trim(),e=(this.cursoAsignadoSeleccionado??"").toString().trim(),t=(this.cursoMixtoSeleccionado??"").toString().trim();return i||e||t||""}getMateriaBaseExcel(){return this.modo==="complementario"?"INSTRUMENTO COMPLEMENTARIO":this.modo==="practicaconjuntos"?"PRACTICA DE CONJUNTOS":"INSTRUMENTO DE ESPECIALIDAD I"}getInstrumentoSeleccionadoLabel(){let i=(this.especialidadSeleccionada??"").toString().trim();return i?((this.instrumentoOptions||[]).find(n=>(n?.value??"").toString().trim()===i)?.label??"").toString().trim()||i:""}getMateriaExcelLabel(){let i=this.getMateriaBaseExcel(),e=this.getInstrumentoSeleccionadoLabel();return e?`${i} (${e})`:i}buildExcelRowsFromTablaActual(i){return(i||[]).map(e=>{let t=`${(e?.Ap_Paterno??"").toString().trim()} ${(e?.Ap_Materno??"").toString().trim()} ${(e?.Nombre??"").toString().trim()}`.replace(/\s+/g," ").trim(),n=(e?.CI??"").toString().trim(),o=(this.getInstrumentoRow(e)??"").toString().trim(),d=this.normalizarSexo(e?.Sexo);return[t,n,o,d==="M"?"X":"",d==="F"?"X":""]})}descargarBlob(i,e){let t=URL.createObjectURL(i),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}generarExcelPlantilla(){return k(this,null,function*(){if(!this.docenteSeleccionado?.id||this.generandoExcel)return;if(!this.getModoCategoriaPlantillaExcel()){this._tools.MostrarMensaje("info","Este modo no tiene generaci\xF3n por plantilla");return}let e=this.estudiantes||[];if(!e.length){this._tools.MostrarMensaje("info","No hay filas para generar");return}this.generandoExcel=!0;try{let t=yield this.pedirPlantillaExcelParaModoActual();if(!t?.id){this._tools.MostrarMensaje("warning","No se encontr\xF3 plantilla Excel para este modo.");return}let n=this.buildExcelRowsFromTablaActual(e),o=this.getNombreCompletoDocente(this.docenteSeleccionado),d=this.getGestionTextoSeleccionada(),p=this.getCursoFiltroTexto(),f=this.getMateriaExcelLabel(),h=O=>(O??"").toString().replace(/[^a-zA-Z0-9_\- ]/g,"").trim(),b=[h(o),h(f),h(d||""),h(p||"")].filter(O=>!!O).join(" ").trim(),y=yield z(this._plantillasExcel.GenerarExcelDesdePlantilla(Number(t.id),{rows:n,filename:b||"registro",docente:o,materia:f,curso:p,gestion:d})),C=y?.body??null;if(!C){this._tools.MostrarMensaje("error","No se pudo generar el Excel");return}let M=y?.headers?.get?.("content-disposition")||y?.headers?.get?.("Content-Disposition"),D=(b||"registro")+".xlsx";if(M){let O=M.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),j=decodeURIComponent((O?.[1]||O?.[2]||"").trim());j&&(D=j)}this.descargarBlob(C,D),this._tools.MostrarMensaje("success",`Excel generado (${e.length} filas)`)}catch(t){console.error(t),this._tools.MostrarMensaje("error","Error al generar el Excel")}finally{this.generandoExcel=!1}})}refrescarTodo(){this.docenteSeleccionado?.id&&(this.cargarConteoAsignados(),this.cargarEstudiantes())}refrescarPantalla(){this.cargarPlantelDocentes(),this.cargarConteoDocentes(),this.docenteSeleccionado?.id&&(this.refrescarTodo(),this.cargarCursosOptionsDesdeTablaCompleta())}onFiltroChange(){this.pagina=1,this.refrescarTodo(),this.cargarConteoDocentes(),this.cargarCursosOptionsDesdeTablaCompleta()}onCursoFilterChange(){this.pagina=1,this.refrescarTodo()}onCursoSolicitadoChange(){(this.cursoSolicitadoSeleccionado??"").trim()&&(this.cursoAsignadoSeleccionado="",this.cursoMixtoSeleccionado=""),this.pagina=1,this.refrescarTodo()}onCursoAsignadoChange(){(this.cursoAsignadoSeleccionado??"").trim()&&(this.cursoSolicitadoSeleccionado="",this.cursoMixtoSeleccionado=""),this.pagina=1,this.refrescarTodo()}onCursoMixtoChange(){(this.cursoMixtoSeleccionado??"").trim()&&(this.cursoSolicitadoSeleccionado="",this.cursoAsignadoSeleccionado=""),this.pagina=1,this.cargarEstudiantes()}onPageSizeChange(){this.pagina=1,this.cargarEstudiantes()}abrirModalReporteActual(){if(!this.docenteSeleccionado?.id)return;let i=this.getInstitucionFiltroId(),e=i?(this.instituciones||[]).find(t=>Number(t?.id??0)===Number(i))?.Nombre:null;this.reporteResumen={titulo:`Estudiantes por docente (${this.tituloModo})`,docente:this.getNombreCompletoDocente(this.docenteSeleccionado),anio_id:this.selectedAnioId,instituciones_id:i,institucion:e||"(seg\xFAn perfil)",especialidad:(this.especialidadSeleccionada??"").trim()||"(todas)",buscar:(this.filterTxt??"").trim()||"(sin texto)",incluirSinDocente:this.includeSinDocente?"S\xED":"No",cursoSolicitado:(this.cursoSolicitadoSeleccionado??"").trim()||"(todos)",cursoAsignado:(this.cursoAsignadoSeleccionado??"").trim()||"(todos)",orden:`${this.sortBy} ${this.sortDir}`.trim(),pagina:this.pagina,pageSize:this.pageSize,filas:(this.estudiantes||[]).length,totalFiltrado:this.collectionSize,fecha:new Date},this.modalReporteRef=this._tools.openModal(this.modalReporte,"lg")}uniqueRowsById(i){let e=[],t=new Set;return(i||[]).forEach(n=>{let d=String(n?.id??n?.estudiantesifas_id??n?.estudiante_id??"").trim()||JSON.stringify([n?.Ap_Paterno,n?.Ap_Materno,n?.Nombre,n?.CI,n?.Curso_Solicitado,n?.CursoAsignado]);t.has(d)||(t.add(d),e.push(n))}),e}esCursoAsignadoSinAsignar(i){let e=String(i?.CursoAsignado??"").trim().toUpperCase();return!e||e==="SIN ASIGNAR"}sortRows(i){let e=this.sortDir==="desc"?-1:1,t=this.sortBy||"NombreEstudiante",n=p=>String(p??"").trim().toUpperCase(),o=(p,f)=>{let h=n(p?.Ap_Paterno),b=n(f?.Ap_Paterno),y=n(p?.Ap_Materno),C=n(f?.Ap_Materno),M=n(p?.Nombre),D=n(f?.Nombre),O=h.localeCompare(b);if(O!==0)return O;let j=y.localeCompare(C);if(j!==0)return j;let Ee=M.localeCompare(D);return Ee!==0?Ee:n(p?.CI).localeCompare(n(f?.CI))},d=p=>t==="Curso_Solicitado"?this.cursoSolicitadoLabel(p).toUpperCase():t==="CursoAsignado"?this.cursoAsignadoLabel(p).toUpperCase():t==="Anio"?String(p?.Anio??"").toUpperCase():"";return(i||[]).slice().sort((p,f)=>{let h=0;return t==="NombreEstudiante"?h=o(p,f):h=d(p).localeCompare(d(f)),h*e})}slicePagina(i){let e=(this.pagina-1)*this.pageSize;return(i||[]).slice(e,e+this.pageSize)}buildReporteMetaBase(i){let e=this.getInstitucionFiltroId(),t=e?(this.instituciones||[]).find(o=>Number(o?.id??0)===Number(e))?.Nombre:null,n=(this.anios||[]).find(o=>Number(o?.id??0)===Number(this.selectedAnioId??0))?.Anio;return N({titulo:`Estudiantes por docente (${this.tituloModo})`,tituloModo:this.tituloModo,docente:this.getNombreCompletoDocente(this.docenteSeleccionado),anio_id:this.selectedAnioId,anio_txt:n||"",instituciones_id:e,institucion:t||"(seg\xFAn perfil)",especialidad:(this.especialidadSeleccionada??"").trim()||"(todas)",buscar:(this.filterTxt??"").trim()||"(sin texto)",incluirSinDocente:this.esDocente?"No":this.includeSinDocente?"S\xED":"No",cursoSolicitado:(this.cursoSolicitadoSeleccionado??"").trim()||"(todos)",cursoAsignado:(this.cursoAsignadoSeleccionado??"").trim()||"(todos)",cursoMixto:(this.cursoMixtoSeleccionado??"").trim()||"(todos)",orden:`${this.sortBy} ${this.sortDir}`.trim(),fecha:new Date},i||{})}cursosUnicosDesdeFilas(i,e){let t=new Set;return(i||[]).forEach(n=>{let o=this.cursoSolicitadoLabel(n),d=this.cursoAsignadoLabel(n);e==="solicitado"&&o?t.add(o):e==="asignado"&&d&&d!=="SIN ASIGNAR"?t.add(d):e==="mixto"&&(d&&d!=="SIN ASIGNAR"?t.add(d):o&&t.add(o))}),Array.from(t.values()).sort((n,o)=>n.localeCompare(o)).join(", ")}cargarFilasParaReporte(i){return k(this,null,function*(){if(!this.docenteSeleccionado?.id)return[];let e=5e3;if(i==="MIXTO"){let d=(this.cursoMixtoSeleccionado??"").trim();if(!d){let O=this.buildParamsSinCursos({page:1,per_page:e}),j=yield z(this._infoest.Obtenerinfoestudiantesifas(O).pipe(re(()=>ae({data:[]}))));return Array.isArray(j?.data)?j.data:[]}let p=(this.cursoMixtoOptionsDocente||[]).find(O=>String(O?.label??"").trim()===d),f=(p?.curso??"").trim(),h=(p?.paralelo??"").trim(),b=this.buildParamsSinCursos({page:1,per_page:e});b.Curso_Solicitado=f,b.Paralelo_Solicitado=h;let y=this.buildParamsSinCursos({page:1,per_page:e});y.CursoAsignado=f,y.ParaleloAsignado=h;let C=yield z(Pe({sol:this._infoest.Obtenerinfoestudiantesifas(b).pipe(re(()=>ae({data:[]}))),asg:this._infoest.Obtenerinfoestudiantesifas(y).pipe(re(()=>ae({data:[]})))})),M=Array.isArray(C?.sol?.data)?C.sol.data:[],D=Array.isArray(C?.asg?.data)?C.asg.data:[];return this.uniqueRowsById([...M,...D])}let t=this.buildParams({page:1,per_page:e}),n=yield z(this._infoest.Obtenerinfoestudiantesifas(t).pipe(re(()=>ae({data:[]})))),o=Array.isArray(n?.data)?n.data:[];return i==="NO_OFICIAL"?o.filter(d=>this.esCursoAsignadoSinAsignar(d)):i==="OFICIAL"?o.filter(d=>!this.esCursoAsignadoSinAsignar(d)):o})}generarReporteNoOficialDirecto(){return k(this,null,function*(){if(this.docenteSeleccionado?.id){try{this._tools.MostrarMensajeLoading?.()}catch{}try{let i=this.sortRows(yield this.cargarFilasParaReporte("NO_OFICIAL"));if(!i.length){this._tools.MostrarMensaje("info","No hay filas para el reporte (No oficial)");return}let e=(this.cursoSolicitadoSeleccionado||"").includes("(todos)")||!(this.cursoSolicitadoSeleccionado??"").trim()?this.cursosUnicosDesdeFilas(i,"solicitado"):(this.cursoSolicitadoSeleccionado??"").trim(),t=this.buildReporteMetaBase({reporteTipo:"NO_OFICIAL",cursosHeaderTxt:e});yield this._reportes.GenerarListaEstudiantesPorDocenteTablaActual(i,t)}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudo generar el reporte (No oficial)")}finally{try{this._tools.OcultarMensajeLoading?.()}catch{}}}})}generarReporteOficialDirecto(){return k(this,null,function*(){if(this.docenteSeleccionado?.id){try{this._tools.MostrarMensajeLoading?.()}catch{}try{let i=this.sortRows(yield this.cargarFilasParaReporte("OFICIAL"));if(!i.length){this._tools.MostrarMensaje("info","No hay filas para el reporte (Oficial)");return}let e=(this.cursoAsignadoSeleccionado||"").includes("(todos)")||!(this.cursoAsignadoSeleccionado??"").trim()?this.cursosUnicosDesdeFilas(i,"asignado"):(this.cursoAsignadoSeleccionado??"").trim(),t=this.buildReporteMetaBase({reporteTipo:"OFICIAL",cursosHeaderTxt:e});yield this._reportes.GenerarListaEstudiantesPorDocenteTablaActual(i,t)}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudo generar el reporte (Oficial)")}finally{try{this._tools.OcultarMensajeLoading?.()}catch{}}}})}generarReporteMixtoDirecto(){return k(this,null,function*(){if(this.docenteSeleccionado?.id){try{this._tools.MostrarMensajeLoading?.()}catch{}try{let i=this.sortRows(yield this.cargarFilasParaReporte("MIXTO"));if(!i.length){this._tools.MostrarMensaje("info","No hay filas para el reporte (Mixto)");return}let e=(this.cursoMixtoSeleccionado||"").includes("(todos)")||!(this.cursoMixtoSeleccionado??"").trim()?this.cursosUnicosDesdeFilas(i,"mixto"):(this.cursoMixtoSeleccionado??"").trim(),t=this.buildReporteMetaBase({reporteTipo:"MIXTO",cursosHeaderTxt:e});yield this._reportes.GenerarListaEstudiantesPorDocenteTablaActual(i,t)}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudo generar el reporte (Mixto)")}finally{try{this._tools.OcultarMensajeLoading?.()}catch{}}}})}generarReportePdfActual(){return k(this,null,function*(){if(!this.docenteSeleccionado?.id)return;let i=this.estudiantes||[];if(!i.length){this._tools.MostrarMensaje("info","No hay filas para reportar con los filtros actuales");return}try{this._tools.MostrarMensajeLoading?.()}catch{}try{yield this._reportes.GenerarListaEstudiantesPorDocenteTablaActual(i,this.reporteResumen);try{this._tools.OcultarMensajeLoading?.()}catch{}this._tools.closeModal(this.modalReporteRef)}catch(e){console.error(e);try{this._tools.OcultarMensajeLoading?.()}catch{}this._tools.MostrarMensaje("error","No se pudo generar el reporte")}})}cargarEstudiantes(){if(!this.docenteSeleccionado?.id){this.estudiantes=[],this.collectionSize=0;return}if((this.cursoMixtoSeleccionado??"").trim()){this.isLoading=!0,this.cargarFilasParaReporte("MIXTO").then(e=>{let t=this.sortRows(e);this.collectionSize=t.length,this.estudiantes=this.slicePagina(t),this.isLoading=!1}).catch(e=>{console.error("Error al cargar estudiantes (mixto)",e),this.estudiantes=[],this.collectionSize=0,this.isLoading=!1});return}if((this.cursoSolicitadoSeleccionado??"").trim()){this.isLoading=!0,this.cargarFilasParaReporte("NO_OFICIAL").then(e=>{let t=this.sortRows(e);this.collectionSize=t.length,this.estudiantes=this.slicePagina(t),this.isLoading=!1}).catch(e=>{console.error("Error al cargar estudiantes (curso solicitado => sin asignar)",e),this.estudiantes=[],this.collectionSize=0,this.isLoading=!1});return}if((this.cursoAsignadoSeleccionado??"").trim()){this.isLoading=!0,this.cargarFilasParaReporte("OFICIAL").then(e=>{let t=this.sortRows(e);this.collectionSize=t.length,this.estudiantes=this.slicePagina(t),this.isLoading=!1}).catch(e=>{console.error("Error al cargar estudiantes (curso asignado => asignados)",e),this.estudiantes=[],this.collectionSize=0,this.isLoading=!1});return}this.isLoading=!0;let i=this.buildParams();this._infoest.Obtenerinfoestudiantesifas(i).subscribe({next:e=>{let t=e?.data||[];this.estudiantes=this.sortBy==="NombreEstudiante"?this.sortRows(t):t,this.collectionSize=Number(e?.meta?.total??this.estudiantes.length??0),this.isLoading=!1},error:e=>{console.error("Error al cargar estudiantes",e),this.estudiantes=[],this.collectionSize=0,this.isLoading=!1}})}cargarConteoAsignados(){if(!this.docenteSeleccionado?.id){this.conteoAsignados=0;return}let i=this.buildParams({page:1,per_page:1,include_sin_docente:0});this._infoest.Obtenerinfoestudiantesifas(i).subscribe({next:e=>{this.conteoAsignados=Number(e?.meta?.total??0)},error:()=>{this.conteoAsignados=0}})}abrirEditarInscripcion(i){let e=Number(i?.id??0);!Number.isFinite(e)||e<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(e).subscribe({next:t=>{let n=t?.data??null;if(!n){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}Object.keys(this.newinfoestudiantesifas.controls).forEach(o=>{o in n&&this.newinfoestudiantesifas.get(o)?.setValue(n[o])}),this.syncDocenteEdicionConForm(),this.modalEditarInscripcionRef=this._tools.openModal(this.modalEditarInscripcion,"xl"),this._tools.MostrarMensajeSuccess()},error:t=>{console.error(t),this._tools.MostrarMensajeError()}}))}guardarInscripcion(){if(this.newinfoestudiantesifas.invalid){Object.values(this.newinfoestudiantesifas.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()}),this._tools.MostrarMensajeFrmIncompleto();return}let i=Number(this.newinfoestudiantesifas.get("id")?.value??0);if(!Number.isFinite(i)||i<=0)return;this.isSaving=!0,this._tools.MostrarMensajeLoading();let e=this.normalizarPayloadDocenteIds(this.newinfoestudiantesifas.value);this._infoest.Modificarinfoestudiantesifas(e,i).subscribe({next:()=>{this.isSaving=!1,this._tools.closeModal(this.modalEditarInscripcionRef),this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:t=>{console.error(t),this.isSaving=!1,this._tools.MostrarMensajeError()}})}asignarADocenteSeleccionado(i){let e=Number(this.docenteSeleccionado?.id??0),t=Number(i?.id??0);!Number.isFinite(e)||e<=0||!Number.isFinite(t)||t<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(t).subscribe({next:n=>{let o=n?.data??null;if(!o){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}let d=this.normalizarPayloadDocenteIds(le(N({},o),{[this.docenteFieldKey]:e}));this._infoest.Modificarinfoestudiantesifas(d,t).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:p=>{console.error(p),this._tools.MostrarMensajeError()}})},error:n=>{console.error(n),this._tools.MostrarMensajeError()}}))}quitarDocenteAsignado(i){let e=Number(i?.id??0);!Number.isFinite(e)||e<=0||(this._tools.MostrarMensajeLoading(),this._infoest.Seleccionarinfoestudiantesifas(e).subscribe({next:t=>{let n=t?.data??null;if(!n){this._tools.MostrarMensaje("warning","No se pudo cargar la inscripci\xF3n");return}let o=this.normalizarPayloadDocenteIds(le(N({},n),{[this.docenteFieldKey]:null}));this._infoest.Modificarinfoestudiantesifas(o,e).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.refrescarTodo()},error:d=>{console.error(d),this._tools.MostrarMensajeError()}})},error:t=>{console.error(t),this._tools.MostrarMensajeError()}}))}cursoSolicitadoLabel(i){let e=(i?.Curso_Solicitado??"").toString().trim(),t=(i?.Paralelo_Solicitado??"").toString().trim();return`${e} ${t}`.trim()}cursoAsignadoLabel(i){let e=(i?.CursoAsignado??"").toString().trim(),t=(i?.ParaleloAsignado??"").toString().trim(),n=`${e} ${t}`.trim();return n||"SIN ASIGNAR"}};ne.\u0275fac=function(e){return new(e||ne)(R(tt),R(et),R(Ye),R(Qe),R(Ge),R(xe),R(qe),R(Ze),R(it),R(X))},ne.\u0275cmp=W({type:ne,selectors:[["app-estudiantesxdocentesespecialidad"]],viewQuery:function(e,t){if(e&1&&(me(di,7),me(ui,7),me(mi,7)),e&2){let n;pe(n=fe())&&(t.modalEditarInscripcion=n.first),pe(n=fe())&&(t.modalReporte=n.first),pe(n=fe())&&(t.modalSeleccionPlantillaExcel=n.first)}},standalone:!1,decls:157,vars:57,consts:[["modalSeleccionPlantillaExcel",""],["modalEditarInscripcion",""],["modalReporte",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","align-items-end",2,"gap","12px"],[1,"col-12","col-lg-5"],[1,"position-relative"],[1,"form-floating"],["type","text","placeholder","Docente",1,"form-control",3,"focus","blur","formControl","disabled"],["class","list-group shadow","style","position: absolute; z-index: 2000; left: 0; right: 0; max-height: 40vh; overflow: auto;",4,"ngIf"],[1,"mt-2","d-flex","align-items-center",2,"gap","10px","flex-wrap","wrap"],["class","badge bg-info",4,"ngIf"],["class","badge bg-secondary",4,"ngIf"],["class","btn btn-outline-secondary btn-sm","type","button","title","Refrescar docentes, conteos y tabla",3,"click",4,"ngIf"],["class","btn btn-outline-secondary btn-sm","type","button",3,"click",4,"ngIf"],["class","col-12 col-lg-2",4,"ngIf"],[1,"col-12","col-lg-2"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-12","col-lg-3"],[3,"ngValue"],[1,"row","mt-3","align-items-center"],[1,"input-group"],[1,"input-group-text"],["type","text","placeholder","Apellidos, nombres, CI, curso...","title","Presiona Enter para buscar",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"col-12","col-lg-4","mt-2","mt-lg-0"],["class","form-check",4,"ngIf"],[1,"button","col-12","col-lg-12","d-flex","justify-content-lg-end","mt-2","mt-lg-0",2,"gap","8px","flex-wrap","wrap"],["type","button","title","Copiar informaci\xF3n",1,"btn","mouse-dir","primary","d-flex","align-items-center","gap-2",3,"click","disabled"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],[4,"ngIf"],[1,"dir-part"],["type","button","title","Generar registro excel (plantilla)",1,"btn","mouse-dir","primary","d-flex","align-items-center","gap-2",3,"click","disabled"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[1,"row","mt-2","align-items-end"],[1,"col-12","col-lg-4"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"mt-2"],["type","button",1,"btn","btn-outline-danger","w-100",3,"click","disabled"],["type","button",1,"btn","btn-outline-primary","w-100",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary","w-100",3,"click","disabled"],[1,"col-12","col-lg-6"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center",2,"width","45px"],[1,"text-center"],["class","text-center","style","width: 180px;",4,"ngIf"],[4,"ngFor","ngForOf"],["class","d-flex justify-content-center mt-3",4,"ngIf"],[1,"list-group","shadow",2,"position","absolute","z-index","2000","left","0","right","0","max-height","40vh","overflow","auto"],["type","button","class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"disabled","click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click","disabled"],[1,"d-flex","align-items-center",2,"gap","8px"],["title","Cantidad de estudiantes asignados",1,"badge","bg-info"],[1,"badge","bg-secondary"],[1,"badge","bg-info"],["type","button","title","Refrescar docentes, conteos y tabla",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"form-check"],["type","checkbox","id","chkSinDoc",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","chkSinDoc",1,"form-check-label","text-black"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["class","list-group",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"list-group"],["type","button","class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click"],[1,"text-muted"],[1,"text-center",2,"width","180px"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-center","text-muted"],[1,"badge",3,"ngClass"],["class","text-center","style","gap: 6px;",4,"ngIf"],[1,"text-center",2,"gap","6px"],["class","btn btn-outline-danger btn-sm","type","button","title","Quitar docente asignado",3,"click",4,"ngIf"],["class","btn btn-outline-primary btn-sm","type","button","title","Asignar a docente seleccionado",3,"click",4,"ngIf"],["type","button","title","Quitar docente asignado",1,"btn","btn-outline-danger","btn-sm",3,"click"],["type","button","title","Asignar a docente seleccionado",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"d-flex","justify-content-center","mt-3"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],["novalidate","",3,"formGroup"],["type","text","placeholder","Docente",1,"form-control",3,"focus","blur","formControl"],["class","list-group shadow","style","position: absolute; z-index: 2100; left: 0; right: 0; max-height: 40vh; overflow: auto;",4,"ngIf"],[1,"form-text"],["type","date","formControlName","FechInsc","placeholder","",1,"form-control"],[1,"row","mt-3"],["type","text","formControlName","Curso_Solicitado","placeholder","",1,"form-control"],["type","text","formControlName","Paralelo_Solicitado","placeholder","",1,"form-control"],["type","text","formControlName","Turno","placeholder","",1,"form-control"],["type","text","formControlName","InstrumentoMusical","placeholder","",1,"form-control"],["type","text","formControlName","InstrumentoMusicalSecundario","placeholder","",1,"form-control"],["type","text","formControlName","Categoria","placeholder","",1,"form-control"],["type","text","formControlName","Verificacion","placeholder","",1,"form-control"],["type","text","formControlName","Matricula","placeholder","",1,"form-control"],[1,"col-12"],["formControlName","Observacion","placeholder","",1,"form-control",2,"height","100px"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"list-group","shadow",2,"position","absolute","z-index","2100","left","0","right","0","max-height","40vh","overflow","auto"],["class","alert alert-info",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click","disabled"],[1,"alert","alert-info"]],template:function(e,t){if(e&1){let n=I();r(0,"div",3)(1,"div",4)(2,"div",5)(3,"h1",6),c(4),a(),r(5,"p",7),c(6,"Busca un docente, revisa sus estudiantes y reasigna inscripciones"),a()()()(),r(7,"div",8)(8,"div",9)(9,"div",10)(10,"div",11)(11,"input",12),x("focus",function(){return g(n),_(t.onDocenteFocus())})("blur",function(){return g(n),_(t.onDocenteBlur())}),a(),r(12,"label"),c(13,"Buscar docente"),a()(),v(14,gi,2,1,"div",13),a(),r(15,"div",14),v(16,_i,2,1,"span",15)(17,hi,2,1,"span",16)(18,bi,2,0,"button",17)(19,xi,2,0,"button",18),a()(),v(20,yi,8,3,"div",19),r(21,"div",20)(22,"div",11)(23,"select",21),A("ngModelChange",function(d){return g(n),P(t.selectedAnioId,d)||(t.selectedAnioId=d),_(d)}),x("change",function(){return g(n),_(t.onFiltroChange())}),v(24,Ci,2,2,"option",22),a(),r(25,"label"),c(26,"A\xF1o"),a()()(),r(27,"div",23)(28,"div",11)(29,"select",21),A("ngModelChange",function(d){return g(n),P(t.especialidadSeleccionada,d)||(t.especialidadSeleccionada=d),_(d)}),x("change",function(){return g(n),_(t.onFiltroChange())}),r(30,"option",24),c(31,"(Todas las especialidades)"),a(),v(32,Si,2,2,"option",22),a(),r(33,"label"),c(34),a()()()(),r(35,"div",25)(36,"div",9)(37,"div",26)(38,"span",27),c(39,"Buscar Estudiante"),a(),r(40,"input",28),A("ngModelChange",function(d){return g(n),P(t.filterTxt,d)||(t.filterTxt=d),_(d)}),x("keyup.enter",function(){return g(n),_(t.onFiltroChange())}),a(),r(41,"button",29),x("click",function(){return g(n),_(t.onFiltroChange())}),c(42,"Filtrar"),a()()(),r(43,"div",30),v(44,Ei,4,1,"div",31),a(),r(45,"div",32)(46,"button",33),x("click",function(){return g(n),_(t.copiarTablaParaExcelPlantilla())}),r(47,"span",34),w(48,"ng-lottie",35),a(),v(49,Mi,2,0,"span",36)(50,Ii,3,0,"span",36),w(51,"span",37),a(),r(52,"button",38),x("click",function(){return g(n),_(t.generarExcelPlantilla())}),r(53,"span",34),w(54,"ng-lottie",35),a(),v(55,wi,2,0,"span",36)(56,Ti,3,0,"span",36),w(57,"span",37),a(),r(58,"select",39),A("ngModelChange",function(d){return g(n),P(t.pageSize,d)||(t.pageSize=d),_(d)}),x("change",function(){return g(n),_(t.onPageSizeChange())}),v(59,Pi,2,2,"option",22),a()()(),v(60,Ni,7,2,"ng-template",null,0,U),r(62,"div",40)(63,"div",41)(64,"div",11)(65,"select",42),A("ngModelChange",function(d){return g(n),P(t.cursoSolicitadoSeleccionado,d)||(t.cursoSolicitadoSeleccionado=d),_(d)}),x("change",function(){return g(n),_(t.onCursoSolicitadoChange())}),r(66,"option",24),c(67,"(Curso solicitado: todos)"),a(),v(68,Di,2,2,"option",22),a(),r(69,"label"),c(70,"Curso solicitado"),a()(),r(71,"div",43)(72,"button",44),x("click",function(){return g(n),_(t.generarReporteNoOficialDirecto())}),c(73," Reporte NO OFICIAL (Curso solicitado) "),a()()(),r(74,"div",41)(75,"div",11)(76,"select",42),A("ngModelChange",function(d){return g(n),P(t.cursoAsignadoSeleccionado,d)||(t.cursoAsignadoSeleccionado=d),_(d)}),x("change",function(){return g(n),_(t.onCursoAsignadoChange())}),r(77,"option",24),c(78,"(Curso asignado: todos)"),a(),v(79,ki,2,2,"option",22),a(),r(80,"label"),c(81,"Curso asignado"),a()(),r(82,"div",43)(83,"button",45),x("click",function(){return g(n),_(t.generarReporteOficialDirecto())}),c(84," Reporte OFICIAL (Curso asignado) "),a()()(),r(85,"div",41)(86,"div",11)(87,"select",42),A("ngModelChange",function(d){return g(n),P(t.cursoMixtoSeleccionado,d)||(t.cursoMixtoSeleccionado=d),_(d)}),x("change",function(){return g(n),_(t.onCursoMixtoChange())}),r(88,"option",24),c(89,"(Curso mixto: todos)"),a(),v(90,Vi,2,2,"option",22),a(),r(91,"label"),c(92,"Curso mixto"),a()(),r(93,"div",43)(94,"button",46),x("click",function(){return g(n),_(t.generarReporteMixtoDirecto())}),c(95," Reporte MIXTO (Asignados + no asignados) "),a()()()(),r(96,"div",40)(97,"div",47)(98,"div",11)(99,"select",21),A("ngModelChange",function(d){return g(n),P(t.sortBy,d)||(t.sortBy=d),_(d)}),x("change",function(){return g(n),_(t.onFiltroChange())}),r(100,"option",24),c(101,"Orden: Ap.Paterno/Ap.Materno/Nombre"),a(),r(102,"option",24),c(103,"Orden: Curso solicitado"),a(),r(104,"option",24),c(105,"Orden: Curso asignado"),a(),r(106,"option",24),c(107,"Orden: A\xF1o"),a()(),r(108,"label"),c(109,"Ordenar por"),a()()(),r(110,"div",47)(111,"div",11)(112,"select",21),A("ngModelChange",function(d){return g(n),P(t.sortDir,d)||(t.sortDir=d),_(d)}),x("change",function(){return g(n),_(t.onFiltroChange())}),r(113,"option",24),c(114,"Ascendente"),a(),r(115,"option",24),c(116,"Descendente"),a()(),r(117,"label"),c(118,"Direcci\xF3n"),a()()()(),r(119,"div",48)(120,"div",49)(121,"table",50)(122,"thead")(123,"tr")(124,"th",51),c(125,"#"),a(),r(126,"th"),c(127,"Docente actual"),a(),r(128,"th"),c(129,"Apellidos"),a(),r(130,"th"),c(131,"Nombres"),a(),r(132,"th"),c(133,"Celular"),a(),r(134,"th"),c(135,"Cel. Pap\xE1"),a(),r(136,"th"),c(137,"Cel. Mam\xE1"),a(),r(138,"th"),c(139,"Curso solicitado"),a(),r(140,"th"),c(141),a(),r(142,"th",52),c(143,"A\xF1o"),a(),r(144,"th"),c(145,"Curso asignado"),a(),v(146,Fi,2,0,"th",53),a()(),r(147,"tbody"),v(148,Li,5,1,"tr",36)(149,ji,3,1,"tr",36)(150,$i,3,1,"tr",36)(151,Wi,25,14,"tr",54),a()()(),v(152,Ui,2,7,"div",55),a(),v(153,Qi,76,7,"ng-template",null,1,U)(155,Zi,12,3,"ng-template",null,2,U)}e&2&&(l(4),E("Estudiantes por docente (",t.tituloModo,")"),l(7),u("formControl",t.docenteInput)("disabled",t.esDocente),l(3),u("ngIf",t.mostrarListaDocentes&&t.docentesFiltrados.length>0),l(2),u("ngIf",t.docenteSeleccionado),l(),u("ngIf",t.docenteSeleccionado),l(),u("ngIf",t.docenteSeleccionado),l(),u("ngIf",t.docenteSeleccionado&&!t.esDocente),l(),u("ngIf",t.esSuperAdmin),l(3),T("ngModel",t.selectedAnioId),l(),u("ngForOf",t.anios),l(5),T("ngModel",t.especialidadSeleccionada),l(),u("ngValue",""),l(2),u("ngForOf",t.instrumentoOptions),l(2),S(t.instrumentoFiltroLabel),l(6),T("ngModel",t.filterTxt),l(4),u("ngIf",t.esPlantelAdministrativo),l(2),u("disabled",!t.docenteSeleccionado||t.isLoading),l(2),u("options",t._tools.optionsarchive),l(),u("ngIf",!t.isLoading),l(),u("ngIf",t.isLoading),l(2),u("disabled",!t.docenteSeleccionado||t.isLoading||t.generandoExcel),l(2),u("options",t._tools.optionsarchive),l(),u("ngIf",!t.generandoExcel),l(),u("ngIf",t.generandoExcel),l(2),T("ngModel",t.pageSize),l(),u("ngForOf",t.pageSizeOptions),l(6),T("ngModel",t.cursoSolicitadoSeleccionado),u("disabled",!t.docenteSeleccionado||t.isLoadingCursosOptions),l(),u("ngValue",""),l(2),u("ngForOf",t.cursoSolicitadoOptionsDocente),l(4),u("disabled",!t.docenteSeleccionado||t.isLoading),l(4),T("ngModel",t.cursoAsignadoSeleccionado),u("disabled",!t.docenteSeleccionado||t.isLoadingCursosOptions),l(),u("ngValue",""),l(2),u("ngForOf",t.cursoAsignadoOptionsDocente),l(4),u("disabled",!t.docenteSeleccionado||t.isLoading),l(4),T("ngModel",t.cursoMixtoSeleccionado),u("disabled",!t.docenteSeleccionado||t.isLoadingCursosOptions),l(),u("ngValue",""),l(2),u("ngForOf",t.cursoMixtoOptionsDocente),l(4),u("disabled",!t.docenteSeleccionado||t.isLoading),l(5),T("ngModel",t.sortBy),l(),u("ngValue","NombreEstudiante"),l(2),u("ngValue","Curso_Solicitado"),l(2),u("ngValue","CursoAsignado"),l(2),u("ngValue","Anio"),l(6),T("ngModel",t.sortDir),l(),u("ngValue","asc"),l(2),u("ngValue","desc"),l(26),S(t.instrumentoFiltroLabel),l(5),u("ngIf",!t.esDocente),l(2),u("ngIf",t.isLoading),l(),u("ngIf",!t.isLoading&&!t.docenteSeleccionado),l(),u("ngIf",!t.isLoading&&t.docenteSeleccionado&&(!t.estudiantes||t.estudiantes.length===0)),l(),u("ngForOf",t.estudiantes),l(),u("ngIf",t.docenteSeleccionado))},dependencies:[ke,G,H,Ke,Z,ee,q,_e,Y,Q,$e,J,Be,ze,We,Xe,He],styles:["[_nghost-%COMP%]{display:block}.list-group[_ngcontent-%COMP%]{border-radius:10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var oe=ne;var en=[{path:"calificaciones",component:ve},{path:"registrocalificaciones",component:Ce},{path:"docespecialidadxestudiante",component:oe,data:{modo:"especialidad"}},{path:"doccomplementarioxestudiante",component:oe,data:{modo:"complementario"}},{path:"docpracticaconjuntosxestudiante",component:oe,data:{modo:"practicaconjuntos"}}],K=class K{};K.\u0275fac=function(e){return new(e||K)},K.\u0275mod=ue({type:K}),K.\u0275inj=ce({imports:[we.forChild(en),we]});var Se=K;var B=class B{};B.\u0275fac=function(e){return new(e||B)},B.\u0275mod=ue({type:B}),B.\u0275inj=ce({imports:[Ve,Je,Se]});var lt=B;export{lt as DocentesModule};
