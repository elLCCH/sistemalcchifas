import{a as de}from"./chunk-ODLKZFFJ.js";import{a as se}from"./chunk-IJONIB2J.js";import{a as ce,b as O}from"./chunk-BWQEPZUS.js";import{b as le}from"./chunk-AFPPIWDW.js";import{a as oe}from"./chunk-B7OMWRKA.js";import{a as K,b as Q,d as Z,h as ee,j as te,n as ie,o as ne,p as ae,t as re}from"./chunk-NILQYPGY.js";import{a as w}from"./chunk-OQPWVW4O.js";import{C as y,Ha as s,Ia as t,Ja as n,K as E,Ka as g,O as R,Oa as D,Pa as B,R as F,Ra as T,Rb as $,Sb as H,U as p,Ua as C,V as u,Wa as d,Zb as q,dc as z,fb as P,g as j,ga as U,ia as r,ib as o,ic as Y,jb as v,kb as f,lc as G,m as S,nc as J,ob as b,pa as A,pb as x,qb as h,ra as W,tb as k,ub as X,wa as _,za as N}from"./chunk-TNNFIFGQ.js";var I=class I{constructor(i){this.http=i;this.base=`${w.apiUrl}${w.apiRoutes.lchaula.base}`}getByAula(i){return this.http.get(`${this.base}/aulas/${i}/publicaciones`).pipe(O())}create(i,e){return this.http.post(`${this.base}/aulas/${i}/publicaciones`,e).pipe(O())}delete(i,e){return this.http.delete(`${this.base}/aulas/${i}/publicaciones/${e}`).pipe(O()).pipe(c=>c)}};I.\u0275fac=function(e){return new(e||I)(F(z))},I.\u0275prov=R({token:I,factory:I.\u0275fac,providedIn:"root"});var V=I;var me=()=>[],ve=a=>["/lchaula/tarea",a];function fe(a,i){a&1&&(t(0,"div",3),g(1,"app-spinner-local",4),n())}function ge(a,i){if(a&1&&(t(0,"div",26)(1,"div",10),o(2,"Descripci\xF3n"),n(),t(3,"div",27),o(4),n()()),a&2){let e=d(2);r(4),v(e.aula.descripcion)}}function be(a,i){if(a&1){let e=T();t(0,"div",6)(1,"label",34),o(2,"L\xEDmite tard\xEDa (horas)"),n(),t(3,"input",55),h("ngModelChange",function(l){p(e);let m=d(4);return x(m.form.tarea.limite_tardia_horas,l)||(m.form.tarea.limite_tardia_horas=l),u(l)}),n()()}if(a&2){let e=d(4);r(3),b("ngModel",e.form.tarea.limite_tardia_horas)}}function xe(a,i){if(a&1){let e=T();t(0,"div",44)(1,"div",45),o(2,"Configuraci\xF3n de tarea"),n(),t(3,"div",46)(4,"div",6)(5,"label",34),o(6,"Fecha entrega (deadline)"),n(),t(7,"input",47),h("ngModelChange",function(l){p(e);let m=d(3);return x(m.form.tarea.fecha_entrega,l)||(m.form.tarea.fecha_entrega=l),u(l)}),n()(),t(8,"div",48)(9,"label",34),o(10,"Puntaje m\xE1ximo"),n(),t(11,"input",49),h("ngModelChange",function(l){p(e);let m=d(3);return x(m.form.tarea.puntaje_maximo,l)||(m.form.tarea.puntaje_maximo=l),u(l)}),n()(),t(12,"div",50)(13,"div",51)(14,"input",52),h("ngModelChange",function(l){p(e);let m=d(3);return x(m.form.tarea.permitir_entrega_tardia,l)||(m.form.tarea.permitir_entrega_tardia=l),u(l)}),n(),t(15,"label",53),o(16,"Entrega tard\xEDa"),n()()(),_(17,be,4,1,"div",54),n()()}if(a&2){let e=d(3);r(7),b("ngModel",e.form.tarea.fecha_entrega),r(4),b("ngModel",e.form.tarea.puntaje_maximo),r(3),b("ngModel",e.form.tarea.permitir_entrega_tardia),r(3),s("ngIf",e.form.tarea.permitir_entrega_tardia)}}function he(a,i){if(a&1){let e=T();t(0,"div",28)(1,"div",29)(2,"div",30)(3,"div",31),o(4,"Crear publicaci\xF3n"),n(),t(5,"div",32),o(6,"Anuncio, material o tarea"),n()(),t(7,"div",8)(8,"div",33)(9,"label",34),o(10,"Tipo"),n(),t(11,"select",35),h("ngModelChange",function(l){p(e);let m=d(2);return x(m.form.tipo,l)||(m.form.tipo=l),u(l)}),t(12,"option",36),o(13,"ANUNCIO"),n(),t(14,"option",37),o(15,"MATERIAL"),n(),t(16,"option",38),o(17,"TAREA"),n()()(),t(18,"div",33)(19,"label",34),o(20,"T\xEDtulo"),n(),t(21,"input",39),h("ngModelChange",function(l){p(e);let m=d(2);return x(m.form.titulo,l)||(m.form.titulo=l),u(l)}),n()(),t(22,"div",33)(23,"label",34),o(24,"Descripci\xF3n"),n(),t(25,"textarea",40),h("ngModelChange",function(l){p(e);let m=d(2);return x(m.form.descripcion,l)||(m.form.descripcion=l),u(l)}),n()(),_(26,xe,18,4,"div",41),t(27,"button",42),C("click",function(){p(e);let l=d(2);return u(l.onCreatePublicacion())}),g(28,"i",43),o(29," Publicar "),n()()()()}if(a&2){let e=d(2);r(11),b("ngModel",e.form.tipo),r(10),b("ngModel",e.form.titulo),r(4),b("ngModel",e.form.descripcion),r(),s("ngIf",e.form.tipo==="TAREA")}}function Ae(a,i){a&1&&(t(0,"div",28)(1,"div",56)(2,"div",31),o(3,"Vista estudiante"),n(),t(4,"div",32),o(5,"Aqu\xED ves anuncios, materiales y tareas. Para entregar una tarea, entra desde su tarjeta."),n()()())}function Ce(a,i){a&1&&(t(0,"div",26)(1,"div",56),o(2,"No hay publicaciones en esta pesta\xF1a."),n()())}function Ie(a,i){if(a&1&&(t(0,"span",10),o(1),n()),a&2){let e=d().$implicit;r(),f(" ",e.fecha_publicacion||e.created_at," ")}}function Se(a,i){if(a&1&&(t(0,"span"),o(1),n()),a&2){let e=d(2).$implicit;r(),f("Deadline: ",e.tarea==null?null:e.tarea.fecha_entrega)}}function ye(a,i){a&1&&(t(0,"span",79),o(1,"\u2022"),n())}function Ee(a,i){if(a&1&&(t(0,"div",74)(1,"div",8)(2,"div",19)(3,"div",32),_(4,Se,2,1,"span",75)(5,ye,2,0,"span",76),t(6,"span"),o(7),n()(),t(8,"a",77),g(9,"i",78),o(10," Abrir tarea "),n()()()()),a&2){let e=d().$implicit;r(4),s("ngIf",e.tarea==null?null:e.tarea.fecha_entrega),r(),s("ngIf",e.tarea==null?null:e.tarea.fecha_entrega),r(2),f("Puntaje m\xE1x: ",e.tarea==null?null:e.tarea.puntaje_maximo),r(),s("routerLink",X(4,ve,e.tarea.id))}}function Te(a,i){if(a&1&&(t(0,"div",80),o(1),n()),a&2){let e=d().$implicit;r(),f(" ",e.descripcion," ")}}function we(a,i){a&1&&(t(0,"div",10),o(1," Sin descripci\xF3n. "),n())}function Me(a,i){a&1&&(t(0,"div",32),o(1," Sin adjuntos. "),n())}function Pe(a,i){if(a&1&&(t(0,"a",85)(1,"span",86),g(2,"i",87),o(3),n(),g(4,"i",88),n()),a&2){let e=d().$implicit,c=d(5);s("href",c.publicBaseUrl+e.archivo.ruta,U),r(3),f(" ",(e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo"," ")}}function Oe(a,i){if(a&1&&(t(0,"div",89)(1,"span",86),g(2,"i",87),o(3),n(),t(4,"span",10),o(5,"sin ruta"),n()()),a&2){let e=d().$implicit;r(3),f(" ",(e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo"," ")}}function Ve(a,i){if(a&1&&(D(0),_(1,Pe,5,2,"a",83)(2,Oe,6,1,"div",84),B()),a&2){let e=i.$implicit;r(),s("ngIf",e==null||e.archivo==null?null:e.archivo.ruta),r(),s("ngIf",!(!(e==null||e.archivo==null)&&e.archivo.ruta))}}function Ne(a,i){if(a&1&&(t(0,"div",81),_(1,Ve,3,2,"ng-container",82),n()),a&2){let e=d().$implicit,c=d(3);r(),s("ngForOf",c.archivosPorPublicacion[e.id])}}function ke(a,i){if(a&1){let e=T();t(0,"div",90)(1,"input",91),C("change",function(l){p(e);let m=d().$implicit,L=d(3);return u(L.onUploadPublicacionFile(m.id,l))}),n(),t(2,"div",92),o(3,"Subir adjunto (solo docentes/admin)."),n()()}}function Le(a,i){if(a&1&&(t(0,"div",59)(1,"h2",60)(2,"button",61)(3,"div",62)(4,"div",63)(5,"span",13),o(6),n(),t(7,"span",13),o(8),n(),_(9,Ie,2,1,"span",64),n(),t(10,"div",65),o(11),n()()()(),t(12,"div",66)(13,"div",67),_(14,Ee,11,6,"div",68)(15,Te,2,1,"div",69)(16,we,2,0,"div",64),t(17,"div",26)(18,"div",70),o(19,"Adjuntos"),n(),_(20,Me,2,0,"div",71)(21,Ne,2,1,"div",72)(22,ke,4,0,"div",73),n()()()()),a&2){let e=i.$implicit,c=d(3);r(),s("id","pub_head_"+e.id),r(),N("data-bs-target","#pub_body_"+e.id)("aria-controls","pub_body_"+e.id),r(4),v(e.tipo),r(2),v(e.estado||"SIN ESTADO"),r(),s("ngIf",e.fecha_publicacion||e.created_at),r(2),v(e.titulo),r(),s("id","pub_body_"+e.id),N("aria-labelledby","pub_head_"+e.id),r(2),s("ngIf",e.tarea),r(),s("ngIf",e.descripcion),r(),s("ngIf",!e.descripcion),r(4),s("ngIf",(c.archivosPorPublicacion[e.id]||k(15,me)).length===0),r(),s("ngIf",(c.archivosPorPublicacion[e.id]||k(16,me)).length>0),r(),s("ngIf",c.isAdminLike)}}function je(a,i){if(a&1&&(t(0,"div",57),_(1,Le,23,17,"div",58),n()),a&2){let e=d(2);r(),s("ngForOf",e.publicacionesFiltradas)}}function Re(a,i){if(a&1){let e=T();t(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"div")(6,"div",10),o(7,"Aula"),n(),t(8,"h2",11),o(9),n(),t(10,"div",12)(11,"span",13),o(12),n(),t(13,"span",13),o(14),n(),t(15,"span",13),o(16),n(),t(17,"span",13),o(18),n()()(),t(19,"a",14),g(20,"i",15),o(21," Volver "),n()(),_(22,ge,5,1,"div",16),n()()(),_(23,he,30,4,"div",17)(24,Ae,6,0,"div",17),t(25,"div",18)(26,"div",19)(27,"div")(28,"h3",20),o(29,"Muro"),n(),t(30,"div",10),o(31,"Ordenado por fecha"),n()(),t(32,"span",10),o(33),n()(),t(34,"ul",21)(35,"li",22)(36,"button",23),C("click",function(){p(e);let l=d();return u(l.setTab("MIXTO"))}),o(37," Mixto "),t(38,"span",24),o(39),n()()(),t(40,"li",22)(41,"button",23),C("click",function(){p(e);let l=d();return u(l.setTab("ANUNCIO"))}),o(42," Anuncios "),t(43,"span",24),o(44),n()()(),t(45,"li",22)(46,"button",23),C("click",function(){p(e);let l=d();return u(l.setTab("MATERIAL"))}),o(47," Material "),t(48,"span",24),o(49),n()()(),t(50,"li",22)(51,"button",23),C("click",function(){p(e);let l=d();return u(l.setTab("TAREA"))}),o(52," Tareas "),t(53,"span",24),o(54),n()()()(),_(55,Ce,3,0,"div",16)(56,je,2,1,"div",25),n()()}if(a&2){let e=d();r(9),v(e.aula.nombre||"Aula #"+e.aula.id),r(3),f("Materia ID: ",e.aula.materias_id),r(2),f("Participantes: ",e.participantesCount),r(2),v(e.aula.estado||"SIN ESTADO"),r(2),v(e.aula.visibilidad||"SIN VISIBILIDAD"),r(4),s("ngIf",e.aula.descripcion),r(),s("ngIf",e.isAdminLike),r(),s("ngIf",!e.isAdminLike),r(9),f("",e.publicaciones.length," publicaciones"),r(3),P("active",e.selectedTab==="MIXTO"),r(3),v(e.getTabCount("MIXTO")),r(2),P("active",e.selectedTab==="ANUNCIO"),r(3),v(e.getTabCount("ANUNCIO")),r(2),P("active",e.selectedTab==="MATERIAL"),r(3),v(e.getTabCount("MATERIAL")),r(2),P("active",e.selectedTab==="TAREA"),r(3),v(e.getTabCount("TAREA")),r(),s("ngIf",e.publicacionesFiltradas.length===0),r(),s("ngIf",e.publicacionesFiltradas.length>0)}}var M=class M{constructor(i,e,c,l,m,L){this.route=i;this.aulasService=e;this.publicacionesService=c;this.archivosService=l;this.auth=m;this.toast=L;this.publicBaseUrl=w.ruta||w.apiUrl||"";this.loading=!1;this.aulaId=0;this.isAdminLike=!1;this.aula=null;this.participantesCount=0;this.publicaciones=[];this.selectedTab="MIXTO";this.form={tipo:"ANUNCIO",titulo:"",descripcion:"",tarea:{fecha_entrega:"",permitir_entrega_tardia:!1,limite_tardia_horas:null,puntaje_maximo:100}};this.archivosPorPublicacion={}}ngOnInit(){if(this.aulaId=Number(this.route.snapshot.paramMap.get("id")||0),!this.aulaId){this.toast.error("Aula inv\xE1lida");return}this.auth.revisarSiesAdmin().subscribe({next:i=>this.isAdminLike=i,error:()=>this.isAdminLike=!1}),this.load()}setTab(i){this.selectedTab=i}getPublicacionSortTime(i){let e=i.fecha_publicacion||i.created_at||"",c=Date.parse(e);return Number.isFinite(c)?c:0}get publicacionesOrdenadas(){return[...this.publicaciones].sort((i,e)=>this.getPublicacionSortTime(e)-this.getPublicacionSortTime(i))}get publicacionesFiltradas(){let i=this.publicacionesOrdenadas;return this.selectedTab==="MIXTO"?i:i.filter(e=>(e.tipo||"").toUpperCase()===this.selectedTab)}getTabCount(i){return i==="MIXTO"?this.publicaciones.length:this.publicaciones.filter(e=>(e.tipo||"").toUpperCase()===i).length}load(){this.loading=!0,this.aulasService.getById(this.aulaId).pipe(E(i=>{this.aula=i.aula,this.participantesCount=i.participantes_count}),y(i=>(this.loading=!1,this.toast.error(i.message),S))).subscribe(()=>{this.loadPublicaciones()})}loadPublicaciones(){this.publicacionesService.getByAula(this.aulaId).pipe(E(i=>{this.publicaciones=i,this.loading=!1,this.publicaciones.forEach(e=>this.loadArchivosPublicacion(e.id))}),y(i=>(this.loading=!1,this.toast.error(i.message),S))).subscribe()}loadArchivosPublicacion(i){this.archivosService.list("PUBLICACION",i).pipe(E(e=>{this.archivosPorPublicacion[i]=e}),y(()=>S)).subscribe()}onCreatePublicacion(){let i={tipo:this.form.tipo,titulo:this.form.titulo,descripcion:this.form.descripcion};this.form.tipo==="TAREA"&&(i.tarea={fecha_entrega:this.form.tarea.fecha_entrega||null,permitir_entrega_tardia:this.form.tarea.permitir_entrega_tardia,limite_tardia_horas:this.form.tarea.limite_tardia_horas,puntaje_maximo:this.form.tarea.puntaje_maximo}),this.publicacionesService.create(this.aulaId,i).pipe(E(()=>{this.toast.success("Publicaci\xF3n creada"),this.form.titulo="",this.form.descripcion="",this.form.tipo="ANUNCIO",this.form.tarea={fecha_entrega:"",permitir_entrega_tardia:!1,limite_tardia_horas:null,puntaje_maximo:100},this.loadPublicaciones()}),y(e=>(this.toast.error(e.message),S))).subscribe()}onUploadPublicacionFile(i,e){return j(this,null,function*(){let c=e.target,l=c.files?.[0];l&&this.archivosService.upload(l,"PUBLICACION",i).pipe(E(()=>{this.toast.success("Archivo subido"),c.value="",this.loadArchivosPublicacion(i)}),y(m=>(this.toast.error(m.message),S))).subscribe()})}};M.\u0275fac=function(e){return new(e||M)(A(Y),A(de),A(V),A(se),A(oe),A(le))},M.\u0275cmp=W({type:M,selectors:[["app-lchaula-aula"]],decls:3,vars:2,consts:[[1,"container-fluid"],["class","py-4",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"py-4"],["textShow","Cargando aula..."],[1,"row","g-3"],[1,"col-12"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"d-flex","align-items-start","align-items-md-center","justify-content-between","gap-3"],[1,"text-muted","small"],[1,"h4","mb-1"],[1,"d-flex","flex-wrap","gap-2"],[1,"badge","text-bg-light","border"],["routerLink","/lchaula",1,"btn","btn-sm","btn-outline-secondary"],[1,"bi","bi-arrow-left"],["class","mt-3",4,"ngIf"],["class","col-12 col-lg-4",4,"ngIf"],[1,"col-12","col-lg-8"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between","gap-2"],[1,"h5","mb-0"],["role","tablist",1,"nav","nav-tabs","mt-3"],["role","presentation",1,"nav-item"],["type","button",1,"nav-link",3,"click"],[1,"badge","text-bg-light","border","ms-1"],["class","accordion mt-3","id","accordionPublicaciones",4,"ngIf"],[1,"mt-3"],[1,"small"],[1,"col-12","col-lg-4"],[1,"card","shadow-sm"],[1,"card-header","bg-light"],[1,"fw-semibold"],[1,"small","text-muted"],[1,"mb-3"],[1,"form-label","small"],["name","tipo",1,"form-select",3,"ngModelChange","ngModel"],["value","ANUNCIO"],["value","MATERIAL"],["value","TAREA"],["name","titulo",1,"form-control",3,"ngModelChange","ngModel"],["rows","4","name","descripcion",1,"form-control",3,"ngModelChange","ngModel"],["class","border rounded p-3 mb-3",4,"ngIf"],[1,"btn","btn-primary","w-100",3,"click"],[1,"bi","bi-send"],[1,"border","rounded","p-3","mb-3"],[1,"fw-semibold","mb-2"],[1,"row","g-2"],["type","datetime-local","name","fecha_entrega",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-6"],["type","number","name","puntaje_maximo",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-6","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","name","tardia","id","tardia",1,"form-check-input",3,"ngModelChange","ngModel"],["for","tardia",1,"form-check-label"],["class","col-12",4,"ngIf"],["type","number","name","limite",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-light","border","mb-0"],["id","accordionPublicaciones",1,"accordion","mt-3"],["class","accordion-item",4,"ngFor","ngForOf"],[1,"accordion-item"],[1,"accordion-header",3,"id"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"accordion-button","collapsed"],[1,"w-100"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],["class","text-muted small",4,"ngIf"],[1,"fw-semibold","mt-1"],["data-bs-parent","#accordionPublicaciones",1,"accordion-collapse","collapse",3,"id"],[1,"accordion-body"],["class","card border mb-3",4,"ngIf"],["class","small","style","white-space: pre-wrap;",4,"ngIf"],[1,"fw-semibold","small","mb-2"],["class","small text-muted",4,"ngIf"],["class","list-group",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"card","border","mb-3"],[4,"ngIf"],["class","mx-2",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary",3,"routerLink"],[1,"bi","bi-box-arrow-in-right"],[1,"mx-2"],[1,"small",2,"white-space","pre-wrap"],[1,"list-group"],[4,"ngFor","ngForOf"],["class","list-group-item list-group-item-action d-flex align-items-center justify-content-between","target","_blank","rel","noopener",3,"href",4,"ngIf"],["class","list-group-item d-flex justify-content-between",4,"ngIf"],["target","_blank","rel","noopener",1,"list-group-item","list-group-item-action","d-flex","align-items-center","justify-content-between",3,"href"],[1,"text-truncate"],[1,"bi","bi-paperclip"],[1,"bi","bi-box-arrow-up-right"],[1,"list-group-item","d-flex","justify-content-between"],[1,"mt-2"],["type","file",1,"form-control","form-control-sm",3,"change"],[1,"text-muted","small","mt-1"]],template:function(e,c){e&1&&(t(0,"div",0),_(1,fe,2,0,"div",1)(2,Re,57,23,"div",2),n()),e&2&&(r(),s("ngIf",c.loading),r(),s("ngIf",!c.loading&&c.aula))},dependencies:[q,$,H,re,ne,ae,Q,te,K,ie,Z,ee,J,G,ce],styles:["[_nghost-%COMP%]{display:block}"]});var pe=M;export{pe as AulaComponent};
