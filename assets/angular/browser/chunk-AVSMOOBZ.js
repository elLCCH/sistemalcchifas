import{b as Xo}from"./chunk-Z2O2VSKU.js";import"./chunk-XTAMVR3G.js";import{e as Ho,g as Fs,k as dr}from"./chunk-UQUUO3LY.js";import{b as Wo}from"./chunk-DIFFSUVD.js";import"./chunk-LYPRS7VW.js";import{c as Bo,e as fr,f as jo,h as zo,j as _e,o as Vo,r as $o,s as Uo,t as Go,y as qo}from"./chunk-WQFYRIBZ.js";import{a as Pi}from"./chunk-5RMZ5E5A.js";import{$b as Ro,Ab as hr,Ba as ct,Bc as Do,Cc as Ns,Eb as Mo,Fb as cr,Ib as it,Ic as No,Ja as je,Jb as ze,Kb as Ds,Kc as Oo,Oa as Ls,Pa as Is,Qc as Fo,Sc as ur,Ta as Xe,Uc as Os,Y as ko,Z as Rs,aa as Po,bc as Lo,fa as Ut,fb as xt,ga as Gt,gb as J,hb as W,ib as ee,o as To,pb as ki,sb as Ft,ub as It,ya as ar,yb as or,zb as lr,zc as Io}from"./chunk-UNG3ZLUF.js";import{a as Be,b as Ci,d as Ah,f as _h,g as Re,h as Ti,i as Ps,j as Ms,k as Co,l as ri,m as Y}from"./chunk-GG76335P.js";var Qo=Ah((Ko,js)=>{(function(h,t){"use strict";typeof js=="object"&&typeof js.exports=="object"?js.exports=h.document?t(h,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(h)})(typeof window<"u"?window:Ko,function(h,t){"use strict";var e=[],i=Object.getPrototypeOf,s=e.slice,n=e.flat?function(r){return e.flat.call(r)}:function(r){return e.concat.apply([],r)},a=e.push,o=e.indexOf,c={},u=c.toString,f=c.hasOwnProperty,m=f.toString,b=m.call(Object),A={},w=function(l){return typeof l=="function"&&typeof l.nodeType!="number"&&typeof l.item!="function"},x=function(l){return l!=null&&l===l.window},C=h.document,k={type:!0,src:!0,nonce:!0,noModule:!0};function D(r,l,d){d=d||C;var g,v,y=d.createElement("script");if(y.text=r,l)for(g in k)v=l[g]||l.getAttribute&&l.getAttribute(g),v&&y.setAttribute(g,v);d.head.appendChild(y).parentNode.removeChild(y)}function O(r){return r==null?r+"":typeof r=="object"||typeof r=="function"?c[u.call(r)]||"object":typeof r}var B="3.7.1",j=/HTML$/i,p=function(r,l){return new p.fn.init(r,l)};p.fn=p.prototype={jquery:B,constructor:p,length:0,toArray:function(){return s.call(this)},get:function(r){return r==null?s.call(this):r<0?this[r+this.length]:this[r]},pushStack:function(r){var l=p.merge(this.constructor(),r);return l.prevObject=this,l},each:function(r){return p.each(this,r)},map:function(r){return this.pushStack(p.map(this,function(l,d){return r.call(l,d,l)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(p.grep(this,function(r,l){return(l+1)%2}))},odd:function(){return this.pushStack(p.grep(this,function(r,l){return l%2}))},eq:function(r){var l=this.length,d=+r+(r<0?l:0);return this.pushStack(d>=0&&d<l?[this[d]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:e.sort,splice:e.splice},p.extend=p.fn.extend=function(){var r,l,d,g,v,y,_=arguments[0]||{},T=1,E=arguments.length,M=!1;for(typeof _=="boolean"&&(M=_,_=arguments[T]||{},T++),typeof _!="object"&&!w(_)&&(_={}),T===E&&(_=this,T--);T<E;T++)if((r=arguments[T])!=null)for(l in r)g=r[l],!(l==="__proto__"||_===g)&&(M&&g&&(p.isPlainObject(g)||(v=Array.isArray(g)))?(d=_[l],v&&!Array.isArray(d)?y=[]:!v&&!p.isPlainObject(d)?y={}:y=d,v=!1,_[l]=p.extend(M,y,g)):g!==void 0&&(_[l]=g));return _},p.extend({expando:"jQuery"+(B+Math.random()).replace(/\D/g,""),isReady:!0,error:function(r){throw new Error(r)},noop:function(){},isPlainObject:function(r){var l,d;return!r||u.call(r)!=="[object Object]"?!1:(l=i(r),l?(d=f.call(l,"constructor")&&l.constructor,typeof d=="function"&&m.call(d)===b):!0)},isEmptyObject:function(r){var l;for(l in r)return!1;return!0},globalEval:function(r,l,d){D(r,{nonce:l&&l.nonce},d)},each:function(r,l){var d,g=0;if(V(r))for(d=r.length;g<d&&l.call(r[g],g,r[g])!==!1;g++);else for(g in r)if(l.call(r[g],g,r[g])===!1)break;return r},text:function(r){var l,d="",g=0,v=r.nodeType;if(!v)for(;l=r[g++];)d+=p.text(l);return v===1||v===11?r.textContent:v===9?r.documentElement.textContent:v===3||v===4?r.nodeValue:d},makeArray:function(r,l){var d=l||[];return r!=null&&(V(Object(r))?p.merge(d,typeof r=="string"?[r]:r):a.call(d,r)),d},inArray:function(r,l,d){return l==null?-1:o.call(l,r,d)},isXMLDoc:function(r){var l=r&&r.namespaceURI,d=r&&(r.ownerDocument||r).documentElement;return!j.test(l||d&&d.nodeName||"HTML")},merge:function(r,l){for(var d=+l.length,g=0,v=r.length;g<d;g++)r[v++]=l[g];return r.length=v,r},grep:function(r,l,d){for(var g,v=[],y=0,_=r.length,T=!d;y<_;y++)g=!l(r[y],y),g!==T&&v.push(r[y]);return v},map:function(r,l,d){var g,v,y=0,_=[];if(V(r))for(g=r.length;y<g;y++)v=l(r[y],y,d),v!=null&&_.push(v);else for(y in r)v=l(r[y],y,d),v!=null&&_.push(v);return n(_)},guid:1,support:A}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=e[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(r,l){c["[object "+l+"]"]=l.toLowerCase()});function V(r){var l=!!r&&"length"in r&&r.length,d=O(r);return w(r)||x(r)?!1:d==="array"||l===0||typeof l=="number"&&l>0&&l-1 in r}function U(r,l){return r.nodeName&&r.nodeName.toLowerCase()===l.toLowerCase()}var rt=e.pop,yt=e.sort,pt=e.splice,nt="[\\x20\\t\\r\\n\\f]",Pt=new RegExp("^"+nt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+nt+"+$","g");p.contains=function(r,l){var d=l&&l.parentNode;return r===d||!!(d&&d.nodeType===1&&(r.contains?r.contains(d):r.compareDocumentPosition&&r.compareDocumentPosition(d)&16))};var St=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Xt(r,l){return l?r==="\0"?"\uFFFD":r.slice(0,-1)+"\\"+r.charCodeAt(r.length-1).toString(16)+" ":"\\"+r}p.escapeSelector=function(r){return(r+"").replace(St,Xt)};var X=C,Q=a;(function(){var r,l,d,g,v,y=Q,_,T,E,M,N,H=p.expando,L=0,z=0,ot=Es(),_t=Es(),ft=Es(),qt=Es(),Vt=function(S,P){return S===P&&(v=!0),0},Ce="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Te="(?:\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",vt="\\["+nt+"*("+Te+")(?:"+nt+"*([*^$|!~]?=)"+nt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Te+"))|)"+nt+"*\\]",si=":("+Te+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+vt+")*)|.*)\\)|)",wt=new RegExp(nt+"+","g"),Ot=new RegExp("^"+nt+"*,"+nt+"*"),Wi=new RegExp("^"+nt+"*([>+~]|"+nt+")"+nt+"*"),Zn=new RegExp(nt+"|>"),ke=new RegExp(si),Xi=new RegExp("^"+Te+"$"),Pe={ID:new RegExp("^#("+Te+")"),CLASS:new RegExp("^\\.("+Te+")"),TAG:new RegExp("^("+Te+"|[*])"),ATTR:new RegExp("^"+vt),PSEUDO:new RegExp("^"+si),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+nt+"*(even|odd|(([+-]|)(\\d*)n|)"+nt+"*(?:([+-]|)"+nt+"*(\\d+)|))"+nt+"*\\)|)","i"),bool:new RegExp("^(?:"+Ce+")$","i"),needsContext:new RegExp("^"+nt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+nt+"*((?:-\\d)?\\d*)"+nt+"*\\)|)(?=[^-]|$)","i")},Ge=/^(?:input|select|textarea|button)$/i,qe=/^h\d$/i,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tr=/[+~]/,Fe=new RegExp("\\\\[\\da-fA-F]{1,6}"+nt+"?|\\\\([^\\r\\n\\f])","g"),He=function(S,P){var R="0x"+S.slice(1)-65536;return P||(R<0?String.fromCharCode(R+65536):String.fromCharCode(R>>10|55296,R&1023|56320))},fh=function(){We()},ph=Ts(function(S){return S.disabled===!0&&U(S,"fieldset")},{dir:"parentNode",next:"legend"});function gh(){try{return _.activeElement}catch{}}try{y.apply(e=s.call(X.childNodes),X.childNodes),e[X.childNodes.length].nodeType}catch{y={apply:function(P,R){Q.apply(P,s.call(R))},call:function(P){Q.apply(P,s.call(arguments,1))}}}function Et(S,P,R,I){var F,$,G,Z,q,mt,at,ht=P&&P.ownerDocument,bt=P?P.nodeType:9;if(R=R||[],typeof S!="string"||!S||bt!==1&&bt!==9&&bt!==11)return R;if(!I&&(We(P),P=P||_,E)){if(bt!==11&&(q=me.exec(S)))if(F=q[1]){if(bt===9)if(G=P.getElementById(F)){if(G.id===F)return y.call(R,G),R}else return R;else if(ht&&(G=ht.getElementById(F))&&Et.contains(P,G)&&G.id===F)return y.call(R,G),R}else{if(q[2])return y.apply(R,P.getElementsByTagName(S)),R;if((F=q[3])&&P.getElementsByClassName)return y.apply(R,P.getElementsByClassName(F)),R}if(!qt[S+" "]&&(!M||!M.test(S))){if(at=S,ht=P,bt===1&&(Zn.test(S)||Wi.test(S))){for(ht=tr.test(S)&&er(P.parentNode)||P,(ht!=P||!A.scope)&&((Z=P.getAttribute("id"))?Z=p.escapeSelector(Z):P.setAttribute("id",Z=H)),mt=Yi(S),$=mt.length;$--;)mt[$]=(Z?"#"+Z:":scope")+" "+Cs(mt[$]);at=mt.join(",")}try{return y.apply(R,ht.querySelectorAll(at)),R}catch{qt(S,!0)}finally{Z===H&&P.removeAttribute("id")}}}return Eo(S.replace(Pt,"$1"),P,R,I)}function Es(){var S=[];function P(R,I){return S.push(R+" ")>l.cacheLength&&delete P[S.shift()],P[R+" "]=I}return P}function Ae(S){return S[H]=!0,S}function Si(S){var P=_.createElement("fieldset");try{return!!S(P)}catch{return!1}finally{P.parentNode&&P.parentNode.removeChild(P),P=null}}function mh(S){return function(P){return U(P,"input")&&P.type===S}}function bh(S){return function(P){return(U(P,"input")||U(P,"button"))&&P.type===S}}function xo(S){return function(P){return"form"in P?P.parentNode&&P.disabled===!1?"label"in P?"label"in P.parentNode?P.parentNode.disabled===S:P.disabled===S:P.isDisabled===S||P.isDisabled!==!S&&ph(P)===S:P.disabled===S:"label"in P?P.disabled===S:!1}}function ni(S){return Ae(function(P){return P=+P,Ae(function(R,I){for(var F,$=S([],R.length,P),G=$.length;G--;)R[F=$[G]]&&(R[F]=!(I[F]=R[F]))})})}function er(S){return S&&typeof S.getElementsByTagName<"u"&&S}function We(S){var P,R=S?S.ownerDocument||S:X;return R==_||R.nodeType!==9||!R.documentElement||(_=R,T=_.documentElement,E=!p.isXMLDoc(_),N=T.matches||T.webkitMatchesSelector||T.msMatchesSelector,T.msMatchesSelector&&X!=_&&(P=_.defaultView)&&P.top!==P&&P.addEventListener("unload",fh),A.getById=Si(function(I){return T.appendChild(I).id=p.expando,!_.getElementsByName||!_.getElementsByName(p.expando).length}),A.disconnectedMatch=Si(function(I){return N.call(I,"*")}),A.scope=Si(function(){return _.querySelectorAll(":scope")}),A.cssHas=Si(function(){try{return _.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),A.getById?(l.filter.ID=function(I){var F=I.replace(Fe,He);return function($){return $.getAttribute("id")===F}},l.find.ID=function(I,F){if(typeof F.getElementById<"u"&&E){var $=F.getElementById(I);return $?[$]:[]}}):(l.filter.ID=function(I){var F=I.replace(Fe,He);return function($){var G=typeof $.getAttributeNode<"u"&&$.getAttributeNode("id");return G&&G.value===F}},l.find.ID=function(I,F){if(typeof F.getElementById<"u"&&E){var $,G,Z,q=F.getElementById(I);if(q){if($=q.getAttributeNode("id"),$&&$.value===I)return[q];for(Z=F.getElementsByName(I),G=0;q=Z[G++];)if($=q.getAttributeNode("id"),$&&$.value===I)return[q]}return[]}}),l.find.TAG=function(I,F){return typeof F.getElementsByTagName<"u"?F.getElementsByTagName(I):F.querySelectorAll(I)},l.find.CLASS=function(I,F){if(typeof F.getElementsByClassName<"u"&&E)return F.getElementsByClassName(I)},M=[],Si(function(I){var F;T.appendChild(I).innerHTML="<a id='"+H+"' href='' disabled='disabled'></a><select id='"+H+"-\r\\' disabled='disabled'><option selected=''></option></select>",I.querySelectorAll("[selected]").length||M.push("\\["+nt+"*(?:value|"+Ce+")"),I.querySelectorAll("[id~="+H+"-]").length||M.push("~="),I.querySelectorAll("a#"+H+"+*").length||M.push(".#.+[+~]"),I.querySelectorAll(":checked").length||M.push(":checked"),F=_.createElement("input"),F.setAttribute("type","hidden"),I.appendChild(F).setAttribute("name","D"),T.appendChild(I).disabled=!0,I.querySelectorAll(":disabled").length!==2&&M.push(":enabled",":disabled"),F=_.createElement("input"),F.setAttribute("name",""),I.appendChild(F),I.querySelectorAll("[name='']").length||M.push("\\["+nt+"*name"+nt+"*="+nt+`*(?:''|"")`)}),A.cssHas||M.push(":has"),M=M.length&&new RegExp(M.join("|")),Vt=function(I,F){if(I===F)return v=!0,0;var $=!I.compareDocumentPosition-!F.compareDocumentPosition;return $||($=(I.ownerDocument||I)==(F.ownerDocument||F)?I.compareDocumentPosition(F):1,$&1||!A.sortDetached&&F.compareDocumentPosition(I)===$?I===_||I.ownerDocument==X&&Et.contains(X,I)?-1:F===_||F.ownerDocument==X&&Et.contains(X,F)?1:g?o.call(g,I)-o.call(g,F):0:$&4?-1:1)}),_}Et.matches=function(S,P){return Et(S,null,null,P)},Et.matchesSelector=function(S,P){if(We(S),E&&!qt[P+" "]&&(!M||!M.test(P)))try{var R=N.call(S,P);if(R||A.disconnectedMatch||S.document&&S.document.nodeType!==11)return R}catch{qt(P,!0)}return Et(P,_,null,[S]).length>0},Et.contains=function(S,P){return(S.ownerDocument||S)!=_&&We(S),p.contains(S,P)},Et.attr=function(S,P){(S.ownerDocument||S)!=_&&We(S);var R=l.attrHandle[P.toLowerCase()],I=R&&f.call(l.attrHandle,P.toLowerCase())?R(S,P,!E):void 0;return I!==void 0?I:S.getAttribute(P)},Et.error=function(S){throw new Error("Syntax error, unrecognized expression: "+S)},p.uniqueSort=function(S){var P,R=[],I=0,F=0;if(v=!A.sortStable,g=!A.sortStable&&s.call(S,0),yt.call(S,Vt),v){for(;P=S[F++];)P===S[F]&&(I=R.push(F));for(;I--;)pt.call(S,R[I],1)}return g=null,S},p.fn.uniqueSort=function(){return this.pushStack(p.uniqueSort(s.apply(this)))},l=p.expr={cacheLength:50,createPseudo:Ae,match:Pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(S){return S[1]=S[1].replace(Fe,He),S[3]=(S[3]||S[4]||S[5]||"").replace(Fe,He),S[2]==="~="&&(S[3]=" "+S[3]+" "),S.slice(0,4)},CHILD:function(S){return S[1]=S[1].toLowerCase(),S[1].slice(0,3)==="nth"?(S[3]||Et.error(S[0]),S[4]=+(S[4]?S[5]+(S[6]||1):2*(S[3]==="even"||S[3]==="odd")),S[5]=+(S[7]+S[8]||S[3]==="odd")):S[3]&&Et.error(S[0]),S},PSEUDO:function(S){var P,R=!S[6]&&S[2];return Pe.CHILD.test(S[0])?null:(S[3]?S[2]=S[4]||S[5]||"":R&&ke.test(R)&&(P=Yi(R,!0))&&(P=R.indexOf(")",R.length-P)-R.length)&&(S[0]=S[0].slice(0,P),S[2]=R.slice(0,P)),S.slice(0,3))}},filter:{TAG:function(S){var P=S.replace(Fe,He).toLowerCase();return S==="*"?function(){return!0}:function(R){return U(R,P)}},CLASS:function(S){var P=ot[S+" "];return P||(P=new RegExp("(^|"+nt+")"+S+"("+nt+"|$)"))&&ot(S,function(R){return P.test(typeof R.className=="string"&&R.className||typeof R.getAttribute<"u"&&R.getAttribute("class")||"")})},ATTR:function(S,P,R){return function(I){var F=Et.attr(I,S);return F==null?P==="!=":P?(F+="",P==="="?F===R:P==="!="?F!==R:P==="^="?R&&F.indexOf(R)===0:P==="*="?R&&F.indexOf(R)>-1:P==="$="?R&&F.slice(-R.length)===R:P==="~="?(" "+F.replace(wt," ")+" ").indexOf(R)>-1:P==="|="?F===R||F.slice(0,R.length+1)===R+"-":!1):!0}},CHILD:function(S,P,R,I,F){var $=S.slice(0,3)!=="nth",G=S.slice(-4)!=="last",Z=P==="of-type";return I===1&&F===0?function(q){return!!q.parentNode}:function(q,mt,at){var ht,bt,st,kt,ae,Yt=$!==G?"nextSibling":"previousSibling",be=q.parentNode,Me=Z&&q.nodeName.toLowerCase(),Ei=!at&&!Z,te=!1;if(be){if($){for(;Yt;){for(st=q;st=st[Yt];)if(Z?U(st,Me):st.nodeType===1)return!1;ae=Yt=S==="only"&&!ae&&"nextSibling"}return!0}if(ae=[G?be.firstChild:be.lastChild],G&&Ei){for(bt=be[H]||(be[H]={}),ht=bt[S]||[],kt=ht[0]===L&&ht[1],te=kt&&ht[2],st=kt&&be.childNodes[kt];st=++kt&&st&&st[Yt]||(te=kt=0)||ae.pop();)if(st.nodeType===1&&++te&&st===q){bt[S]=[L,kt,te];break}}else if(Ei&&(bt=q[H]||(q[H]={}),ht=bt[S]||[],kt=ht[0]===L&&ht[1],te=kt),te===!1)for(;(st=++kt&&st&&st[Yt]||(te=kt=0)||ae.pop())&&!((Z?U(st,Me):st.nodeType===1)&&++te&&(Ei&&(bt=st[H]||(st[H]={}),bt[S]=[L,te]),st===q)););return te-=F,te===I||te%I===0&&te/I>=0}}},PSEUDO:function(S,P){var R,I=l.pseudos[S]||l.setFilters[S.toLowerCase()]||Et.error("unsupported pseudo: "+S);return I[H]?I(P):I.length>1?(R=[S,S,"",P],l.setFilters.hasOwnProperty(S.toLowerCase())?Ae(function(F,$){for(var G,Z=I(F,P),q=Z.length;q--;)G=o.call(F,Z[q]),F[G]=!($[G]=Z[q])}):function(F){return I(F,0,R)}):I}},pseudos:{not:Ae(function(S){var P=[],R=[],I=rr(S.replace(Pt,"$1"));return I[H]?Ae(function(F,$,G,Z){for(var q,mt=I(F,null,Z,[]),at=F.length;at--;)(q=mt[at])&&(F[at]=!($[at]=q))}):function(F,$,G){return P[0]=F,I(P,null,G,R),P[0]=null,!R.pop()}}),has:Ae(function(S){return function(P){return Et(S,P).length>0}}),contains:Ae(function(S){return S=S.replace(Fe,He),function(P){return(P.textContent||p.text(P)).indexOf(S)>-1}}),lang:Ae(function(S){return Xi.test(S||"")||Et.error("unsupported lang: "+S),S=S.replace(Fe,He).toLowerCase(),function(P){var R;do if(R=E?P.lang:P.getAttribute("xml:lang")||P.getAttribute("lang"))return R=R.toLowerCase(),R===S||R.indexOf(S+"-")===0;while((P=P.parentNode)&&P.nodeType===1);return!1}}),target:function(S){var P=h.location&&h.location.hash;return P&&P.slice(1)===S.id},root:function(S){return S===T},focus:function(S){return S===gh()&&_.hasFocus()&&!!(S.type||S.href||~S.tabIndex)},enabled:xo(!1),disabled:xo(!0),checked:function(S){return U(S,"input")&&!!S.checked||U(S,"option")&&!!S.selected},selected:function(S){return S.parentNode&&S.parentNode.selectedIndex,S.selected===!0},empty:function(S){for(S=S.firstChild;S;S=S.nextSibling)if(S.nodeType<6)return!1;return!0},parent:function(S){return!l.pseudos.empty(S)},header:function(S){return qe.test(S.nodeName)},input:function(S){return Ge.test(S.nodeName)},button:function(S){return U(S,"input")&&S.type==="button"||U(S,"button")},text:function(S){var P;return U(S,"input")&&S.type==="text"&&((P=S.getAttribute("type"))==null||P.toLowerCase()==="text")},first:ni(function(){return[0]}),last:ni(function(S,P){return[P-1]}),eq:ni(function(S,P,R){return[R<0?R+P:R]}),even:ni(function(S,P){for(var R=0;R<P;R+=2)S.push(R);return S}),odd:ni(function(S,P){for(var R=1;R<P;R+=2)S.push(R);return S}),lt:ni(function(S,P,R){var I;for(R<0?I=R+P:R>P?I=P:I=R;--I>=0;)S.push(I);return S}),gt:ni(function(S,P,R){for(var I=R<0?R+P:R;++I<P;)S.push(I);return S})}},l.pseudos.nth=l.pseudos.eq;for(r in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})l.pseudos[r]=mh(r);for(r in{submit:!0,reset:!0})l.pseudos[r]=bh(r);function So(){}So.prototype=l.filters=l.pseudos,l.setFilters=new So;function Yi(S,P){var R,I,F,$,G,Z,q,mt=_t[S+" "];if(mt)return P?0:mt.slice(0);for(G=S,Z=[],q=l.preFilter;G;){(!R||(I=Ot.exec(G)))&&(I&&(G=G.slice(I[0].length)||G),Z.push(F=[])),R=!1,(I=Wi.exec(G))&&(R=I.shift(),F.push({value:R,type:I[0].replace(Pt," ")}),G=G.slice(R.length));for($ in l.filter)(I=Pe[$].exec(G))&&(!q[$]||(I=q[$](I)))&&(R=I.shift(),F.push({value:R,type:$,matches:I}),G=G.slice(R.length));if(!R)break}return P?G.length:G?Et.error(S):_t(S,Z).slice(0)}function Cs(S){for(var P=0,R=S.length,I="";P<R;P++)I+=S[P].value;return I}function Ts(S,P,R){var I=P.dir,F=P.next,$=F||I,G=R&&$==="parentNode",Z=z++;return P.first?function(q,mt,at){for(;q=q[I];)if(q.nodeType===1||G)return S(q,mt,at);return!1}:function(q,mt,at){var ht,bt,st=[L,Z];if(at){for(;q=q[I];)if((q.nodeType===1||G)&&S(q,mt,at))return!0}else for(;q=q[I];)if(q.nodeType===1||G)if(bt=q[H]||(q[H]={}),F&&U(q,F))q=q[I]||q;else{if((ht=bt[$])&&ht[0]===L&&ht[1]===Z)return st[2]=ht[2];if(bt[$]=st,st[2]=S(q,mt,at))return!0}return!1}}function ir(S){return S.length>1?function(P,R,I){for(var F=S.length;F--;)if(!S[F](P,R,I))return!1;return!0}:S[0]}function vh(S,P,R){for(var I=0,F=P.length;I<F;I++)Et(S,P[I],R);return R}function ks(S,P,R,I,F){for(var $,G=[],Z=0,q=S.length,mt=P!=null;Z<q;Z++)($=S[Z])&&(!R||R($,I,F))&&(G.push($),mt&&P.push(Z));return G}function sr(S,P,R,I,F,$){return I&&!I[H]&&(I=sr(I)),F&&!F[H]&&(F=sr(F,$)),Ae(function(G,Z,q,mt){var at,ht,bt,st,kt=[],ae=[],Yt=Z.length,be=G||vh(P||"*",q.nodeType?[q]:q,[]),Me=S&&(G||!P)?ks(be,kt,S,q,mt):be;if(R?(st=F||(G?S:Yt||I)?[]:Z,R(Me,st,q,mt)):st=Me,I)for(at=ks(st,ae),I(at,[],q,mt),ht=at.length;ht--;)(bt=at[ht])&&(st[ae[ht]]=!(Me[ae[ht]]=bt));if(G){if(F||S){if(F){for(at=[],ht=st.length;ht--;)(bt=st[ht])&&at.push(Me[ht]=bt);F(null,st=[],at,mt)}for(ht=st.length;ht--;)(bt=st[ht])&&(at=F?o.call(G,bt):kt[ht])>-1&&(G[at]=!(Z[at]=bt))}}else st=ks(st===Z?st.splice(Yt,st.length):st),F?F(null,Z,st,mt):y.apply(Z,st)})}function nr(S){for(var P,R,I,F=S.length,$=l.relative[S[0].type],G=$||l.relative[" "],Z=$?1:0,q=Ts(function(ht){return ht===P},G,!0),mt=Ts(function(ht){return o.call(P,ht)>-1},G,!0),at=[function(ht,bt,st){var kt=!$&&(st||bt!=d)||((P=bt).nodeType?q(ht,bt,st):mt(ht,bt,st));return P=null,kt}];Z<F;Z++)if(R=l.relative[S[Z].type])at=[Ts(ir(at),R)];else{if(R=l.filter[S[Z].type].apply(null,S[Z].matches),R[H]){for(I=++Z;I<F&&!l.relative[S[I].type];I++);return sr(Z>1&&ir(at),Z>1&&Cs(S.slice(0,Z-1).concat({value:S[Z-2].type===" "?"*":""})).replace(Pt,"$1"),R,Z<I&&nr(S.slice(Z,I)),I<F&&nr(S=S.slice(I)),I<F&&Cs(S))}at.push(R)}return ir(at)}function yh(S,P){var R=P.length>0,I=S.length>0,F=function($,G,Z,q,mt){var at,ht,bt,st=0,kt="0",ae=$&&[],Yt=[],be=d,Me=$||I&&l.find.TAG("*",mt),Ei=L+=be==null?1:Math.random()||.1,te=Me.length;for(mt&&(d=G==_||G||mt);kt!==te&&(at=Me[kt])!=null;kt++){if(I&&at){for(ht=0,!G&&at.ownerDocument!=_&&(We(at),Z=!E);bt=S[ht++];)if(bt(at,G||_,Z)){y.call(q,at);break}mt&&(L=Ei)}R&&((at=!bt&&at)&&st--,$&&ae.push(at))}if(st+=kt,R&&kt!==st){for(ht=0;bt=P[ht++];)bt(ae,Yt,G,Z);if($){if(st>0)for(;kt--;)ae[kt]||Yt[kt]||(Yt[kt]=rt.call(q));Yt=ks(Yt)}y.apply(q,Yt),mt&&!$&&Yt.length>0&&st+P.length>1&&p.uniqueSort(q)}return mt&&(L=Ei,d=be),ae};return R?Ae(F):F}function rr(S,P){var R,I=[],F=[],$=ft[S+" "];if(!$){for(P||(P=Yi(S)),R=P.length;R--;)$=nr(P[R]),$[H]?I.push($):F.push($);$=ft(S,yh(F,I)),$.selector=S}return $}function Eo(S,P,R,I){var F,$,G,Z,q,mt=typeof S=="function"&&S,at=!I&&Yi(S=mt.selector||S);if(R=R||[],at.length===1){if($=at[0]=at[0].slice(0),$.length>2&&(G=$[0]).type==="ID"&&P.nodeType===9&&E&&l.relative[$[1].type]){if(P=(l.find.ID(G.matches[0].replace(Fe,He),P)||[])[0],P)mt&&(P=P.parentNode);else return R;S=S.slice($.shift().value.length)}for(F=Pe.needsContext.test(S)?0:$.length;F--&&(G=$[F],!l.relative[Z=G.type]);)if((q=l.find[Z])&&(I=q(G.matches[0].replace(Fe,He),tr.test($[0].type)&&er(P.parentNode)||P))){if($.splice(F,1),S=I.length&&Cs($),!S)return y.apply(R,I),R;break}}return(mt||rr(S,at))(I,P,!E,R,!P||tr.test(S)&&er(P.parentNode)||P),R}A.sortStable=H.split("").sort(Vt).join("")===H,We(),A.sortDetached=Si(function(S){return S.compareDocumentPosition(_.createElement("fieldset"))&1}),p.find=Et,p.expr[":"]=p.expr.pseudos,p.unique=p.uniqueSort,Et.compile=rr,Et.select=Eo,Et.setDocument=We,Et.tokenize=Yi,Et.escape=p.escapeSelector,Et.getText=p.text,Et.isXML=p.isXMLDoc,Et.selectors=p.expr,Et.support=p.support,Et.uniqueSort=p.uniqueSort})();var zt=function(r,l,d){for(var g=[],v=d!==void 0;(r=r[l])&&r.nodeType!==9;)if(r.nodeType===1){if(v&&p(r).is(d))break;g.push(r)}return g},ce=function(r,l){for(var d=[];r;r=r.nextSibling)r.nodeType===1&&r!==l&&d.push(r);return d},Se=p.expr.match.needsContext,Zt=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Nt(r,l,d){return w(l)?p.grep(r,function(g,v){return!!l.call(g,v,g)!==d}):l.nodeType?p.grep(r,function(g){return g===l!==d}):typeof l!="string"?p.grep(r,function(g){return o.call(l,g)>-1!==d}):p.filter(l,r,d)}p.filter=function(r,l,d){var g=l[0];return d&&(r=":not("+r+")"),l.length===1&&g.nodeType===1?p.find.matchesSelector(g,r)?[g]:[]:p.find.matches(r,p.grep(l,function(v){return v.nodeType===1}))},p.fn.extend({find:function(r){var l,d,g=this.length,v=this;if(typeof r!="string")return this.pushStack(p(r).filter(function(){for(l=0;l<g;l++)if(p.contains(v[l],this))return!0}));for(d=this.pushStack([]),l=0;l<g;l++)p.find(r,v[l],d);return g>1?p.uniqueSort(d):d},filter:function(r){return this.pushStack(Nt(this,r||[],!1))},not:function(r){return this.pushStack(Nt(this,r||[],!0))},is:function(r){return!!Nt(this,typeof r=="string"&&Se.test(r)?p(r):r||[],!1).length}});var Lt,Ue=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ze=p.fn.init=function(r,l,d){var g,v;if(!r)return this;if(d=d||Lt,typeof r=="string")if(r[0]==="<"&&r[r.length-1]===">"&&r.length>=3?g=[null,r,null]:g=Ue.exec(r),g&&(g[1]||!l))if(g[1]){if(l=l instanceof p?l[0]:l,p.merge(this,p.parseHTML(g[1],l&&l.nodeType?l.ownerDocument||l:C,!0)),Zt.test(g[1])&&p.isPlainObject(l))for(g in l)w(this[g])?this[g](l[g]):this.attr(g,l[g]);return this}else return v=C.getElementById(g[2]),v&&(this[0]=v,this.length=1),this;else return!l||l.jquery?(l||d).find(r):this.constructor(l).find(r);else{if(r.nodeType)return this[0]=r,this.length=1,this;if(w(r))return d.ready!==void 0?d.ready(r):r(p)}return p.makeArray(r,this)};Ze.prototype=p.fn,Lt=p(C);var ie=/^(?:parents|prev(?:Until|All))/,Tt={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(r){var l=p(r,this),d=l.length;return this.filter(function(){for(var g=0;g<d;g++)if(p.contains(this,l[g]))return!0})},closest:function(r,l){var d,g=0,v=this.length,y=[],_=typeof r!="string"&&p(r);if(!Se.test(r)){for(;g<v;g++)for(d=this[g];d&&d!==l;d=d.parentNode)if(d.nodeType<11&&(_?_.index(d)>-1:d.nodeType===1&&p.find.matchesSelector(d,r))){y.push(d);break}}return this.pushStack(y.length>1?p.uniqueSort(y):y)},index:function(r){return r?typeof r=="string"?o.call(p(r),this[0]):o.call(this,r.jquery?r[0]:r):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(r,l){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(r,l))))},addBack:function(r){return this.add(r==null?this.prevObject:this.prevObject.filter(r))}});function ue(r,l){for(;(r=r[l])&&r.nodeType!==1;);return r}p.each({parent:function(r){var l=r.parentNode;return l&&l.nodeType!==11?l:null},parents:function(r){return zt(r,"parentNode")},parentsUntil:function(r,l,d){return zt(r,"parentNode",d)},next:function(r){return ue(r,"nextSibling")},prev:function(r){return ue(r,"previousSibling")},nextAll:function(r){return zt(r,"nextSibling")},prevAll:function(r){return zt(r,"previousSibling")},nextUntil:function(r,l,d){return zt(r,"nextSibling",d)},prevUntil:function(r,l,d){return zt(r,"previousSibling",d)},siblings:function(r){return ce((r.parentNode||{}).firstChild,r)},children:function(r){return ce(r.firstChild)},contents:function(r){return r.contentDocument!=null&&i(r.contentDocument)?r.contentDocument:(U(r,"template")&&(r=r.content||r),p.merge([],r.childNodes))}},function(r,l){p.fn[r]=function(d,g){var v=p.map(this,l,d);return r.slice(-5)!=="Until"&&(g=d),g&&typeof g=="string"&&(v=p.filter(g,v)),this.length>1&&(Tt[r]||p.uniqueSort(v),ie.test(r)&&v.reverse()),this.pushStack(v)}});var de=/[^\x20\t\r\n\f]+/g;function Fn(r){var l={};return p.each(r.match(de)||[],function(d,g){l[g]=!0}),l}p.Callbacks=function(r){r=typeof r=="string"?Fn(r):p.extend({},r);var l,d,g,v,y=[],_=[],T=-1,E=function(){for(v=v||r.once,g=l=!0;_.length;T=-1)for(d=_.shift();++T<y.length;)y[T].apply(d[0],d[1])===!1&&r.stopOnFalse&&(T=y.length,d=!1);r.memory||(d=!1),l=!1,v&&(d?y=[]:y="")},M={add:function(){return y&&(d&&!l&&(T=y.length-1,_.push(d)),(function N(H){p.each(H,function(L,z){w(z)?(!r.unique||!M.has(z))&&y.push(z):z&&z.length&&O(z)!=="string"&&N(z)})})(arguments),d&&!l&&E()),this},remove:function(){return p.each(arguments,function(N,H){for(var L;(L=p.inArray(H,y,L))>-1;)y.splice(L,1),L<=T&&T--}),this},has:function(N){return N?p.inArray(N,y)>-1:y.length>0},empty:function(){return y&&(y=[]),this},disable:function(){return v=_=[],y=d="",this},disabled:function(){return!y},lock:function(){return v=_=[],!d&&!l&&(y=d=""),this},locked:function(){return!!v},fireWith:function(N,H){return v||(H=H||[],H=[N,H.slice?H.slice():H],_.push(H),l||E()),this},fire:function(){return M.fireWith(this,arguments),this},fired:function(){return!!g}};return M};function bi(r){return r}function vs(r){throw r}function Ua(r,l,d,g){var v;try{r&&w(v=r.promise)?v.call(r).done(l).fail(d):r&&w(v=r.then)?v.call(r,l,d):l.apply(void 0,[r].slice(g))}catch(y){d.apply(void 0,[y])}}p.extend({Deferred:function(r){var l=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],d="pending",g={state:function(){return d},always:function(){return v.done(arguments).fail(arguments),this},catch:function(y){return g.then(null,y)},pipe:function(){var y=arguments;return p.Deferred(function(_){p.each(l,function(T,E){var M=w(y[E[4]])&&y[E[4]];v[E[1]](function(){var N=M&&M.apply(this,arguments);N&&w(N.promise)?N.promise().progress(_.notify).done(_.resolve).fail(_.reject):_[E[0]+"With"](this,M?[N]:arguments)})}),y=null}).promise()},then:function(y,_,T){var E=0;function M(N,H,L,z){return function(){var ot=this,_t=arguments,ft=function(){var Vt,Ce;if(!(N<E)){if(Vt=L.apply(ot,_t),Vt===H.promise())throw new TypeError("Thenable self-resolution");Ce=Vt&&(typeof Vt=="object"||typeof Vt=="function")&&Vt.then,w(Ce)?z?Ce.call(Vt,M(E,H,bi,z),M(E,H,vs,z)):(E++,Ce.call(Vt,M(E,H,bi,z),M(E,H,vs,z),M(E,H,bi,H.notifyWith))):(L!==bi&&(ot=void 0,_t=[Vt]),(z||H.resolveWith)(ot,_t))}},qt=z?ft:function(){try{ft()}catch(Vt){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(Vt,qt.error),N+1>=E&&(L!==vs&&(ot=void 0,_t=[Vt]),H.rejectWith(ot,_t))}};N?qt():(p.Deferred.getErrorHook?qt.error=p.Deferred.getErrorHook():p.Deferred.getStackHook&&(qt.error=p.Deferred.getStackHook()),h.setTimeout(qt))}}return p.Deferred(function(N){l[0][3].add(M(0,N,w(T)?T:bi,N.notifyWith)),l[1][3].add(M(0,N,w(y)?y:bi)),l[2][3].add(M(0,N,w(_)?_:vs))}).promise()},promise:function(y){return y!=null?p.extend(y,g):g}},v={};return p.each(l,function(y,_){var T=_[2],E=_[5];g[_[1]]=T.add,E&&T.add(function(){d=E},l[3-y][2].disable,l[3-y][3].disable,l[0][2].lock,l[0][3].lock),T.add(_[3].fire),v[_[0]]=function(){return v[_[0]+"With"](this===v?void 0:this,arguments),this},v[_[0]+"With"]=T.fireWith}),g.promise(v),r&&r.call(v,v),v},when:function(r){var l=arguments.length,d=l,g=Array(d),v=s.call(arguments),y=p.Deferred(),_=function(T){return function(E){g[T]=this,v[T]=arguments.length>1?s.call(arguments):E,--l||y.resolveWith(g,v)}};if(l<=1&&(Ua(r,y.done(_(d)).resolve,y.reject,!l),y.state()==="pending"||w(v[d]&&v[d].then)))return y.then();for(;d--;)Ua(v[d],_(d),y.reject);return y.promise()}});var Sl=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(r,l){h.console&&h.console.warn&&r&&Sl.test(r.name)&&h.console.warn("jQuery.Deferred exception: "+r.message,r.stack,l)},p.readyException=function(r){h.setTimeout(function(){throw r})};var Hn=p.Deferred();p.fn.ready=function(r){return Hn.then(r).catch(function(l){p.readyException(l)}),this},p.extend({isReady:!1,readyWait:1,ready:function(r){(r===!0?--p.readyWait:p.isReady)||(p.isReady=!0,!(r!==!0&&--p.readyWait>0)&&Hn.resolveWith(C,[p]))}}),p.ready.then=Hn.then;function ys(){C.removeEventListener("DOMContentLoaded",ys),h.removeEventListener("load",ys),p.ready()}C.readyState==="complete"||C.readyState!=="loading"&&!C.documentElement.doScroll?h.setTimeout(p.ready):(C.addEventListener("DOMContentLoaded",ys),h.addEventListener("load",ys));var Ne=function(r,l,d,g,v,y,_){var T=0,E=r.length,M=d==null;if(O(d)==="object"){v=!0;for(T in d)Ne(r,l,T,d[T],!0,y,_)}else if(g!==void 0&&(v=!0,w(g)||(_=!0),M&&(_?(l.call(r,g),l=null):(M=l,l=function(N,H,L){return M.call(p(N),L)})),l))for(;T<E;T++)l(r[T],d,_?g:g.call(r[T],T,l(r[T],d)));return v?r:M?l.call(r):E?l(r[0],d):y},El=/^-ms-/,Cl=/-([a-z])/g;function Tl(r,l){return l.toUpperCase()}function Ee(r){return r.replace(El,"ms-").replace(Cl,Tl)}var Bi=function(r){return r.nodeType===1||r.nodeType===9||!+r.nodeType};function ji(){this.expando=p.expando+ji.uid++}ji.uid=1,ji.prototype={cache:function(r){var l=r[this.expando];return l||(l={},Bi(r)&&(r.nodeType?r[this.expando]=l:Object.defineProperty(r,this.expando,{value:l,configurable:!0}))),l},set:function(r,l,d){var g,v=this.cache(r);if(typeof l=="string")v[Ee(l)]=d;else for(g in l)v[Ee(g)]=l[g];return v},get:function(r,l){return l===void 0?this.cache(r):r[this.expando]&&r[this.expando][Ee(l)]},access:function(r,l,d){return l===void 0||l&&typeof l=="string"&&d===void 0?this.get(r,l):(this.set(r,l,d),d!==void 0?d:l)},remove:function(r,l){var d,g=r[this.expando];if(g!==void 0){if(l!==void 0)for(Array.isArray(l)?l=l.map(Ee):(l=Ee(l),l=l in g?[l]:l.match(de)||[]),d=l.length;d--;)delete g[l[d]];(l===void 0||p.isEmptyObject(g))&&(r.nodeType?r[this.expando]=void 0:delete r[this.expando])}},hasData:function(r){var l=r[this.expando];return l!==void 0&&!p.isEmptyObject(l)}};var et=new ji,se=new ji,kl=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Pl=/[A-Z]/g;function Ml(r){return r==="true"?!0:r==="false"?!1:r==="null"?null:r===+r+""?+r:kl.test(r)?JSON.parse(r):r}function Ga(r,l,d){var g;if(d===void 0&&r.nodeType===1)if(g="data-"+l.replace(Pl,"-$&").toLowerCase(),d=r.getAttribute(g),typeof d=="string"){try{d=Ml(d)}catch{}se.set(r,l,d)}else d=void 0;return d}p.extend({hasData:function(r){return se.hasData(r)||et.hasData(r)},data:function(r,l,d){return se.access(r,l,d)},removeData:function(r,l){se.remove(r,l)},_data:function(r,l,d){return et.access(r,l,d)},_removeData:function(r,l){et.remove(r,l)}}),p.fn.extend({data:function(r,l){var d,g,v,y=this[0],_=y&&y.attributes;if(r===void 0){if(this.length&&(v=se.get(y),y.nodeType===1&&!et.get(y,"hasDataAttrs"))){for(d=_.length;d--;)_[d]&&(g=_[d].name,g.indexOf("data-")===0&&(g=Ee(g.slice(5)),Ga(y,g,v[g])));et.set(y,"hasDataAttrs",!0)}return v}return typeof r=="object"?this.each(function(){se.set(this,r)}):Ne(this,function(T){var E;if(y&&T===void 0)return E=se.get(y,r),E!==void 0||(E=Ga(y,r),E!==void 0)?E:void 0;this.each(function(){se.set(this,r,T)})},null,l,arguments.length>1,null,!0)},removeData:function(r){return this.each(function(){se.remove(this,r)})}}),p.extend({queue:function(r,l,d){var g;if(r)return l=(l||"fx")+"queue",g=et.get(r,l),d&&(!g||Array.isArray(d)?g=et.access(r,l,p.makeArray(d)):g.push(d)),g||[]},dequeue:function(r,l){l=l||"fx";var d=p.queue(r,l),g=d.length,v=d.shift(),y=p._queueHooks(r,l),_=function(){p.dequeue(r,l)};v==="inprogress"&&(v=d.shift(),g--),v&&(l==="fx"&&d.unshift("inprogress"),delete y.stop,v.call(r,_,y)),!g&&y&&y.empty.fire()},_queueHooks:function(r,l){var d=l+"queueHooks";return et.get(r,d)||et.access(r,d,{empty:p.Callbacks("once memory").add(function(){et.remove(r,[l+"queue",d])})})}}),p.fn.extend({queue:function(r,l){var d=2;return typeof r!="string"&&(l=r,r="fx",d--),arguments.length<d?p.queue(this[0],r):l===void 0?this:this.each(function(){var g=p.queue(this,r,l);p._queueHooks(this,r),r==="fx"&&g[0]!=="inprogress"&&p.dequeue(this,r)})},dequeue:function(r){return this.each(function(){p.dequeue(this,r)})},clearQueue:function(r){return this.queue(r||"fx",[])},promise:function(r,l){var d,g=1,v=p.Deferred(),y=this,_=this.length,T=function(){--g||v.resolveWith(y,[y])};for(typeof r!="string"&&(l=r,r=void 0),r=r||"fx";_--;)d=et.get(y[_],r+"queueHooks"),d&&d.empty&&(g++,d.empty.add(T));return T(),v.promise(l)}});var qa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,zi=new RegExp("^(?:([+-])=|)("+qa+")([a-z%]*)$","i"),Oe=["Top","Right","Bottom","Left"],ti=C.documentElement,vi=function(r){return p.contains(r.ownerDocument,r)},Rl={composed:!0};ti.getRootNode&&(vi=function(r){return p.contains(r.ownerDocument,r)||r.getRootNode(Rl)===r.ownerDocument});var As=function(r,l){return r=l||r,r.style.display==="none"||r.style.display===""&&vi(r)&&p.css(r,"display")==="none"};function Wa(r,l,d,g){var v,y,_=20,T=g?function(){return g.cur()}:function(){return p.css(r,l,"")},E=T(),M=d&&d[3]||(p.cssNumber[l]?"":"px"),N=r.nodeType&&(p.cssNumber[l]||M!=="px"&&+E)&&zi.exec(p.css(r,l));if(N&&N[3]!==M){for(E=E/2,M=M||N[3],N=+E||1;_--;)p.style(r,l,N+M),(1-y)*(1-(y=T()/E||.5))<=0&&(_=0),N=N/y;N=N*2,p.style(r,l,N+M),d=d||[]}return d&&(N=+N||+E||0,v=d[1]?N+(d[1]+1)*d[2]:+d[2],g&&(g.unit=M,g.start=N,g.end=v)),v}var Xa={};function Ll(r){var l,d=r.ownerDocument,g=r.nodeName,v=Xa[g];return v||(l=d.body.appendChild(d.createElement(g)),v=p.css(l,"display"),l.parentNode.removeChild(l),v==="none"&&(v="block"),Xa[g]=v,v)}function yi(r,l){for(var d,g,v=[],y=0,_=r.length;y<_;y++)g=r[y],g.style&&(d=g.style.display,l?(d==="none"&&(v[y]=et.get(g,"display")||null,v[y]||(g.style.display="")),g.style.display===""&&As(g)&&(v[y]=Ll(g))):d!=="none"&&(v[y]="none",et.set(g,"display",d)));for(y=0;y<_;y++)v[y]!=null&&(r[y].style.display=v[y]);return r}p.fn.extend({show:function(){return yi(this,!0)},hide:function(){return yi(this)},toggle:function(r){return typeof r=="boolean"?r?this.show():this.hide():this.each(function(){As(this)?p(this).show():p(this).hide()})}});var Vi=/^(?:checkbox|radio)$/i,Ya=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ka=/^$|^module$|\/(?:java|ecma)script/i;(function(){var r=C.createDocumentFragment(),l=r.appendChild(C.createElement("div")),d=C.createElement("input");d.setAttribute("type","radio"),d.setAttribute("checked","checked"),d.setAttribute("name","t"),l.appendChild(d),A.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,l.innerHTML="<textarea>x</textarea>",A.noCloneChecked=!!l.cloneNode(!0).lastChild.defaultValue,l.innerHTML="<option></option>",A.option=!!l.lastChild})();var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,A.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);function ne(r,l){var d;return typeof r.getElementsByTagName<"u"?d=r.getElementsByTagName(l||"*"):typeof r.querySelectorAll<"u"?d=r.querySelectorAll(l||"*"):d=[],l===void 0||l&&U(r,l)?p.merge([r],d):d}function Bn(r,l){for(var d=0,g=r.length;d<g;d++)et.set(r[d],"globalEval",!l||et.get(l[d],"globalEval"))}var Il=/<|&#?\w+;/;function Qa(r,l,d,g,v){for(var y,_,T,E,M,N,H=l.createDocumentFragment(),L=[],z=0,ot=r.length;z<ot;z++)if(y=r[z],y||y===0)if(O(y)==="object")p.merge(L,y.nodeType?[y]:y);else if(!Il.test(y))L.push(l.createTextNode(y));else{for(_=_||H.appendChild(l.createElement("div")),T=(Ya.exec(y)||["",""])[1].toLowerCase(),E=ge[T]||ge._default,_.innerHTML=E[1]+p.htmlPrefilter(y)+E[2],N=E[0];N--;)_=_.lastChild;p.merge(L,_.childNodes),_=H.firstChild,_.textContent=""}for(H.textContent="",z=0;y=L[z++];){if(g&&p.inArray(y,g)>-1){v&&v.push(y);continue}if(M=vi(y),_=ne(H.appendChild(y),"script"),M&&Bn(_),d)for(N=0;y=_[N++];)Ka.test(y.type||"")&&d.push(y)}return H}var Ja=/^([^.]*)(?:\.(.+)|)/;function Ai(){return!0}function _i(){return!1}function jn(r,l,d,g,v,y){var _,T;if(typeof l=="object"){typeof d!="string"&&(g=g||d,d=void 0);for(T in l)jn(r,T,d,g,l[T],y);return r}if(g==null&&v==null?(v=d,g=d=void 0):v==null&&(typeof d=="string"?(v=g,g=void 0):(v=g,g=d,d=void 0)),v===!1)v=_i;else if(!v)return r;return y===1&&(_=v,v=function(E){return p().off(E),_.apply(this,arguments)},v.guid=_.guid||(_.guid=p.guid++)),r.each(function(){p.event.add(this,l,v,g,d)})}p.event={global:{},add:function(r,l,d,g,v){var y,_,T,E,M,N,H,L,z,ot,_t,ft=et.get(r);if(Bi(r))for(d.handler&&(y=d,d=y.handler,v=y.selector),v&&p.find.matchesSelector(ti,v),d.guid||(d.guid=p.guid++),(E=ft.events)||(E=ft.events=Object.create(null)),(_=ft.handle)||(_=ft.handle=function(qt){return typeof p<"u"&&p.event.triggered!==qt.type?p.event.dispatch.apply(r,arguments):void 0}),l=(l||"").match(de)||[""],M=l.length;M--;)T=Ja.exec(l[M])||[],z=_t=T[1],ot=(T[2]||"").split(".").sort(),z&&(H=p.event.special[z]||{},z=(v?H.delegateType:H.bindType)||z,H=p.event.special[z]||{},N=p.extend({type:z,origType:_t,data:g,handler:d,guid:d.guid,selector:v,needsContext:v&&p.expr.match.needsContext.test(v),namespace:ot.join(".")},y),(L=E[z])||(L=E[z]=[],L.delegateCount=0,(!H.setup||H.setup.call(r,g,ot,_)===!1)&&r.addEventListener&&r.addEventListener(z,_)),H.add&&(H.add.call(r,N),N.handler.guid||(N.handler.guid=d.guid)),v?L.splice(L.delegateCount++,0,N):L.push(N),p.event.global[z]=!0)},remove:function(r,l,d,g,v){var y,_,T,E,M,N,H,L,z,ot,_t,ft=et.hasData(r)&&et.get(r);if(!(!ft||!(E=ft.events))){for(l=(l||"").match(de)||[""],M=l.length;M--;){if(T=Ja.exec(l[M])||[],z=_t=T[1],ot=(T[2]||"").split(".").sort(),!z){for(z in E)p.event.remove(r,z+l[M],d,g,!0);continue}for(H=p.event.special[z]||{},z=(g?H.delegateType:H.bindType)||z,L=E[z]||[],T=T[2]&&new RegExp("(^|\\.)"+ot.join("\\.(?:.*\\.|)")+"(\\.|$)"),_=y=L.length;y--;)N=L[y],(v||_t===N.origType)&&(!d||d.guid===N.guid)&&(!T||T.test(N.namespace))&&(!g||g===N.selector||g==="**"&&N.selector)&&(L.splice(y,1),N.selector&&L.delegateCount--,H.remove&&H.remove.call(r,N));_&&!L.length&&((!H.teardown||H.teardown.call(r,ot,ft.handle)===!1)&&p.removeEvent(r,z,ft.handle),delete E[z])}p.isEmptyObject(E)&&et.remove(r,"handle events")}},dispatch:function(r){var l,d,g,v,y,_,T=new Array(arguments.length),E=p.event.fix(r),M=(et.get(this,"events")||Object.create(null))[E.type]||[],N=p.event.special[E.type]||{};for(T[0]=E,l=1;l<arguments.length;l++)T[l]=arguments[l];if(E.delegateTarget=this,!(N.preDispatch&&N.preDispatch.call(this,E)===!1)){for(_=p.event.handlers.call(this,E,M),l=0;(v=_[l++])&&!E.isPropagationStopped();)for(E.currentTarget=v.elem,d=0;(y=v.handlers[d++])&&!E.isImmediatePropagationStopped();)(!E.rnamespace||y.namespace===!1||E.rnamespace.test(y.namespace))&&(E.handleObj=y,E.data=y.data,g=((p.event.special[y.origType]||{}).handle||y.handler).apply(v.elem,T),g!==void 0&&(E.result=g)===!1&&(E.preventDefault(),E.stopPropagation()));return N.postDispatch&&N.postDispatch.call(this,E),E.result}},handlers:function(r,l){var d,g,v,y,_,T=[],E=l.delegateCount,M=r.target;if(E&&M.nodeType&&!(r.type==="click"&&r.button>=1)){for(;M!==this;M=M.parentNode||this)if(M.nodeType===1&&!(r.type==="click"&&M.disabled===!0)){for(y=[],_={},d=0;d<E;d++)g=l[d],v=g.selector+" ",_[v]===void 0&&(_[v]=g.needsContext?p(v,this).index(M)>-1:p.find(v,this,null,[M]).length),_[v]&&y.push(g);y.length&&T.push({elem:M,handlers:y})}}return M=this,E<l.length&&T.push({elem:M,handlers:l.slice(E)}),T},addProp:function(r,l){Object.defineProperty(p.Event.prototype,r,{enumerable:!0,configurable:!0,get:w(l)?function(){if(this.originalEvent)return l(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[r]},set:function(d){Object.defineProperty(this,r,{enumerable:!0,configurable:!0,writable:!0,value:d})}})},fix:function(r){return r[p.expando]?r:new p.Event(r)},special:{load:{noBubble:!0},click:{setup:function(r){var l=this||r;return Vi.test(l.type)&&l.click&&U(l,"input")&&_s(l,"click",!0),!1},trigger:function(r){var l=this||r;return Vi.test(l.type)&&l.click&&U(l,"input")&&_s(l,"click"),!0},_default:function(r){var l=r.target;return Vi.test(l.type)&&l.click&&U(l,"input")&&et.get(l,"click")||U(l,"a")}},beforeunload:{postDispatch:function(r){r.result!==void 0&&r.originalEvent&&(r.originalEvent.returnValue=r.result)}}}};function _s(r,l,d){if(!d){et.get(r,l)===void 0&&p.event.add(r,l,Ai);return}et.set(r,l,!1),p.event.add(r,l,{namespace:!1,handler:function(g){var v,y=et.get(this,l);if(g.isTrigger&1&&this[l]){if(y)(p.event.special[l]||{}).delegateType&&g.stopPropagation();else if(y=s.call(arguments),et.set(this,l,y),this[l](),v=et.get(this,l),et.set(this,l,!1),y!==v)return g.stopImmediatePropagation(),g.preventDefault(),v}else y&&(et.set(this,l,p.event.trigger(y[0],y.slice(1),this)),g.stopPropagation(),g.isImmediatePropagationStopped=Ai)}})}p.removeEvent=function(r,l,d){r.removeEventListener&&r.removeEventListener(l,d)},p.Event=function(r,l){if(!(this instanceof p.Event))return new p.Event(r,l);r&&r.type?(this.originalEvent=r,this.type=r.type,this.isDefaultPrevented=r.defaultPrevented||r.defaultPrevented===void 0&&r.returnValue===!1?Ai:_i,this.target=r.target&&r.target.nodeType===3?r.target.parentNode:r.target,this.currentTarget=r.currentTarget,this.relatedTarget=r.relatedTarget):this.type=r,l&&p.extend(this,l),this.timeStamp=r&&r.timeStamp||Date.now(),this[p.expando]=!0},p.Event.prototype={constructor:p.Event,isDefaultPrevented:_i,isPropagationStopped:_i,isImmediatePropagationStopped:_i,isSimulated:!1,preventDefault:function(){var r=this.originalEvent;this.isDefaultPrevented=Ai,r&&!this.isSimulated&&r.preventDefault()},stopPropagation:function(){var r=this.originalEvent;this.isPropagationStopped=Ai,r&&!this.isSimulated&&r.stopPropagation()},stopImmediatePropagation:function(){var r=this.originalEvent;this.isImmediatePropagationStopped=Ai,r&&!this.isSimulated&&r.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},p.event.addProp),p.each({focus:"focusin",blur:"focusout"},function(r,l){function d(g){if(C.documentMode){var v=et.get(this,"handle"),y=p.event.fix(g);y.type=g.type==="focusin"?"focus":"blur",y.isSimulated=!0,v(g),y.target===y.currentTarget&&v(y)}else p.event.simulate(l,g.target,p.event.fix(g))}p.event.special[r]={setup:function(){var g;if(_s(this,r,!0),C.documentMode)g=et.get(this,l),g||this.addEventListener(l,d),et.set(this,l,(g||0)+1);else return!1},trigger:function(){return _s(this,r),!0},teardown:function(){var g;if(C.documentMode)g=et.get(this,l)-1,g?et.set(this,l,g):(this.removeEventListener(l,d),et.remove(this,l));else return!1},_default:function(g){return et.get(g.target,r)},delegateType:l},p.event.special[l]={setup:function(){var g=this.ownerDocument||this.document||this,v=C.documentMode?this:g,y=et.get(v,l);y||(C.documentMode?this.addEventListener(l,d):g.addEventListener(r,d,!0)),et.set(v,l,(y||0)+1)},teardown:function(){var g=this.ownerDocument||this.document||this,v=C.documentMode?this:g,y=et.get(v,l)-1;y?et.set(v,l,y):(C.documentMode?this.removeEventListener(l,d):g.removeEventListener(r,d,!0),et.remove(v,l))}}}),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(r,l){p.event.special[r]={delegateType:l,bindType:l,handle:function(d){var g,v=this,y=d.relatedTarget,_=d.handleObj;return(!y||y!==v&&!p.contains(v,y))&&(d.type=_.origType,g=_.handler.apply(this,arguments),d.type=l),g}}}),p.fn.extend({on:function(r,l,d,g){return jn(this,r,l,d,g)},one:function(r,l,d,g){return jn(this,r,l,d,g,1)},off:function(r,l,d){var g,v;if(r&&r.preventDefault&&r.handleObj)return g=r.handleObj,p(r.delegateTarget).off(g.namespace?g.origType+"."+g.namespace:g.origType,g.selector,g.handler),this;if(typeof r=="object"){for(v in r)this.off(v,l,r[v]);return this}return(l===!1||typeof l=="function")&&(d=l,l=void 0),d===!1&&(d=_i),this.each(function(){p.event.remove(this,r,d,l)})}});var Dl=/<script|<style|<link/i,Nl=/checked\s*(?:[^=]|=\s*.checked.)/i,Ol=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Za(r,l){return U(r,"table")&&U(l.nodeType!==11?l:l.firstChild,"tr")&&p(r).children("tbody")[0]||r}function Fl(r){return r.type=(r.getAttribute("type")!==null)+"/"+r.type,r}function Hl(r){return(r.type||"").slice(0,5)==="true/"?r.type=r.type.slice(5):r.removeAttribute("type"),r}function to(r,l){var d,g,v,y,_,T,E;if(l.nodeType===1){if(et.hasData(r)&&(y=et.get(r),E=y.events,E)){et.remove(l,"handle events");for(v in E)for(d=0,g=E[v].length;d<g;d++)p.event.add(l,v,E[v][d])}se.hasData(r)&&(_=se.access(r),T=p.extend({},_),se.set(l,T))}}function Bl(r,l){var d=l.nodeName.toLowerCase();d==="input"&&Vi.test(r.type)?l.checked=r.checked:(d==="input"||d==="textarea")&&(l.defaultValue=r.defaultValue)}function wi(r,l,d,g){l=n(l);var v,y,_,T,E,M,N=0,H=r.length,L=H-1,z=l[0],ot=w(z);if(ot||H>1&&typeof z=="string"&&!A.checkClone&&Nl.test(z))return r.each(function(_t){var ft=r.eq(_t);ot&&(l[0]=z.call(this,_t,ft.html())),wi(ft,l,d,g)});if(H&&(v=Qa(l,r[0].ownerDocument,!1,r,g),y=v.firstChild,v.childNodes.length===1&&(v=y),y||g)){for(_=p.map(ne(v,"script"),Fl),T=_.length;N<H;N++)E=v,N!==L&&(E=p.clone(E,!0,!0),T&&p.merge(_,ne(E,"script"))),d.call(r[N],E,N);if(T)for(M=_[_.length-1].ownerDocument,p.map(_,Hl),N=0;N<T;N++)E=_[N],Ka.test(E.type||"")&&!et.access(E,"globalEval")&&p.contains(M,E)&&(E.src&&(E.type||"").toLowerCase()!=="module"?p._evalUrl&&!E.noModule&&p._evalUrl(E.src,{nonce:E.nonce||E.getAttribute("nonce")},M):D(E.textContent.replace(Ol,""),E,M))}return r}function eo(r,l,d){for(var g,v=l?p.filter(l,r):r,y=0;(g=v[y])!=null;y++)!d&&g.nodeType===1&&p.cleanData(ne(g)),g.parentNode&&(d&&vi(g)&&Bn(ne(g,"script")),g.parentNode.removeChild(g));return r}p.extend({htmlPrefilter:function(r){return r},clone:function(r,l,d){var g,v,y,_,T=r.cloneNode(!0),E=vi(r);if(!A.noCloneChecked&&(r.nodeType===1||r.nodeType===11)&&!p.isXMLDoc(r))for(_=ne(T),y=ne(r),g=0,v=y.length;g<v;g++)Bl(y[g],_[g]);if(l)if(d)for(y=y||ne(r),_=_||ne(T),g=0,v=y.length;g<v;g++)to(y[g],_[g]);else to(r,T);return _=ne(T,"script"),_.length>0&&Bn(_,!E&&ne(r,"script")),T},cleanData:function(r){for(var l,d,g,v=p.event.special,y=0;(d=r[y])!==void 0;y++)if(Bi(d)){if(l=d[et.expando]){if(l.events)for(g in l.events)v[g]?p.event.remove(d,g):p.removeEvent(d,g,l.handle);d[et.expando]=void 0}d[se.expando]&&(d[se.expando]=void 0)}}}),p.fn.extend({detach:function(r){return eo(this,r,!0)},remove:function(r){return eo(this,r)},text:function(r){return Ne(this,function(l){return l===void 0?p.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=l)})},null,r,arguments.length)},append:function(){return wi(this,arguments,function(r){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var l=Za(this,r);l.appendChild(r)}})},prepend:function(){return wi(this,arguments,function(r){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var l=Za(this,r);l.insertBefore(r,l.firstChild)}})},before:function(){return wi(this,arguments,function(r){this.parentNode&&this.parentNode.insertBefore(r,this)})},after:function(){return wi(this,arguments,function(r){this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling)})},empty:function(){for(var r,l=0;(r=this[l])!=null;l++)r.nodeType===1&&(p.cleanData(ne(r,!1)),r.textContent="");return this},clone:function(r,l){return r=r??!1,l=l??r,this.map(function(){return p.clone(this,r,l)})},html:function(r){return Ne(this,function(l){var d=this[0]||{},g=0,v=this.length;if(l===void 0&&d.nodeType===1)return d.innerHTML;if(typeof l=="string"&&!Dl.test(l)&&!ge[(Ya.exec(l)||["",""])[1].toLowerCase()]){l=p.htmlPrefilter(l);try{for(;g<v;g++)d=this[g]||{},d.nodeType===1&&(p.cleanData(ne(d,!1)),d.innerHTML=l);d=0}catch{}}d&&this.empty().append(l)},null,r,arguments.length)},replaceWith:function(){var r=[];return wi(this,arguments,function(l){var d=this.parentNode;p.inArray(this,r)<0&&(p.cleanData(ne(this)),d&&d.replaceChild(l,this))},r)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(r,l){p.fn[r]=function(d){for(var g,v=[],y=p(d),_=y.length-1,T=0;T<=_;T++)g=T===_?this:this.clone(!0),p(y[T])[l](g),a.apply(v,g.get());return this.pushStack(v)}});var zn=new RegExp("^("+qa+")(?!px)[a-z%]+$","i"),Vn=/^--/,ws=function(r){var l=r.ownerDocument.defaultView;return(!l||!l.opener)&&(l=h),l.getComputedStyle(r)},io=function(r,l,d){var g,v,y={};for(v in l)y[v]=r.style[v],r.style[v]=l[v];g=d.call(r);for(v in l)r.style[v]=y[v];return g},jl=new RegExp(Oe.join("|"),"i");(function(){function r(){if(M){E.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",M.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ti.appendChild(E).appendChild(M);var N=h.getComputedStyle(M);d=N.top!=="1%",T=l(N.marginLeft)===12,M.style.right="60%",y=l(N.right)===36,g=l(N.width)===36,M.style.position="absolute",v=l(M.offsetWidth/3)===12,ti.removeChild(E),M=null}}function l(N){return Math.round(parseFloat(N))}var d,g,v,y,_,T,E=C.createElement("div"),M=C.createElement("div");M.style&&(M.style.backgroundClip="content-box",M.cloneNode(!0).style.backgroundClip="",A.clearCloneStyle=M.style.backgroundClip==="content-box",p.extend(A,{boxSizingReliable:function(){return r(),g},pixelBoxStyles:function(){return r(),y},pixelPosition:function(){return r(),d},reliableMarginLeft:function(){return r(),T},scrollboxSize:function(){return r(),v},reliableTrDimensions:function(){var N,H,L,z;return _==null&&(N=C.createElement("table"),H=C.createElement("tr"),L=C.createElement("div"),N.style.cssText="position:absolute;left:-11111px;border-collapse:separate",H.style.cssText="box-sizing:content-box;border:1px solid",H.style.height="1px",L.style.height="9px",L.style.display="block",ti.appendChild(N).appendChild(H).appendChild(L),z=h.getComputedStyle(H),_=parseInt(z.height,10)+parseInt(z.borderTopWidth,10)+parseInt(z.borderBottomWidth,10)===H.offsetHeight,ti.removeChild(N)),_}}))})();function $i(r,l,d){var g,v,y,_,T=Vn.test(l),E=r.style;return d=d||ws(r),d&&(_=d.getPropertyValue(l)||d[l],T&&_&&(_=_.replace(Pt,"$1")||void 0),_===""&&!vi(r)&&(_=p.style(r,l)),!A.pixelBoxStyles()&&zn.test(_)&&jl.test(l)&&(g=E.width,v=E.minWidth,y=E.maxWidth,E.minWidth=E.maxWidth=E.width=_,_=d.width,E.width=g,E.minWidth=v,E.maxWidth=y)),_!==void 0?_+"":_}function so(r,l){return{get:function(){if(r()){delete this.get;return}return(this.get=l).apply(this,arguments)}}}var no=["Webkit","Moz","ms"],ro=C.createElement("div").style,ao={};function zl(r){for(var l=r[0].toUpperCase()+r.slice(1),d=no.length;d--;)if(r=no[d]+l,r in ro)return r}function $n(r){var l=p.cssProps[r]||ao[r];return l||(r in ro?r:ao[r]=zl(r)||r)}var Vl=/^(none|table(?!-c[ea]).+)/,$l={position:"absolute",visibility:"hidden",display:"block"},oo={letterSpacing:"0",fontWeight:"400"};function lo(r,l,d){var g=zi.exec(l);return g?Math.max(0,g[2]-(d||0))+(g[3]||"px"):l}function Un(r,l,d,g,v,y){var _=l==="width"?1:0,T=0,E=0,M=0;if(d===(g?"border":"content"))return 0;for(;_<4;_+=2)d==="margin"&&(M+=p.css(r,d+Oe[_],!0,v)),g?(d==="content"&&(E-=p.css(r,"padding"+Oe[_],!0,v)),d!=="margin"&&(E-=p.css(r,"border"+Oe[_]+"Width",!0,v))):(E+=p.css(r,"padding"+Oe[_],!0,v),d!=="padding"?E+=p.css(r,"border"+Oe[_]+"Width",!0,v):T+=p.css(r,"border"+Oe[_]+"Width",!0,v));return!g&&y>=0&&(E+=Math.max(0,Math.ceil(r["offset"+l[0].toUpperCase()+l.slice(1)]-y-E-T-.5))||0),E+M}function ho(r,l,d){var g=ws(r),v=!A.boxSizingReliable()||d,y=v&&p.css(r,"boxSizing",!1,g)==="border-box",_=y,T=$i(r,l,g),E="offset"+l[0].toUpperCase()+l.slice(1);if(zn.test(T)){if(!d)return T;T="auto"}return(!A.boxSizingReliable()&&y||!A.reliableTrDimensions()&&U(r,"tr")||T==="auto"||!parseFloat(T)&&p.css(r,"display",!1,g)==="inline")&&r.getClientRects().length&&(y=p.css(r,"boxSizing",!1,g)==="border-box",_=E in r,_&&(T=r[E])),T=parseFloat(T)||0,T+Un(r,l,d||(y?"border":"content"),_,g,T)+"px"}p.extend({cssHooks:{opacity:{get:function(r,l){if(l){var d=$i(r,"opacity");return d===""?"1":d}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(r,l,d,g){if(!(!r||r.nodeType===3||r.nodeType===8||!r.style)){var v,y,_,T=Ee(l),E=Vn.test(l),M=r.style;if(E||(l=$n(T)),_=p.cssHooks[l]||p.cssHooks[T],d!==void 0){if(y=typeof d,y==="string"&&(v=zi.exec(d))&&v[1]&&(d=Wa(r,l,v),y="number"),d==null||d!==d)return;y==="number"&&!E&&(d+=v&&v[3]||(p.cssNumber[T]?"":"px")),!A.clearCloneStyle&&d===""&&l.indexOf("background")===0&&(M[l]="inherit"),(!_||!("set"in _)||(d=_.set(r,d,g))!==void 0)&&(E?M.setProperty(l,d):M[l]=d)}else return _&&"get"in _&&(v=_.get(r,!1,g))!==void 0?v:M[l]}},css:function(r,l,d,g){var v,y,_,T=Ee(l),E=Vn.test(l);return E||(l=$n(T)),_=p.cssHooks[l]||p.cssHooks[T],_&&"get"in _&&(v=_.get(r,!0,d)),v===void 0&&(v=$i(r,l,g)),v==="normal"&&l in oo&&(v=oo[l]),d===""||d?(y=parseFloat(v),d===!0||isFinite(y)?y||0:v):v}}),p.each(["height","width"],function(r,l){p.cssHooks[l]={get:function(d,g,v){if(g)return Vl.test(p.css(d,"display"))&&(!d.getClientRects().length||!d.getBoundingClientRect().width)?io(d,$l,function(){return ho(d,l,v)}):ho(d,l,v)},set:function(d,g,v){var y,_=ws(d),T=!A.scrollboxSize()&&_.position==="absolute",E=T||v,M=E&&p.css(d,"boxSizing",!1,_)==="border-box",N=v?Un(d,l,v,M,_):0;return M&&T&&(N-=Math.ceil(d["offset"+l[0].toUpperCase()+l.slice(1)]-parseFloat(_[l])-Un(d,l,"border",!1,_)-.5)),N&&(y=zi.exec(g))&&(y[3]||"px")!=="px"&&(d.style[l]=g,g=p.css(d,l)),lo(d,g,N)}}}),p.cssHooks.marginLeft=so(A.reliableMarginLeft,function(r,l){if(l)return(parseFloat($i(r,"marginLeft"))||r.getBoundingClientRect().left-io(r,{marginLeft:0},function(){return r.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(r,l){p.cssHooks[r+l]={expand:function(d){for(var g=0,v={},y=typeof d=="string"?d.split(" "):[d];g<4;g++)v[r+Oe[g]+l]=y[g]||y[g-2]||y[0];return v}},r!=="margin"&&(p.cssHooks[r+l].set=lo)}),p.fn.extend({css:function(r,l){return Ne(this,function(d,g,v){var y,_,T={},E=0;if(Array.isArray(g)){for(y=ws(d),_=g.length;E<_;E++)T[g[E]]=p.css(d,g[E],!1,y);return T}return v!==void 0?p.style(d,g,v):p.css(d,g)},r,l,arguments.length>1)}});function re(r,l,d,g,v){return new re.prototype.init(r,l,d,g,v)}p.Tween=re,re.prototype={constructor:re,init:function(r,l,d,g,v,y){this.elem=r,this.prop=d,this.easing=v||p.easing._default,this.options=l,this.start=this.now=this.cur(),this.end=g,this.unit=y||(p.cssNumber[d]?"":"px")},cur:function(){var r=re.propHooks[this.prop];return r&&r.get?r.get(this):re.propHooks._default.get(this)},run:function(r){var l,d=re.propHooks[this.prop];return this.options.duration?this.pos=l=p.easing[this.easing](r,this.options.duration*r,0,1,this.options.duration):this.pos=l=r,this.now=(this.end-this.start)*l+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),d&&d.set?d.set(this):re.propHooks._default.set(this),this}},re.prototype.init.prototype=re.prototype,re.propHooks={_default:{get:function(r){var l;return r.elem.nodeType!==1||r.elem[r.prop]!=null&&r.elem.style[r.prop]==null?r.elem[r.prop]:(l=p.css(r.elem,r.prop,""),!l||l==="auto"?0:l)},set:function(r){p.fx.step[r.prop]?p.fx.step[r.prop](r):r.elem.nodeType===1&&(p.cssHooks[r.prop]||r.elem.style[$n(r.prop)]!=null)?p.style(r.elem,r.prop,r.now+r.unit):r.elem[r.prop]=r.now}}},re.propHooks.scrollTop=re.propHooks.scrollLeft={set:function(r){r.elem.nodeType&&r.elem.parentNode&&(r.elem[r.prop]=r.now)}},p.easing={linear:function(r){return r},swing:function(r){return .5-Math.cos(r*Math.PI)/2},_default:"swing"},p.fx=re.prototype.init,p.fx.step={};var xi,xs,Ul=/^(?:toggle|show|hide)$/,Gl=/queueHooks$/;function Gn(){xs&&(C.hidden===!1&&h.requestAnimationFrame?h.requestAnimationFrame(Gn):h.setTimeout(Gn,p.fx.interval),p.fx.tick())}function co(){return h.setTimeout(function(){xi=void 0}),xi=Date.now()}function Ss(r,l){var d,g=0,v={height:r};for(l=l?1:0;g<4;g+=2-l)d=Oe[g],v["margin"+d]=v["padding"+d]=r;return l&&(v.opacity=v.width=r),v}function uo(r,l,d){for(var g,v=(ye.tweeners[l]||[]).concat(ye.tweeners["*"]),y=0,_=v.length;y<_;y++)if(g=v[y].call(d,l,r))return g}function ql(r,l,d){var g,v,y,_,T,E,M,N,H="width"in l||"height"in l,L=this,z={},ot=r.style,_t=r.nodeType&&As(r),ft=et.get(r,"fxshow");d.queue||(_=p._queueHooks(r,"fx"),_.unqueued==null&&(_.unqueued=0,T=_.empty.fire,_.empty.fire=function(){_.unqueued||T()}),_.unqueued++,L.always(function(){L.always(function(){_.unqueued--,p.queue(r,"fx").length||_.empty.fire()})}));for(g in l)if(v=l[g],Ul.test(v)){if(delete l[g],y=y||v==="toggle",v===(_t?"hide":"show"))if(v==="show"&&ft&&ft[g]!==void 0)_t=!0;else continue;z[g]=ft&&ft[g]||p.style(r,g)}if(E=!p.isEmptyObject(l),!(!E&&p.isEmptyObject(z))){H&&r.nodeType===1&&(d.overflow=[ot.overflow,ot.overflowX,ot.overflowY],M=ft&&ft.display,M==null&&(M=et.get(r,"display")),N=p.css(r,"display"),N==="none"&&(M?N=M:(yi([r],!0),M=r.style.display||M,N=p.css(r,"display"),yi([r]))),(N==="inline"||N==="inline-block"&&M!=null)&&p.css(r,"float")==="none"&&(E||(L.done(function(){ot.display=M}),M==null&&(N=ot.display,M=N==="none"?"":N)),ot.display="inline-block")),d.overflow&&(ot.overflow="hidden",L.always(function(){ot.overflow=d.overflow[0],ot.overflowX=d.overflow[1],ot.overflowY=d.overflow[2]})),E=!1;for(g in z)E||(ft?"hidden"in ft&&(_t=ft.hidden):ft=et.access(r,"fxshow",{display:M}),y&&(ft.hidden=!_t),_t&&yi([r],!0),L.done(function(){_t||yi([r]),et.remove(r,"fxshow");for(g in z)p.style(r,g,z[g])})),E=uo(_t?ft[g]:0,g,L),g in ft||(ft[g]=E.start,_t&&(E.end=E.start,E.start=0))}}function Wl(r,l){var d,g,v,y,_;for(d in r)if(g=Ee(d),v=l[g],y=r[d],Array.isArray(y)&&(v=y[1],y=r[d]=y[0]),d!==g&&(r[g]=y,delete r[d]),_=p.cssHooks[g],_&&"expand"in _){y=_.expand(y),delete r[g];for(d in y)d in r||(r[d]=y[d],l[d]=v)}else l[g]=v}function ye(r,l,d){var g,v,y=0,_=ye.prefilters.length,T=p.Deferred().always(function(){delete E.elem}),E=function(){if(v)return!1;for(var H=xi||co(),L=Math.max(0,M.startTime+M.duration-H),z=L/M.duration||0,ot=1-z,_t=0,ft=M.tweens.length;_t<ft;_t++)M.tweens[_t].run(ot);return T.notifyWith(r,[M,ot,L]),ot<1&&ft?L:(ft||T.notifyWith(r,[M,1,0]),T.resolveWith(r,[M]),!1)},M=T.promise({elem:r,props:p.extend({},l),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},d),originalProperties:l,originalOptions:d,startTime:xi||co(),duration:d.duration,tweens:[],createTween:function(H,L){var z=p.Tween(r,M.opts,H,L,M.opts.specialEasing[H]||M.opts.easing);return M.tweens.push(z),z},stop:function(H){var L=0,z=H?M.tweens.length:0;if(v)return this;for(v=!0;L<z;L++)M.tweens[L].run(1);return H?(T.notifyWith(r,[M,1,0]),T.resolveWith(r,[M,H])):T.rejectWith(r,[M,H]),this}}),N=M.props;for(Wl(N,M.opts.specialEasing);y<_;y++)if(g=ye.prefilters[y].call(M,r,N,M.opts),g)return w(g.stop)&&(p._queueHooks(M.elem,M.opts.queue).stop=g.stop.bind(g)),g;return p.map(N,uo,M),w(M.opts.start)&&M.opts.start.call(r,M),M.progress(M.opts.progress).done(M.opts.done,M.opts.complete).fail(M.opts.fail).always(M.opts.always),p.fx.timer(p.extend(E,{elem:r,anim:M,queue:M.opts.queue})),M}p.Animation=p.extend(ye,{tweeners:{"*":[function(r,l){var d=this.createTween(r,l);return Wa(d.elem,r,zi.exec(l),d),d}]},tweener:function(r,l){w(r)?(l=r,r=["*"]):r=r.match(de);for(var d,g=0,v=r.length;g<v;g++)d=r[g],ye.tweeners[d]=ye.tweeners[d]||[],ye.tweeners[d].unshift(l)},prefilters:[ql],prefilter:function(r,l){l?ye.prefilters.unshift(r):ye.prefilters.push(r)}}),p.speed=function(r,l,d){var g=r&&typeof r=="object"?p.extend({},r):{complete:d||!d&&l||w(r)&&r,duration:r,easing:d&&l||l&&!w(l)&&l};return p.fx.off?g.duration=0:typeof g.duration!="number"&&(g.duration in p.fx.speeds?g.duration=p.fx.speeds[g.duration]:g.duration=p.fx.speeds._default),(g.queue==null||g.queue===!0)&&(g.queue="fx"),g.old=g.complete,g.complete=function(){w(g.old)&&g.old.call(this),g.queue&&p.dequeue(this,g.queue)},g},p.fn.extend({fadeTo:function(r,l,d,g){return this.filter(As).css("opacity",0).show().end().animate({opacity:l},r,d,g)},animate:function(r,l,d,g){var v=p.isEmptyObject(r),y=p.speed(l,d,g),_=function(){var T=ye(this,p.extend({},r),y);(v||et.get(this,"finish"))&&T.stop(!0)};return _.finish=_,v||y.queue===!1?this.each(_):this.queue(y.queue,_)},stop:function(r,l,d){var g=function(v){var y=v.stop;delete v.stop,y(d)};return typeof r!="string"&&(d=l,l=r,r=void 0),l&&this.queue(r||"fx",[]),this.each(function(){var v=!0,y=r!=null&&r+"queueHooks",_=p.timers,T=et.get(this);if(y)T[y]&&T[y].stop&&g(T[y]);else for(y in T)T[y]&&T[y].stop&&Gl.test(y)&&g(T[y]);for(y=_.length;y--;)_[y].elem===this&&(r==null||_[y].queue===r)&&(_[y].anim.stop(d),v=!1,_.splice(y,1));(v||!d)&&p.dequeue(this,r)})},finish:function(r){return r!==!1&&(r=r||"fx"),this.each(function(){var l,d=et.get(this),g=d[r+"queue"],v=d[r+"queueHooks"],y=p.timers,_=g?g.length:0;for(d.finish=!0,p.queue(this,r,[]),v&&v.stop&&v.stop.call(this,!0),l=y.length;l--;)y[l].elem===this&&y[l].queue===r&&(y[l].anim.stop(!0),y.splice(l,1));for(l=0;l<_;l++)g[l]&&g[l].finish&&g[l].finish.call(this);delete d.finish})}}),p.each(["toggle","show","hide"],function(r,l){var d=p.fn[l];p.fn[l]=function(g,v,y){return g==null||typeof g=="boolean"?d.apply(this,arguments):this.animate(Ss(l,!0),g,v,y)}}),p.each({slideDown:Ss("show"),slideUp:Ss("hide"),slideToggle:Ss("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(r,l){p.fn[r]=function(d,g,v){return this.animate(l,d,g,v)}}),p.timers=[],p.fx.tick=function(){var r,l=0,d=p.timers;for(xi=Date.now();l<d.length;l++)r=d[l],!r()&&d[l]===r&&d.splice(l--,1);d.length||p.fx.stop(),xi=void 0},p.fx.timer=function(r){p.timers.push(r),p.fx.start()},p.fx.interval=13,p.fx.start=function(){xs||(xs=!0,Gn())},p.fx.stop=function(){xs=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(r,l){return r=p.fx&&p.fx.speeds[r]||r,l=l||"fx",this.queue(l,function(d,g){var v=h.setTimeout(d,r);g.stop=function(){h.clearTimeout(v)}})},(function(){var r=C.createElement("input"),l=C.createElement("select"),d=l.appendChild(C.createElement("option"));r.type="checkbox",A.checkOn=r.value!=="",A.optSelected=d.selected,r=C.createElement("input"),r.value="t",r.type="radio",A.radioValue=r.value==="t"})();var fo,Ui=p.expr.attrHandle;p.fn.extend({attr:function(r,l){return Ne(this,p.attr,r,l,arguments.length>1)},removeAttr:function(r){return this.each(function(){p.removeAttr(this,r)})}}),p.extend({attr:function(r,l,d){var g,v,y=r.nodeType;if(!(y===3||y===8||y===2)){if(typeof r.getAttribute>"u")return p.prop(r,l,d);if((y!==1||!p.isXMLDoc(r))&&(v=p.attrHooks[l.toLowerCase()]||(p.expr.match.bool.test(l)?fo:void 0)),d!==void 0){if(d===null){p.removeAttr(r,l);return}return v&&"set"in v&&(g=v.set(r,d,l))!==void 0?g:(r.setAttribute(l,d+""),d)}return v&&"get"in v&&(g=v.get(r,l))!==null?g:(g=p.find.attr(r,l),g??void 0)}},attrHooks:{type:{set:function(r,l){if(!A.radioValue&&l==="radio"&&U(r,"input")){var d=r.value;return r.setAttribute("type",l),d&&(r.value=d),l}}}},removeAttr:function(r,l){var d,g=0,v=l&&l.match(de);if(v&&r.nodeType===1)for(;d=v[g++];)r.removeAttribute(d)}}),fo={set:function(r,l,d){return l===!1?p.removeAttr(r,d):r.setAttribute(d,d),d}},p.each(p.expr.match.bool.source.match(/\w+/g),function(r,l){var d=Ui[l]||p.find.attr;Ui[l]=function(g,v,y){var _,T,E=v.toLowerCase();return y||(T=Ui[E],Ui[E]=_,_=d(g,v,y)!=null?E:null,Ui[E]=T),_}});var Xl=/^(?:input|select|textarea|button)$/i,Yl=/^(?:a|area)$/i;p.fn.extend({prop:function(r,l){return Ne(this,p.prop,r,l,arguments.length>1)},removeProp:function(r){return this.each(function(){delete this[p.propFix[r]||r]})}}),p.extend({prop:function(r,l,d){var g,v,y=r.nodeType;if(!(y===3||y===8||y===2))return(y!==1||!p.isXMLDoc(r))&&(l=p.propFix[l]||l,v=p.propHooks[l]),d!==void 0?v&&"set"in v&&(g=v.set(r,d,l))!==void 0?g:r[l]=d:v&&"get"in v&&(g=v.get(r,l))!==null?g:r[l]},propHooks:{tabIndex:{get:function(r){var l=p.find.attr(r,"tabindex");return l?parseInt(l,10):Xl.test(r.nodeName)||Yl.test(r.nodeName)&&r.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),A.optSelected||(p.propHooks.selected={get:function(r){var l=r.parentNode;return l&&l.parentNode&&l.parentNode.selectedIndex,null},set:function(r){var l=r.parentNode;l&&(l.selectedIndex,l.parentNode&&l.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function ei(r){var l=r.match(de)||[];return l.join(" ")}function ii(r){return r.getAttribute&&r.getAttribute("class")||""}function qn(r){return Array.isArray(r)?r:typeof r=="string"?r.match(de)||[]:[]}p.fn.extend({addClass:function(r){var l,d,g,v,y,_;return w(r)?this.each(function(T){p(this).addClass(r.call(this,T,ii(this)))}):(l=qn(r),l.length?this.each(function(){if(g=ii(this),d=this.nodeType===1&&" "+ei(g)+" ",d){for(y=0;y<l.length;y++)v=l[y],d.indexOf(" "+v+" ")<0&&(d+=v+" ");_=ei(d),g!==_&&this.setAttribute("class",_)}}):this)},removeClass:function(r){var l,d,g,v,y,_;return w(r)?this.each(function(T){p(this).removeClass(r.call(this,T,ii(this)))}):arguments.length?(l=qn(r),l.length?this.each(function(){if(g=ii(this),d=this.nodeType===1&&" "+ei(g)+" ",d){for(y=0;y<l.length;y++)for(v=l[y];d.indexOf(" "+v+" ")>-1;)d=d.replace(" "+v+" "," ");_=ei(d),g!==_&&this.setAttribute("class",_)}}):this):this.attr("class","")},toggleClass:function(r,l){var d,g,v,y,_=typeof r,T=_==="string"||Array.isArray(r);return w(r)?this.each(function(E){p(this).toggleClass(r.call(this,E,ii(this),l),l)}):typeof l=="boolean"&&T?l?this.addClass(r):this.removeClass(r):(d=qn(r),this.each(function(){if(T)for(y=p(this),v=0;v<d.length;v++)g=d[v],y.hasClass(g)?y.removeClass(g):y.addClass(g);else(r===void 0||_==="boolean")&&(g=ii(this),g&&et.set(this,"__className__",g),this.setAttribute&&this.setAttribute("class",g||r===!1?"":et.get(this,"__className__")||""))}))},hasClass:function(r){var l,d,g=0;for(l=" "+r+" ";d=this[g++];)if(d.nodeType===1&&(" "+ei(ii(d))+" ").indexOf(l)>-1)return!0;return!1}});var Kl=/\r/g;p.fn.extend({val:function(r){var l,d,g,v=this[0];return arguments.length?(g=w(r),this.each(function(y){var _;this.nodeType===1&&(g?_=r.call(this,y,p(this).val()):_=r,_==null?_="":typeof _=="number"?_+="":Array.isArray(_)&&(_=p.map(_,function(T){return T==null?"":T+""})),l=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],(!l||!("set"in l)||l.set(this,_,"value")===void 0)&&(this.value=_))})):v?(l=p.valHooks[v.type]||p.valHooks[v.nodeName.toLowerCase()],l&&"get"in l&&(d=l.get(v,"value"))!==void 0?d:(d=v.value,typeof d=="string"?d.replace(Kl,""):d??"")):void 0}}),p.extend({valHooks:{option:{get:function(r){var l=p.find.attr(r,"value");return l??ei(p.text(r))}},select:{get:function(r){var l,d,g,v=r.options,y=r.selectedIndex,_=r.type==="select-one",T=_?null:[],E=_?y+1:v.length;for(y<0?g=E:g=_?y:0;g<E;g++)if(d=v[g],(d.selected||g===y)&&!d.disabled&&(!d.parentNode.disabled||!U(d.parentNode,"optgroup"))){if(l=p(d).val(),_)return l;T.push(l)}return T},set:function(r,l){for(var d,g,v=r.options,y=p.makeArray(l),_=v.length;_--;)g=v[_],(g.selected=p.inArray(p.valHooks.option.get(g),y)>-1)&&(d=!0);return d||(r.selectedIndex=-1),y}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(r,l){if(Array.isArray(l))return r.checked=p.inArray(p(r).val(),l)>-1}},A.checkOn||(p.valHooks[this].get=function(r){return r.getAttribute("value")===null?"on":r.value})});var Gi=h.location,po={guid:Date.now()},Wn=/\?/;p.parseXML=function(r){var l,d;if(!r||typeof r!="string")return null;try{l=new h.DOMParser().parseFromString(r,"text/xml")}catch{}return d=l&&l.getElementsByTagName("parsererror")[0],(!l||d)&&p.error("Invalid XML: "+(d?p.map(d.childNodes,function(g){return g.textContent}).join(`
`):r)),l};var go=/^(?:focusinfocus|focusoutblur)$/,mo=function(r){r.stopPropagation()};p.extend(p.event,{trigger:function(r,l,d,g){var v,y,_,T,E,M,N,H,L=[d||C],z=f.call(r,"type")?r.type:r,ot=f.call(r,"namespace")?r.namespace.split("."):[];if(y=H=_=d=d||C,!(d.nodeType===3||d.nodeType===8)&&!go.test(z+p.event.triggered)&&(z.indexOf(".")>-1&&(ot=z.split("."),z=ot.shift(),ot.sort()),E=z.indexOf(":")<0&&"on"+z,r=r[p.expando]?r:new p.Event(z,typeof r=="object"&&r),r.isTrigger=g?2:3,r.namespace=ot.join("."),r.rnamespace=r.namespace?new RegExp("(^|\\.)"+ot.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,r.result=void 0,r.target||(r.target=d),l=l==null?[r]:p.makeArray(l,[r]),N=p.event.special[z]||{},!(!g&&N.trigger&&N.trigger.apply(d,l)===!1))){if(!g&&!N.noBubble&&!x(d)){for(T=N.delegateType||z,go.test(T+z)||(y=y.parentNode);y;y=y.parentNode)L.push(y),_=y;_===(d.ownerDocument||C)&&L.push(_.defaultView||_.parentWindow||h)}for(v=0;(y=L[v++])&&!r.isPropagationStopped();)H=y,r.type=v>1?T:N.bindType||z,M=(et.get(y,"events")||Object.create(null))[r.type]&&et.get(y,"handle"),M&&M.apply(y,l),M=E&&y[E],M&&M.apply&&Bi(y)&&(r.result=M.apply(y,l),r.result===!1&&r.preventDefault());return r.type=z,!g&&!r.isDefaultPrevented()&&(!N._default||N._default.apply(L.pop(),l)===!1)&&Bi(d)&&E&&w(d[z])&&!x(d)&&(_=d[E],_&&(d[E]=null),p.event.triggered=z,r.isPropagationStopped()&&H.addEventListener(z,mo),d[z](),r.isPropagationStopped()&&H.removeEventListener(z,mo),p.event.triggered=void 0,_&&(d[E]=_)),r.result}},simulate:function(r,l,d){var g=p.extend(new p.Event,d,{type:r,isSimulated:!0});p.event.trigger(g,null,l)}}),p.fn.extend({trigger:function(r,l){return this.each(function(){p.event.trigger(r,l,this)})},triggerHandler:function(r,l){var d=this[0];if(d)return p.event.trigger(r,l,d,!0)}});var Ql=/\[\]$/,bo=/\r?\n/g,Jl=/^(?:submit|button|image|reset|file)$/i,Zl=/^(?:input|select|textarea|keygen)/i;function Xn(r,l,d,g){var v;if(Array.isArray(l))p.each(l,function(y,_){d||Ql.test(r)?g(r,_):Xn(r+"["+(typeof _=="object"&&_!=null?y:"")+"]",_,d,g)});else if(!d&&O(l)==="object")for(v in l)Xn(r+"["+v+"]",l[v],d,g);else g(r,l)}p.param=function(r,l){var d,g=[],v=function(y,_){var T=w(_)?_():_;g[g.length]=encodeURIComponent(y)+"="+encodeURIComponent(T??"")};if(r==null)return"";if(Array.isArray(r)||r.jquery&&!p.isPlainObject(r))p.each(r,function(){v(this.name,this.value)});else for(d in r)Xn(d,r[d],l,v);return g.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var r=p.prop(this,"elements");return r?p.makeArray(r):this}).filter(function(){var r=this.type;return this.name&&!p(this).is(":disabled")&&Zl.test(this.nodeName)&&!Jl.test(r)&&(this.checked||!Vi.test(r))}).map(function(r,l){var d=p(this).val();return d==null?null:Array.isArray(d)?p.map(d,function(g){return{name:l.name,value:g.replace(bo,`\r
`)}}):{name:l.name,value:d.replace(bo,`\r
`)}}).get()}});var th=/%20/g,eh=/#.*$/,ih=/([?&])_=[^&]*/,sh=/^(.*?):[ \t]*([^\r\n]*)$/mg,nh=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rh=/^(?:GET|HEAD)$/,ah=/^\/\//,vo={},Yn={},yo="*/".concat("*"),Kn=C.createElement("a");Kn.href=Gi.href;function Ao(r){return function(l,d){typeof l!="string"&&(d=l,l="*");var g,v=0,y=l.toLowerCase().match(de)||[];if(w(d))for(;g=y[v++];)g[0]==="+"?(g=g.slice(1)||"*",(r[g]=r[g]||[]).unshift(d)):(r[g]=r[g]||[]).push(d)}}function _o(r,l,d,g){var v={},y=r===Yn;function _(T){var E;return v[T]=!0,p.each(r[T]||[],function(M,N){var H=N(l,d,g);if(typeof H=="string"&&!y&&!v[H])return l.dataTypes.unshift(H),_(H),!1;if(y)return!(E=H)}),E}return _(l.dataTypes[0])||!v["*"]&&_("*")}function Qn(r,l){var d,g,v=p.ajaxSettings.flatOptions||{};for(d in l)l[d]!==void 0&&((v[d]?r:g||(g={}))[d]=l[d]);return g&&p.extend(!0,r,g),r}function oh(r,l,d){for(var g,v,y,_,T=r.contents,E=r.dataTypes;E[0]==="*";)E.shift(),g===void 0&&(g=r.mimeType||l.getResponseHeader("Content-Type"));if(g){for(v in T)if(T[v]&&T[v].test(g)){E.unshift(v);break}}if(E[0]in d)y=E[0];else{for(v in d){if(!E[0]||r.converters[v+" "+E[0]]){y=v;break}_||(_=v)}y=y||_}if(y)return y!==E[0]&&E.unshift(y),d[y]}function lh(r,l,d,g){var v,y,_,T,E,M={},N=r.dataTypes.slice();if(N[1])for(_ in r.converters)M[_.toLowerCase()]=r.converters[_];for(y=N.shift();y;)if(r.responseFields[y]&&(d[r.responseFields[y]]=l),!E&&g&&r.dataFilter&&(l=r.dataFilter(l,r.dataType)),E=y,y=N.shift(),y){if(y==="*")y=E;else if(E!=="*"&&E!==y){if(_=M[E+" "+y]||M["* "+y],!_){for(v in M)if(T=v.split(" "),T[1]===y&&(_=M[E+" "+T[0]]||M["* "+T[0]],_)){_===!0?_=M[v]:M[v]!==!0&&(y=T[0],N.unshift(T[1]));break}}if(_!==!0)if(_&&r.throws)l=_(l);else try{l=_(l)}catch(H){return{state:"parsererror",error:_?H:"No conversion from "+E+" to "+y}}}}return{state:"success",data:l}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Gi.href,type:"GET",isLocal:nh.test(Gi.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":yo,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(r,l){return l?Qn(Qn(r,p.ajaxSettings),l):Qn(p.ajaxSettings,r)},ajaxPrefilter:Ao(vo),ajaxTransport:Ao(Yn),ajax:function(r,l){typeof r=="object"&&(l=r,r=void 0),l=l||{};var d,g,v,y,_,T,E,M,N,H,L=p.ajaxSetup({},l),z=L.context||L,ot=L.context&&(z.nodeType||z.jquery)?p(z):p.event,_t=p.Deferred(),ft=p.Callbacks("once memory"),qt=L.statusCode||{},Vt={},Ce={},Te="canceled",vt={readyState:0,getResponseHeader:function(wt){var Ot;if(E){if(!y)for(y={};Ot=sh.exec(v);)y[Ot[1].toLowerCase()+" "]=(y[Ot[1].toLowerCase()+" "]||[]).concat(Ot[2]);Ot=y[wt.toLowerCase()+" "]}return Ot==null?null:Ot.join(", ")},getAllResponseHeaders:function(){return E?v:null},setRequestHeader:function(wt,Ot){return E==null&&(wt=Ce[wt.toLowerCase()]=Ce[wt.toLowerCase()]||wt,Vt[wt]=Ot),this},overrideMimeType:function(wt){return E==null&&(L.mimeType=wt),this},statusCode:function(wt){var Ot;if(wt)if(E)vt.always(wt[vt.status]);else for(Ot in wt)qt[Ot]=[qt[Ot],wt[Ot]];return this},abort:function(wt){var Ot=wt||Te;return d&&d.abort(Ot),si(0,Ot),this}};if(_t.promise(vt),L.url=((r||L.url||Gi.href)+"").replace(ah,Gi.protocol+"//"),L.type=l.method||l.type||L.method||L.type,L.dataTypes=(L.dataType||"*").toLowerCase().match(de)||[""],L.crossDomain==null){T=C.createElement("a");try{T.href=L.url,T.href=T.href,L.crossDomain=Kn.protocol+"//"+Kn.host!=T.protocol+"//"+T.host}catch{L.crossDomain=!0}}if(L.data&&L.processData&&typeof L.data!="string"&&(L.data=p.param(L.data,L.traditional)),_o(vo,L,l,vt),E)return vt;M=p.event&&L.global,M&&p.active++===0&&p.event.trigger("ajaxStart"),L.type=L.type.toUpperCase(),L.hasContent=!rh.test(L.type),g=L.url.replace(eh,""),L.hasContent?L.data&&L.processData&&(L.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(L.data=L.data.replace(th,"+")):(H=L.url.slice(g.length),L.data&&(L.processData||typeof L.data=="string")&&(g+=(Wn.test(g)?"&":"?")+L.data,delete L.data),L.cache===!1&&(g=g.replace(ih,"$1"),H=(Wn.test(g)?"&":"?")+"_="+po.guid+++H),L.url=g+H),L.ifModified&&(p.lastModified[g]&&vt.setRequestHeader("If-Modified-Since",p.lastModified[g]),p.etag[g]&&vt.setRequestHeader("If-None-Match",p.etag[g])),(L.data&&L.hasContent&&L.contentType!==!1||l.contentType)&&vt.setRequestHeader("Content-Type",L.contentType),vt.setRequestHeader("Accept",L.dataTypes[0]&&L.accepts[L.dataTypes[0]]?L.accepts[L.dataTypes[0]]+(L.dataTypes[0]!=="*"?", "+yo+"; q=0.01":""):L.accepts["*"]);for(N in L.headers)vt.setRequestHeader(N,L.headers[N]);if(L.beforeSend&&(L.beforeSend.call(z,vt,L)===!1||E))return vt.abort();if(Te="abort",ft.add(L.complete),vt.done(L.success),vt.fail(L.error),d=_o(Yn,L,l,vt),!d)si(-1,"No Transport");else{if(vt.readyState=1,M&&ot.trigger("ajaxSend",[vt,L]),E)return vt;L.async&&L.timeout>0&&(_=h.setTimeout(function(){vt.abort("timeout")},L.timeout));try{E=!1,d.send(Vt,si)}catch(wt){if(E)throw wt;si(-1,wt)}}function si(wt,Ot,Wi,Zn){var ke,Xi,Pe,Ge,qe,me=Ot;E||(E=!0,_&&h.clearTimeout(_),d=void 0,v=Zn||"",vt.readyState=wt>0?4:0,ke=wt>=200&&wt<300||wt===304,Wi&&(Ge=oh(L,vt,Wi)),!ke&&p.inArray("script",L.dataTypes)>-1&&p.inArray("json",L.dataTypes)<0&&(L.converters["text script"]=function(){}),Ge=lh(L,Ge,vt,ke),ke?(L.ifModified&&(qe=vt.getResponseHeader("Last-Modified"),qe&&(p.lastModified[g]=qe),qe=vt.getResponseHeader("etag"),qe&&(p.etag[g]=qe)),wt===204||L.type==="HEAD"?me="nocontent":wt===304?me="notmodified":(me=Ge.state,Xi=Ge.data,Pe=Ge.error,ke=!Pe)):(Pe=me,(wt||!me)&&(me="error",wt<0&&(wt=0))),vt.status=wt,vt.statusText=(Ot||me)+"",ke?_t.resolveWith(z,[Xi,me,vt]):_t.rejectWith(z,[vt,me,Pe]),vt.statusCode(qt),qt=void 0,M&&ot.trigger(ke?"ajaxSuccess":"ajaxError",[vt,L,ke?Xi:Pe]),ft.fireWith(z,[vt,me]),M&&(ot.trigger("ajaxComplete",[vt,L]),--p.active||p.event.trigger("ajaxStop")))}return vt},getJSON:function(r,l,d){return p.get(r,l,d,"json")},getScript:function(r,l){return p.get(r,void 0,l,"script")}}),p.each(["get","post"],function(r,l){p[l]=function(d,g,v,y){return w(g)&&(y=y||v,v=g,g=void 0),p.ajax(p.extend({url:d,type:l,dataType:y,data:g,success:v},p.isPlainObject(d)&&d))}}),p.ajaxPrefilter(function(r){var l;for(l in r.headers)l.toLowerCase()==="content-type"&&(r.contentType=r.headers[l]||"")}),p._evalUrl=function(r,l,d){return p.ajax({url:r,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(g){p.globalEval(g,l,d)}})},p.fn.extend({wrapAll:function(r){var l;return this[0]&&(w(r)&&(r=r.call(this[0])),l=p(r,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&l.insertBefore(this[0]),l.map(function(){for(var d=this;d.firstElementChild;)d=d.firstElementChild;return d}).append(this)),this},wrapInner:function(r){return w(r)?this.each(function(l){p(this).wrapInner(r.call(this,l))}):this.each(function(){var l=p(this),d=l.contents();d.length?d.wrapAll(r):l.append(r)})},wrap:function(r){var l=w(r);return this.each(function(d){p(this).wrapAll(l?r.call(this,d):r)})},unwrap:function(r){return this.parent(r).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(r){return!p.expr.pseudos.visible(r)},p.expr.pseudos.visible=function(r){return!!(r.offsetWidth||r.offsetHeight||r.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new h.XMLHttpRequest}catch{}};var hh={0:200,1223:204},qi=p.ajaxSettings.xhr();A.cors=!!qi&&"withCredentials"in qi,A.ajax=qi=!!qi,p.ajaxTransport(function(r){var l,d;if(A.cors||qi&&!r.crossDomain)return{send:function(g,v){var y,_=r.xhr();if(_.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(y in r.xhrFields)_[y]=r.xhrFields[y];r.mimeType&&_.overrideMimeType&&_.overrideMimeType(r.mimeType),!r.crossDomain&&!g["X-Requested-With"]&&(g["X-Requested-With"]="XMLHttpRequest");for(y in g)_.setRequestHeader(y,g[y]);l=function(T){return function(){l&&(l=d=_.onload=_.onerror=_.onabort=_.ontimeout=_.onreadystatechange=null,T==="abort"?_.abort():T==="error"?typeof _.status!="number"?v(0,"error"):v(_.status,_.statusText):v(hh[_.status]||_.status,_.statusText,(_.responseType||"text")!=="text"||typeof _.responseText!="string"?{binary:_.response}:{text:_.responseText},_.getAllResponseHeaders()))}},_.onload=l(),d=_.onerror=_.ontimeout=l("error"),_.onabort!==void 0?_.onabort=d:_.onreadystatechange=function(){_.readyState===4&&h.setTimeout(function(){l&&d()})},l=l("abort");try{_.send(r.hasContent&&r.data||null)}catch(T){if(l)throw T}},abort:function(){l&&l()}}}),p.ajaxPrefilter(function(r){r.crossDomain&&(r.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(r){return p.globalEval(r),r}}}),p.ajaxPrefilter("script",function(r){r.cache===void 0&&(r.cache=!1),r.crossDomain&&(r.type="GET")}),p.ajaxTransport("script",function(r){if(r.crossDomain||r.scriptAttrs){var l,d;return{send:function(g,v){l=p("<script>").attr(r.scriptAttrs||{}).prop({charset:r.scriptCharset,src:r.url}).on("load error",d=function(y){l.remove(),d=null,y&&v(y.type==="error"?404:200,y.type)}),C.head.appendChild(l[0])},abort:function(){d&&d()}}}});var wo=[],Jn=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var r=wo.pop()||p.expando+"_"+po.guid++;return this[r]=!0,r}}),p.ajaxPrefilter("json jsonp",function(r,l,d){var g,v,y,_=r.jsonp!==!1&&(Jn.test(r.url)?"url":typeof r.data=="string"&&(r.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Jn.test(r.data)&&"data");if(_||r.dataTypes[0]==="jsonp")return g=r.jsonpCallback=w(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,_?r[_]=r[_].replace(Jn,"$1"+g):r.jsonp!==!1&&(r.url+=(Wn.test(r.url)?"&":"?")+r.jsonp+"="+g),r.converters["script json"]=function(){return y||p.error(g+" was not called"),y[0]},r.dataTypes[0]="json",v=h[g],h[g]=function(){y=arguments},d.always(function(){v===void 0?p(h).removeProp(g):h[g]=v,r[g]&&(r.jsonpCallback=l.jsonpCallback,wo.push(g)),y&&w(v)&&v(y[0]),y=v=void 0}),"script"}),A.createHTMLDocument=(function(){var r=C.implementation.createHTMLDocument("").body;return r.innerHTML="<form></form><form></form>",r.childNodes.length===2})(),p.parseHTML=function(r,l,d){if(typeof r!="string")return[];typeof l=="boolean"&&(d=l,l=!1);var g,v,y;return l||(A.createHTMLDocument?(l=C.implementation.createHTMLDocument(""),g=l.createElement("base"),g.href=C.location.href,l.head.appendChild(g)):l=C),v=Zt.exec(r),y=!d&&[],v?[l.createElement(v[1])]:(v=Qa([r],l,y),y&&y.length&&p(y).remove(),p.merge([],v.childNodes))},p.fn.load=function(r,l,d){var g,v,y,_=this,T=r.indexOf(" ");return T>-1&&(g=ei(r.slice(T)),r=r.slice(0,T)),w(l)?(d=l,l=void 0):l&&typeof l=="object"&&(v="POST"),_.length>0&&p.ajax({url:r,type:v||"GET",dataType:"html",data:l}).done(function(E){y=arguments,_.html(g?p("<div>").append(p.parseHTML(E)).find(g):E)}).always(d&&function(E,M){_.each(function(){d.apply(this,y||[E.responseText,M,E])})}),this},p.expr.pseudos.animated=function(r){return p.grep(p.timers,function(l){return r===l.elem}).length},p.offset={setOffset:function(r,l,d){var g,v,y,_,T,E,M,N=p.css(r,"position"),H=p(r),L={};N==="static"&&(r.style.position="relative"),T=H.offset(),y=p.css(r,"top"),E=p.css(r,"left"),M=(N==="absolute"||N==="fixed")&&(y+E).indexOf("auto")>-1,M?(g=H.position(),_=g.top,v=g.left):(_=parseFloat(y)||0,v=parseFloat(E)||0),w(l)&&(l=l.call(r,d,p.extend({},T))),l.top!=null&&(L.top=l.top-T.top+_),l.left!=null&&(L.left=l.left-T.left+v),"using"in l?l.using.call(r,L):H.css(L)}},p.fn.extend({offset:function(r){if(arguments.length)return r===void 0?this:this.each(function(v){p.offset.setOffset(this,r,v)});var l,d,g=this[0];if(g)return g.getClientRects().length?(l=g.getBoundingClientRect(),d=g.ownerDocument.defaultView,{top:l.top+d.pageYOffset,left:l.left+d.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var r,l,d,g=this[0],v={top:0,left:0};if(p.css(g,"position")==="fixed")l=g.getBoundingClientRect();else{for(l=this.offset(),d=g.ownerDocument,r=g.offsetParent||d.documentElement;r&&(r===d.body||r===d.documentElement)&&p.css(r,"position")==="static";)r=r.parentNode;r&&r!==g&&r.nodeType===1&&(v=p(r).offset(),v.top+=p.css(r,"borderTopWidth",!0),v.left+=p.css(r,"borderLeftWidth",!0))}return{top:l.top-v.top-p.css(g,"marginTop",!0),left:l.left-v.left-p.css(g,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var r=this.offsetParent;r&&p.css(r,"position")==="static";)r=r.offsetParent;return r||ti})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(r,l){var d=l==="pageYOffset";p.fn[r]=function(g){return Ne(this,function(v,y,_){var T;if(x(v)?T=v:v.nodeType===9&&(T=v.defaultView),_===void 0)return T?T[l]:v[y];T?T.scrollTo(d?T.pageXOffset:_,d?_:T.pageYOffset):v[y]=_},r,g,arguments.length)}}),p.each(["top","left"],function(r,l){p.cssHooks[l]=so(A.pixelPosition,function(d,g){if(g)return g=$i(d,l),zn.test(g)?p(d).position()[l]+"px":g})}),p.each({Height:"height",Width:"width"},function(r,l){p.each({padding:"inner"+r,content:l,"":"outer"+r},function(d,g){p.fn[g]=function(v,y){var _=arguments.length&&(d||typeof v!="boolean"),T=d||(v===!0||y===!0?"margin":"border");return Ne(this,function(E,M,N){var H;return x(E)?g.indexOf("outer")===0?E["inner"+r]:E.document.documentElement["client"+r]:E.nodeType===9?(H=E.documentElement,Math.max(E.body["scroll"+r],H["scroll"+r],E.body["offset"+r],H["offset"+r],H["client"+r])):N===void 0?p.css(E,M,T):p.style(E,M,N,T)},l,_?v:void 0,_)}})}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(r,l){p.fn[l]=function(d){return this.on(l,d)}}),p.fn.extend({bind:function(r,l,d){return this.on(r,null,l,d)},unbind:function(r,l){return this.off(r,null,l)},delegate:function(r,l,d,g){return this.on(l,r,d,g)},undelegate:function(r,l,d){return arguments.length===1?this.off(r,"**"):this.off(l,r||"**",d)},hover:function(r,l){return this.on("mouseenter",r).on("mouseleave",l||r)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(r,l){p.fn[l]=function(d,g){return arguments.length>0?this.on(l,null,d,g):this.trigger(l)}});var ch=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;p.proxy=function(r,l){var d,g,v;if(typeof l=="string"&&(d=r[l],l=r,r=d),!!w(r))return g=s.call(arguments,2),v=function(){return r.apply(l||this,g.concat(s.call(arguments)))},v.guid=r.guid=r.guid||p.guid++,v},p.holdReady=function(r){r?p.readyWait++:p.ready(!0)},p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=U,p.isFunction=w,p.isWindow=x,p.camelCase=Ee,p.type=O,p.now=Date.now,p.isNumeric=function(r){var l=p.type(r);return(l==="number"||l==="string")&&!isNaN(r-parseFloat(r))},p.trim=function(r){return r==null?"":(r+"").replace(ch,"$1")},typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var uh=h.jQuery,dh=h.$;return p.noConflict=function(r){return h.$===p&&(h.$=dh),r&&h.jQuery===p&&(h.jQuery=uh),p},typeof t>"u"&&(h.jQuery=h.$=p),p})});var ai=class ai{constructor(t){this.http=t;this.ruta=Pi.ruta}listar(t){let e=new Fo;return t?.categoria&&(e=e.set("categoria",String(t.categoria))),t?.visibilidad&&(e=e.set("visibilidad",String(t.visibilidad))),t?.institucion_id&&(e=e.set("institucion_id",String(t.institucion_id))),this.http.get(this.ruta+"api/bibliotecaarchivoslcch",{params:e})}seleccionar(t){return this.http.get(this.ruta+"api/bibliotecaarchivoslcch/"+t)}crear(t){return this.http.post(this.ruta+"api/bibliotecaarchivoslcch",t)}modificar(t,e){return this.http.put(this.ruta+"api/bibliotecaarchivoslcch/"+t,e)}eliminar(t){return this.http.delete(this.ruta+"api/bibliotecaarchivoslcch/"+t)}};ai.\u0275fac=function(e){return new(e||ai)(Po(Os))},ai.\u0275prov=ko({token:ai,factory:ai.\u0275fac,providedIn:"root"});var Mi=ai;function Ch(h,t){if(h&1&&(J(0,"div",31)(1,"div",32)(2,"div",33),it(3),W()()()),h&2){let e=It();ct(2),Mo("width",e.uploadProgress,"%"),ct(),Ds("",e.uploadProgress,"%")}}function Th(h,t){h&1&&(J(0,"div",34),it(1,"Cargando..."),W())}function kh(h,t){h&1&&(J(0,"div",35),it(1," Sin documentos registrados. "),W())}function Ph(h,t){if(h&1){let e=ki();J(0,"tr")(1,"td")(2,"div",40),it(3),W(),J(4,"div",41),it(5),W()(),J(6,"td"),it(7),W(),J(8,"td"),it(9),W(),J(10,"td"),it(11),W(),J(12,"td",38)(13,"button",42),Ft("click",function(){let s=Ut(e).$implicit,n=It(2);return Gt(n.ver(s))}),it(14,"Ver"),W(),J(15,"button",43),Ft("click",function(){let s=Ut(e).$implicit,n=It(2);return Gt(n.editar(s))}),it(16,"Editar"),W(),J(17,"button",44),Ft("click",function(){let s=Ut(e).$implicit,n=It(2);return Gt(n.eliminar(s))}),it(18,"Eliminar"),W()()()}if(h&2){let e=t.$implicit;ct(3),ze(e.nombre_documento),ct(2),ze(e.publicado_por),ct(2),ze(e.categoria),ct(2),ze(e.fecha),ct(2),ze(e.visibilidad)}}function Mh(h,t){if(h&1&&(J(0,"div",36)(1,"table",37)(2,"thead")(3,"tr")(4,"th"),it(5,"Nombre"),W(),J(6,"th"),it(7,"Categor\xEDa"),W(),J(8,"th"),it(9,"Fecha"),W(),J(10,"th"),it(11,"Vis."),W(),J(12,"th",38),it(13,"Acciones"),W()()(),J(14,"tbody"),Xe(15,Ph,19,5,"tr",39),W()()()),h&2){let e=It();ct(15),xt("ngForOf",e.items)}}var Ri=class Ri{constructor(t,e,i){this.api=t;this.tools=e;this.router=i;this.ruta=Pi.ruta;this.items=[];this.isLoading=!1;this.uploadProgress=null;this.form=new zo({id:new _e(0,{nonNullable:!0}),categoria:new _e(""),nombre_documento:new _e("",{nonNullable:!0,validators:[fr.required]}),fecha:new _e(""),archivo:new _e("",{nonNullable:!0,validators:[fr.required]}),estado:new _e("ACTIVO"),visibilidad:new _e("VISIBLE"),publicado_por:new _e(""),dirigido:new _e(""),descripcion:new _e("")});this.cargar()}cargar(){this.isLoading=!0,this.api.listar().subscribe({next:t=>{this.items=t?.data??[],this.isLoading=!1},error:t=>{console.error(t),this.isLoading=!1,this.tools.MostrarMensaje("error","Error al cargar biblioteca")}})}limpiarForm(){this.form.reset({id:0,categoria:"",nombre_documento:"",fecha:"",archivo:"",estado:"ACTIVO",visibilidad:"VISIBLE",publicado_por:"",dirigido:"",descripcion:""}),this.uploadProgress=null}editar(t){this.form.patchValue({id:t.id,categoria:t.categoria??"",nombre_documento:t.nombre_documento??"",fecha:t.fecha??"",archivo:t.archivo??"",estado:t.estado??"ACTIVO",visibilidad:t.visibilidad??"VISIBLE",publicado_por:t.publicado_por??"",dirigido:t.dirigido??"",descripcion:t.descripcion??""})}eliminar(t){return Y(this,null,function*(){(yield this.tools.mostrarMensajeConfirm("Eliminar","\xBFEliminar este documento?","warning","S\xED, eliminar"))&&this.api.eliminar(t.id).subscribe({next:()=>{t.archivo&&this.tools.EliminarArchivo(t.archivo),this.tools.MostrarMensaje("success","Eliminado"),this.cargar(),this.form.value.id===t.id&&this.limpiarForm()},error:i=>{console.error(i),this.tools.MostrarMensaje("error","Error al eliminar")}})})}ver(t){this.router.navigate(["/gestioninstitucion/visor-biblioteca",t.id])}onFileSelected(t){let i=t.target.files?.[0];if(i){if(!i.name.toLowerCase().endsWith(".pdf")){this.tools.MostrarMensaje("warning","Solo se permite PDF");return}this.uploadProgress=0,this.tools.SubirArchivo(i,"bibliotecaPdf").subscribe({next:s=>{if(s.type===ur.UploadProgress){let n=s.total??0;n>0&&(this.uploadProgress=Math.round(s.loaded/n*100))}if(s.type===ur.Response){let a=s.body?.filePath;a&&(this.form.patchValue({archivo:String(a)}),this.tools.MostrarMensaje("success","PDF subido")),this.uploadProgress=null}},error:s=>{console.error(s),this.uploadProgress=null,this.tools.MostrarMensaje("error","Error al subir PDF")}})}}guardar(){if(this.form.invalid){this.tools.MostrarMensajeFrmIncompleto();return}let t=Number(this.form.value.id??0),e={categoria:this.form.value.categoria??null,nombre_documento:this.form.value.nombre_documento??null,fecha:this.form.value.fecha??null,archivo:this.form.value.archivo??null,estado:this.form.value.estado??null,visibilidad:this.form.value.visibilidad??null,publicado_por:this.form.value.publicado_por??null,dirigido:this.form.value.dirigido??null,descripcion:this.form.value.descripcion??null};if(!t){this.api.crear(e).subscribe({next:()=>{this.tools.MostrarMensaje("success","Guardado"),this.limpiarForm(),this.cargar()},error:i=>{console.error(i),this.tools.MostrarMensaje("error","Error al guardar")}});return}this.api.modificar(t,e).subscribe({next:()=>{this.tools.MostrarMensaje("success","Actualizado"),this.limpiarForm(),this.cargar()},error:i=>{console.error(i),this.tools.MostrarMensaje("error","Error al actualizar")}})}};Ri.\u0275fac=function(e){return new(e||Ri)(je(Mi),je(Wo),je(Fs))},Ri.\u0275cmp=Ls({type:Ri,selectors:[["app-bibliotecaarchivoslcch"]],standalone:!1,decls:69,vars:13,consts:[[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"row","g-3"],[1,"col-12","col-lg-4"],[1,"card"],[1,"card-body"],[1,"mb-2"],[1,"form-label"],["placeholder","Ej: Reglamentos",1,"form-control",3,"formControl"],[1,"form-control",3,"formControl"],["type","date",1,"form-control",3,"formControl"],["placeholder","Ej: Estudiantes / Docentes",1,"form-control",3,"formControl"],["rows","3",1,"form-control",3,"formControl"],[1,"row","g-2"],[1,"col-6"],[1,"form-select",3,"formControl"],["value","ACTIVO"],["value","INACTIVO"],["value","VISIBLE"],["value","OCULTO"],["type","file","accept","application/pdf",1,"form-control",3,"change"],["class","mt-2",4,"ngIf"],[1,"mb-3"],["placeholder","Se llena al subir",1,"form-control",3,"formControl"],[1,"btn","btn-primary","w-100",3,"click"],[1,"col-12","col-lg-8"],["class","text-center py-4",4,"ngIf"],["class","text-center py-4 text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"mt-2"],[1,"progress"],["role","progressbar",1,"progress-bar"],[1,"text-center","py-4"],[1,"text-center","py-4","text-muted"],[1,"table-responsive"],[1,"table","table-sm","align-middle"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"fw-semibold"],[1,"small","text-muted"],[1,"btn","btn-outline-primary","btn-sm","me-1",3,"click"],[1,"btn","btn-outline-secondary","btn-sm","me-1",3,"click"],[1,"btn","btn-outline-danger","btn-sm",3,"click"]],template:function(e,i){e&1&&(J(0,"div",0)(1,"div",1)(2,"h5",2),it(3,"Biblioteca digital (PDF)"),W(),J(4,"button",3),Ft("click",function(){return i.limpiarForm()}),it(5,"Nuevo"),W()(),J(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"label",9),it(12,"Categor\xEDa"),W(),ee(13,"input",10),W(),J(14,"div",8)(15,"label",9),it(16,"Nombre del documento *"),W(),ee(17,"input",11),W(),J(18,"div",8)(19,"label",9),it(20,"Fecha"),W(),ee(21,"input",12),W(),J(22,"div",8)(23,"label",9),it(24,"Publicado por"),W(),ee(25,"input",11),W(),J(26,"div",8)(27,"label",9),it(28,"Dirigido"),W(),ee(29,"input",13),W(),J(30,"div",8)(31,"label",9),it(32,"Descripci\xF3n"),W(),ee(33,"textarea",14),W(),J(34,"div",15)(35,"div",16)(36,"label",9),it(37,"Estado"),W(),J(38,"select",17)(39,"option",18),it(40,"ACTIVO"),W(),J(41,"option",19),it(42,"INACTIVO"),W()()(),J(43,"div",16)(44,"label",9),it(45,"Visibilidad"),W(),J(46,"select",17)(47,"option",20),it(48,"VISIBLE"),W(),J(49,"option",21),it(50,"OCULTO"),W()()()(),ee(51,"hr"),J(52,"div",8)(53,"label",9),it(54,"PDF (subir)"),W(),J(55,"input",22),Ft("change",function(n){return i.onFileSelected(n)}),W(),Xe(56,Ch,4,3,"div",23),W(),J(57,"div",24)(58,"label",9),it(59,"Ruta del archivo *"),W(),ee(60,"input",25),W(),J(61,"button",26),Ft("click",function(){return i.guardar()}),it(62,"Guardar"),W()()()(),J(63,"div",27)(64,"div",6)(65,"div",7),Xe(66,Th,2,0,"div",28)(67,kh,2,0,"div",29)(68,Mh,16,1,"div",30),W()()()()()),e&2&&(ct(13),xt("formControl",i.form.controls.categoria),ct(4),xt("formControl",i.form.controls.nombre_documento),ct(4),xt("formControl",i.form.controls.fecha),ct(4),xt("formControl",i.form.controls.publicado_por),ct(4),xt("formControl",i.form.controls.dirigido),ct(4),xt("formControl",i.form.controls.descripcion),ct(5),xt("formControl",i.form.controls.estado),ct(8),xt("formControl",i.form.controls.visibilidad),ct(10),xt("ngIf",i.uploadProgress!==null),ct(4),xt("formControl",i.form.controls.archivo),ct(6),xt("ngIf",i.isLoading),ct(),xt("ngIf",!i.isLoading&&i.items.length===0),ct(),xt("ngIf",!i.isLoading&&i.items.length>0))},dependencies:[Do,Ns,Uo,Go,Bo,$o,jo,Vo],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.progress-bar[_ngcontent-%COMP%]{transition:width .2s ease}"]});var Bs=Ri;var $a=_h(Qo());var es={};es.d=(h,t)=>{for(var e in t)es.o(t,e)&&!es.o(h,e)&&Object.defineProperty(h,e,{enumerable:!0,get:t[e]})};es.o=(h,t)=>Object.prototype.hasOwnProperty.call(h,t);var lt=globalThis.pdfjsLib={};es.d(lt,{AbortException:()=>De,AnnotationEditorLayer:()=>Tc,AnnotationEditorParamsType:()=>At,AnnotationEditorType:()=>ut,AnnotationEditorUIManager:()=>os,AnnotationLayer:()=>ka,AnnotationMode:()=>Ye,ColorPicker:()=>xn,DOMSVGFactory:()=>ds,DrawLayer:()=>Fa,FeatureTest:()=>Wt,GlobalWorkerOptions:()=>ci,ImageKind:()=>qs,InvalidPDFException:()=>ss,MissingPDFException:()=>ui,OPS:()=>we,OutputScale:()=>as,PDFDataRangeTransport:()=>un,PDFDateString:()=>Qs,PDFWorker:()=>Di,PasswordResponses:()=>Nh,PermissionFlag:()=>Dh,PixelsPerInch:()=>Qe,RenderingCancelledException:()=>rs,TextLayer:()=>cs,TouchManager:()=>Zs,UnexpectedResponseException:()=>Fi,Util:()=>tt,VerbosityLevel:()=>Tn,XfaLayer:()=>pn,build:()=>Sc,createValidAbsoluteUrl:()=>Bh,fetchData:()=>Rn,getDocument:()=>Ac,getFilenameFromUrl:()=>Wh,getPdfFilenameFromUrl:()=>Xh,getXfaPageViewport:()=>Yh,isDataScheme:()=>Ln,isPdfFile:()=>ja,noContextMenu:()=>xe,normalizeUnicode:()=>Uh,setLayerDimensions:()=>di,shadow:()=>gt,stopEvent:()=>pe,version:()=>xc});var Jt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),fl=[1,0,0,1,0,0],yr=[.001,0,0,.001,0,0],Rh=1e7,Gs=1.35,Lh=.35,Wc=Lh/Gs,fe={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ye={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Ih="pdfjs_internal_editor_",ut={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},At={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Dh={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Kt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},qs={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},$t={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Ki={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var Tn={ERRORS:0,WARNINGS:1,INFOS:5},we={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Nh={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},kn=Tn.WARNINGS;function Oh(h){Number.isInteger(h)&&(kn=h)}function Fh(){return kn}function Pn(h){kn>=Tn.INFOS&&console.log(`Info: ${h}`)}function dt(h){kn>=Tn.WARNINGS&&console.log(`Warning: ${h}`)}function Ct(h){throw new Error(h)}function jt(h,t){h||Ct(t)}function Hh(h){switch(h?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Bh(h,t=null,e=null){if(!h)return null;try{if(e&&typeof h=="string"&&(e.addDefaultProtocol&&h.startsWith("www.")&&h.match(/\./g)?.length>=2&&(h=`http://${h}`),e.tryConvertEncoding))try{h=$h(h)}catch{}let i=t?new URL(h,t):new URL(h);if(Hh(i))return i}catch{}return null}function gt(h,t,e,i=!1){return Object.defineProperty(h,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}var Je=(function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t})(),Ys=class extends Je{constructor(t,e){super(t,"PasswordException"),this.code=e}},is=class extends Je{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}},ss=class extends Je{constructor(t){super(t,"InvalidPDFException")}},ui=class extends Je{constructor(t){super(t,"MissingPDFException")}},Fi=class extends Je{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}},Ar=class extends Je{constructor(t){super(t,"FormatError")}},De=class extends Je{constructor(t){super(t,"AbortException")}};function pl(h){(typeof h!="object"||h?.length===void 0)&&Ct("Invalid argument for bytesToString");let t=h.length,e=8192;if(t<e)return String.fromCharCode.apply(null,h);let i=[];for(let s=0;s<t;s+=e){let n=Math.min(s+e,t),a=h.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function Mn(h){typeof h!="string"&&Ct("Invalid argument for stringToBytes");let t=h.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=h.charCodeAt(i)&255;return e}function jh(h){return String.fromCharCode(h>>24&255,h>>16&255,h>>8&255,h&255)}function Ha(h){let t=Object.create(null);for(let[e,i]of h)t[e]=i;return t}function zh(){let h=new Uint8Array(4);return h[0]=1,new Uint32Array(h.buffer,0,1)[0]===1}function Vh(){try{return new Function(""),!0}catch{return!1}}var Wt=class{static get isLittleEndian(){return gt(this,"isLittleEndian",zh())}static get isEvalSupported(){return gt(this,"isEvalSupported",Vh())}static get isOffscreenCanvasSupported(){return gt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return gt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?gt(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):gt(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return gt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},pr=Array.from(Array(256).keys(),h=>h.toString(16).padStart(2,"0")),tt=class{static makeHexColor(t,e,i){return`#${pr[t]}${pr[e]}${pr[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){let i=t[0]*e[0]+t[1]*e[2]+e[4],s=t[0]*e[1]+t[1]*e[3]+e[5];return[i,s]}static applyInverseTransform(t,e){let i=e[0]*e[3]-e[1]*e[2],s=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[s,n]}static getAxialAlignedBoundingBox(t,e){let i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),n=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}static inverseTransform(t){let e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){let e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],o=(i+a)/2,c=Math.sqrt((i+a)**2-4*(i*a-n*s))/2,u=o+c||1,f=o-c||1;return[Math.sqrt(u),Math.sqrt(f)]}static normalizeRect(t){let e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){let i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;let n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[i,n,s,a]}static#t(t,e,i,s,n,a,o,c,u,f){if(u<=0||u>=1)return;let m=1-u,b=u*u,A=b*u,w=m*(m*(m*t+3*u*e)+3*b*i)+A*s,x=m*(m*(m*n+3*u*a)+3*b*o)+A*c;f[0]=Math.min(f[0],w),f[1]=Math.min(f[1],x),f[2]=Math.max(f[2],w),f[3]=Math.max(f[3],x)}static#e(t,e,i,s,n,a,o,c,u,f,m,b){if(Math.abs(u)<1e-12){Math.abs(f)>=1e-12&&this.#t(t,e,i,s,n,a,o,c,-m/f,b);return}let A=f**2-4*m*u;if(A<0)return;let w=Math.sqrt(A),x=2*u;this.#t(t,e,i,s,n,a,o,c,(-f+w)/x,b),this.#t(t,e,i,s,n,a,o,c,(-f-w)/x,b)}static bezierBoundingBox(t,e,i,s,n,a,o,c,u){return u?(u[0]=Math.min(u[0],t,o),u[1]=Math.min(u[1],e,c),u[2]=Math.max(u[2],t,o),u[3]=Math.max(u[3],e,c)):u=[Math.min(t,o),Math.min(e,c),Math.max(t,o),Math.max(e,c)],this.#e(t,i,n,o,e,s,a,c,3*(-t+3*(i-n)+o),6*(t-2*i+n),3*(i-t),u),this.#e(t,i,n,o,e,s,a,c,3*(-e+3*(s-a)+c),6*(e-2*s+a),3*(s-e),u),u}};function $h(h){return decodeURIComponent(escape(h))}var gr=null,Jo=null;function Uh(h){return gr||(gr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Jo=new Map([["\uFB05","\u017Ft"]])),h.replaceAll(gr,(t,e,i)=>e?e.normalize("NFKC"):Jo.get(i))}function Gh(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let h=new Uint8Array(32);return crypto.getRandomValues(h),pl(h)}var Ba="pdfjs_internal_id_";function qh(h){return Uint8Array.prototype.toBase64?h.toBase64():btoa(pl(h))}typeof Promise.try!="function"&&(Promise.try=function(h,...t){return new Promise(e=>{e(h(...t))})});var Ve="http://www.w3.org/2000/svg",Qe=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function Rn(h,t="text"){return Y(this,null,function*(){if(ts(h,document.baseURI)){let e=yield fetch(h);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{let s=new XMLHttpRequest;s.open("GET",h,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})})}var ns=class h{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=a,i*=e;let c=(t[2]+t[0])/2,u=(t[3]+t[1])/2,f,m,b,A;switch(s%=360,s<0&&(s+=360),s){case 180:f=-1,m=0,b=0,A=1;break;case 90:f=0,m=1,b=1,A=0;break;case 270:f=0,m=-1,b=-1,A=0;break;case 0:f=1,m=0,b=0,A=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(b=-b,A=-A);let w,x,C,k;f===0?(w=Math.abs(u-t[1])*i+n,x=Math.abs(c-t[0])*i+a,C=(t[3]-t[1])*i,k=(t[2]-t[0])*i):(w=Math.abs(c-t[0])*i+n,x=Math.abs(u-t[1])*i+a,C=(t[2]-t[0])*i,k=(t[3]-t[1])*i),this.transform=[f*i,m*i,b*i,A*i,w-f*i*c-b*i*u,x-m*i*c-A*i*u],this.width=C,this.height=k}get rawDims(){let{userUnit:t,viewBox:e}=this,i=e.map(s=>s*t);return gt(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new h({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){return tt.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){let e=tt.applyTransform([t[0],t[1]],this.transform),i=tt.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return tt.applyInverseTransform([t,e],this.transform)}},rs=class extends Je{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}};function Ln(h){let t=h.length,e=0;for(;e<t&&h[e].trim()==="";)e++;return h.substring(e,e+5).toLowerCase()==="data:"}function ja(h){return typeof h=="string"&&/\.pdf$/i.test(h)}function Wh(h){return[h]=h.split(/[#?]/,1),h.substring(h.lastIndexOf("/")+1)}function Xh(h,t="document.pdf"){if(typeof h!="string")return t;if(Ln(h))return dt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=e.exec(h),n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||t}var Ks=class{started=Object.create(null);times=[];time(t){t in this.started&&dt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||dt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){let t=[],e=0;for(let{name:i}of this.times)e=Math.max(i.length,e);for(let{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}};function ts(h,t){try{let{protocol:e}=t?new URL(h,t):new URL(h);return e==="http:"||e==="https:"}catch{return!1}}function xe(h){h.preventDefault()}function pe(h){h.preventDefault(),h.stopPropagation()}var Qs=class{static#t;static toDateObject(t){if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let e=this.#t.exec(t);if(!e)return null;let i=parseInt(e[1],10),s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let c=parseInt(e[6],10);c=c>=0&&c<=59?c:0;let u=e[7]||"Z",f=parseInt(e[8],10);f=f>=0&&f<=23?f:0;let m=parseInt(e[9],10)||0;return m=m>=0&&m<=59?m:0,u==="-"?(a+=f,o+=m):u==="+"&&(a-=f,o-=m),new Date(Date.UTC(i,s,n,a,o,c))}};function Yh(h,{scale:t=1,rotation:e=0}){let{width:i,height:s}=h.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new ns({viewBox:n,userUnit:1,scale:t,rotation:e})}function za(h){if(h.startsWith("#")){let t=parseInt(h.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return h.startsWith("rgb(")?h.slice(4,-1).split(",").map(t=>parseInt(t)):h.startsWith("rgba(")?h.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(dt(`Not a valid color format: "${h}"`),[0,0,0])}function Kh(h){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let e of h.keys()){t.style.color=e;let i=window.getComputedStyle(t).color;h.set(e,za(i))}t.remove()}function Rt(h){let{a:t,b:e,c:i,d:s,e:n,f:a}=h.getTransform();return[t,e,i,s,n,a]}function Le(h){let{a:t,b:e,c:i,d:s,e:n,f:a}=h.getTransform().invertSelf();return[t,e,i,s,n,a]}function di(h,t,e=!1,i=!0){if(t instanceof ns){let{pageWidth:s,pageHeight:n}=t.rawDims,{style:a}=h,o=Wt.isCSSRoundSupported,c=`var(--scale-factor) * ${s}px`,u=`var(--scale-factor) * ${n}px`,f=o?`round(down, ${c}, var(--scale-round-x, 1px))`:`calc(${c})`,m=o?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!e||t.rotation%180===0?(a.width=f,a.height=m):(a.width=m,a.height=f)}i&&h.setAttribute("data-main-rotation",t.rotation)}var as=class{constructor(){let t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},_r=class h{#t=null;#e=null;#i;#s=null;#r=null;static#n=null;constructor(t){this.#i=t,h.#n||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");let e=this.#i._uiManager._signal;t.addEventListener("contextmenu",xe,{signal:e}),t.addEventListener("pointerdown",h.#l,{signal:e});let i=this.#s=document.createElement("div");i.className="buttons",t.append(i);let s=this.#i.toolbarPosition;if(s){let{style:n}=t,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#d(),t}get div(){return this.#t}static#l(t){t.stopPropagation()}#o(t){this.#i._focusEventsAllowed=!1,pe(t)}#c(t){this.#i._focusEventsAllowed=!0,pe(t)}#h(t){let e=this.#i._uiManager._signal;t.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#c.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",xe,{signal:e})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#d(){let{editorType:t,_uiManager:e}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",h.#n[t]),this.#h(i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#s.append(i)}get#u(){let t=document.createElement("div");return t.className="divider",t}addAltText(t){return Y(this,null,function*(){let e=yield t.render();this.#h(e),this.#s.prepend(e,this.#u),this.#r=t})}addColorPicker(t){this.#e=t;let e=t.renderButton();this.#h(e),this.#s.prepend(e,this.#u)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}},wr=class{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){let t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",xe,{signal:this.#i._signal});let e=this.#t=document.createElement("div");return e.className="buttons",t.append(e),this.#n(),t}#r(t,e){let i=0,s=0;for(let n of t){let a=n.y+n.height;if(a<i)continue;let o=n.x+(e?n.width:0);if(a>i){s=o,i=a;continue}e?o>s&&(s=o):o<s&&(s=o)}return[e?1-s:s,i]}show(t,e,i){let[s,n]=this.#r(e,i),{style:a}=this.#e||=this.#s();t.append(this.#e),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(){let t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let i=this.#i._signal;t.addEventListener("contextmenu",xe,{signal:i}),t.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#t.append(t)}};function Js(h,t,e){for(let i of e)t.addEventListener(i,h[i].bind(h))}var xr=class{#t=0;get id(){return`${Ih}${this.#t++}`}},Sr=class h{#t=Gh();#e=0;#i=null;static get _isSVGFittingCanvas(){let t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;let n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return gt(this,"_isSVGFittingCanvas",n)}#s(t,e){return Y(this,null,function*(){this.#i||=new Map;let i=this.#i.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(i.url=e,s=yield Rn(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){let n=h._isSVGFittingCanvas,a=new FileReader,o=new Image,c=new Promise((u,f)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,u()},a.onload=()=>Y(this,null,function*(){let m=i.svgUrl=a.result;o.src=(yield n)?`${m}#svgView(preserveAspectRatio(none))`:m}),o.onerror=a.onerror=f});a.readAsDataURL(s),yield c}else i.bitmap=yield createImageBitmap(s);i.refCounter=1}catch(s){dt(s),i=null}return this.#i.set(t,i),i&&this.#i.set(i.id,i),i})}getFromFile(t){return Y(this,null,function*(){let{lastModified:e,name:i,size:s,type:n}=t;return this.#s(`${e}_${i}_${s}_${n}`,t)})}getFromUrl(t){return Y(this,null,function*(){return this.#s(t,t)})}getFromBlob(t,e){return Y(this,null,function*(){let i=yield e;return this.#s(t,i)})}getFromId(t){return Y(this,null,function*(){this.#i||=new Map;let e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){let{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)})}getFromCanvas(t,e){this.#i||=new Map;let i=this.#i.get(t);if(i?.bitmap)return i.refCounter+=1,i;let s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,i),this.#i.set(i.id,i),i}getSvgUrl(t){let e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;let e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;let{bitmap:i}=e;if(!e.url&&!e.file){let s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=s.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}},Er=class{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(s&&t(),this.#e)return;let c={cmd:t,undo:e,post:i,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(c);return}if(a&&this.#t[this.#s].type===n){o&&(c.undo=this.#t[this.#s].undo),this.#t[this.#s]=c;return}let u=this.#s+1;u===this.#i?this.#t.splice(0,1):(this.#s=u,u<this.#t.length&&this.#t.splice(u)),this.#t.push(c)}undo(){if(this.#s===-1)return;this.#e=!0;let{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;let{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}},fi=class{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:e}=Wt.platform;for(let[i,s,n={}]of t)for(let a of i){let o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);let e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;let i=this.callbacks.get(this.#t(e));if(!i)return;let{callback:s,options:{bubbles:n=!1,args:a=[],checker:o=null}}=i;o&&!o(t,e)||(s.bind(t,...a,e)(),n||pe(e))}},Cr=class h{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let t=new Map([["CanvasText",null],["Canvas",null]]);return Kh(t),gt(this,"_colors",t)}convert(t){let e=za(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(let[i,s]of this._colors)if(s.every((n,a)=>n===e[a]))return h._colorsMapping.get(i);return e}getHexCode(t){let e=this._colors.get(t);return e?tt.makeHexColor(...e):t}},os=(()=>{class h{#t=new AbortController;#e=null;#i=new Map;#s=new Map;#r=null;#n=null;#l=null;#o=new Er;#c=null;#h=null;#d=0;#u=new Set;#f=null;#a=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#b=!1;#A=null;#v=null;#_=null;#x=null;#E=!1;#T=null;#P=new xr;#w=!1;#k=!1;#C=null;#R=null;#D=null;#O=null;#S=ut.NONE;#y=new Set;#I=null;#z=null;#V=null;#$={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#F=[0,0];#N=null;#H=null;#U=null;#L=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let e=h.prototype,i=o=>o.#H.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:c})=>{if(c instanceof HTMLInputElement){let{type:u}=c;return u!=="text"&&u!=="number"}return!0},n=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return gt(this,"_keyboardManager",new fi([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&o.#H.contains(c)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&o.#H.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:i}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:i}]]))}constructor(e,i,s,n,a,o,c,u,f,m,b,A,w){let x=this._signal=this.#t.signal;this.#H=e,this.#U=i,this.#r=s,this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:x}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:x}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:x}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:x}),n._on("setpreference",this.onSetPreference.bind(this),{signal:x}),n._on("switchannotationeditorparams",C=>this.updateParams(C.type,C.value),{signal:x}),this.#et(),this.#rt(),this.#X(),this.#n=a.annotationStorage,this.#A=a.filterFactory,this.#z=o,this.#x=c||null,this.#m=u,this.#g=f,this.#b=m,this.#O=b||null,this.viewParameters={realScale:Qe.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=A||null,this._supportsPinchToZoom=w!==!1}destroy(){this.#L?.resolve(),this.#L=null,this.#t?.abort(),this.#t=null,this._signal=null;for(let e of this.#s.values())e.destroy();this.#s.clear(),this.#i.clear(),this.#p.clear(),this.#e=null,this.#y.clear(),this.#o.destroy(),this.#r?.destroy(),this.#T?.hide(),this.#T=null,this.#v&&(clearTimeout(this.#v),this.#v=null),this.#N&&(clearTimeout(this.#N),this.#N=null),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#O}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return gt(this,"hcmFilter",this.#z?this.#A.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return gt(this,"direction",getComputedStyle(this.#H).direction)}get highlightColors(){return gt(this,"highlightColors",this.#x?new Map(this.#x.split(",").map(e=>e.split("=").map(i=>i.trim()))):null)}get highlightColorNames(){return gt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=e}setMainHighlightColorPicker(e){this.#D=e}editAltText(e,i=!1){this.#r?.editAltText(this,e,i)}switchToMode(e,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,i){this._eventBus.dispatch("setpreference",{source:this,name:e,value:i})}onSetPreference({name:e,value:i}){switch(e){case"enableNewAltTextWhenAddingImage":this.#b=i;break}}onPageChanging({pageNumber:e}){this.#d=e-1}focusMainContainer(){this.#H.focus()}findParent(e,i){for(let s of this.#s.values()){let{x:n,y:a,width:o,height:c}=s.div.getBoundingClientRect();if(e>=n&&e<=n+o&&i>=a&&i<=a+c)return s}return null}disableUserSelect(e=!1){this.#U.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Qe.PDF_TO_CSS_UNITS;for(let i of this.#p)i.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#B({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#W(e){let{currentLayer:i}=this;if(i.hasTextLayer(e))return i;for(let s of this.#s.values())if(s.hasTextLayer(e))return s;return null}highlightSelection(e=""){let i=document.getSelection();if(!i||i.isCollapsed)return;let{anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o}=i,c=i.toString(),f=this.#B(i).closest(".textLayer"),m=this.getSelectionBoxes(f);if(!m)return;i.empty();let b=this.#W(f),A=this.#S===ut.NONE,w=()=>{b?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:m,anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o,text:c}),A&&this.showAllEditors("highlight",!0,!0)};if(A){this.switchToMode(ut.HIGHLIGHT,w);return}w()}#Z(){let e=document.getSelection();if(!e||e.isCollapsed)return;let s=this.#B(e).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#T||=new wr(this),this.#T.show(s,n,this.direction==="ltr"))}addToAnnotationStorage(e){!e.isEmpty()&&this.#n&&!this.#n.has(e.id)&&this.#n.setValue(e.id,e)}#tt(){let e=document.getSelection();if(!e||e.isCollapsed){this.#I&&(this.#T?.hide(),this.#I=null,this.#M({hasSelectedText:!1}));return}let{anchorNode:i}=e;if(i===this.#I)return;let n=this.#B(e).closest(".textLayer");if(!n){this.#I&&(this.#T?.hide(),this.#I=null,this.#M({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#I=i,this.#M({hasSelectedText:!0}),!(this.#S!==ut.HIGHLIGHT&&this.#S!==ut.NONE)&&(this.#S===ut.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){let a=this.#S===ut.HIGHLIGHT?this.#W(n):null;a?.toggleDrawing();let o=new AbortController,c=this.combinedSignal(o),u=f=>{f.type==="pointerup"&&f.button!==0||(o.abort(),a?.toggleDrawing(!0),f.type==="pointerup"&&this.#q("main_toolbar"))};window.addEventListener("pointerup",u,{signal:c}),window.addEventListener("blur",u,{signal:c})}}#q(e=""){this.#S===ut.HIGHLIGHT?this.highlightSelection(e):this.#m&&this.#Z()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#it(){if(this.#_)return;this.#_=new AbortController;let e=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#st(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#q("main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let i of this.#y)if(i.div.contains(e)){this.#R=[i,e],i._focusEventsAllowed=!1;break}}focus(){if(!this.#R)return;let[e,i]=this.#R;this.#R=null,i.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#X(){if(this.#C)return;this.#C=new AbortController;let e=this.combinedSignal(this.#C);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#nt(){this.#C?.abort(),this.#C=null}#Y(){if(this.#c)return;this.#c=new AbortController;let e=this.combinedSignal(this.#c);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#K(){this.#c?.abort(),this.#c=null}#rt(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#X(),this.#Y()}removeEditListeners(){this.#nt(),this.#K()}dragOver(e){for(let{type:i}of e.dataTransfer.items)for(let s of this.#a)if(s.isHandlingMimeForPasting(i)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let i of e.dataTransfer.items)for(let s of this.#a)if(s.isHandlingMimeForPasting(i.type)){s.paste(i,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;let i=[];for(let s of this.#y){let n=s.serialize(!0);n&&i.push(n)}i.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(e){this.copy(e),this.delete()}paste(e){return Y(this,null,function*(){e.preventDefault();let{clipboardData:i}=e;for(let a of i.items)for(let o of this.#a)if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let s=i.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(a){dt(`paste: "${a.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();let n=this.currentLayer;try{let a=[];for(let u of s){let f=yield n.deserialize(u);if(!f)return;a.push(f)}let o=()=>{for(let u of a)this.#Q(u);this.#J(a)},c=()=>{for(let u of a)u.remove()};this.addCommands({cmd:o,undo:c,mustExec:!0})}catch(a){dt(`paste: "${a.message}".`)}})}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#S!==ut.NONE&&!this.isEditorHandlingKeyboard&&h._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#q("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#M(e){Object.entries(e).some(([s,n])=>this.#$[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#$,e)}),this.#S===ut.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#j([[At.HIGHLIGHT_FREE,!0]]))}#j(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#it(),this.#Y(),this.#M({isEditing:this.#S!==ut.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#st(),this.#K(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#a){this.#a=e;for(let i of this.#a)this.#j(i.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#s.get(this.#d)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#d}addLayer(e){this.#s.set(e.pageIndex,e),this.#w?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}updateMode(e,i=null,s=!1){return Y(this,null,function*(){if(this.#S!==e&&!(this.#L&&(yield this.#L.promise,!this.#L))){if(this.#L=Promise.withResolvers(),this.#S=e,e===ut.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#L.resolve();return}this.setEditingState(!0),yield this.#at(),this.unselectAll();for(let n of this.#s.values())n.updateMode(e);if(!i){s&&this.addNewEditorFromKeyboard(),this.#L.resolve();return}for(let n of this.#i.values())n.annotationElementId===i?(this.setSelected(n),n.enterInEditMode()):n.unselect();this.#L.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#S&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,i){if(this.#a){switch(e){case At.CREATE:this.currentLayer.addNewEditor();return;case At.HIGHLIGHT_DEFAULT_COLOR:this.#D?.updateColor(i);break;case At.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#V||=new Map).set(e,i),this.showAllEditors("highlight",i);break}for(let s of this.#y)s.updateParams(e,i);for(let s of this.#a)s.updateDefaultParams(e,i)}}showAllEditors(e,i,s=!1){for(let a of this.#i.values())a.editorType===e&&a.show(i);(this.#V?.get(At.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#j([[At.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(e=!1){if(this.#k!==e){this.#k=e;for(let i of this.#s.values())e?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",e)}}#at(){return Y(this,null,function*(){if(!this.#w){this.#w=!0;let e=[];for(let i of this.#s.values())e.push(i.enable());yield Promise.all(e);for(let i of this.#i.values())i.enable()}})}#ot(){if(this.unselectAll(),this.#w){this.#w=!1;for(let e of this.#s.values())e.disable();for(let e of this.#i.values())e.disable()}}getEditors(e){let i=[];for(let s of this.#i.values())s.pageIndex===e&&i.push(s);return i}getEditor(e){return this.#i.get(e)}addEditor(e){this.#i.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.focusMainContainer(),this.#v=null},0)),this.#i.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#u.has(e.annotationElementId))&&this.#n?.remove(e.id)}addDeletedAnnotationElement(e){this.#u.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#u.has(e)}removeDeletedAnnotationElement(e){this.#u.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#Q(e){let i=this.#s.get(e.pageIndex);i?i.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#e!==e&&(this.#e=e,e&&this.#j(e.propertiesToUpdate))}get#lt(){let e=null;for(e of this.#y);return e}updateUI(e){this.#lt===e&&this.#j(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#j(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#y.has(e)){this.#y.delete(e),e.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#y.add(e),e.select(),this.#j(e.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(e){this.#h?.commitOrRemove();for(let i of this.#y)i!==e&&i.unselect();this.#y.clear(),this.#y.add(e),e.select(),this.#j(e.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(e){return this.#y.has(e)}get firstSelectedEditor(){return this.#y.values().next().value}unselect(e){e.unselect(),this.#y.delete(e),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#y.size!==0}get isEnterHandled(){return this.#y.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#M({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(e){this.#o.add(e),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}cleanUndoStack(e){this.#o.cleanType(e)}#G(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(let e of this.#i.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let i=e?[e]:[...this.#y],s=()=>{this._editorUndoBar?.show(n,i.length===1?i[0].editorType:i.length);for(let a of i)a.remove()},n=()=>{for(let a of i)this.#Q(a)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#J(e){for(let i of this.#y)i.unselect();this.#y.clear();for(let i of e)i.isEmpty()||(this.#y.add(i),i.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(let e of this.#y)e.commit();this.#J(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#S!==ut.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(let e of this.#y)e.unselect();this.#y.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(e,i,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#F[0]+=e,this.#F[1]+=i;let[n,a]=this.#F,o=[...this.#y],c=1e3;this.#N&&clearTimeout(this.#N),this.#N=setTimeout(()=>{this.#N=null,this.#F[0]=this.#F[1]=0,this.addCommands({cmd:()=>{for(let u of o)this.#i.has(u.id)&&u.translateInPage(n,a)},undo:()=>{for(let u of o)this.#i.has(u.id)&&u.translateInPage(-n,-a)},mustExec:!1})},c);for(let u of o)u.translateInPage(e,i)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(let e of this.#y)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);let e=this.#f;this.#f=null;let i=!1;for(let[{x:n,y:a,pageIndex:o},c]of e)c.newX=n,c.newY=a,c.newPageIndex=o,i||=n!==c.savedX||a!==c.savedY||o!==c.savedPageIndex;if(!i)return!1;let s=(n,a,o,c)=>{if(this.#i.has(n.id)){let u=this.#s.get(c);u?n._setParentAndPosition(u,a,o):(n.pageIndex=c,n.x=a,n.y=o)}};return this.addCommands({cmd:()=>{for(let[n,{newX:a,newY:o,newPageIndex:c}]of e)s(n,a,o,c)},undo:()=>{for(let[n,{savedX:a,savedY:o,savedPageIndex:c}]of e)s(n,a,o,c)},mustExec:!0}),!0}dragSelectedEditors(e,i){if(this.#f)for(let s of this.#f.keys())s.drag(e,i)}rebuild(e){if(e.parent===null){let i=this.getLayer(e.pageIndex);i?(i.changeParent(e),i.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#y.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#e===e}getActive(){return this.#e}getMode(){return this.#S}get imageManager(){return gt(this,"imageManager",new Sr)}getSelectionBoxes(e){if(!e)return null;let i=document.getSelection();for(let f=0,m=i.rangeCount;f<m;f++)if(!e.contains(i.getRangeAt(f).commonAncestorContainer))return null;let{x:s,y:n,width:a,height:o}=e.getBoundingClientRect(),c;switch(e.getAttribute("data-main-rotation")){case"90":c=(f,m,b,A)=>({x:(m-n)/o,y:1-(f+b-s)/a,width:A/o,height:b/a});break;case"180":c=(f,m,b,A)=>({x:1-(f+b-s)/a,y:1-(m+A-n)/o,width:b/a,height:A/o});break;case"270":c=(f,m,b,A)=>({x:1-(m+A-n)/o,y:(f-s)/a,width:A/o,height:b/a});break;default:c=(f,m,b,A)=>({x:(f-s)/a,y:(m-n)/o,width:b/a,height:A/o});break}let u=[];for(let f=0,m=i.rangeCount;f<m;f++){let b=i.getRangeAt(f);if(!b.collapsed)for(let{x:A,y:w,width:x,height:C}of b.getClientRects())x===0||C===0||u.push(c(A,w,x,C))}return u.length===0?null:u}addChangedExistingAnnotation({annotationElementId:e,id:i}){(this.#l||=new Map).set(e,i)}removeChangedExistingAnnotation({annotationElementId:e}){this.#l?.delete(e)}renderAnnotationElement(e){let i=this.#l?.get(e.data.id);if(!i)return;let s=this.#n.getRawValue(i);s&&(this.#S===ut.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}}return h})(),Zo=(()=>{class h{#t=null;#e=!1;#i=null;#s=null;#r=null;#n=null;#l=!1;#o=null;#c=null;#h=null;#d=null;#u=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#u=e._uiManager.useNewAltTextFlow,h.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){h._l10n??=e}render(){return Y(this,null,function*(){let e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";let i=this.#s=document.createElement("span");e.append(i),this.#u?(e.classList.add("new"),e.setAttribute("data-l10n-id",h.#f.missing),i.setAttribute("data-l10n-id",h.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let s=this.#c._uiManager._signal;e.addEventListener("contextmenu",xe,{signal:s}),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:s});let n=a=>{a.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#u&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a}})};return e.addEventListener("click",n,{capture:!0,signal:s}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#l=!0,n(a))},{signal:s}),yield this.#p(),e})}get#a(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#u?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#u?this.#t!==null||!!this.#h:this.isEmpty()}get guessedText(){return this.#h}setGuessedText(e){return Y(this,null,function*(){this.#t===null&&(this.#h=e,this.#d=yield h._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())})}toggleAltTextBadge(e=!1){if(!this.#u||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){let i=this.#o=document.createElement("div");i.className="noAltTextBadge",this.#c.div.append(i)}this.#o.classList.toggle("hidden",!e)}serialize(e){let i=this.#t;return!e&&this.#h===i&&(i=this.#d),{altText:i,decorative:this.#e,guessedText:this.#h,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:e,decorative:i,guessedText:s,textWithDisclaimer:n,cancel:a=!1}){s&&(this.#h=s,this.#d=n),!(this.#t===e&&this.#e===i)&&(a||(this.#t=e,this.#e=i),this.#p())}toggle(e=!1){this.#i&&(!e&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#r=null,this.#o?.remove(),this.#o=null}#p(){return Y(this,null,function*(){let e=this.#i;if(!e)return;if(this.#u){if(e.classList.toggle("done",!!this.#t),e.setAttribute("data-l10n-id",h.#f[this.#a]),this.#s?.setAttribute("data-l10n-id",h.#f[`${this.#a}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=this.#r;if(!i){this.#r=i=document.createElement("span"),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${this.#c.id}`;let n=100,a=this.#c._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:a}),e.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:a})}this.#e?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=this.#t),i.parentNode||e.append(i),this.#c.getImageForAltText()?.setAttribute("aria-describedby",i.id)})}}return h})(),Zs=class h{#t;#e=!1;#i=null;#s;#r;#n;#l;#o;#c=null;#h;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){this.#t=t,this.#i=i,this.#s=e,this.#r=s,this.#n=n,this.#l=a,this.#h=new AbortController,this.#o=AbortSignal.any([o,this.#h.signal]),t.addEventListener("touchstart",this.#u.bind(this),{passive:!1,signal:this.#o})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return gt(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#u(t){if(this.#s?.()||t.touches.length<2)return;if(!this.#d){this.#d=new AbortController;let s=AbortSignal.any([this.#o,this.#d.signal]),n=this.#t,a={signal:s,passive:!1};n.addEventListener("touchmove",this.#f.bind(this),a),n.addEventListener("touchend",this.#a.bind(this),a),n.addEventListener("touchcancel",this.#a.bind(this),a),this.#r?.()}if(pe(t),t.touches.length!==2||this.#i?.()){this.#c=null;return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),this.#c={touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#f(t){if(!this.#c||t.touches.length!==2)return;let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);let{screenX:s,screenY:n}=e,{screenX:a,screenY:o}=i,c=this.#c,{touch0X:u,touch0Y:f,touch1X:m,touch1Y:b}=c,A=m-u,w=b-f,x=a-s,C=o-n,k=Math.hypot(x,C)||1,D=Math.hypot(A,w)||1;if(!this.#e&&Math.abs(D-k)<=h.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=s,c.touch0Y=n,c.touch1X=a,c.touch1Y=o,t.preventDefault(),!this.#e){this.#e=!0;return}let O=[(s+a)/2,(n+o)/2];this.#n?.(O,D,k)}#a(t){this.#d.abort(),this.#d=null,this.#l?.(),this.#c&&(t.preventDefault(),this.#c=null,this.#e=!1)}destroy(){this.#h?.abort(),this.#h=null}},Dt=class h{#t=null;#e=null;#i=null;#s=!1;#r=null;#n="";#l=!1;#o=null;#c=null;#h=null;#d=null;#u="";#f=!1;#a=null;#p=!1;#m=!1;#g=!1;#b=null;#A=0;#v=0;#_=null;#x=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#T=h._zIndex++;static _borderLineWidth=-1;static _colorManager=new Cr;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let t=h.prototype._resizeWithKeyboard,e=os.TRANSLATE_SMALL,i=os.TRANSLATE_BIG;return gt(this,"_resizerKeyboardManager",new fi([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],h.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;let{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];let[o,c]=this.parentDimensions;this.x=t.x/o,this.y=t.y/c,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return gt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){let e=new Tr({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(h._l10n??=t,h._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),h._borderLineWidth!==-1)return;let i=getComputedStyle(document.documentElement);h._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Ct("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(t){this.#E=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){let[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#B(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){let[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/a,this.fixAndSetPosition()}#P([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#P(this.parentDimensions,t,e)}translateInPage(t,e){this.#a||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#a||=[this.x,this.y,this.width,this.height];let{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:m,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,m,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this,[c,u]=this.getBaseTranslation();a+=c,o+=u;let{style:f}=i;f.left=`${(100*a).toFixed(2)}%`,f.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#a&&(this.#a[0]!==this.x||this.#a[1]!==this.y)}get _hasBeenResized(){return!!this.#a&&(this.#a[2]!==this.width||this.#a[3]!==this.height)}getBaseTranslation(){let[t,e]=this.parentDimensions,{_borderLineWidth:i}=h,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){let{div:{style:e},pageDimensions:[i,s]}=this,{x:n,y:a,width:o,height:c}=this;if(o*=i,c*=s,n*=i,a*=s,this._mustFixPosition)switch(t){case 0:n=Math.max(0,Math.min(i-o,n)),a=Math.max(0,Math.min(s-c,a));break;case 90:n=Math.max(0,Math.min(i-c,n)),a=Math.min(s,Math.max(o,a));break;case 180:n=Math.min(i,Math.max(o,n)),a=Math.min(s,Math.max(c,a));break;case 270:n=Math.min(i,Math.max(c,n)),a=Math.max(0,Math.min(s-o,a));break}this.x=n/=i,this.y=a/=s;let[u,f]=this.getBaseTranslation();n+=u,a+=f,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#w(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return h.#w(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return h.#w(t,e,360-this.parentRotation)}#k(t){switch(t){case 90:{let[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){let[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/i).toFixed(2)}%`,this.#l||(n.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){let{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!this.#l&&e.endsWith("%");if(s&&n)return;let[a,o]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!this.#l&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#C(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");let t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(let i of t){let s=document.createElement("div");this.#o.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#R.bind(this,i),{signal:e}),s.addEventListener("contextmenu",xe,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#o)}#R(t,e){e.preventDefault();let{isMac:i}=Wt.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#i?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,this.#c=[e.screenX,e.screenY];let n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#S.bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",pe,{passive:!1,signal:a}),window.addEventListener("contextmenu",xe,{signal:a}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let o=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;let u=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=c,this.#O()};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})}#D(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e;let[n,a]=this.parentDimensions;this.setDims(n*i,a*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#h)return;let{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=this.#h;this.#h=null;let n=this.x,a=this.y,o=this.width,c=this.height;n===t&&a===e&&o===i&&c===s||this.addCommands({cmd:this.#D.bind(this,n,a,o,c),undo:this.#D.bind(this,t,e,i,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#S(t,e){let[i,s]=this.parentDimensions,n=this.x,a=this.y,o=this.width,c=this.height,u=h.MIN_SIZE/i,f=h.MIN_SIZE/s,m=this.#k(this.rotation),b=(X,Q)=>[m[0]*X+m[2]*Q,m[1]*X+m[3]*Q],A=this.#k(360-this.rotation),w=(X,Q)=>[A[0]*X+A[2]*Q,A[1]*X+A[3]*Q],x,C,k=!1,D=!1;switch(t){case"topLeft":k=!0,x=(X,Q)=>[0,0],C=(X,Q)=>[X,Q];break;case"topMiddle":x=(X,Q)=>[X/2,0],C=(X,Q)=>[X/2,Q];break;case"topRight":k=!0,x=(X,Q)=>[X,0],C=(X,Q)=>[0,Q];break;case"middleRight":D=!0,x=(X,Q)=>[X,Q/2],C=(X,Q)=>[0,Q/2];break;case"bottomRight":k=!0,x=(X,Q)=>[X,Q],C=(X,Q)=>[0,0];break;case"bottomMiddle":x=(X,Q)=>[X/2,Q],C=(X,Q)=>[X/2,0];break;case"bottomLeft":k=!0,x=(X,Q)=>[0,Q],C=(X,Q)=>[X,0];break;case"middleLeft":D=!0,x=(X,Q)=>[0,Q/2],C=(X,Q)=>[X,Q/2];break}let O=x(o,c),B=C(o,c),j=b(...B),p=h._round(n+j[0]),V=h._round(a+j[1]),U=1,rt=1,yt,pt;if(e.fromKeyboard)({deltaX:yt,deltaY:pt}=e);else{let{screenX:X,screenY:Q}=e,[zt,ce]=this.#c;[yt,pt]=this.screenToPageTranslation(X-zt,Q-ce),this.#c[0]=X,this.#c[1]=Q}if([yt,pt]=w(yt/i,pt/s),k){let X=Math.hypot(o,c);U=rt=Math.max(Math.min(Math.hypot(B[0]-O[0]-yt,B[1]-O[1]-pt)/X,1/o,1/c),u/o,f/c)}else D?U=Math.max(u,Math.min(1,Math.abs(B[0]-O[0]-yt)))/o:rt=Math.max(f,Math.min(1,Math.abs(B[1]-O[1]-pt)))/c;let nt=h._round(o*U),Pt=h._round(c*rt);j=b(...C(nt,Pt));let St=p-j[0],Xt=V-j[1];this.#a||=[this.x,this.y,this.width,this.height],this.width=nt,this.height=Pt,this.x=St,this.y=Xt,this.setDims(i*nt,s*Pt),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}addEditToolbar(){return Y(this,null,function*(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new _r(this),this.div.append(this._editToolbar.render()),this.#i&&(yield this._editToolbar.addAltText(this.#i)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(t){let e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return Y(this,null,function*(){this.#i||(Zo.initialize(h._l10n),this.#i=new Zo(this),this.#t&&(this.#i.data=this.#t,this.#t=null),yield this.addEditToolbar())})}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}setGuessedAltText(t){return Y(this,null,function*(){yield this.#i?.setGuessedText(t)})}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#F();let[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);let[i,s]=this.getInitialTranslation();return this.translate(i,s),Js(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#x||=new Zs({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#y.bind(this),onPinching:this.#I.bind(this),onPinchEnd:this.#z.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#y(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#I(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;let a=this.#k(this.rotation),o=(p,V)=>[a[0]*p+a[2]*V,a[1]*p+a[3]*V],[c,u]=this.parentDimensions,f=this.x,m=this.y,b=this.width,A=this.height,w=h.MIN_SIZE/c,x=h.MIN_SIZE/u;n=Math.max(Math.min(n,1/b,1/A),w/b,x/A);let C=h._round(b*n),k=h._round(A*n);if(C===b&&k===A)return;this.#a||=[f,m,b,A];let D=o(b/2,A/2),O=h._round(f+D[0]),B=h._round(m+D[1]),j=o(C/2,k/2);this.x=O-j[0],this.y=B-j[1],this.width=C,this.height=k,this.setDims(c*C,u*k),this.fixAndSetPosition(),this._onResizing()}#z(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(t){let{isMac:e}=Wt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#$(t);return}this.#V(t)}get isSelected(){return this._uiManager.isSelected(this)}#V(t){let{isMac:e}=Wt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#$(t){let{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1,s=new AbortController,n=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:n},o=u=>{s.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#V(u),i&&this._onStopDragging()};e&&(this.#A=t.clientX,this.#v=t.clientY,this.#r=t.pointerId,this.#n=t.pointerType,window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());let{clientX:f,clientY:m,pointerId:b}=u;if(b!==this.#r){pe(u);return}let[A,w]=this.screenToPageTranslation(f-this.#A,m-this.#v);this.#A=f,this.#v=m,this._uiManager.dragSelectedEditors(A,w)},a),window.addEventListener("touchmove",pe,a),window.addEventListener("pointerdown",u=>{u.pointerType===this.#n&&(this.#x||u.isPrimary)&&o(u),pe(u)},a));let c=u=>{if(!this.#r||this.#r===u.pointerId){o(u);return}pe(u)};window.addEventListener("pointerup",c,{signal:n}),window.addEventListener("blur",c,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){let s=this.parentScale,[n,a]=this.pageDimensions,[o,c]=this.pageTranslation,u=t/s,f=e/s,m=this.x*n,b=this.y*a,A=this.width*n,w=this.height*a;switch(i){case 0:return[m+u+o,a-b-f-w+c,m+u+A+o,a-b-f+c];case 90:return[m+f+o,a-b+u+c,m+f+w+o,a-b+u+A+c];case 180:return[m-u-A+o,a-b+f+c,m-u+o,a-b+f+w+c];case 270:return[m-f-w+o,a-b-u-A+c,m-f+o,a-b-u+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){let[i,s,n,a]=t,o=n-i,c=a-s;switch(this.rotation){case 0:return[i,e-a,o,c];case 90:return[i,e-s,c,o];case 180:return[n,e-s,o,c];case 270:return[n,e-a,c,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return e<a&&s>0&&t<n&&i>0}#F(){if(this.#d||!this.div)return;this.#d=new AbortController;let t=this._uiManager.combinedSignal(this.#d);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#F()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){Ct("An editor must be serializable")}static deserialize(t,e,i){return Y(this,null,function*(){let s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});s.rotation=t.rotation,s.#t=t.accessibilityData;let[n,a]=s.pageDimensions,[o,c,u,f]=s.getRectInCurrentCoords(t.rect,a);return s.x=o/n,s.y=c/a,s.width=u/n,s.height=f/a,s})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#d?.abort(),this.#d=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#B(),this.removeEditToolbar(),this.#_){for(let t of this.#_.values())clearTimeout(t);this.#_=null}this.parent=null,this.#x?.destroy(),this.#x=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#C(),this.#o.classList.remove("hidden"),Js(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let e=this.#o.children;if(!this.#e){this.#e=Array.from(e);let a=this.#N.bind(this),o=this.#H.bind(this),c=this._uiManager._signal;for(let u of this.#e){let f=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:c}),u.addEventListener("blur",o,{signal:c}),u.addEventListener("focus",this.#U.bind(this,f),{signal:c}),u.setAttribute("data-l10n-id",h._l10nResizer[f])}}let i=this.#e[0],s=0;for(let a of e){if(a===i)break;s++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)this.#o.append(this.#o.firstChild);else if(n>s)for(let o=0;o<n-s;o++)this.#o.firstChild.before(this.#o.lastChild);let a=0;for(let o of e){let u=this.#e[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",h._l10nResizer[u])}}this.#L(0),this.#g=!0,this.#o.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#N(t){h._resizerKeyboardManager.exec(this,t)}#H(t){this.#g&&t.relatedTarget?.parentNode!==this.#o&&this.#B()}#U(t){this.#u=this.#g?t:""}#L(t){if(this.#e)for(let e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#g&&this.#S(this.#u,{deltaX:t,deltaY:e,fromKeyboard:!0})}#B(){this.#g=!1,this.#L(-1),this.#O()}_stopResizingWithKeyboard(){this.#B(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#l=!0;let i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#_||=new Map;let{action:i}=t,s=this.#_.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#_.delete(i),this.#_.size===0&&(this.#_=null)},h._telemetryTimeout),this.#_.set(i,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){let i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){let{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}},Tr=class extends Dt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},tl=3285377520,ve=4294901760,Ie=65535,tn=class{constructor(t){this.h1=t?t&4294967295:tl,this.h2=t?t&4294967295:tl}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let x=0,C=t.length;x<C;x++){let k=t.charCodeAt(x);k<=255?e[i++]=k:(e[i++]=k>>>8,e[i++]=k&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=i>>2,n=i-s*4,a=new Uint32Array(e.buffer,0,s),o=0,c=0,u=this.h1,f=this.h2,m=3432918353,b=461845907,A=m&Ie,w=b&Ie;for(let x=0;x<s;x++)x&1?(o=a[x],o=o*m&ve|o*A&Ie,o=o<<15|o>>>17,o=o*b&ve|o*w&Ie,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(c=a[x],c=c*m&ve|c*A&Ie,c=c<<15|c>>>17,c=c*b&ve|c*w&Ie,f^=c,f=f<<13|f>>>19,f=f*5+3864292196);switch(o=0,n){case 3:o^=e[s*4+2]<<16;case 2:o^=e[s*4+1]<<8;case 1:o^=e[s*4],o=o*m&ve|o*A&Ie,o=o<<15|o>>>17,o=o*b&ve|o*w&Ie,s&1?u^=o:f^=o}this.h1=u,this.h2=f}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&ve|t*36045&Ie,e=e*4283543511&ve|((e<<16|t>>>16)*2950163797&ve)>>>16,t^=e>>>1,t=t*444984403&ve|t*60499&Ie,e=e*3301882366&ve|((e<<16|t>>>16)*3120437893&ve)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}},kr=Object.freeze({map:null,hash:"",transfer:void 0}),ls=class{#t=!1;#e=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){let i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){if(this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let e of this.#i.values())if(e instanceof Dt)return;this.onAnnotationEditor(null)}}setValue(t,e){let i=this.#i.get(t),s=!1;if(i!==void 0)for(let[n,a]of Object.entries(e))i[n]!==a&&(s=!0,i[n]=a);else s=!0,this.#i.set(t,e);s&&this.#s(),e instanceof Dt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#i.has(t)}getAll(){return this.#i.size>0?Ha(this.#i):null}setAll(t){for(let[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return this.#i.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new en(this)}get serializable(){if(this.#i.size===0)return kr;let t=new Map,e=new tn,i=[],s=Object.create(null),n=!1;for(let[a,o]of this.#i){let c=o instanceof Dt?o.serialize(!1,s):o;c&&(t.set(a,c),e.update(`${a}:${JSON.stringify(c)}`),n||=!!c.bitmap)}if(n)for(let a of t.values())a.bitmap&&i.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:kr}get editorStats(){let t=null,e=new Map;for(let i of this.#i.values()){if(!(i instanceof Dt))continue;let s=i.telemetryFinalData;if(!s)continue;let{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||=Object.create(null);let a=t[n]||=new Map;for(let[o,c]of Object.entries(s)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));let f=u.get(c)??0;u.set(c,f+1)}}for(let[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;let t=[];for(let e of this.#i.values())!(e instanceof Dt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}},en=class extends ls{#t;constructor(t){super();let{map:e,hash:i,transfer:s}=t.serializable,n=structuredClone(e,s?{transfer:s}:null);this.#t={map:n,hash:i,transfer:s}}get print(){Ct("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return gt(this,"modifiedIds",{ids:new Set,hash:""})}},Pr=class{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(let t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(i){return Y(this,arguments,function*({systemFontInfo:t,_inspectFont:e}){if(!(!t||this.#t.has(t.loadedName))){if(jt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:s,src:n,style:a}=t,o=new FontFace(s,n,a);this.addNativeFontFace(o);try{yield o.load(),this.#t.add(s),e?.(t)}catch{dt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Ct("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(t){return Y(this,null,function*(){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){yield this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){let i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{yield i.loaded}catch(s){throw dt(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}let e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;yield new Promise(i=>{let s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}})}get isFontLoadingAPISupported(){let t=!!this._document?.fonts;return gt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(Jt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),gt(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(jt(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){let n=i.shift();setTimeout(n.callback,0)}}let{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){let t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return gt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(B,j){return B.charCodeAt(j)<<24|B.charCodeAt(j+1)<<16|B.charCodeAt(j+2)<<8|B.charCodeAt(j+3)&255}function s(B,j,p,V){let U=B.substring(0,j),rt=B.substring(j+p);return U+V+rt}let n,a,o=this._document.createElement("canvas");o.width=1,o.height=1;let c=o.getContext("2d"),u=0;function f(B,j){if(++u>30){dt("Load test font never loaded."),j();return}if(c.font="30px "+B,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(f.bind(null,B,j))}let m=`lt${Date.now()}${this.loadTestFontId++}`,b=this._loadTestFont;b=s(b,976,m.length,m);let w=16,x=1482184792,C=i(b,w);for(n=0,a=m.length-3;n<a;n+=4)C=C-x+i(m,n)|0;n<m.length&&(C=C-x+i(m+"XXX",n)|0),b=s(b,w,4,jh(C));let k=`url(data:font/opentype;base64,${btoa(b)});`,D=`@font-face {font-family:"${m}";src:${k}}`;this.insertRule(D);let O=this._document.createElement("div");O.style.visibility="hidden",O.style.width=O.style.height="10px",O.style.position="absolute",O.style.top=O.style.left="0px";for(let B of[t.loadedName,m]){let j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=B,O.append(j)}this._document.body.append(O),f(m,()=>{O.remove(),e.complete()})}},Mr=class{constructor(t,{disableFontFace:e=!1,fontExtraProperties:i=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let n in t)this[n]=t[n];this.disableFontFace=e===!0,this.fontExtraProperties=i===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{let e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let t=`url(data:${this.mimetype};base64,${qh(this.data)});`,e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let i=this.loadedName+"_path_"+e,s;try{s=t.get(i)}catch(a){dt(`getPathGenerator - ignoring character: "${a}".`)}let n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}},zs={DATA:1,ERROR:2},Bt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function el(){}function le(h){if(h instanceof De||h instanceof ss||h instanceof ui||h instanceof Ys||h instanceof Fi||h instanceof is)return h;switch(h instanceof Error||typeof h=="object"&&h!==null||Ct('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new De(h.message);case"InvalidPDFException":return new ss(h.message);case"MissingPDFException":return new ui(h.message);case"PasswordException":return new Ys(h.message,h.code);case"UnexpectedResponseException":return new Fi(h.message,h.status);case"UnknownErrorException":return new is(h.message,h.details)}return new is(h.message,h.toString())}var oi=class{#t=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){let i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===zs.DATA)s.resolve(t.data);else if(t.callback===zs.ERROR)s.reject(le(t.reason));else throw new Error("Unexpected callback case");return}let e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:zs.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:zs.ERROR,callbackId:t.callbackId,reason:le(a)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){let i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){let s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,i,s){let n=this.streamId++,a=this.sourceName,o=this.targetName,c=this.comObj;return new ReadableStream({start:u=>{let f=Promise.withResolvers();return this.streamControllers[n]={controller:u,startCall:f,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:o,action:t,streamId:n,data:e,desiredSize:u.desiredSize},s),f.promise},pull:u=>{let f=Promise.withResolvers();return this.streamControllers[n].pullCall=f,c.postMessage({sourceName:a,targetName:o,stream:Bt.PULL,streamId:n,desiredSize:u.desiredSize}),f.promise},cancel:u=>{jt(u instanceof Error,"cancel must have a valid reason");let f=Promise.withResolvers();return this.streamControllers[n].cancelCall=f,this.streamControllers[n].isClosed=!0,c.postMessage({sourceName:a,targetName:o,stream:Bt.CANCEL,streamId:n,reason:le(u)}),f.promise}},i)}#i(t){let e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this,o=this.actionHandler[t.action],c={enqueue(u,f=1,m){if(this.isCancelled)return;let b=this.desiredSize;this.desiredSize-=f,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Bt.ENQUEUE,streamId:e,chunk:u},m)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Bt.CLOSE,streamId:e}),delete a.streamSinks[e])},error(u){jt(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Bt.ERROR,streamId:e,reason:le(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[e]=c,Promise.try(o,t.data,c).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Bt.START_COMPLETE,streamId:e,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:Bt.START_COMPLETE,streamId:e,reason:le(u)})})}#s(t){let e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case Bt.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(le(t.reason));break;case Bt.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(le(t.reason));break;case Bt.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:Bt.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||el).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Bt.PULL_COMPLETE,streamId:e,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:Bt.PULL_COMPLETE,streamId:e,reason:le(u)})});break;case Bt.ENQUEUE:if(jt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case Bt.CLOSE:if(jt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,e);break;case Bt.ERROR:jt(a,"error should have stream controller"),a.controller.error(le(t.reason)),this.#r(a,e);break;case Bt.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(le(t.reason)),this.#r(a,e);break;case Bt.CANCEL:if(!o)break;let c=le(t.reason);Promise.try(o.onCancel||el,c).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Bt.CANCEL_COMPLETE,streamId:e,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:Bt.CANCEL_COMPLETE,streamId:e,reason:le(u)})}),o.sinkCapability.reject(c),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}#r(t,e){return Y(this,null,function*(){yield Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]})}destroy(){this.#t?.abort(),this.#t=null}},sn=class{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");let i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Ct("Abstract method `_createCanvas` called.")}},Rr=class extends sn{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){let i=this._document.createElement("canvas");return i.width=t,i.height=e,i}},nn=class{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}fetch(e){return Y(this,arguments,function*({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");let i=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(i).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})})}_fetch(t){return Y(this,null,function*(){Ct("Abstract method `_fetch` called.")})}},rn=class extends nn{_fetch(t){return Y(this,null,function*(){let e=yield Rn(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Mn(e)})}},an=class{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}},Lr=class extends an{#t;#e;#i;#s;#r;#n;#l=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#r=e}get#o(){return this.#e||=new Map}get#c(){return this.#n||=new Map}get#h(){if(!this.#i){let t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;let i=this.#r.createElementNS(Ve,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS(Ve,"defs"),t.append(i),i.append(this.#i),this.#r.body.append(t)}return this.#i}#d(t){if(t.length===1){let c=t[0],u=new Array(256);for(let m=0;m<256;m++)u[m]=c[m]/255;let f=u.join(",");return[f,f,f]}let[e,i,s]=t,n=new Array(256),a=new Array(256),o=new Array(256);for(let c=0;c<256;c++)n[c]=e[c]/255,a[c]=i[c]/255,o[c]=s[c]/255;return[n.join(","),a.join(","),o.join(",")]}#u(t){if(this.#t===void 0){this.#t="";let e=this.#r.URL;e!==this.#r.baseURI&&(Ln(e)?dt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=e.split("#",1)[0])}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;let[i,s,n]=this.#d(t),a=t.length===1?i:`${i}${s}${n}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;let o=`g_${this.#s}_transfer_map_${this.#l++}`,c=this.#u(o);this.#o.set(t,c),this.#o.set(a,c);let u=this.#p(o);return this.#g(i,s,n,u),c}addHCMFilter(t,e){let i=`${t}-${e}`,s="base",n=this.#c.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#c.set(s,n)),!t||!e))return n.url;let a=this.#A(t);t=tt.makeHexColor(...a);let o=this.#A(e);if(e=tt.makeHexColor(...o),this.#h.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;let c=new Array(256);for(let A=0;A<=255;A++){let w=A/255;c[A]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}let u=c.join(","),f=`g_${this.#s}_hcm_filter`,m=n.filter=this.#p(f);this.#g(u,u,u,m),this.#a(m);let b=(A,w)=>{let x=a[A]/255,C=o[A]/255,k=new Array(w+1);for(let D=0;D<=w;D++)k[D]=x+D/w*(C-x);return k.join(",")};return this.#g(b(0,5),b(1,5),b(2,5),m),n.url=this.#u(f),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;let[i]=this.#d([t]),s=`alpha_${i}`;if(e=this.#o.get(s),e)return this.#o.set(t,e),e;let n=`g_${this.#s}_alpha_map_${this.#l++}`,a=this.#u(n);this.#o.set(t,a),this.#o.set(s,a);let o=this.#p(n);return this.#b(i,o),a}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let i,s;if(t?([i]=this.#d([t]),s=`luminosity_${i}`):s="luminosity",e=this.#o.get(s),e)return this.#o.set(t,e),e;let n=`g_${this.#s}_luminosity_map_${this.#l++}`,a=this.#u(n);this.#o.set(t,a),this.#o.set(s,a);let o=this.#p(n);return this.#f(o),t&&this.#b(i,o),a}addHighlightHCMFilter(t,e,i,s,n){let a=`${e}-${i}-${s}-${n}`,o=this.#c.get(t);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},this.#c.set(t,o)),!e||!i))return o.url;let[c,u]=[e,i].map(this.#A.bind(this)),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),m=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[b,A]=[s,n].map(this.#A.bind(this));m<f&&([f,m,b,A]=[m,f,A,b]),this.#h.style.color="";let w=(k,D,O)=>{let B=new Array(256),j=(m-f)/O,p=k/255,V=(D-k)/(255*O),U=0;for(let rt=0;rt<=O;rt++){let yt=Math.round(f+rt*j),pt=p+rt*V;for(let nt=U;nt<=yt;nt++)B[nt]=pt;U=yt+1}for(let rt=U;rt<256;rt++)B[rt]=B[U-1];return B.join(",")},x=`g_${this.#s}_hcm_${t}_filter`,C=o.filter=this.#p(x);return this.#a(C),this.#g(w(b[0],A[0],5),w(b[1],A[1],5),w(b[2],A[2],5),C),o.url=this.#u(x),o.url}destroy(t=!1){t&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#l=0)}#f(t){let e=this.#r.createElementNS(Ve,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#a(t){let e=this.#r.createElementNS(Ve,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){let e=this.#r.createElementNS(Ve,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#h.append(e),e}#m(t,e,i){let s=this.#r.createElementNS(Ve,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),t.append(s)}#g(t,e,i,s){let n=this.#r.createElementNS(Ve,"feComponentTransfer");s.append(n),this.#m(n,"feFuncR",t),this.#m(n,"feFuncG",e),this.#m(n,"feFuncB",i)}#b(t,e){let i=this.#r.createElementNS(Ve,"feComponentTransfer");e.append(i),this.#m(i,"feFuncA",t)}#A(t){return this.#h.style.color=t,za(getComputedStyle(this.#h).getPropertyValue("color"))}},on=class{constructor({baseUrl:t=null}){this.baseUrl=t}fetch(e){return Y(this,arguments,function*({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");let i=`${this.baseUrl}${t}`;return this._fetch(i).catch(s=>{throw new Error(`Unable to load font data at: ${i}`)})})}_fetch(t){return Y(this,null,function*(){Ct("Abstract method `_fetch` called.")})}},ln=class extends on{_fetch(t){return Y(this,null,function*(){let e=yield Rn(t,"arraybuffer");return new Uint8Array(e)})}};Jt&&dt("Please use the `legacy` build in Node.js environments.");function gl(h){return Y(this,null,function*(){let e=yield process.getBuiltinModule("fs").promises.readFile(h);return new Uint8Array(e)})}var Ir=class extends an{},Dr=class extends sn{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}},Nr=class extends nn{_fetch(t){return Y(this,null,function*(){return gl(t)})}},Or=class extends on{_fetch(t){return Y(this,null,function*(){return gl(t)})}},Qt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Fr(h,t){if(!t)return;let e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),h.clip(s)}var hs=class{getPattern(){Ct("Abstract method `getPattern` called.")}},Hr=class extends hs{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===Qt.STROKE||s===Qt.FILL){let a=e.current.getClippedPathBoundingBox(s,Rt(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,u=e.cachedCanvases.getCanvas("pattern",o,c),f=u.context;f.clearRect(0,0,f.canvas.width,f.canvas.height),f.beginPath(),f.rect(0,0,f.canvas.width,f.canvas.height),f.translate(-a[0],-a[1]),i=tt.transform(i,[1,0,0,1,a[0],a[1]]),f.transform(...e.baseTransform),this.matrix&&f.transform(...this.matrix),Fr(f,this._bbox),f.fillStyle=this._createGradient(f),f.fill(),n=t.createPattern(u.canvas,"no-repeat");let m=new DOMMatrix(i);n.setTransform(m)}else Fr(t,this._bbox),n=this._createGradient(t);return n}};function mr(h,t,e,i,s,n,a,o){let c=t.coords,u=t.colors,f=h.data,m=h.width*4,b;c[e+1]>c[i+1]&&(b=e,e=i,i=b,b=n,n=a,a=b),c[i+1]>c[s+1]&&(b=i,i=s,s=b,b=a,a=o,o=b),c[e+1]>c[i+1]&&(b=e,e=i,i=b,b=n,n=a,a=b);let A=(c[e]+t.offsetX)*t.scaleX,w=(c[e+1]+t.offsetY)*t.scaleY,x=(c[i]+t.offsetX)*t.scaleX,C=(c[i+1]+t.offsetY)*t.scaleY,k=(c[s]+t.offsetX)*t.scaleX,D=(c[s+1]+t.offsetY)*t.scaleY;if(w>=D)return;let O=u[n],B=u[n+1],j=u[n+2],p=u[a],V=u[a+1],U=u[a+2],rt=u[o],yt=u[o+1],pt=u[o+2],nt=Math.round(w),Pt=Math.round(D),St,Xt,X,Q,zt,ce,Se,Zt;for(let Nt=nt;Nt<=Pt;Nt++){if(Nt<C){let Tt=Nt<w?0:(w-Nt)/(w-C);St=A-(A-x)*Tt,Xt=O-(O-p)*Tt,X=B-(B-V)*Tt,Q=j-(j-U)*Tt}else{let Tt;Nt>D?Tt=1:C===D?Tt=0:Tt=(C-Nt)/(C-D),St=x-(x-k)*Tt,Xt=p-(p-rt)*Tt,X=V-(V-yt)*Tt,Q=U-(U-pt)*Tt}let Lt;Nt<w?Lt=0:Nt>D?Lt=1:Lt=(w-Nt)/(w-D),zt=A-(A-k)*Lt,ce=O-(O-rt)*Lt,Se=B-(B-yt)*Lt,Zt=j-(j-pt)*Lt;let Ue=Math.round(Math.min(St,zt)),Ze=Math.round(Math.max(St,zt)),ie=m*Nt+Ue*4;for(let Tt=Ue;Tt<=Ze;Tt++)Lt=(St-Tt)/(St-zt),Lt<0?Lt=0:Lt>1&&(Lt=1),f[ie++]=Xt-(Xt-ce)*Lt|0,f[ie++]=X-(X-Se)*Lt|0,f[ie++]=Q-(Q-Zt)*Lt|0,f[ie++]=255}}function Qh(h,t,e){let i=t.coords,s=t.colors,n,a;switch(t.type){case"lattice":let o=t.verticesPerRow,c=Math.floor(i.length/o)-1,u=o-1;for(n=0;n<c;n++){let f=n*o;for(let m=0;m<u;m++,f++)mr(h,e,i[f],i[f+1],i[f+o],s[f],s[f+1],s[f+o]),mr(h,e,i[f+o+1],i[f+1],i[f+o],s[f+o+1],s[f+1],s[f+o])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)mr(h,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var Br=class extends hs{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,i){let o=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,f=Math.ceil(this._bounds[3])-c,m=Math.min(Math.ceil(Math.abs(u*t[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(f*t[1]*1.1)),3e3),A=u/m,w=f/b,x={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-c,scaleX:1/A,scaleY:1/w},C=m+4,k=b+4,D=i.getCanvas("mesh",C,k),O=D.context,B=O.createImageData(m,b);if(e){let p=B.data;for(let V=0,U=p.length;V<U;V+=4)p[V]=e[0],p[V+1]=e[1],p[V+2]=e[2],p[V+3]=255}for(let p of this._figures)Qh(B,p,x);return O.putImageData(B,2,2),{canvas:D.canvas,offsetX:o-2*A,offsetY:c-2*w,scaleX:A,scaleY:w}}getPattern(t,e,i,s){Fr(t,this._bbox);let n;if(s===Qt.SHADING)n=tt.singularValueDecompose2dScale(Rt(t));else if(n=tt.singularValueDecompose2dScale(e.baseTransform),this.matrix){let o=tt.singularValueDecompose2dScale(this.matrix);n=[n[0]*o[0],n[1]*o[1]]}let a=this._createMeshCanvas(n,s===Qt.SHADING?null:this._background,e.cachedCanvases);return s!==Qt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}},jr=class extends hs{getPattern(){return"hotpink"}};function Jh(h){switch(h[0]){case"RadialAxial":return new Hr(h);case"Mesh":return new Br(h);case"Dummy":return new jr}throw new Error(`Unknown IR type: ${h[0]}`)}var il={COLORED:1,UNCOLORED:2},Zh=(()=>{class h{static MAX_PATTERN_SIZE=3e3;constructor(e,i,s,n,a){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=i,this.ctx=s,this.canvasGraphicsFactory=n,this.baseTransform=a}createPatternCanvas(e){let{bbox:i,operatorList:s,paintType:n,tilingType:a,color:o,canvasGraphicsFactory:c}=this,{xstep:u,ystep:f}=this;u=Math.abs(u),f=Math.abs(f),Pn("TilingType: "+a);let m=i[0],b=i[1],A=i[2],w=i[3],x=A-m,C=w-b,k=tt.singularValueDecompose2dScale(this.matrix),D=tt.singularValueDecompose2dScale(this.baseTransform),O=k[0]*D[0],B=k[1]*D[1],j=x,p=C,V=!1,U=!1,rt=Math.ceil(u*O),yt=Math.ceil(f*B),pt=Math.ceil(x*O),nt=Math.ceil(C*B);rt>=pt?j=u:V=!0,yt>=nt?p=f:U=!0;let Pt=this.getSizeAndScale(j,this.ctx.canvas.width,O),St=this.getSizeAndScale(p,this.ctx.canvas.height,B),Xt=e.cachedCanvases.getCanvas("pattern",Pt.size,St.size),X=Xt.context,Q=c.createCanvasGraphics(X);if(Q.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Q,n,o),X.translate(-Pt.scale*m,-St.scale*b),Q.transform(Pt.scale,0,0,St.scale,0,0),X.save(),this.clipBbox(Q,m,b,A,w),Q.baseTransform=Rt(Q.ctx),Q.executeOperatorList(s),Q.endDrawing(),X.restore(),V||U){let zt=Xt.canvas;V&&(j=u),U&&(p=f);let ce=this.getSizeAndScale(j,this.ctx.canvas.width,O),Se=this.getSizeAndScale(p,this.ctx.canvas.height,B),Zt=ce.size,Nt=Se.size,Lt=e.cachedCanvases.getCanvas("pattern-workaround",Zt,Nt),Ue=Lt.context,Ze=V?Math.floor(x/u):0,ie=U?Math.floor(C/f):0;for(let Tt=0;Tt<=Ze;Tt++)for(let ue=0;ue<=ie;ue++)Ue.drawImage(zt,Zt*Tt,Nt*ue,Zt,Nt,0,0,Zt,Nt);return{canvas:Lt.canvas,scaleX:ce.scale,scaleY:Se.scale,offsetX:m,offsetY:b}}return{canvas:Xt.canvas,scaleX:Pt.scale,scaleY:St.scale,offsetX:m,offsetY:b}}getSizeAndScale(e,i,s){let n=Math.max(h.MAX_PATTERN_SIZE,i),a=Math.ceil(e*s);return a>=n?a=n:s=a/e,{scale:s,size:a}}clipBbox(e,i,s,n,a){let o=n-i,c=a-s;e.ctx.rect(i,s,o,c),e.current.updateRectMinMax(Rt(e.ctx),[i,s,n,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,i,s){let n=e.ctx,a=e.current;switch(i){case il.COLORED:let o=this.ctx;n.fillStyle=o.fillStyle,n.strokeStyle=o.strokeStyle,a.fillColor=o.fillStyle,a.strokeColor=o.strokeStyle;break;case il.UNCOLORED:let c=tt.makeHexColor(s[0],s[1],s[2]);n.fillStyle=c,n.strokeStyle=c,a.fillColor=c,a.strokeColor=c;break;default:throw new Ar(`Unsupported paint type: ${i}`)}}getPattern(e,i,s,n){let a=s;n!==Qt.SHADING&&(a=tt.transform(a,i.baseTransform),this.matrix&&(a=tt.transform(a,this.matrix)));let o=this.createPatternCanvas(i),c=new DOMMatrix(a);c=c.translate(o.offsetX,o.offsetY),c=c.scale(1/o.scaleX,1/o.scaleY);let u=e.createPattern(o.canvas,"repeat");return u.setTransform(c),u}}return h})();function tc({src:h,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){let o=Wt.isLittleEndian?4278190080:255,[c,u]=a?[n,o]:[o,n],f=i>>3,m=i&7,b=h.length;e=new Uint32Array(e.buffer);let A=0;for(let w=0;w<s;w++){for(let C=t+f;t<C;t++){let k=t<b?h[t]:255;e[A++]=k&128?u:c,e[A++]=k&64?u:c,e[A++]=k&32?u:c,e[A++]=k&16?u:c,e[A++]=k&8?u:c,e[A++]=k&4?u:c,e[A++]=k&2?u:c,e[A++]=k&1?u:c}if(m===0)continue;let x=t<b?h[t++]:255;for(let C=0;C<m;C++)e[A++]=x&1<<7-C?u:c}return{srcPos:t,destPos:A}}var sl=16,nl=100,ec=15,rl=10,al=1e3,he=16;function ic(h,t){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){t.save(),this.__originalSave()},h.restore=function(){t.restore(),this.__originalRestore()},h.translate=function(i,s){t.translate(i,s),this.__originalTranslate(i,s)},h.scale=function(i,s){t.scale(i,s),this.__originalScale(i,s)},h.transform=function(i,s,n,a,o,c){t.transform(i,s,n,a,o,c),this.__originalTransform(i,s,n,a,o,c)},h.setTransform=function(i,s,n,a,o,c){t.setTransform(i,s,n,a,o,c),this.__originalSetTransform(i,s,n,a,o,c)},h.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},h.rotate=function(i){t.rotate(i),this.__originalRotate(i)},h.clip=function(i){t.clip(i),this.__originalClip(i)},h.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},h.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},h.bezierCurveTo=function(e,i,s,n,a,o){t.bezierCurveTo(e,i,s,n,a,o),this.__originalBezierCurveTo(e,i,s,n,a,o)},h.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},h.closePath=function(){t.closePath(),this.__originalClosePath()},h.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}var zr=class{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(let t in this.cache){let e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}};function Vs(h,t,e,i,s,n,a,o,c,u){let[f,m,b,A,w,x]=Rt(h);if(m===0&&b===0){let D=a*f+w,O=Math.round(D),B=o*A+x,j=Math.round(B),p=(a+c)*f+w,V=Math.abs(Math.round(p)-O)||1,U=(o+u)*A+x,rt=Math.abs(Math.round(U)-j)||1;return h.setTransform(Math.sign(f),0,0,Math.sign(A),O,j),h.drawImage(t,e,i,s,n,0,0,V,rt),h.setTransform(f,m,b,A,w,x),[V,rt]}if(f===0&&A===0){let D=o*b+w,O=Math.round(D),B=a*m+x,j=Math.round(B),p=(o+u)*b+w,V=Math.abs(Math.round(p)-O)||1,U=(a+c)*m+x,rt=Math.abs(Math.round(U)-j)||1;return h.setTransform(0,Math.sign(m),Math.sign(b),0,O,j),h.drawImage(t,e,i,s,n,0,0,rt,V),h.setTransform(f,m,b,A,w,x),[rt,V]}h.drawImage(t,e,i,s,n,a,o,c,u);let C=Math.hypot(f,m),k=Math.hypot(b,A);return[C*c,k*u]}function sc(h){let{width:t,height:e}=h;if(t>al||e>al)return null;let i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1,a=new Uint8Array(n*(e+1)),o,c,u,f=t+7&-8,m=new Uint8Array(f*e),b=0;for(let k of h.data){let D=128;for(;D>0;)m[b++]=k&D?0:255,D>>=1}let A=0;for(b=0,m[b]!==0&&(a[0]=1,++A),c=1;c<t;c++)m[b]!==m[b+1]&&(a[c]=m[b]?2:1,++A),b++;for(m[b]!==0&&(a[c]=2,++A),o=1;o<e;o++){b=o*f,u=o*n,m[b-f]!==m[b]&&(a[u]=m[b]?1:8,++A);let k=(m[b]?4:0)+(m[b-f]?8:0);for(c=1;c<t;c++)k=(k>>2)+(m[b+1]?4:0)+(m[b-f+1]?8:0),s[k]&&(a[u+c]=s[k],++A),b++;if(m[b-f]!==m[b]&&(a[u+c]=m[b]?2:4,++A),A>i)return null}for(b=f*(e-1),u=o*n,m[b]!==0&&(a[u]=8,++A),c=1;c<t;c++)m[b]!==m[b+1]&&(a[u+c]=m[b]?4:8,++A),b++;if(m[b]!==0&&(a[u+c]=4,++A),A>i)return null;let w=new Int32Array([0,n,-1,0,-n,0,0,0,1]),x=new Path2D;for(o=0;A&&o<=e;o++){let k=o*n,D=k+t;for(;k<D&&!a[k];)k++;if(k===D)continue;x.moveTo(k%n,o);let O=k,B=a[k];do{let j=w[B];do k+=j;while(!a[k]);let p=a[k];p!==5&&p!==10?(B=p,a[k]=0):(B=p&51*B>>4,a[k]&=B>>2|B<<2),x.lineTo(k%n,k/n|0),a[k]||--A}while(O!==k);--o}return m=null,a=null,function(k){k.save(),k.scale(1/t,-1/e),k.translate(0,-e),k.fill(x),k.beginPath(),k.restore()}}var hn=class{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=fl,this.textMatrixScale=1,this.fontMatrix=yr,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Kt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){let t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,i){[e,i]=tt.applyTransform([e,i],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){let i=tt.applyTransform(e,t),s=tt.applyTransform(e.slice(2),t),n=tt.applyTransform([e[0],e[3]],t),a=tt.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],n[0],a[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],a[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],a[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],a[1])}updateScalingPathMinMax(t,e){tt.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,s,n,a,o,c,u,f){let m=tt.bezierBoundingBox(e,i,s,n,a,o,c,u,f);f||this.updateRectMinMax(t,m)}getPathBoundingBox(t=Qt.FILL,e=null){let i=[this.minX,this.minY,this.maxX,this.maxY];if(t===Qt.STROKE){e||Ct("Stroke bounding box must include transform.");let s=tt.singularValueDecompose2dScale(e),n=s[0]*this.lineWidth/2,a=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=a,i[2]+=n,i[3]+=a}return i}updateClipFromPath(){let t=tt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Qt.FILL,e=null){return tt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}};function ol(h,t){if(t instanceof ImageData){h.putImageData(t,0,0);return}let e=t.height,i=t.width,s=e%he,n=(e-s)/he,a=s===0?n:n+1,o=h.createImageData(i,he),c=0,u,f=t.data,m=o.data,b,A,w,x;if(t.kind===qs.GRAYSCALE_1BPP){let C=f.byteLength,k=new Uint32Array(m.buffer,0,m.byteLength>>2),D=k.length,O=i+7>>3,B=4294967295,j=Wt.isLittleEndian?4278190080:255;for(b=0;b<a;b++){for(w=b<n?he:s,u=0,A=0;A<w;A++){let p=C-c,V=0,U=p>O?i:p*8-7,rt=U&-8,yt=0,pt=0;for(;V<rt;V+=8)pt=f[c++],k[u++]=pt&128?B:j,k[u++]=pt&64?B:j,k[u++]=pt&32?B:j,k[u++]=pt&16?B:j,k[u++]=pt&8?B:j,k[u++]=pt&4?B:j,k[u++]=pt&2?B:j,k[u++]=pt&1?B:j;for(;V<U;V++)yt===0&&(pt=f[c++],yt=128),k[u++]=pt&yt?B:j,yt>>=1}for(;u<D;)k[u++]=0;h.putImageData(o,0,b*he)}}else if(t.kind===qs.RGBA_32BPP){for(A=0,x=i*he*4,b=0;b<n;b++)m.set(f.subarray(c,c+x)),c+=x,h.putImageData(o,0,A),A+=he;b<a&&(x=i*s*4,m.set(f.subarray(c,c+x)),h.putImageData(o,0,A))}else if(t.kind===qs.RGB_24BPP)for(w=he,x=i*w,b=0;b<a;b++){for(b>=n&&(w=s,x=i*w),u=0,A=x;A--;)m[u++]=f[c++],m[u++]=f[c++],m[u++]=f[c++],m[u++]=255;h.putImageData(o,0,b*he)}else throw new Error(`bad image kind: ${t.kind}`)}function ll(h,t){if(t.bitmap){h.drawImage(t.bitmap,0,0);return}let e=t.height,i=t.width,s=e%he,n=(e-s)/he,a=s===0?n:n+1,o=h.createImageData(i,he),c=0,u=t.data,f=o.data;for(let m=0;m<a;m++){let b=m<n?he:s;({srcPos:c}=tc({src:u,srcPos:c,dest:f,width:i,height:b,nonBlackColor:0})),h.putImageData(o,0,m*he)}}function Qi(h,t){let e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let i of e)h[i]!==void 0&&(t[i]=h[i]);h.setLineDash!==void 0&&(t.setLineDash(h.getLineDash()),t.lineDashOffset=h.lineDashOffset)}function $s(h){if(h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0),!Jt){let{filter:t}=h;t!=="none"&&t!==""&&(h.filter="none")}}function hl(h,t){if(t)return!0;let e=tt.singularValueDecompose2dScale(h);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);let i=Math.fround((globalThis.devicePixelRatio||1)*Qe.PDF_TO_CSS_UNITS);return e[0]<=i&&e[1]<=i}var nc=["butt","round","square"],rc=["miter","round","bevel"],ac={},cl={},Ii=class h{constructor(t,e,i,s,n,{optionalContentConfig:a,markedContentStack:o=null},c,u){this.ctx=t,this.current=new hn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new zr(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){let n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,i){let c=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Rt(this.compositeCtx))}this.ctx.save(),$s(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Rt(this.ctx)}executeOperatorList(t,e,i,s){let n=t.argsArray,a=t.fnArray,o=e||0,c=n.length;if(c===o)return o;let u=c-o>rl&&typeof i=="function",f=u?Date.now()+ec:0,m=0,b=this.commonObjs,A=this.objs,w;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(w=a[o],w!==we.dependency)this[w].apply(this,n[o]);else for(let x of n[o]){let C=x.startsWith("g_")?b:A;if(!C.has(x))return C.get(x,i),o}if(o++,o===c)return o;if(u&&++m>rl){if(Date.now()>f)return i(),o;m=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let t of this._cachedBitmapsMap.values()){for(let e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){let t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){let e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){let i=t.width??t.displayWidth,s=t.height??t.displayHeight,n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=i,c=s,u="prescale1",f,m;for(;n>2&&o>1||a>2&&c>1;){let b=o,A=c;n>2&&o>1&&(b=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/b),a>2&&c>1&&(A=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/A),f=this.cachedCanvases.getCanvas(u,b,A),m=f.context,m.clearRect(0,0,b,A),m.drawImage(t,0,0,o,c,0,0,b,A),t=f.canvas,o=b,c=A,u=u==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:c}}_createMaskCanvas(t){let e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,a=this.current.patternFill,o=Rt(e),c,u,f,m;if((t.bitmap||t.data)&&t.count>1){let U=t.bitmap||t.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),n]),c=this._cachedBitmapsMap.get(U),c||(c=new Map,this._cachedBitmapsMap.set(U,c));let rt=c.get(u);if(rt&&!a){let yt=Math.round(Math.min(o[0],o[2])+o[4]),pt=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:rt,offsetX:yt,offsetY:pt}}f=rt}f||(m=this.cachedCanvases.getCanvas("maskCanvas",i,s),ll(m.context,t));let b=tt.transform(o,[1/i,0,0,-1/s,0,0]);b=tt.transform(b,[1,0,0,1,0,-s]);let[A,w,x,C]=tt.getAxialAlignedBoundingBox([0,0,i,s],b),k=Math.round(x-A)||1,D=Math.round(C-w)||1,O=this.cachedCanvases.getCanvas("fillCanvas",k,D),B=O.context,j=A,p=w;B.translate(-j,-p),B.transform(...b),f||(f=this._scaleImage(m.canvas,Le(B)),f=f.img,c&&a&&c.set(u,f)),B.imageSmoothingEnabled=hl(Rt(B),t.interpolate),Vs(B,f,0,0,f.width,f.height,0,0,i,s),B.globalCompositeOperation="source-in";let V=tt.transform(Le(B),[1,0,0,1,-j,-p]);return B.fillStyle=a?n.getPattern(e,this,V,Qt.FILL):n,B.fillRect(0,0,i,s),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(u,O.canvas)),{canvas:O.canvas,offsetX:Math.round(j),offsetY:Math.round(p)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=nc[t]}setLineJoin(t){this.ctx.lineJoin=rc[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){let i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(let[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx,this.ctx=s.context;let n=this.ctx;n.setTransform(...Rt(this.suspendedCtx)),Qi(this.suspendedCtx,n),ic(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Qi(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){let n=s[0],a=s[1],o=s[2]-n,c=s[3]-a;o===0||c===0||(this.genericComposeSMask(e.context,i,o,c,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,a,o,c,u,f,m){let b=t.canvas,A=c-f,w=u-m;if(a){let C=tt.makeHexColor(...a);if(A<0||w<0||A+i>b.width||w+s>b.height){let k=this.cachedCanvases.getCanvas("maskExtension",i,s),D=k.context;D.drawImage(b,-A,-w),D.globalCompositeOperation="destination-atop",D.fillStyle=C,D.fillRect(0,0,i,s),D.globalCompositeOperation="source-over",b=k.canvas,A=w=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);let k=new Path2D;k.rect(A,w,i,s),t.clip(k),t.globalCompositeOperation="destination-atop",t.fillStyle=C,t.fillRect(A,w,i,s),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));let x=new Path2D;x.rect(c,u,i,s),e.clip(x),e.globalCompositeOperation="destination-in",e.drawImage(b,A,w,i,s,c,u,i,s),e.restore()}save(){this.inSMaskMode?(Qi(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Qi(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,i,s,n,a){this.ctx.transform(t,e,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){let s=this.ctx,n=this.current,a=n.x,o=n.y,c,u,f=Rt(s),m=f[0]===0&&f[3]===0||f[1]===0&&f[2]===0,b=m?i.slice(0):null;for(let A=0,w=0,x=t.length;A<x;A++)switch(t[A]|0){case we.rectangle:a=e[w++],o=e[w++];let C=e[w++],k=e[w++],D=a+C,O=o+k;s.moveTo(a,o),C===0||k===0?s.lineTo(D,O):(s.lineTo(D,o),s.lineTo(D,O),s.lineTo(a,O)),m||n.updateRectMinMax(f,[a,o,D,O]),s.closePath();break;case we.moveTo:a=e[w++],o=e[w++],s.moveTo(a,o),m||n.updatePathMinMax(f,a,o);break;case we.lineTo:a=e[w++],o=e[w++],s.lineTo(a,o),m||n.updatePathMinMax(f,a,o);break;case we.curveTo:c=a,u=o,a=e[w+4],o=e[w+5],s.bezierCurveTo(e[w],e[w+1],e[w+2],e[w+3],a,o),n.updateCurvePathMinMax(f,c,u,e[w],e[w+1],e[w+2],e[w+3],a,o,b),w+=6;break;case we.curveTo2:c=a,u=o,s.bezierCurveTo(a,o,e[w],e[w+1],e[w+2],e[w+3]),n.updateCurvePathMinMax(f,c,u,a,o,e[w],e[w+1],e[w+2],e[w+3],b),a=e[w+2],o=e[w+3],w+=4;break;case we.curveTo3:c=a,u=o,a=e[w+2],o=e[w+3],s.bezierCurveTo(e[w],e[w+1],a,o,a,o),n.updateCurvePathMinMax(f,c,u,e[w],e[w+1],a,o,a,o,b),w+=4;break;case we.closePath:s.closePath();break}m&&n.updateScalingPathMinMax(f,b),n.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(t=!0){let e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(e.save(),e.strokeStyle=i.getPattern(e,this,Le(e),Qt.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){let e=this.ctx,i=this.current.fillColor,s=this.current.patternFill,n=!1;s&&(e.save(),e.fillStyle=i.getPattern(e,this,Le(e),Qt.FILL),n=!0);let a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),n&&e.restore(),t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ac}eoClip(){this.pendingClip=cl}beginText(){this.current.textMatrix=fl,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}let i=new Path2D,s=e.getTransform().invertSelf();for(let{transform:n,x:a,y:o,fontSize:c,path:u}of t)i.addPath(u,new DOMMatrix(n).preMultiplySelf(s).translate(a,o).scale(c,-c));e.clip(i),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){let i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||yr,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&dt("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;let n=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`,o="normal";i.black?o="900":i.bold&&(o="bold");let c=i.italic?"italic":"normal",u=e;e<sl?u=sl:e>nl&&(u=nl),this.current.fontSizeScale=e/u,this.ctx.font=`${c} ${o} ${u}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,s,n,a){this.current.textMatrix=[t,e,i,s,n,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#i(t,e,i){let s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s}paintChar(t,e,i,s,n){let a=this.ctx,o=this.current,c=o.font,u=o.textRenderingMode,f=o.fontSize/o.fontSizeScale,m=u&Kt.FILL_STROKE_MASK,b=!!(u&Kt.ADD_TO_PATH_FLAG),A=o.patternFill&&!c.missingFile,w=o.patternStroke&&!c.missingFile,x;if((c.disableFontFace||b||A||w)&&(x=c.getPathGenerator(this.commonObjs,t)),c.disableFontFace||A||w){if(a.save(),a.translate(e,i),a.scale(f,-f),m===Kt.FILL||m===Kt.FILL_STROKE)if(s){let C=a.getTransform();a.setTransform(...s),a.fill(this.#i(x,C,s))}else a.fill(x);if(m===Kt.STROKE||m===Kt.FILL_STROKE)if(n){let C=a.getTransform();a.setTransform(...n),a.stroke(this.#i(x,C,n))}else a.lineWidth/=f,a.stroke(x);a.restore()}else(m===Kt.FILL||m===Kt.FILL_STROKE)&&a.fillText(t,e,i),(m===Kt.STROKE||m===Kt.FILL_STROKE)&&a.strokeText(t,e,i);b&&(this.pendingTextPaths||=[]).push({transform:Rt(a),x:e,y:i,fontSize:f,path:x})}get isFontSubpixelAAEnabled(){let{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);let e=t.getImageData(0,0,10,10).data,i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return gt(this,"isFontSubpixelAAEnabled",i)}showText(t){let e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);let s=e.fontSize;if(s===0)return;let n=this.ctx,a=e.fontSizeScale,o=e.charSpacing,c=e.wordSpacing,u=e.fontDirection,f=e.textHScale*u,m=t.length,b=i.vertical,A=b?1:-1,w=i.defaultVMetrics,x=s*e.fontMatrix[0],C=e.textRenderingMode===Kt.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),u>0?n.scale(f,-1):n.scale(f,1);let k,D;if(e.patternFill){n.save();let V=e.fillColor.getPattern(n,this,Le(n),Qt.FILL);k=Rt(n),n.restore(),n.fillStyle=V}if(e.patternStroke){n.save();let V=e.strokeColor.getPattern(n,this,Le(n),Qt.STROKE);D=Rt(n),n.restore(),n.strokeStyle=V}let O=e.lineWidth,B=e.textMatrixScale;if(B===0||O===0){let V=e.textRenderingMode&Kt.FILL_STROKE_MASK;(V===Kt.STROKE||V===Kt.FILL_STROKE)&&(O=this.getSinglePixelWidth())}else O/=B;if(a!==1&&(n.scale(a,a),O/=a),n.lineWidth=O,i.isInvalidPDFjsFont){let V=[],U=0;for(let rt of t)V.push(rt.unicode),U+=rt.width;n.fillText(V.join(""),0,0),e.x+=U*x*f,n.restore(),this.compose();return}let j=0,p;for(p=0;p<m;++p){let V=t[p];if(typeof V=="number"){j+=A*V*s/1e3;continue}let U=!1,rt=(V.isSpace?c:0)+o,yt=V.fontChar,pt=V.accent,nt,Pt,St=V.width;if(b){let X=V.vmetric||w,Q=-(V.vmetric?X[1]:St*.5)*x,zt=X[2]*x;St=X?-X[0]:St,nt=Q/a,Pt=(j+zt)/a}else nt=j/a,Pt=0;if(i.remeasure&&St>0){let X=n.measureText(yt).width*1e3/s*a;if(St<X&&this.isFontSubpixelAAEnabled){let Q=St/X;U=!0,n.save(),n.scale(Q,1),nt/=Q}else St!==X&&(nt+=(St-X)/2e3*s/a)}if(this.contentVisible&&(V.isInFont||i.missingFile)){if(C&&!pt)n.fillText(yt,nt,Pt);else if(this.paintChar(yt,nt,Pt,k,D),pt){let X=nt+s*pt.offset.x/a,Q=Pt-s*pt.offset.y/a;this.paintChar(pt.fontChar,X,Q,k,D)}}let Xt=b?St*x-rt*u:St*x+rt*u;j+=Xt,U&&n.restore()}b?e.y-=j:e.x+=j*f,n.restore(),this.compose()}showType3Text(t){let e=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,o=s.vertical?1:-1,c=i.charSpacing,u=i.wordSpacing,f=i.textHScale*a,m=i.fontMatrix||yr,b=t.length,A=i.textRenderingMode===Kt.INVISIBLE,w,x,C,k;if(!(A||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...i.textMatrix),e.translate(i.x,i.y),e.scale(f,a),w=0;w<b;++w){if(x=t[w],typeof x=="number"){k=o*x*n/1e3,this.ctx.translate(k,0),i.x+=k*f;continue}let D=(x.isSpace?u:0)+c,O=s.charProcOperatorList[x.operatorListId];if(!O){dt(`Type3 character "${x.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=x,this.save(),e.scale(n,n),e.transform(...m),this.executeOperatorList(O),this.restore()),C=tt.applyTransform([x.width,0],m)[0]*n+D,e.translate(C,0),i.x+=C*f}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,a){this.ctx.rect(i,s,n-i,a-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){let i=t[1],s=this.baseTransform||Rt(this.ctx),n={createCanvasGraphics:a=>new h(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Zh(t,i,this.ctx,n,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=tt.makeHexColor(t,e,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,i){this.ctx.fillStyle=this.current.fillColor=tt.makeHexColor(t,e,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=Jh(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;let e=this.ctx;this.save();let i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,Le(e),Qt.SHADING);let s=Le(e);if(s){let{width:n,height:a}=e.canvas,[o,c,u,f]=tt.getAxialAlignedBoundingBox([0,0,n,a],s);this.ctx.fillRect(o,c,u-o,f-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Ct("Should not call beginInlineImage")}beginImageData(){Ct("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Rt(this.ctx),e)){let i=e[2]-e[0],s=e[3]-e[1];this.ctx.rect(e[0],e[1],i,s),this.current.updateRectMinMax(Rt(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let e=this.ctx;t.isolated||Pn("TODO: Support non-isolated groups."),t.knockout&&dt("Knockout groups not supported.");let i=Rt(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=tt.getAxialAlignedBoundingBox(t.bbox,Rt(e)),n=[0,0,e.canvas.width,e.canvas.height];s=tt.intersect(s,n)||[0,0,0,0];let a=Math.floor(s[0]),o=Math.floor(s[1]),c=Math.max(Math.ceil(s[2])-a,1),u=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,c,u]);let f="groupAt"+this.groupLevel;t.smask&&(f+="_smask_"+this.smaskCounter++%2);let m=this.cachedCanvases.getCanvas(f,c,u),b=m.context;b.translate(-a,-o),b.transform(...i),t.smask?this.smaskStack.push({canvas:m.canvas,context:b,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),Qi(e,b),this.ctx=b,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;let e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=Rt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let n=tt.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(this.#t(),$s(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){let a=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o;let[c,u]=tt.singularValueDecompose2dScale(Rt(this.ctx)),{viewportScale:f}=this,m=Math.ceil(a*this.outputScaleX*f),b=Math.ceil(o*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(m,b);let{canvas:A,context:w}=this.annotationCanvas;this.annotationCanvasMap.set(t,A),this.annotationCanvas.savedCtx=this.ctx,this.ctx=w,this.ctx.save(),this.ctx.setTransform(c,0,0,-u,0,o*u),$s(this.ctx)}else $s(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new hn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;let e=t.count;t=this.getObject(t.data,t),t.count=e;let i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=sc(t)),s.compiled)){s.compiled(i);return}let n=this._createMaskCanvas(t),a=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);let o=this.ctx;o.save();let c=Rt(o);o.transform(e,i,s,n,0,0);let u=this._createMaskCanvas(t);o.setTransform(1,0,0,1,u.offsetX-c[4],u.offsetY-c[5]);for(let f=0,m=a.length;f<m;f+=2){let b=tt.transform(c,[e,i,s,n,a[f],a[f+1]]),[A,w]=tt.applyTransform([0,0],b);o.drawImage(u.canvas,A,w)}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;let e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(let n of t){let{data:a,width:o,height:c,transform:u}=n,f=this.cachedCanvases.getCanvas("maskCanvas",o,c),m=f.context;m.save();let b=this.getObject(a,n);ll(m,b),m.globalCompositeOperation="source-in",m.fillStyle=s?i.getPattern(m,this,Le(e),Qt.FILL):i,m.fillRect(0,0,o,c),m.restore(),e.save(),e.transform(...u),e.scale(1,-1),Vs(e,f.canvas,0,0,o,c,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;let e=this.getObject(t);if(!e){dt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;let n=this.getObject(t);if(!n){dt("Dependent image isn't ready yet");return}let a=n.width,o=n.height,c=[];for(let u=0,f=s.length;u<f;u+=2)c.push({transform:[e,0,0,i,s[u],s[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,c)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;let{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;let e=t.width,i=t.height,s=this.ctx;if(this.save(),!Jt){let{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none")}s.scale(1/e,-1/i);let n;if(t.bitmap)n=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)n=t;else{let c=this.cachedCanvases.getCanvas("inlineImage",e,i).context;ol(c,t),n=this.applyTransferMapsToCanvas(c)}let a=this._scaleImage(n,Le(s));s.imageSmoothingEnabled=hl(Rt(s),t.interpolate),Vs(s,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;let i=this.ctx,s;if(t.bitmap)s=t.bitmap;else{let n=t.width,a=t.height,c=this.cachedCanvases.getCanvas("inlineImage",n,a).context;ol(c,t),s=this.applyTransferMapsToCanvas(c)}for(let n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),Vs(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){let e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);let i=this.ctx;this.pendingClip&&(e||(this.pendingClip===cl?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let t=Rt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{let e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform(),a,o;if(i===0&&s===0){let c=Math.abs(e),u=Math.abs(n);if(c===u)if(t===0)a=o=1/c;else{let f=c*t;a=o=f<1?1/f:1}else if(t===0)a=1/c,o=1/u;else{let f=c*t,m=u*t;a=f<1?1/f:1,o=m<1?1/m:1}}else{let c=Math.abs(e*n-i*s),u=Math.hypot(e,i),f=Math.hypot(s,n);if(t===0)a=f/c,o=u/c;else{let m=t*c;a=f>m?f/m:1,o=u>m?u/m:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t){let{ctx:e}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(e.lineWidth=i||1,s===1&&n===1){e.stroke();return}let a=e.getLineDash();if(t&&e.save(),e.scale(s,n),a.length>0){let o=Math.max(s,n);e.setLineDash(a.map(c=>c/o)),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};for(let h in we)Ii.prototype[h]!==void 0&&(Ii.prototype[we[h]]=Ii.prototype[h]);var ci=class{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}},Vr=class{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}getAll(){return Ha(this.#t)}has(t){return this.#t.has(t)}},Li=Symbol("INTERNAL"),$r=class{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){this.#t=!!(t&fe.DISPLAY),this.#e=!!(t&fe.PRINT),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;let{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==Li&&Ct("Internal method `_setVisible` called."),this.#i=i,this.#s=e}},Ur=class{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=fe.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(let i of t.groups)this.#e.set(i.id,new $r(e,i));if(t.baseState==="OFF")for(let i of this.#e.values())i._setVisible(Li,!1);for(let i of t.on)this.#e.get(i)._setVisible(Li,!0);for(let i of t.off)this.#e.get(i)._setVisible(Li,!1);this.#i=this.getHash()}}#r(t){let e=t.length;if(e<2)return!0;let i=t[0];for(let s=1;s<e;s++){let n=t[s],a;if(Array.isArray(n))a=this.#r(n);else if(this.#e.has(n))a=this.#e.get(n).visible;else return dt(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Pn("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(dt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(let e of t.ids){if(!this.#e.has(e))return dt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(let e of t.ids){if(!this.#e.has(e))return dt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(let e of t.ids){if(!this.#e.has(e))return dt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(let e of t.ids){if(!this.#e.has(e))return dt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return dt(`Unknown optional content policy ${t.policy}.`),!0}return dt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){let s=this.#e.get(t);if(!s){dt(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(let n of s.rbGroups)for(let a of n)a!==t&&this.#e.get(a)?._setVisible(Li,!1,!0);s._setVisible(Li,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let i;for(let s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}let n=this.#e.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?Ha(this.#e):null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;let t=new tn;for(let[e,i]of this.#e)t.update(`${e}:${i.visible}`);return this.#t=t.hexdigest()}},Gr=class{constructor(t,{disableRange:e=!1,disableStream:i=!1}){jt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,n?.length>0){let c=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((c,u)=>{this._onReceiveData({begin:c,chunk:u})}),t.addProgressListener((c,u)=>{this._onProgress({loaded:c,total:u})}),t.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){let i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{let s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});jt(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){let e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){jt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let t=this._queuedChunks;return this._queuedChunks=null,new qr(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new Wr(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}},qr=class{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=ja(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(let n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return Y(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},Wr=class{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return Y(this,null,function*(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function oc(h){let t=!0,e=i("filename\\*","i").exec(h);if(e){e=e[1];let f=o(e);return f=unescape(f),f=c(f),f=u(f),n(f)}if(e=a(h),e){let f=u(e);return n(f)}if(e=i("filename","i").exec(h),e){e=e[1];let f=o(e);return f=u(f),n(f)}function i(f,m){return new RegExp("(?:^|;)\\s*"+f+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function s(f,m){if(f){if(!/^[\x00-\xFF]+$/.test(m))return m;try{let b=new TextDecoder(f,{fatal:!0}),A=Mn(m);m=b.decode(A),t=!1}catch{}}return m}function n(f){return t&&/[\x80-\xff]/.test(f)&&(f=s("utf-8",f),t&&(f=s("iso-8859-1",f))),f}function a(f){let m=[],b,A=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=A.exec(f))!==null;){let[,x,C,k]=b;if(x=parseInt(x,10),x in m){if(x===0)break;continue}m[x]=[C,k]}let w=[];for(let x=0;x<m.length&&x in m;++x){let[C,k]=m[x];k=o(k),C&&(k=unescape(k),x===0&&(k=c(k))),w.push(k)}return w.join("")}function o(f){if(f.startsWith('"')){let m=f.slice(1).split('\\"');for(let b=0;b<m.length;++b){let A=m[b].indexOf('"');A!==-1&&(m[b]=m[b].slice(0,A),m.length=b+1),m[b]=m[b].replaceAll(/\\(.)/g,"$1")}f=m.join('"')}return f}function c(f){let m=f.indexOf("'");if(m===-1)return f;let b=f.slice(0,m),w=f.slice(m+1).replace(/^[^']*'/,"");return s(b,w)}function u(f){return!f.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(f)?f:f.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,b,A,w){if(A==="q"||A==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(x,C){return String.fromCharCode(parseInt(C,16))}),s(b,w);try{w=atob(w)}catch{}return s(b,w)})}return""}function ml(h,t){let e=new Headers;if(!h||!t||typeof t!="object")return e;for(let i in t){let s=t[i];s!==void 0&&e.append(i,s)}return e}function In(h){try{return new URL(h).origin}catch{}return null}function bl({responseHeaders:h,isHttp:t,rangeChunkSize:e,disableRange:i}){let s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(h.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||h.get("Accept-Ranges")!=="bytes"||(h.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function vl(h){let t=h.get("Content-Disposition");if(t){let e=oc(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(ja(e))return e}return null}function Dn(h,t){return h===404||h===0&&t.startsWith("file:")?new ui('Missing PDF "'+t+'".'):new Fi(`Unexpected server response (${h}) while retrieving PDF "${t}".`,h)}function yl(h){return h===200||h===206}function Al(h,t,e){return{method:"GET",headers:h,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function _l(h){return h instanceof Uint8Array?h.buffer:h instanceof ArrayBuffer?h:(dt(`getArrayBuffer - unexpected data format: ${h}`),new Uint8Array(h).buffer)}var cn=class{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=ml(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return jt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Xr(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new Yr(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},Xr=class{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;let e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;let i=new Headers(t.headers),s=e.url;fetch(s,Al(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=In(n.url),!yl(n.status))throw Dn(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();let a=n.headers,{allowRangeRequests:o,suggestedLength:c}=bl({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=c||this._contentLength,this._filename=vl(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new De("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return Y(this,null,function*(){yield this._headersCapability.promise;let{value:t,done:e}=yield this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:_l(t),done:!1})})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}},Yr=class{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;let s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);let a=s.url;fetch(a,Al(n,this._withCredentials,this._abortController)).then(o=>{let c=In(o.url);if(c!==t._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${t._responseOrigin}".`);if(!yl(o.status))throw Dn(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return Y(this,null,function*(){yield this._readCapability.promise;let{value:t,done:e}=yield this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:_l(t),done:!1})})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}},br=200,vr=206;function lc(h){let t=h.response;return typeof t!="string"?t:Mn(t).buffer}var Kr=class{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=ml(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){let e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(let[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=vr):s.expectedStatus=br,e.responseType="arraybuffer",jt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){let i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){let i=this.pendingRequests[t];if(!i)return;let s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}let n=s.status||br;if(!(n===br&&i.expectedStatus===vr)&&n!==i.expectedStatus){i.onError(s.status);return}let o=lc(s);if(n===vr){let c=s.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);u?i.onDone({begin:parseInt(u[1],10),chunk:o}):(dt('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){let e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}},Qr=class{constructor(t){this._source=t,this._manager=new Kr(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){let e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return jt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Jr(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){let i=new Zr(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},Jr=class{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=In(e.responseURL);let i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{let[c,...u]=o.split(": ");return[c,u.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=bl({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=vl(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Dn(t,this._url),this._headersCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return Y(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0,this._headersCapability.reject(t);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},Zr=class{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let t=In(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){let e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Dn(t,this._url);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}read(){return Y(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},hc=/^[a-z][a-z0-9\-+.]+:/i;function cc(h){if(hc.test(h))return new URL(h);let t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(h))}var ta=class{constructor(t){this.source=t,this.url=cc(t.url),jt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return jt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new ea(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new ia(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},ea=class{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;let e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new ui(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return Y(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new De("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},ia=class{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=t.source;this._isStreamingSupported=!s.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return Y(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}},uc=1e5,oe=30,dc=.8,cs=class h{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#l=0;#o=0;#c=null;#h=null;#d=0;#u=0;#f=Object.create(null);#a=[];#p=null;#m=[];#g=new WeakMap;#b=null;static#A=new Map;static#v=new Map;static#_=new WeakMap;static#x=null;static#E=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(c){c.enqueue(t),c.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#h=e,this.#u=i.scale*(globalThis.devicePixelRatio||1),this.#d=i.rotation,this.#n={div:null,properties:null,ctx:null};let{pageWidth:s,pageHeight:n,pageX:a,pageY:o}=i.rawDims;this.#b=[1,0,0,-1,-a,o+n],this.#o=s,this.#l=n,h.#R(),di(e,i),this.#t.promise.finally(()=>{h.#E.delete(this),this.#n=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:t,isFirefox:e}=Wt.platform;return gt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){let t=()=>{this.#c.read().then(({value:e,done:i})=>{if(i){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#f,e.styles),this.#T(e.items),t()},this.#t.reject)};return this.#c=this.#p.getReader(),h.#E.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){let i=t.scale*(globalThis.devicePixelRatio||1),s=t.rotation;if(s!==this.#d&&(e?.(),this.#d=s,di(this.#h,{rotation:s})),i!==this.#u){e?.(),this.#u=i;let n={div:null,properties:null,ctx:h.#k(this.#r)};for(let a of this.#m)n.properties=this.#g.get(a),n.div=a,this.#w(n)}}cancel(){let t=new De("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#a}#T(t){if(this.#i)return;this.#n.ctx??=h.#k(this.#r);let e=this.#m,i=this.#a;for(let s of t){if(e.length>uc){dt("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){let n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id!==null&&this.#e.setAttribute("id",`${s.id}`),n.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(s.str),this.#P(s)}}#P(t){let e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#m.push(e);let s=tt.transform(this.#b,t.transform),n=Math.atan2(s[1],s[0]),a=this.#f[t.fontName];a.vertical&&(n+=Math.PI/2);let o=this.#s&&a.fontSubstitution||a.fontFamily;o=h.fontFamilyMap.get(o)||o;let c=Math.hypot(s[2],s[3]),u=c*h.#D(o,this.#r),f,m;n===0?(f=s[4],m=s[5]-u):(f=s[4]+u*Math.sin(n),m=s[5]-u*Math.cos(n));let b="calc(var(--scale-factor)*",A=e.style;this.#e===this.#h?(A.left=`${(100*f/this.#o).toFixed(2)}%`,A.top=`${(100*m/this.#l).toFixed(2)}%`):(A.left=`${b}${f.toFixed(2)}px)`,A.top=`${b}${m.toFixed(2)}px)`),A.fontSize=`${b}${(h.#x*c).toFixed(2)}px)`,A.fontFamily=o,i.fontSize=c,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let w=!1;if(t.str.length>1)w=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){let x=Math.abs(t.transform[0]),C=Math.abs(t.transform[3]);x!==C&&Math.max(x,C)/Math.min(x,C)>1.5&&(w=!0)}if(w&&(i.canvasWidth=a.vertical?t.height:t.width),this.#g.set(e,i),this.#n.div=e,this.#n.properties=i,this.#w(this.#n),i.hasText&&this.#e.append(e),i.hasEOL){let x=document.createElement("br");x.setAttribute("role","presentation"),this.#e.append(x)}}#w(t){let{div:e,properties:i,ctx:s}=t,{style:n}=e,a="";if(h.#x>1&&(a=`scale(${1/h.#x})`),i.canvasWidth!==0&&i.hasText){let{fontFamily:o}=n,{canvasWidth:c,fontSize:u}=i;h.#C(s,u*this.#u,o);let{width:f}=s.measureText(e.textContent);f>0&&(a=`scaleX(${c*this.#u/f}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#E.size>0)){this.#A.clear();for(let{canvas:t}of this.#v.values())t.remove();this.#v.clear()}}static#k(t=null){let e=this.#v.get(t||="");if(!e){let i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(t,e),this.#_.set(e,{size:0,family:""})}return e}static#C(t,e,i){let s=this.#_.get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)}static#R(){if(this.#x!==null)return;let t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#x=t.getBoundingClientRect().height,t.remove()}static#D(t,e){let i=this.#A.get(t);if(i)return i;let s=this.#k(e);s.canvas.width=s.canvas.height=oe,this.#C(s,oe,t);let n=s.measureText(""),a=n.fontBoundingBoxAscent,o=Math.abs(n.fontBoundingBoxDescent);if(a){let f=a/(a+o);return this.#A.set(t,f),s.canvas.width=s.canvas.height=0,f}s.strokeStyle="red",s.clearRect(0,0,oe,oe),s.strokeText("g",0,0);let c=s.getImageData(0,0,oe,oe).data;o=0;for(let f=c.length-1-3;f>=0;f-=4)if(c[f]>0){o=Math.ceil(f/4/oe);break}s.clearRect(0,0,oe,oe),s.strokeText("A",0,oe),c=s.getImageData(0,0,oe,oe).data,a=0;for(let f=0,m=c.length;f<m;f+=4)if(c[f]>0){a=oe-Math.floor(f/4/oe);break}s.canvas.width=s.canvas.height=0;let u=a?a/(a+o):dc;return this.#A.set(t,u),u}},us=class h{static textContent(t){let e=[],i={items:e,styles:Object.create(null)};function s(n){if(!n)return;let a=null,o=n.name;if(o==="#text")a=n.value;else if(h.shouldBuildText(o))n?.attributes?.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(let c of n.children)s(c)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}},fc=65536,pc=100,gc=5e3,mc=Jt?Dr:Rr,bc=Jt?Nr:rn,vc=Jt?Ir:Lr,yc=Jt?Or:ln;function Ac(h={}){typeof h=="string"||h instanceof URL?h={url:h}:(h instanceof ArrayBuffer||ArrayBuffer.isView(h))&&(h={data:h});let t=new sa,{docId:e}=t,i=h.url?_c(h.url):null,s=h.data?wc(h.data):null,n=h.httpHeaders||null,a=h.withCredentials===!0,o=h.password??null,c=h.range instanceof un?h.range:null,u=Number.isInteger(h.rangeChunkSize)&&h.rangeChunkSize>0?h.rangeChunkSize:fc,f=h.worker instanceof Di?h.worker:null,m=h.verbosity,b=typeof h.docBaseUrl=="string"&&!Ln(h.docBaseUrl)?h.docBaseUrl:null,A=typeof h.cMapUrl=="string"?h.cMapUrl:null,w=h.cMapPacked!==!1,x=h.CMapReaderFactory||bc,C=typeof h.standardFontDataUrl=="string"?h.standardFontDataUrl:null,k=h.StandardFontDataFactory||yc,D=h.stopAtErrors!==!0,O=Number.isInteger(h.maxImageSize)&&h.maxImageSize>-1?h.maxImageSize:-1,B=h.isEvalSupported!==!1,j=typeof h.isOffscreenCanvasSupported=="boolean"?h.isOffscreenCanvasSupported:!Jt,p=typeof h.isImageDecoderSupported=="boolean"?h.isImageDecoderSupported:!Jt&&(Wt.platform.isFirefox||!globalThis.chrome),V=Number.isInteger(h.canvasMaxAreaInBytes)?h.canvasMaxAreaInBytes:-1,U=typeof h.disableFontFace=="boolean"?h.disableFontFace:Jt,rt=h.fontExtraProperties===!0,yt=h.enableXfa===!0,pt=h.ownerDocument||globalThis.document,nt=h.disableRange===!0,Pt=h.disableStream===!0,St=h.disableAutoFetch===!0,Xt=h.pdfBug===!0,X=h.CanvasFactory||mc,Q=h.FilterFactory||vc,zt=h.enableHWA===!0,ce=c?c.length:h.length??NaN,Se=typeof h.useSystemFonts=="boolean"?h.useSystemFonts:!Jt&&!U,Zt=typeof h.useWorkerFetch=="boolean"?h.useWorkerFetch:x===rn&&k===ln&&A&&C&&ts(A,document.baseURI)&&ts(C,document.baseURI),Nt=null;Oh(m);let Lt={canvasFactory:new X({ownerDocument:pt,enableHWA:zt}),filterFactory:new Q({docId:e,ownerDocument:pt}),cMapReaderFactory:Zt?null:new x({baseUrl:A,isCompressed:w}),standardFontDataFactory:Zt?null:new k({baseUrl:C})};if(!f){let ie={verbosity:m,port:ci.workerPort};f=ie.port?Di.fromPort(ie):new Di(ie),t._worker=f}let Ue={docId:e,apiVersion:"4.10.38",data:s,password:o,disableAutoFetch:St,rangeChunkSize:u,length:ce,docBaseUrl:b,enableXfa:yt,evaluatorOptions:{maxImageSize:O,disableFontFace:U,ignoreErrors:D,isEvalSupported:B,isOffscreenCanvasSupported:j,isImageDecoderSupported:p,canvasMaxAreaInBytes:V,fontExtraProperties:rt,useSystemFonts:Se,cMapUrl:Zt?A:null,standardFontDataUrl:Zt?C:null}},Ze={disableFontFace:U,fontExtraProperties:rt,ownerDocument:pt,pdfBug:Xt,styleElement:Nt,loadingParams:{disableAutoFetch:St,enableXfa:yt}};return f.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");let ie=f.messageHandler.sendWithPromise("GetDocRequest",Ue,s?[s.buffer]:null),Tt;if(c)Tt=new Gr(c,{disableRange:nt,disableStream:Pt});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let ue;if(Jt)if(ts(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");ue=cn}else ue=ta;else ue=ts(i)?cn:Qr;Tt=new ue({url:i,length:ce,httpHeaders:n,withCredentials:a,rangeChunkSize:u,disableRange:nt,disableStream:Pt})}return ie.then(ue=>{if(t.destroyed)throw new Error("Loading aborted");if(f.destroyed)throw new Error("Worker was destroyed");let de=new oi(e,ue,f.port),Fn=new oa(de,t,Tt,Ze,Lt);t._transport=Fn,de.send("Ready",null)})}).catch(t._capability.reject),t}function _c(h){if(h instanceof URL)return h.href;try{return new URL(h,window.location).href}catch{if(Jt&&typeof h=="string")return h}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function wc(h){if(Jt&&typeof Buffer<"u"&&h instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength)return h;if(typeof h=="string")return Mn(h);if(h instanceof ArrayBuffer||ArrayBuffer.isView(h)||typeof h=="object"&&!isNaN(h?.length))return new Uint8Array(h);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function ul(h){return typeof h=="object"&&Number.isInteger(h?.num)&&h.num>=0&&Number.isInteger(h?.gen)&&h.gen>=0}var sa=class h{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${h.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return Y(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null})}},un=class{constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(let i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(let e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){Ct("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},na=class{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},ra=class{#t=null;#e=!1;constructor(t,e,i,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new Ks:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new dn,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new ns({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return Y(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=Ye.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:c=null,pageColors:u=null,printAnnotationStorage:f=null,isEditing:m=!1}){this._stats?.time("Overall");let b=this._transport.getRenderingIntent(i,s,f,m),{renderingIntent:A,cacheKey:w}=b;this.#e=!1,this.#s(),o||=this._transport.getOptionalContentConfig(A);let x=this._intentStates.get(w);x||(x=Object.create(null),this._intentStates.set(w,x)),x.streamReaderCancelTimeout&&(clearTimeout(x.streamReaderCancelTimeout),x.streamReaderCancelTimeout=null);let C=!!(A&fe.PRINT);x.displayReadyCapability||(x.displayReadyCapability=Promise.withResolvers(),x.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(b));let k=B=>{x.renderTasks.delete(D),(this._maybeCleanupAfterRender||C)&&(this.#e=!0),this.#i(!C),B?(D.capability.reject(B),this._abortOperatorList({intentState:x,reason:B instanceof Error?B:new Error(B)})):D.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},D=new ha({callback:k,params:{canvasContext:t,viewport:e,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:x.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!C,pdfBug:this._pdfBug,pageColors:u});(x.renderTasks||=new Set).add(D);let O=D.task;return Promise.all([x.displayReadyCapability.promise,o]).then(([B,j])=>{if(this.destroyed){k();return}if(this._stats?.time("Rendering"),!(j.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");D.initializeGraphics({transparency:B,optionalContentConfig:j}),D.operatorListChanged()}).catch(k),O}getOperatorList({intent:t="display",annotationMode:e=Ye.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(c))}let a=this._transport.getRenderingIntent(t,e,i,s,!0),o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let c;return o.opListReadCapability||(c=Object.create(null),c.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(c),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>us.textContent(i));let e=this.streamTextContent(t);return new Promise(function(i,s){function n(){a.read().then(function({value:c,done:u}){if(u){i(o);return}o.lang??=c.lang,Object.assign(o.styles,c.styles),o.items.push(...c.items),n()},s)}let a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let t=[];for(let e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(let i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(t)}cleanup(t=!1){this.#e=!0;let e=this.#i(!1);return t&&e&&(this._stats&&=new Ks),e}#i(t=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(t)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},gc),!1;for(let{renderTasks:e,operatorList:i}of this._intentStates.values())if(e.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(t,e){let i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(let i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){let{map:n,transfer:a}=i,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},a).getReader(),u=this._intentStates.get(e);u.streamReader=c;let f=()=>{c.read().then(({value:m,done:b})=>{if(b){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(m,u),f())},m=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(let b of u.renderTasks)b.operatorListChanged();this.#i(!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(m);else if(u.opListReadCapability)u.opListReadCapability.reject(m);else throw m}})};f()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof rs){let s=pc;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new De(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(let[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}},aa=class{#t=new Map;#e=Promise.resolve();postMessage(t,e){let i={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(let[s]of this.#t)s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if(i?.signal instanceof AbortSignal){let{signal:n}=i;if(n.aborted){dt("LoopbackPort - cannot use an `aborted` signal.");return}let a=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(let[,t]of this.#t)t?.();this.#t.clear()}},Cn,li,hi,Ni,Ws,Oi,Xs,Mt=class Mt{constructor({name:t=null,port:e=null,verbosity:i=Fh()}={}){Ti(this,Ni);if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if(Re(Mt,hi)?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(Re(Mt,hi)||Ps(Mt,hi,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new oi("main","worker",t),this._messageHandler.on("ready",function(){}),Ms(this,Ni,Ws).call(this)}_initialize(){if(Re(Mt,li)||Re(Mt,Oi,Xs)){this._setupFakeWorker();return}let{workerSrc:t}=Mt;try{Mt._isSameOrigin(window.location.href,t)||(t=Mt._createCDNWrapper(new URL(t,window.location).href));let e=new Worker(t,{type:"module"}),i=new oi("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;e.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}this._messageHandler=i,this._port=e,this._webWorker=e,Ms(this,Ni,Ws).call(this)}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{this._setupFakeWorker()}});let a=()=>{let o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{Pn("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){Re(Mt,li)||(dt("Setting up fake worker."),Ps(Mt,li,!0)),Mt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new aa;this._port=e;let i=`fake${Co(Mt,Cn)._++}`,s=new oi(i+"_worker",i,e);t.setup(s,e),this._messageHandler=new oi(i,i+"_worker",e),Ms(this,Ni,Ws).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,Re(Mt,hi)?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let e=Re(this,hi)?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Mt(t)}static get workerSrc(){if(ci.workerSrc)return ci.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return gt(this,"_setupFakeWorkerGlobal",Y(this,null,function*(){return Re(this,Oi,Xs)?Re(this,Oi,Xs):(yield import(this.workerSrc)).WorkerMessageHandler}))}};Cn=new WeakMap,li=new WeakMap,hi=new WeakMap,Ni=new WeakSet,Ws=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Oi=new WeakSet,Xs=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Ti(Mt,Oi),Ti(Mt,Cn,0),Ti(Mt,li,!1),Ti(Mt,hi),Jt&&(Ps(Mt,li,!0),ci.workerSrc||="./pdf.worker.mjs"),Mt._isSameOrigin=(t,e)=>{let i;try{if(i=new URL(t),!i.origin||i.origin==="null")return!1}catch{return!1}let s=new URL(e,i);return i.origin===s.origin},Mt._createCDNWrapper=t=>{let e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var Di=Mt,oa=class{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#r=null;constructor(t,e,i,s,n){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new dn,this.fontLoader=new Pr({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(t,e=null){let i=this.#t.get(t);if(i)return i;let s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return gt(this,"annotationStorage",new ls)}getRenderingIntent(t,e=Ye.ENABLE,i=null,s=!1,n=!1){let a=fe.DISPLAY,o=kr;switch(t){case"any":a=fe.ANY;break;case"display":break;case"print":a=fe.PRINT;break;default:dt(`getRenderingIntent - invalid intent: ${t}`)}let c=a&fe.PRINT&&i instanceof en?i:this.annotationStorage;switch(e){case Ye.DISABLE:a+=fe.ANNOTATIONS_DISABLE;break;case Ye.ENABLE:break;case Ye.ENABLE_FORMS:a+=fe.ANNOTATIONS_FORMS;break;case Ye.ENABLE_STORAGE:a+=fe.ANNOTATIONS_STORAGE,o=c.serializable;break;default:dt(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=fe.IS_EDITING),n&&(a+=fe.OPLIST);let{ids:u,hash:f}=c.modifiedIds,m=[a,o.hash,f];return{renderingIntent:a,cacheKey:m.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));let t=[];for(let i of this.#e.values())t.push(i._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),cs.cleanup(),this._networkStream?.cancelAllRequests(new De("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{jt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}jt(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",i=>Y(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{e.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}})),t.on("GetRangeReader",(i,s)=>{jt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){s.close();return}jt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new na(i,this))}),t.on("DocException",i=>{e._capability.reject(le(i))}),t.on("PasswordRequest",i=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw le(i);let s=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};e.onPassword(s,i.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:o,pdfBug:c}=this._params;if("error"in n){let b=n.error;dt(`Error during font loading: ${b}`),this.commonObjs.resolve(i,b);break}let u=c&&globalThis.FontInspector?.enabled?(b,A)=>globalThis.FontInspector.fontAdded(b,A):null,f=new Mr(n,{disableFontFace:a,fontExtraProperties:o,inspectFont:u});this.fontLoader.bind(f).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!o&&f.data&&(f.data=null),this.commonObjs.resolve(i,f)});break;case"CopyLocalImage":let{imageRef:m}=n;jt(m,"The imageRef must be defined.");for(let b of this.#e.values())for(let[,A]of b.objs)if(A?.ref===m)return A.dataLen?(this.commonObjs.resolve(i,structuredClone(A)),A.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,a])=>{if(this.destroyed)return;let o=this.#e.get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){a?.bitmap?.close();return}switch(n){case"Image":o.objs.resolve(i,a),a?.dataLen>Rh&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBuiltInCMap",i=>Y(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)})),t.on("FetchStandardFontData",i=>Y(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&dt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));let e=t-1,i=this.#i.get(e);if(i)return i;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,t);let a=new ra(e,n,this,this._params.pdfBug);return this.#e.set(e,a),a});return this.#i.set(e,s),s}getPageIndex(t){return ul(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#n("GetOptionalContentConfig").then(e=>new Ur(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let t="GetMetadata",e=this.#t.get(t);if(e)return e;let i=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new Vr(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(t=!1){return Y(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),cs.cleanup()}})}cachedPageNumber(t){if(!ul(t))return null;let e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}},Ji=Symbol("INITIAL_DATA"),dn=class{#t=Object.create(null);#e(t){return this.#t[t]||=Ci(Be({},Promise.withResolvers()),{data:Ji})}get(t,e=null){if(e){let s=this.#e(t);return s.promise.then(()=>e(s.data)),null}let i=this.#t[t];if(!i||i.data===Ji)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){let e=this.#t[t];return!!e&&e.data!==Ji}delete(t){let e=this.#t[t];return!e||e.data===Ji?!1:(delete this.#t[t],!0)}resolve(t,e=null){let i=this.#e(t);i.data=e,i.resolve()}clear(){for(let t in this.#t){let{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(let t in this.#t){let{data:e}=this.#t[t];e!==Ji&&(yield[t,e])}}},la=class{#t=null;constructor(t){this.#t=t,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){let{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;let{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}},ha=class h{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:c,filterFactory:u,useRequestAnimationFrame:f=!1,pdfBug:m=!1,pageColors:b=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=c,this.filterFactory=u,this._pdfBug=m,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=f===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new la(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(h.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");h.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:s,transform:n,background:a}=this.params;this.gfx=new Ii(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),h.#e.delete(this._canvas),this.callback(t||new rs(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return Y(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),h.#e.delete(this._canvas),this.callback())))})}},xc="4.10.38",Sc="f9bea397f";function dl(h){return Math.floor(Math.max(0,Math.min(1,h))*255).toString(16).padStart(2,"0")}function Zi(h){return Math.max(0,Math.min(255,255*h))}var fn=class{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Zi(t),[t,t,t]}static G_HTML([t]){let e=dl(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(Zi)}static RGB_HTML(t){return`#${t.map(dl).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[Zi(1-Math.min(1,t+s)),Zi(1-Math.min(1,i+s)),Zi(1-Math.min(1,e+s))]}static CMYK_HTML(t){let e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){let s=1-t,n=1-e,a=1-i,o=Math.min(s,n,a);return["CMYK",s,n,a,o]}},ca=class{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Ct("Abstract method `_createSVG` called.")}},ds=class extends ca{_createSVG(t){return document.createElementNS(Ve,t)}},pn=class{static setupStorage(t,e,i,s,n){let a=s.getValue(e,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?t.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{s.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(let o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{let c=o.target.options,u=c.selectedIndex===-1?"":c[c.selectedIndex].value;s.setValue(e,{value:u})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){let{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(let[c,u]of Object.entries(a))if(u!=null)switch(c){case"class":u.length&&t.setAttribute(c,u.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",u);break;case"style":Object.assign(t.style,u);break;case"textContent":t.textContent=u;break;default:(!o||c!=="href"&&c!=="newWindow")&&t.setAttribute(c,u)}o&&n.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,e,i)}static render(t){let e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});let o=n!=="richText",c=t.div;if(c.append(a),t.viewport){let m=`matrix(${t.viewport.transform.join(",")})`;c.style.transform=m}o&&c.setAttribute("class","xfaLayer xfaFont");let u=[];if(s.children.length===0){if(s.value){let m=document.createTextNode(s.value);a.append(m),o&&us.shouldBuildText(s.name)&&u.push(m)}return{textDivs:u}}let f=[[s,-1,a]];for(;f.length>0;){let[m,b,A]=f.at(-1);if(b+1===m.children.length){f.pop();continue}let w=m.children[++f.at(-1)[1]];if(w===null)continue;let{name:x}=w;if(x==="#text"){let k=document.createTextNode(w.value);u.push(k),A.append(k);continue}let C=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,x):document.createElement(x);if(A.append(C),w.attributes&&this.setAttributes({html:C,element:w,storage:e,intent:n,linkService:i}),w.children?.length>0)f.push([w,-1,C]);else if(w.value){let k=document.createTextNode(w.value);o&&us.shouldBuildText(x)&&u.push(k),C.append(k)}}for(let m of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:u}}static update(t){let e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}},bs=1e3,Ec=9,pi=new WeakSet;function Ke(h){return{width:h[2]-h[0],height:h[3]-h[1]}}var ua=class{static create(t){switch(t.data.annotationType){case $t.LINK:return new gn(t);case $t.TEXT:return new da(t);case $t.WIDGET:switch(t.data.fieldType){case"Tx":return new fa(t);case"Btn":return t.data.radioButton?new mn(t):t.data.checkBox?new ga(t):new ma(t);case"Ch":return new ba(t);case"Sig":return new pa(t)}return new $e(t);case $t.POPUP:return new fs(t);case $t.FREETEXT:return new bn(t);case $t.LINE:return new ya(t);case $t.SQUARE:return new Aa(t);case $t.CIRCLE:return new _a(t);case $t.POLYLINE:return new vn(t);case $t.CARET:return new xa(t);case $t.INK:return new ps(t);case $t.POLYGON:return new wa(t);case $t.HIGHLIGHT:return new yn(t);case $t.UNDERLINE:return new Sa(t);case $t.SQUIGGLY:return new Ea(t);case $t.STRIKEOUT:return new Ca(t);case $t.STAMP:return new An(t);case $t.FILEATTACHMENT:return new Ta(t);default:return new Ht(t)}}},Ht=class h{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t?.str||e?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return h._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};let{rect:e}=t;e&&this.#s(e),this.#i?.popup.updateEdited(t)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){let{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}}}=this;i?.splice(0,4,...t);let{width:u,height:f}=Ke(t);e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(a-t[3]+c)/a}%`,s===0?(e.width=`${100*u/n}%`,e.height=`${100*f/a}%`):this.setRotation(s)}_createContainer(t){let{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof $e||(n.tabIndex=bs);let{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof fs){let{rotation:x}=e;return!e.hasOwnCanvas&&x!==0&&this.setRotation(x,n),n}let{width:o,height:c}=Ke(e.rect);if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;let x=e.borderStyle.horizontalCornerRadius,C=e.borderStyle.verticalCornerRadius;if(x>0||C>0){let D=`calc(${x}px * var(--scale-factor)) / calc(${C}px * var(--scale-factor))`;a.borderRadius=D}else if(this instanceof mn){let D=`calc(${o}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;a.borderRadius=D}switch(e.borderStyle.style){case Ki.SOLID:a.borderStyle="solid";break;case Ki.DASHED:a.borderStyle="dashed";break;case Ki.BEVELED:dt("Unimplemented border style: beveled");break;case Ki.INSET:dt("Unimplemented border style: inset");break;case Ki.UNDERLINE:a.borderBottomStyle="solid";break;default:break}let k=e.borderColor||null;k?(this.#e=!0,a.borderColor=tt.makeHexColor(k[0]|0,k[1]|0,k[2]|0)):a.borderWidth=0}let u=tt.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:f,pageHeight:m,pageX:b,pageY:A}=s.rawDims;a.left=`${100*(u[0]-b)/f}%`,a.top=`${100*(u[1]-A)/m}%`;let{rotation:w}=e;return e.hasOwnCanvas||w===0?(a.width=`${100*o/f}%`,a.height=`${100*c/m}%`):this.setRotation(w,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;let{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:a}=Ke(this.data.rect),o,c;t%180===0?(o=100*n/i,c=100*a/s):(o=100*a/i,c=100*n/s),e.style.width=`${o}%`,e.style.height=`${c}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){let t=(e,i,s)=>{let n=s.detail[e],a=n[0],o=n.slice(1);s.target.style[i]=fn[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:fn[`${a}_rgb`](o)})};return gt(this,"_commonActions",{display:e=>{let{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{let i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){let i=this._commonActions;for(let s of Object.keys(e.detail))(t[s]||i[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;let e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;let i=this._commonActions;for(let[s,n]of Object.entries(e)){let a=i[s];if(a){let o={detail:{[s]:n},target:t};a(o),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:t}=this.data;if(!t)return;let[e,i,s,n]=this.data.rect.map(x=>Math.fround(x));if(t.length===8){let[x,C,k,D]=t.subarray(2,6);if(s===x&&n===C&&e===k&&i===D)return}let{style:a}=this.container,o;if(this.#e){let{borderColor:x,borderWidth:C}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${x}" stroke-width="${C}">`],this.container.classList.add("hasBorder")}let c=s-e,u=n-i,{svgFactory:f}=this,m=f.createElement("svg");m.classList.add("quadrilateralsContainer"),m.setAttribute("width",0),m.setAttribute("height",0);let b=f.createElement("defs");m.append(b);let A=f.createElement("clipPath"),w=`clippath_${this.data.id}`;A.setAttribute("id",w),A.setAttribute("clipPathUnits","objectBoundingBox"),b.append(A);for(let x=2,C=t.length;x<C;x+=8){let k=t[x],D=t[x+1],O=t[x+2],B=t[x+3],j=f.createElement("rect"),p=(O-e)/c,V=(n-D)/u,U=(k-O)/c,rt=(D-B)/u;j.setAttribute("x",p),j.setAttribute("y",V),j.setAttribute("width",U),j.setAttribute("height",rt),A.append(j),o?.push(`<rect vector-effect="non-scaling-stroke" x="${p}" y="${V}" width="${U}" height="${rt}"/>`)}this.#e&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(m),this.container.style.clipPath=`url(#${w})`}_createPopup(){let{data:t}=this,e=this.#i=new fs({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){Ct("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){let i=[];if(this._fieldObjects){let s=this._fieldObjects[t];if(s)for(let{page:n,id:a,exportValues:o}of s){if(n===-1||a===e)continue;let c=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!pi.has(u)){dt(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:c,domElement:u})}return i}for(let s of document.getElementsByName(t)){let{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==e&&pi.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(let e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}},gn=class extends Ht{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action),s=!0):t.attachment?(this.#e(i,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(this.#i(i,t.setOCGState),s=!0):t.dest?(this._bindLink(i,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#t()}#e(t,e,i=null){t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#i(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let s of Object.keys(e.actions)){let n=i.get(s);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){let i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){dt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();let{fields:s,refs:n,include:a}=e,o=[];if(s.length!==0||n.length!==0){let f=new Set(n);for(let m of s){let b=this._fieldObjects[m]||[];for(let{id:A}of b)f.add(A)}for(let m of Object.values(this._fieldObjects))for(let b of m)f.has(b.id)===a&&o.push(b)}else for(let f of Object.values(this._fieldObjects))o.push(...f);let c=this.annotationStorage,u=[];for(let f of o){let{id:m}=f;switch(u.push(m),f.type){case"text":{let A=f.defaultValue||"";c.setValue(m,{value:A});break}case"checkbox":case"radiobutton":{let A=f.defaultValue===f.exportValues;c.setValue(m,{value:A});break}case"combobox":case"listbox":{let A=f.defaultValue||"";c.setValue(m,{value:A});break}default:continue}let b=document.querySelector(`[data-element-id="${m}"]`);if(b){if(!pi.has(b)){dt(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}}),!1}}},da=class extends Ht{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}},$e=class extends Ht{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Wt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(i,a=>{if(i==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}})})}_setEventListeners(t,e,i,s){for(let[n,a]of i)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){let e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":tt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){let e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||Ec,n=t.style,a,o=2,c=u=>Math.round(10*u)/10;if(this.data.multiLine){let u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),f=Math.round(u/(Gs*s))||1,m=u/f;a=Math.min(s,c(m/Gs))}else{let u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(s,c(u/Gs))}n.fontSize=`calc(${a}px * var(--scale-factor))`,n.color=tt.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}},fa=class extends $e{constructor(t){let e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){let n=this.annotationStorage;for(let a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=i),n.setValue(a.id,{[s]:i})}render(){let t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){let s=t.getValue(e,{value:this.data.fieldValue}),n=s.value||"",a=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let o=s.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));let c={userValue:n,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=o??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",o??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),pi.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=bs,this._setRequired(i,this.data.required),a&&(i.maxLength=a),i.addEventListener("input",f=>{t.setValue(e,{value:f.target.value}),this.setPropertyOnSiblings(i,"value",f.target.value,"value"),c.formattedValue=null}),i.addEventListener("resetform",f=>{let m=this.data.defaultFieldValue??"";i.value=c.userValue=m,c.formattedValue=null});let u=f=>{let{formattedValue:m}=c;m!=null&&(f.target.value=m),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",m=>{if(c.focused)return;let{target:b}=m;c.userValue&&(b.value=c.userValue),c.lastCommittedValue=b.value,c.commitKey=1,this.data.actions?.Focus||(c.focused=!0)}),i.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);let b={value(A){c.userValue=A.detail.value??"",t.setValue(e,{value:c.userValue.toString()}),A.target.value=c.userValue},formattedValue(A){let{formattedValue:w}=A.detail;c.formattedValue=w,w!=null&&A.target!==document.activeElement&&(A.target.value=w),t.setValue(e,{formattedValue:w})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{let{charLimit:w}=A.detail,{target:x}=A;if(w===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",w);let C=c.userValue;!C||C.length<=w||(C=C.slice(0,w),x.value=c.userValue=C,t.setValue(e,{value:C}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(b,m)}),i.addEventListener("keydown",m=>{c.commitKey=1;let b=-1;if(m.key==="Escape"?b=0:m.key==="Enter"&&!this.data.multiLine?b=2:m.key==="Tab"&&(c.commitKey=3),b===-1)return;let{value:A}=m.target;c.lastCommittedValue!==A&&(c.lastCommittedValue=A,c.userValue=A,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:b,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});let f=u;u=null,i.addEventListener("blur",m=>{if(!c.focused||!m.relatedTarget)return;this.data.actions?.Blur||(c.focused=!1);let{value:b}=m.target;c.userValue=b,c.lastCommittedValue!==b&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:c.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}),f(m)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",m=>{c.lastCommittedValue=null;let{data:b,target:A}=m,{value:w,selectionStart:x,selectionEnd:C}=A,k=x,D=C;switch(m.inputType){case"deleteWordBackward":{let O=w.substring(0,x).match(/\w*[^\w]*$/);O&&(k-=O[0].length);break}case"deleteWordForward":{let O=w.substring(x).match(/^[^\w]*\w*/);O&&(D+=O[0].length);break}case"deleteContentBackward":x===C&&(k-=1);break;case"deleteContentForward":x===C&&(D+=1);break}m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,change:b||"",willCommit:!1,selStart:k,selEnd:D}})}),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(u&&i.addEventListener("blur",u),this.data.comb){let m=(this.data.rect[2]-this.data.rect[0])/a;i.classList.add("comb"),i.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},pa=class extends $e{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}},ga=class extends $e{constructor(t){super(t,{isRenderable:t.renderForms})}render(){let t=this.annotationStorage,e=this.data,i=e.id,s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return pi.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=bs,n.addEventListener("change",a=>{let{name:o,checked:c}=a.target;for(let u of this._getElementsByName(o,i)){let f=c&&u.exportValue===e.exportValue;u.domElement&&(u.domElement.checked=f),t.setValue(u.id,{value:f})}t.setValue(i,{value:c})}),n.addEventListener("resetform",a=>{let o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{let o={value(c){c.target.checked=c.detail.value!=="Off",t.setValue(i,{value:c.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},mn=class extends $e{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let t=this.annotationStorage,e=this.data,i=e.id,s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(let a of this._getElementsByName(e.fieldName,i))t.setValue(a.id,{value:!1});let n=document.createElement("input");if(pi.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=bs,n.addEventListener("change",a=>{let{name:o,checked:c}=a.target;for(let u of this._getElementsByName(o,i))t.setValue(u.id,{value:!1});t.setValue(i,{value:c})}),n.addEventListener("resetform",a=>{let o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){let a=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{let c={value:u=>{let f=a===u.detail.value;for(let m of this._getElementsByName(u.target.name)){let b=f&&m.id===i;m.domElement&&(m.domElement.checked=b),t.setValue(m.id,{value:b})}}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},ma=class extends gn{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){let t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");let e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}},ba=class extends $e{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");pi.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=bs;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",f=>{let m=this.data.defaultFieldValue;for(let b of s.options)b.selected=b.value===m});for(let f of this.data.options){let m=document.createElement("option");m.textContent=f.displayValue,m.value=f.exportValue,i.value.includes(f.exportValue)&&(m.setAttribute("selected",!0),n=!1),s.append(m)}let a=null;if(n){let f=document.createElement("option");f.value=" ",f.setAttribute("hidden",!0),f.setAttribute("selected",!0),s.prepend(f),a=()=>{f.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}let o=f=>{let m=f?"value":"textContent",{options:b,multiple:A}=s;return A?Array.prototype.filter.call(b,w=>w.selected).map(w=>w[m]):b.selectedIndex===-1?null:b[b.selectedIndex][m]},c=o(!1),u=f=>{let m=f.target.options;return Array.prototype.map.call(m,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",f=>{let m={value(b){a?.();let A=b.detail.value,w=new Set(Array.isArray(A)?A:[A]);for(let x of s.options)x.selected=w.has(x.value);t.setValue(e,{value:o(!0)}),c=o(!1)},multipleSelection(b){s.multiple=!0},remove(b){let A=s.options,w=b.detail.remove;A[w].selected=!1,s.remove(w),A.length>0&&Array.prototype.findIndex.call(A,C=>C.selected)===-1&&(A[0].selected=!0),t.setValue(e,{value:o(!0),items:u(b)}),c=o(!1)},clear(b){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),c=o(!1)},insert(b){let{index:A,displayValue:w,exportValue:x}=b.detail.insert,C=s.children[A],k=document.createElement("option");k.textContent=w,k.value=x,C?C.before(k):s.append(k),t.setValue(e,{value:o(!0),items:u(b)}),c=o(!1)},items(b){let{items:A}=b.detail;for(;s.length!==0;)s.remove(0);for(let w of A){let{displayValue:x,exportValue:C}=w,k=document.createElement("option");k.textContent=x,k.value=C,s.append(k)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:o(!0),items:u(b)}),c=o(!1)},indices(b){let A=new Set(b.detail.indices);for(let w of b.target.options)w.selected=A.has(w.index);t.setValue(e,{value:o(!0)}),c=o(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(m,f)}),s.addEventListener("input",f=>{let m=o(!0),b=o(!1);t.setValue(e,{value:m}),f.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:c,change:b,changeEx:m,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],f=>f.target.value)):s.addEventListener("input",function(f){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},fs=class extends Ht{constructor(t){let{data:e,elements:i}=t;super(t,{isRenderable:Ht._hasPopupData(e)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");let t=this.popup=new va({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(let i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(i=>`${Ba}${i}`).join(",")),this.container}},va=class{#t=this.#T.bind(this);#e=this.#C.bind(this);#i=this.#k.bind(this);#s=this.#w.bind(this);#r=null;#n=null;#l=null;#o=null;#c=null;#h=null;#d=null;#u=!1;#f=null;#a=null;#p=null;#m=null;#g=null;#b=null;#A=!1;constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:o,parent:c,rect:u,parentRect:f,open:m}){this.#n=t,this.#g=s,this.#l=a,this.#m=o,this.#h=c,this.#r=e,this.#p=u,this.#d=f,this.#c=i,this.#o=Qs.toDateObject(n),this.trigger=i.flatMap(b=>b.getElementsToTriggerPopup());for(let b of this.trigger)b.addEventListener("click",this.#s),b.addEventListener("mouseenter",this.#i),b.addEventListener("mouseleave",this.#e),b.classList.add("popupTriggerArea");for(let b of i)b.container?.addEventListener("keydown",this.#t);this.#n.hidden=!0,m&&this.#w()}render(){if(this.#f)return;let t=this.#f=document.createElement("div");if(t.className="popup",this.#r){let n=t.style.outlineColor=tt.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:t.style.backgroundColor=tt.makeHexColor(...this.#r.map(o=>Math.floor(.7*(255-o)+o)))}let e=document.createElement("span");e.className="header";let i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=this.#g,t.append(e),this.#o){let n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),e.append(n)}let s=this.#v;if(s)pn.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{let n=this._formatContents(this.#l);t.append(n)}this.#n.append(t)}get#v(){let t=this.#m,e=this.#l;return t?.str&&(!e?.str||e.str===t.str)&&this.#m.html||null}get#_(){return this.#v?.attributes?.style?.fontSize||0}get#x(){return this.#v?.attributes?.style?.color||null}#E(t){let e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#x,fontSize:this.#_?`calc(${this.#_}px * var(--scale-factor))`:""}};for(let n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i}_formatContents({str:t,dir:e}){let i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;let s=t.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){let o=s[n];i.append(document.createTextNode(o)),n<a-1&&i.append(document.createElement("br"))}return i}#T(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#u)&&this.#w()}updateEdited({rect:t,popupContent:e}){this.#b||={contentsObj:this.#l,richText:this.#m},t&&(this.#a=null),e&&(this.#m=this.#E(e),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#b&&({contentsObj:this.#l,richText:this.#m}=this.#b,this.#b=null,this.#f?.remove(),this.#f=null,this.#a=null)}#P(){if(this.#a!==null)return;let{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=this.#h,a=!!this.#d,o=a?this.#d:this.#p;for(let w of this.#c)if(!o||tt.intersect(w.data.rect,o)!==null){o=w.data.rect,a=!0;break}let c=tt.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),f=a?o[2]-o[0]+5:0,m=c[0]+f,b=c[1];this.#a=[100*(m-s)/e,100*(b-n)/i];let{style:A}=this.#n;A.left=`${this.#a[0]}%`,A.top=`${this.#a[1]}%`}#w(){this.#u=!this.#u,this.#u?(this.#k(),this.#n.addEventListener("click",this.#s),this.#n.addEventListener("keydown",this.#t)):(this.#C(),this.#n.removeEventListener("click",this.#s),this.#n.removeEventListener("keydown",this.#t))}#k(){this.#f||this.render(),this.isVisible?this.#u&&this.#n.classList.add("focused"):(this.#P(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#C(){this.#n.classList.remove("focused"),!(this.#u||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#n.hidden=!0)}maybeShow(){this.#A&&(this.#f||this.#k(),this.#A=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}},bn=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=ut.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(let e of this.textContent){let i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},ya=class extends Ht{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:e,height:i}=Ke(t.rect),s=this.svgFactory.create(e,i,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Aa=class extends Ht{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:e,height:i}=Ke(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",e-n),a.setAttribute("height",i-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},_a=class extends Ht{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:e,height:i}=Ke(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",i/2),a.setAttribute("rx",e/2-n/2),a.setAttribute("ry",i/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},vn=class extends Ht{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:e,borderStyle:i,popupRef:s}}=this;if(!e)return this.container;let{width:n,height:a}=Ke(t),o=this.svgFactory.create(n,a,!0),c=[];for(let f=0,m=e.length;f<m;f+=2){let b=e[f]-t[0],A=t[3]-e[f+1];c.push(`${b},${A}`)}c=c.join(" ");let u=this.#t=this.svgFactory.createElement(this.svgElementName);return u.setAttribute("points",c),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),o.append(u),this.container.append(o),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},wa=class extends vn{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},xa=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},ps=class extends Ht{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ut.HIGHLIGHT:ut.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:e,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:a,width:o,height:c}=this.#i(e,t),u=this.svgFactory.create(o,c,!0),f=this.#t=this.svgFactory.createElement("svg:g");u.append(f),f.setAttribute("stroke-width",s.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",a);for(let m=0,b=i.length;m<b;m++){let A=this.svgFactory.createElement(this.svgElementName);this.#e.push(A),A.setAttribute("points",i[m].join(",")),f.append(A)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:e,points:i,rect:s}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),i)for(let a=0,o=this.#e.length;a<o;a++)this.#e[a].setAttribute("points",i[a].join(","));if(s){let{transform:a,width:o,height:c}=this.#i(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${o} ${c}`),n.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},yn=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ut.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},Sa=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Ea=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Ca=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},An=class extends Ht{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ut.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Ta=class extends Ht{#t=null;constructor(t){super(t,{isRenderable:!0});let{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",Be({source:this},e))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:e}=this,i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;let{isMac:s}=Wt.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},ka=class{#t=null;#e=null;#i=new Map;#s=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:o}){this.div=t,this.#t=e,this.#e=i,this.#s=o||null,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}#r(t,e){return Y(this,null,function*(){let i=t.firstChild||t,s=i.id=`${Ba}${e}`,n=yield this.#s?.getAriaAttributes(s);if(n)for(let[a,o]of n)i.setAttribute(a,o);this.div.append(t),this.#t?.moveElementInDOM(this.div,t,i,!1)})}render(t){return Y(this,null,function*(){let{annotations:e}=t,i=this.div;di(i,this.viewport);let s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new ds,annotationStorage:t.annotationStorage||new ls,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(let a of e){if(a.noHTML)continue;let o=a.annotationType===$t.POPUP;if(o){let f=s.get(a.id);if(!f)continue;n.elements=f}else{let{width:f,height:m}=Ke(a.rect);if(f<=0||m<=0)continue}n.data=a;let c=ua.create(n);if(!c.isRenderable)continue;if(!o&&a.popupRef){let f=s.get(a.popupRef);f?f.push(c):s.set(a.popupRef,[c])}let u=c.render();a.hidden&&(u.style.visibility="hidden"),yield this.#r(u,a.id),c._isEditable&&(this.#i.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}this.#n()})}update({viewport:t}){let e=this.div;this.viewport=t,di(e,{rotation:t.rotation}),this.#n(),e.hidden=!1}#n(){if(!this.#e)return;let t=this.div;for(let[e,i]of this.#e){let s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;i.className="annotationContent";let{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}},Us=/\r\n?|\n/g,Pa=class h extends Dt{#t;#e="";#i=`${this.id}-editor`;#s=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let t=h.prototype,e=n=>n.isEmpty(),i=os.TRANSLATE_SMALL,s=os.TRANSLATE_BIG;return gt(this,"_keyboardManager",new fi([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=ut.FREETEXT;constructor(t){super(Ci(Be({},t),{name:"freeTextEditor"})),this.#t=t.color||h._defaultColor||Dt._defaultLineColor,this.#r=t.fontSize||h._defaultFontSize}static initialize(t,e){Dt.initialize(t,e);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case At.FREETEXT_SIZE:h._defaultFontSize=e;break;case At.FREETEXT_COLOR:h._defaultColor=e;break}}updateParams(t,e){switch(t){case At.FREETEXT_SIZE:this.#n(e);break;case At.FREETEXT_COLOR:this.#l(e);break}}static get defaultPropertiesToUpdate(){return[[At.FREETEXT_SIZE,h._defaultFontSize],[At.FREETEXT_COLOR,h._defaultColor||Dt._defaultLineColor]]}get propertiesToUpdate(){return[[At.FREETEXT_SIZE,this.#r],[At.FREETEXT_COLOR,this.#t]]}#n(t){let e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#c()},i=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(t){let e=s=>{this.#t=this.editorDiv.style.color=s},i=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){let t=this.parentScale;return[-h._internalPadding*t,-(h._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(ut.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;let t=this._uiManager.combinedSignal(this.#s);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){let t=[];this.editorDiv.normalize();let e=null;for(let i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(h.#h(i)),e=i);return t.join(`
`)}#c(){let[t,e]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:s,div:n}=this,a=n.style.display,o=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=a,n.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;let i=s=>{if(this.#e=s,!s){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#c()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#c()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){h._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Js(this,this.div,["dblclick","keydown"]),this.width){let[s,n]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[o,c]=this.getInitialTranslation();[o,c]=this.pageTranslationToScreen(o,c);let[u,f]=this.pageDimensions,[m,b]=this.pageTranslation,A,w;switch(this.rotation){case 0:A=t+(a[0]-m)/u,w=e+this.height-(a[1]-b)/f;break;case 90:A=t+(a[0]-m)/u,w=e-(a[1]-b)/f,[o,c]=[c,-o];break;case 180:A=t-this.width+(a[0]-m)/u,w=e-(a[1]-b)/f,[o,c]=[-o,-c];break;case 270:A=t+(a[0]-m-this.height*f)/u,w=e+(a[1]-b-this.width*u)/f,[o,c]=[-c,o];break}this.setAt(A*s,w*n,o,c)}else this.setAt(t*s,e*n,this.width*s,this.height*n);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Us,"")}editorDivPaste(t){let e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();let s=h.#f(e.getData("text")||"").replaceAll(Us,`
`);if(!s)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let a=n.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}let{startContainer:o,startOffset:c}=a,u=[],f=[];if(o.nodeType===Node.TEXT_NODE){let A=o.parentElement;if(f.push(o.nodeValue.slice(c).replaceAll(Us,"")),A!==this.editorDiv){let w=u;for(let x of this.editorDiv.childNodes){if(x===A){w=f;continue}w.push(h.#h(x))}}u.push(o.nodeValue.slice(0,c).replaceAll(Us,""))}else if(o===this.editorDiv){let A=u,w=0;for(let x of this.editorDiv.childNodes)w++===c&&(A=f),A.push(h.#h(x))}this.#e=`${u.join(`
`)}${s}${f.join(`
`)}`,this.#d();let m=new Range,b=u.reduce((A,w)=>A+w.length,0);for(let{firstChild:A}of this.editorDiv.childNodes)if(A.nodeType===Node.TEXT_NODE){let w=A.nodeValue.length;if(b<=w){m.setStart(A,b),m.setEnd(A,b);break}b-=w}n.removeAllRanges(),n.addRange(m)}#d(){if(this.editorDiv.replaceChildren(),!!this.#e)for(let t of this.#e.split(`
`)){let e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#e.replaceAll("\xA0"," ")}static#f(t){return t.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(t,e,i){return Y(this,null,function*(){let s=null;if(t instanceof bn){let{data:{defaultAppearanceData:{fontSize:a,fontColor:o},rect:c,rotation:u,id:f,popupRef:m},textContent:b,textPosition:A,parent:{page:{pageNumber:w}}}=t;if(!b||b.length===0)return null;s=t={annotationType:ut.FREETEXT,color:Array.from(o),fontSize:a,value:b.join(`
`),position:A,pageIndex:w-1,rect:c.slice(0),rotation:u,id:f,deleted:!1,popupRef:m}}let n=yield ri(h,this,"deserialize").call(this,t,e,i);return n.#r=t.fontSize,n.#t=tt.makeHexColor(...t.color),n.#e=h.#f(t.value),n.annotationElementId=t.id||null,n._initialData=s,n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let e=h._internalPadding*this.parentScale,i=this.getRect(e,e),s=Dt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),n={annotationType:ut.FREETEXT,color:s,fontSize:this.#r,value:this.#u(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?n:this.annotationElementId&&!this.#a(n)?null:(n.id=this.annotationElementId,n)}#a(t){let{value:e,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((a,o)=>a!==s[o])||t.pageIndex!==n}renderAnnotationElement(t){let e=super.renderAnnotationElement(t);if(this.deleted)return e;let{style:i}=e;i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,e.replaceChildren();for(let n of this.#e.split(`
`)){let a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),e.append(a)}let s=h._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:this.#e}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}},K=(()=>{class h{static PRECISION=1e-4;toSVGPath(){Ct("Abstract method `toSVGPath` must be implemented.")}get box(){Ct("Abstract getter `box` must be implemented.")}serialize(e,i){Ct("Abstract method `serialize` must be implemented.")}static _rescale(e,i,s,n,a,o){o||=new Float32Array(e.length);for(let c=0,u=e.length;c<u;c+=2)o[c]=i+e[c]*n,o[c+1]=s+e[c+1]*a;return o}static _rescaleAndSwap(e,i,s,n,a,o){o||=new Float32Array(e.length);for(let c=0,u=e.length;c<u;c+=2)o[c]=i+e[c+1]*n,o[c+1]=s+e[c]*a;return o}static _translate(e,i,s,n){n||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)n[a]=i+e[a],n[a+1]=s+e[a+1];return n}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,i,s,n,a){switch(a){case 90:return[1-i/s,e/n];case 180:return[1-e/s,1-i/n];case 270:return[i/s,1-e/n];default:return[e/s,i/n]}}static _normalizePagePoint(e,i,s){switch(s){case 90:return[1-i,e];case 180:return[1-e,1-i];case 270:return[i,1-e];default:return[e,i]}}static createBezierPoints(e,i,s,n,a,o){return[(e+5*s)/6,(i+5*n)/6,(5*s+a)/6,(5*n+o)/6,(s+a)/2,(n+o)/2]}}return h})(),_n=class h{#t;#e=[];#i;#s;#r=[];#n=new Float32Array(18);#l;#o;#c;#h;#d;#u;#f=[];static#a=8;static#p=2;static#m=h.#a+h.#p;constructor({x:t,y:e},i,s,n,a,o=0){this.#t=i,this.#u=n*s,this.#s=a,this.#n.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=o,this.#h=h.#a*s,this.#c=h.#m*s,this.#d=s,this.#f.push(t,e)}isEmpty(){return isNaN(this.#n[8])}#g(){let t=this.#n.subarray(4,6),e=this.#n.subarray(16,18),[i,s,n,a]=this.#t;return[(this.#l+(t[0]-e[0])/2-i)/n,(this.#o+(t[1]-e[1])/2-s)/a,(this.#l+(e[0]-t[0])/2-i)/n,(this.#o+(e[1]-t[1])/2-s)/a]}add({x:t,y:e}){this.#l=t,this.#o=e;let[i,s,n,a]=this.#t,[o,c,u,f]=this.#n.subarray(8,12),m=t-u,b=e-f,A=Math.hypot(m,b);if(A<this.#c)return!1;let w=A-this.#h,x=w/A,C=x*m,k=x*b,D=o,O=c;o=u,c=f,u+=C,f+=k,this.#f?.push(t,e);let B=-k/w,j=C/w,p=B*this.#u,V=j*this.#u;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([u+p,f+V],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([u-p,f-V],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([o+p,c+V],2),this.#r.push(NaN,NaN,NaN,NaN,(o+p-i)/n,(c+V-s)/a),this.#n.set([o-p,c-V],14),this.#e.push(NaN,NaN,NaN,NaN,(o-p-i)/n,(c-V-s)/a)),this.#n.set([D,O,o,c,u,f],6),!this.isEmpty()):(this.#n.set([D,O,o,c,u,f],6),Math.abs(Math.atan2(O-c,D-o)-Math.atan2(k,C))<Math.PI/2?([o,c,u,f]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((o+u)/2-i)/n,((c+f)/2-s)/a),[o,c,D,O]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((D+o)/2-i)/n,((O+c)/2-s)/a),!0):([D,O,o,c,u,f]=this.#n.subarray(0,6),this.#r.push(((D+5*o)/6-i)/n,((O+5*c)/6-s)/a,((5*o+u)/6-i)/n,((5*c+f)/6-s)/a,((o+u)/2-i)/n,((c+f)/2-s)/a),[u,f,o,c,D,O]=this.#n.subarray(12,18),this.#e.push(((D+5*o)/6-i)/n,((O+5*c)/6-s)/a,((5*o+u)/6-i)/n,((5*c+f)/6-s)/a,((o+u)/2-i)/n,((c+f)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";let t=this.#r,e=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#b();let i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#v(i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#A(i),i.join(" ")}#b(){let[t,e,i,s]=this.#t,[n,a,o,c]=this.#g();return`M${(this.#n[2]-t)/i} ${(this.#n[3]-e)/s} L${(this.#n[4]-t)/i} ${(this.#n[5]-e)/s} L${n} ${a} L${o} ${c} L${(this.#n[16]-t)/i} ${(this.#n[17]-e)/s} L${(this.#n[14]-t)/i} ${(this.#n[15]-e)/s} Z`}#A(t){let e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#v(t){let[e,i,s,n]=this.#t,a=this.#n.subarray(4,6),o=this.#n.subarray(16,18),[c,u,f,m]=this.#g();t.push(`L${(a[0]-e)/s} ${(a[1]-i)/n} L${c} ${u} L${f} ${m} L${(o[0]-e)/s} ${(o[1]-i)/n}`)}newFreeDrawOutline(t,e,i,s,n,a){return new wn(t,e,i,s,n,a)}getOutlines(){let t=this.#r,e=this.#e,i=this.#n,[s,n,a,o]=this.#t,c=new Float32Array((this.#f?.length??0)+2);for(let m=0,b=c.length-2;m<b;m+=2)c[m]=(this.#f[m]-s)/a,c[m+1]=(this.#f[m+1]-n)/o;if(c[c.length-2]=(this.#l-s)/a,c[c.length-1]=(this.#o-n)/o,isNaN(i[6])&&!this.isEmpty())return this.#_(c);let u=new Float32Array(this.#r.length+24+this.#e.length),f=t.length;for(let m=0;m<f;m+=2){if(isNaN(t[m])){u[m]=u[m+1]=NaN;continue}u[m]=t[m],u[m+1]=t[m+1]}f=this.#E(u,f);for(let m=e.length-6;m>=6;m-=6)for(let b=0;b<6;b+=2){if(isNaN(e[m+b])){u[f]=u[f+1]=NaN,f+=2;continue}u[f]=e[m+b],u[f+1]=e[m+b+1],f+=2}return this.#x(u,f),this.newFreeDrawOutline(u,c,this.#t,this.#d,this.#i,this.#s)}#_(t){let e=this.#n,[i,s,n,a]=this.#t,[o,c,u,f]=this.#g(),m=new Float32Array(36);return m.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/a,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/a,NaN,NaN,NaN,NaN,o,c,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/a,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/a],0),this.newFreeDrawOutline(m,t,this.#t,this.#d,this.#i,this.#s)}#x(t,e){let i=this.#e;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#E(t,e){let i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,a,o,c]=this.#t,[u,f,m,b]=this.#g();return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/c,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,m,b,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/c],e),e+=24}},wn=class extends K{#t;#e=new Float32Array(4);#i;#s;#r;#n;#l;constructor(t,e,i,s,n,a){super(),this.#l=t,this.#r=e,this.#t=i,this.#n=s,this.#i=n,this.#s=a,this.lastPoint=[NaN,NaN],this.#o(a);let[o,c,u,f]=this.#e;for(let m=0,b=t.length;m<b;m+=2)t[m]=(t[m]-o)/u,t[m+1]=(t[m+1]-c)/f;for(let m=0,b=e.length;m<b;m+=2)e[m]=(e[m]-o)/u,e[m+1]=(e[m+1]-c)/f}toSVGPath(){let t=[`M${this.#l[4]} ${this.#l[5]}`];for(let e=6,i=this.#l.length;e<i;e+=6){if(isNaN(this.#l[e])){t.push(`L${this.#l[e+4]} ${this.#l[e+5]}`);continue}t.push(`C${this.#l[e]} ${this.#l[e+1]} ${this.#l[e+2]} ${this.#l[e+3]} ${this.#l[e+4]} ${this.#l[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,s],n){let a=i-t,o=s-e,c,u;switch(n){case 0:c=K._rescale(this.#l,t,s,a,-o),u=K._rescale(this.#r,t,s,a,-o);break;case 90:c=K._rescaleAndSwap(this.#l,t,e,a,o),u=K._rescaleAndSwap(this.#r,t,e,a,o);break;case 180:c=K._rescale(this.#l,i,e,-a,o),u=K._rescale(this.#r,i,e,-a,o);break;case 270:c=K._rescaleAndSwap(this.#l,i,s,-a,-o),u=K._rescaleAndSwap(this.#r,i,s,-a,-o);break}return{outline:Array.from(c),points:[Array.from(u)]}}#o(t){let e=this.#l,i=e[4],s=e[5],n=i,a=s,o=i,c=s,u=i,f=s,m=t?Math.max:Math.min;for(let A=6,w=e.length;A<w;A+=6){if(isNaN(e[A]))n=Math.min(n,e[A+4]),a=Math.min(a,e[A+5]),o=Math.max(o,e[A+4]),c=Math.max(c,e[A+5]),f<e[A+5]?(u=e[A+4],f=e[A+5]):f===e[A+5]&&(u=m(u,e[A+4]));else{let x=tt.bezierBoundingBox(i,s,...e.slice(A,A+6));n=Math.min(n,x[0]),a=Math.min(a,x[1]),o=Math.max(o,x[2]),c=Math.max(c,x[3]),f<x[3]?(u=x[2],f=x[3]):f===x[3]&&(u=m(u,x[2]))}i=e[A+4],s=e[A+5]}let b=this.#e;b[0]=n-this.#i,b[1]=a-this.#i,b[2]=o-n+2*this.#i,b[3]=c-a+2*this.#i,this.lastPoint=[u,f]}get box(){return this.#e}newOutliner(t,e,i,s,n,a=0){return new _n(t,e,i,s,n,a)}getNewOutline(t,e){let[i,s,n,a]=this.#e,[o,c,u,f]=this.#t,m=n*u,b=a*f,A=i*u+o,w=s*f+c,x=this.newOutliner({x:this.#r[0]*m+A,y:this.#r[1]*b+w},this.#t,this.#n,t,this.#s,e??this.#i);for(let C=2;C<this.#r.length;C+=2)x.add({x:this.#r[C]*m+A,y:this.#r[C+1]*b+w});return x.getOutlines()}},gs=class{#t;#e;#i=[];#s=[];constructor(t,e=0,i=0,s=!0){let n=1/0,a=-1/0,o=1/0,c=-1/0,f=10**-4;for(let{x:k,y:D,width:O,height:B}of t){let j=Math.floor((k-e)/f)*f,p=Math.ceil((k+O+e)/f)*f,V=Math.floor((D-e)/f)*f,U=Math.ceil((D+B+e)/f)*f,rt=[j,V,U,!0],yt=[p,V,U,!1];this.#i.push(rt,yt),n=Math.min(n,j),a=Math.max(a,p),o=Math.min(o,V),c=Math.max(c,U)}let m=a-n+2*i,b=c-o+2*i,A=n-i,w=o-i,x=this.#i.at(s?-1:-2),C=[x[0],x[2]];for(let k of this.#i){let[D,O,B]=k;k[0]=(D-A)/m,k[1]=(O-w)/b,k[2]=(B-w)/b}this.#t=new Float32Array([A,w,m,b]),this.#e=C}getOutlines(){this.#i.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);let t=[];for(let e of this.#i)e[3]?(t.push(...this.#c(e)),this.#l(e)):(this.#o(e),t.push(...this.#c(e)));return this.#r(t)}#r(t){let e=[],i=new Set;for(let a of t){let[o,c,u]=a;e.push([o,c,a],[o,u,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){let c=e[a][2],u=e[a+1][2];c.push(u),u.push(c),i.add(c),i.add(u)}let s=[],n;for(;i.size>0;){let a=i.values().next().value,[o,c,u,f,m]=a;i.delete(a);let b=o,A=c;for(n=[o,u],s.push(n);;){let w;if(i.has(f))w=f;else if(i.has(m))w=m;else break;i.delete(w),[o,c,u,f,m]=w,b!==o&&(n.push(b,A,o,A===c?c:u),b=o),A=A===c?u:c}n.push(b,A)}return new Ma(s,this.#t,this.#e)}#n(t){let e=this.#s,i=0,s=e.length-1;for(;i<=s;){let n=i+s>>1,a=e[n][0];if(a===t)return n;a<t?i=n+1:s=n-1}return s+1}#l([,t,e]){let i=this.#n(t);this.#s.splice(i,0,[t,e])}#o([,t,e]){let i=this.#n(t);for(let s=i;s<this.#s.length;s++){let[n,a]=this.#s[s];if(n!==t)break;if(n===t&&a===e){this.#s.splice(s,1);return}}for(let s=i-1;s>=0;s--){let[n,a]=this.#s[s];if(n!==t)break;if(n===t&&a===e){this.#s.splice(s,1);return}}}#c(t){let[e,i,s]=t,n=[[e,i,s]],a=this.#n(s);for(let o=0;o<a;o++){let[c,u]=this.#s[o];for(let f=0,m=n.length;f<m;f++){let[,b,A]=n[f];if(!(u<=b||A<=c)){if(b>=c){if(A>u)n[f][1]=u;else{if(m===1)return[];n.splice(f,1),f--,m--}continue}n[f][2]=c,A>u&&n.push([e,u,A])}}}return n}},Ma=class extends K{#t;#e;constructor(t,e,i){super(),this.#e=t,this.#t=e,this.lastPoint=i}toSVGPath(){let t=[];for(let e of this.#e){let[i,s]=e;t.push(`M${i} ${s}`);for(let n=2;n<e.length;n+=2){let a=e[n],o=e[n+1];a===i?(t.push(`V${o}`),s=o):o===s&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,e,i,s],n){let a=[],o=i-t,c=s-e;for(let u of this.#e){let f=new Array(u.length);for(let m=0;m<u.length;m+=2)f[m]=t+u[m]*o,f[m+1]=s-u[m+1]*c;a.push(f)}return a}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}},ms=class extends _n{newFreeDrawOutline(t,e,i,s,n,a){return new Ra(t,e,i,s,n,a)}},Ra=class extends wn{newOutliner(t,e,i,s,n,a=0){return new ms(t,e,i,s,n,a)}},xn=class h{#t=null;#e=null;#i;#s=null;#r=!1;#n=!1;#l=null;#o;#c=null;#h=null;#d;static#u=null;static get _keyboardManager(){return gt(this,"_keyboardManager",new fi([[["Escape","mac+Escape"],h.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],h.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],h.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],h.prototype._moveToPrevious],[["Home","mac+Home"],h.prototype._moveToBeginning],[["End","mac+End"],h.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#n=!1,this.#d=At.HIGHLIGHT_COLOR,this.#l=t):(this.#n=!0,this.#d=At.HIGHLIGHT_DEFAULT_COLOR),this.#h=t?._uiManager||e,this.#o=this.#h._eventBus,this.#i=t?.color||this.#h?.highlightColors.values().next().value||"#FFFF98",h.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);let e=this.#h._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#p.bind(this),{signal:e});let i=this.#e=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,t.append(i),t}renderMainDropdown(){let t=this.#s=this.#f();return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#f(){let t=document.createElement("div"),e=this.#h._signal;t.addEventListener("contextmenu",xe,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[i,s]of this.#h.highlightColors){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",h.#u[i]);let a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.setAttribute("aria-selected",s===this.#i),n.addEventListener("click",this.#a.bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#p.bind(this),{signal:e}),t}#a(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#d,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}let e=t.target.getAttribute("data-color");e&&this.#a(e,t)}_moveToNext(t){if(!this.#b){this.#m(t);return}if(t.target===this.#t){this.#s.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstChild||t.target===this.#t){this.#b&&this._hideDropdownFromKeyboard();return}this.#b||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#b){this.#m(t);return}this.#s.firstChild?.focus()}_moveToEnd(t){if(!this.#b){this.#m(t);return}this.#s.lastChild?.focus()}#p(t){h._keyboardManager.exec(this,t)}#m(t){if(this.#b){this.hideDropdown();return}if(this.#r=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#h.combinedSignal(this.#c)})),this.#s){this.#s.classList.remove("hidden");return}let e=this.#s=this.#f();this.#t.append(e)}#g(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#c?.abort(),this.#c=null}get#b(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#b){this.#l?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;let e=this.#h.highlightColors.values();for(let i of this.#s.children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}},Sn=class h extends Dt{#t=null;#e=0;#i;#s=null;#r=null;#n=null;#l=null;#o=0;#c=null;#h=null;#d=null;#u=!1;#f=null;#a;#p=null;#m="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=ut.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let t=h.prototype;return gt(this,"_keyboardManager",new fi([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super(Ci(Be({},t),{name:"highlightEditor"})),this.color=t.color||h._defaultColor,this.#g=t.thickness||h._defaultThickness,this.#a=t.opacity||h._defaultOpacity,this.#i=t.boxes||null,this.#b=t.methodOfCreation||"",this.#m=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#u=!0,this.#v(t),this.#P()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#l=t.focusNode,this.#o=t.focusOffset,this.#A(),this.#P(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#u?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#A(){let t=new gs(this.#i,.001);this.#h=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#h.box;let e=new gs(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=e.getOutlines();let{lastPoint:i}=this.#n;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#v({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#h=t;let s=1.5;if(this.#n=t.getNewOutline(this.#g/2+s,.0025),e>=0)this.#d=e,this.#s=i,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){let f=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:h.#w(this.#h.box,(f-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:h.#w(this.#n.box,f),path:{d:this.#n.toSVGPath()}})}let[n,a,o,c]=t.box;switch(this.rotation){case 0:this.x=n,this.y=a,this.width=o,this.height=c;break;case 90:{let[f,m]=this.parentDimensions;this.x=a,this.y=1-n,this.width=o*m/f,this.height=c*f/m;break}case 180:this.x=1-n,this.y=1-a,this.width=o,this.height=c;break;case 270:{let[f,m]=this.parentDimensions;this.x=1-a,this.y=n,this.width=o*m/f,this.height=c*f/m;break}}let{lastPoint:u}=this.#n;this.#f=[(u[0]-n)/o,(u[1]-a)/c]}static initialize(t,e){Dt.initialize(t,e),h._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case At.HIGHLIGHT_DEFAULT_COLOR:h._defaultColor=e;break;case At.HIGHLIGHT_THICKNESS:h._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case At.HIGHLIGHT_COLOR:this.#_(e);break;case At.HIGHLIGHT_THICKNESS:this.#x(e);break}}static get defaultPropertiesToUpdate(){return[[At.HIGHLIGHT_DEFAULT_COLOR,h._defaultColor],[At.HIGHLIGHT_THICKNESS,h._defaultThickness]]}get propertiesToUpdate(){return[[At.HIGHLIGHT_COLOR,this.color||h._defaultColor],[At.HIGHLIGHT_THICKNESS,this.#g||h._defaultThickness],[At.HIGHLIGHT_FREE,this.#u]]}#_(t){let e=(n,a)=>{this.color=n,this.#a=a,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:n,"fill-opacity":a}}),this.#r?.updateColor(n)},i=this.color,s=this.#a;this.addCommands({cmd:e.bind(this,t,h._defaultOpacity),undo:e.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#x(t){let e=this.#g,i=s=>{this.#g=s,this.#E(s)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}addEditToolbar(){return Y(this,null,function*(){let t=yield ri(h.prototype,this,"addEditToolbar").call(this);return t?(this._uiManager.highlightColors&&(this.#r=new xn({editor:this}),t.addColorPicker(this.#r)),t):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#R())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#R())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#T(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#P(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#T():t&&(this.#P(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#E(t){if(!this.#u)return;this.#v({highlightOutlines:this.#h.getNewOutline(t/2)}),this.fixAndSetPosition();let[e,i]=this.parentDimensions;this.setDims(this.width*e,this.height*i)}#T(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#P(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#h.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#a},rootClass:{highlight:!0,free:this.#u},path:{d:this.#h.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#u},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#u),this.#c&&(this.#c.style.clipPath=this.#s))}static#w([t,e,i,s],n){switch(n){case 90:return[1-e-s,t,s,i];case 180:return[1-t-i,1-e-s,i,s];case 270:return[e,1-t-i,s,i]}return[t,e,i,s]}rotate(t){let{drawLayer:e}=this.parent,i;this.#u?(t=(t-this.rotation+360)%360,i=h.#w(this.#h.box,t)):i=h.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:i,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:h.#w(this.#n.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();this.#m&&(t.setAttribute("aria-label",this.#m),t.setAttribute("role","mark")),this.#u?t.classList.add("free"):this.div.addEventListener("keydown",this.#k.bind(this),{signal:this._uiManager._signal});let e=this.#c=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s;let[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),Js(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#k(t){h._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#C(!0);break;case 1:case 3:this.#C(!1);break}}#C(t){if(!this.#t)return;let e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#l,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#u||this.#C(!1))}get _mustFixPosition(){return!this.#u}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#R(){return this.#u?this.rotation:0}#D(){if(this.#u)return null;let[t,e]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,a=new Float32Array(n.length*8),o=0;for(let{x:c,y:u,width:f,height:m}of n){let b=c*t+i,A=(1-u)*e+s;a[o]=a[o+4]=b,a[o+1]=a[o+3]=A,a[o+2]=a[o+6]=b+f*t,a[o+5]=a[o+7]=A-m*e,o+=8}return a}#O(t){return this.#h.serialize(t,this.#R())}static startHighlighting(t,e,{target:i,x:s,y:n}){let{x:a,y:o,width:c,height:u}=i.getBoundingClientRect(),f=new AbortController,m=t.combinedSignal(f),b=A=>{f.abort(),this.#y(t,A)};window.addEventListener("blur",b,{signal:m}),window.addEventListener("pointerup",b,{signal:m}),window.addEventListener("pointerdown",pe,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",xe,{signal:m}),i.addEventListener("pointermove",this.#S.bind(this,t),{signal:m}),this._freeHighlight=new ms({x:s,y:n},[a,o,c,u],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#S(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#y(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,e,i){return Y(this,null,function*(){let s=null;if(t instanceof yn){let{data:{quadPoints:w,rect:x,rotation:C,id:k,color:D,opacity:O,popupRef:B},parent:{page:{pageNumber:j}}}=t;s=t={annotationType:ut.HIGHLIGHT,color:Array.from(D),opacity:O,quadPoints:w,boxes:null,pageIndex:j-1,rect:x.slice(0),rotation:C,id:k,deleted:!1,popupRef:B}}else if(t instanceof ps){let{data:{inkLists:w,rect:x,rotation:C,id:k,color:D,borderStyle:{rawWidth:O},popupRef:B},parent:{page:{pageNumber:j}}}=t;s=t={annotationType:ut.HIGHLIGHT,color:Array.from(D),thickness:O,inkLists:w,boxes:null,pageIndex:j-1,rect:x.slice(0),rotation:C,id:k,deleted:!1,popupRef:B}}let{color:n,quadPoints:a,inkLists:o,opacity:c}=t,u=yield ri(h,this,"deserialize").call(this,t,e,i);u.color=tt.makeHexColor(...n),u.#a=c||1,o&&(u.#g=t.thickness),u.annotationElementId=t.id||null,u._initialData=s;let[f,m]=u.pageDimensions,[b,A]=u.pageTranslation;if(a){let w=u.#i=[];for(let x=0;x<a.length;x+=8)w.push({x:(a[x]-b)/f,y:1-(a[x+1]-A)/m,width:(a[x+2]-a[x])/f,height:(a[x+1]-a[x+5])/m});u.#A(),u.#P(),u.rotate(u.rotation)}else if(o){u.#u=!0;let w=o[0],x={x:w[0]-b,y:m-(w[1]-A)},C=new ms(x,[0,0,f,m],1,u.#g/2,!0,.001);for(let O=0,B=w.length;O<B;O+=2)x.x=w[O]-b,x.y=m-(w[O+1]-A),C.add(x);let{id:k,clipPathId:D}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);u.#v({highlightOutlines:C.getOutlines(),highlightId:k,clipPathId:D}),u.#P()}return u})}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let e=this.getRect(0,0),i=Dt._colorManager.convert(this.color),s={annotationType:ut.HIGHLIGHT,color:i,opacity:this.#a,thickness:this.#g,quadPoints:this.#D(),outlines:this.#O(e),pageIndex:this.pageIndex,rect:e,rotation:this.#R(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#I(s)?null:(s.id=this.annotationElementId,s)}#I(t){let{color:e}=this._initialData;return t.color.some((i,s)=>i!==e[s])}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},La=class{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(let[e,i]of Object.entries(t))this.updateProperty(e,i)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){let t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Ct("Not implemented")}},Cc=(()=>{class h extends Dt{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#r=null;static#n=NaN;static#l=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#e=e.mustBeCommitted||!1,e.drawOutlines&&(this.#h(e),this.#f())}#h({drawOutlines:e,drawId:i,drawingOptions:s}){this.#t=e,this._drawingOptions||=s,i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=this.#d(e,this.parent),this.#m(e.box)}#d(e,i){let{id:s}=i.drawLayer.draw(h._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(e,i){let s=new Set(Object.keys(e));for(let[n,a]of Object.entries(i))s.has(n)?Object.assign(e[n],a):e[n]=a;return e}static getDefaultDrawingOptions(e){Ct("Not implemented")}static get typesMap(){Ct("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){let s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(h.#i.updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){let s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,i)}static get defaultPropertiesToUpdate(){let e=[],i=this._defaultDrawingOptions;for(let[s,n]of this.typesMap)e.push([s,i[n]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:i}=this;for(let[s,n]of this.constructor.typesMap)e.push([s,i[n]]);return e}_updateProperty(e,i,s){let n=this._drawingOptions,a=n[i],o=c=>{n.updateProperty(i,c);let u=this.#t.updateProperty(i,c);u&&this.#m(u),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,h._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,h._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(e,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(e,i)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,h._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#u(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#u()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),i&&this.select()}#u(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#t,e)}}#a([e,i,s,n]){let{parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[i,1-e,s*(o/a),n*(a/o)];case 180:return[1-e,1-i,s,n];case 270:return[1-i,e,s*(o/a),n*(a/o)];default:return[e,i,s,n]}}#p(){let{x:e,y:i,width:s,height:n,parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[1-i,e,s*(a/o),n*(o/a)];case 180:return[1-e,1-i,s,n];case 270:return[i,1-e,s*(a/o),n*(o/a)];default:return[e,i,s,n]}}#m(e){if([this.x,this.y,this.width,this.height]=this.#a(e),this.div){this.fixAndSetPosition();let[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()}#g(){let{x:e,y:i,width:s,height:n,rotation:a,parentRotation:o,parentDimensions:[c,u]}=this;switch((a*4+o)/90){case 1:return[1-i-n,e,n,s];case 2:return[1-e-s,1-i-n,s,n];case 3:return[i,1-e-s,n,s];case 4:return[e,i-s*(c/u),n*(u/c),s*(c/u)];case 5:return[1-i,e,s*(c/u),n*(u/c)];case 6:return[1-e-n*(u/c),1-i,n*(u/c),s*(c/u)];case 7:return[i-s*(c/u),1-e-n*(u/c),s*(c/u),n*(u/c)];case 8:return[e-s,i-n,s,n];case 9:return[1-i,e-s,n,s];case 10:return[1-e,1-i,s,n];case 11:return[i-n,1-e,n,s];case 12:return[e-n*(u/c),i,n*(u/c),s*(c/u)];case 13:return[1-i-s*(c/u),e-n*(u/c),s*(c/u),n*(u/c)];case 14:return[1-e,1-i-s*(c/u),n*(u/c),s*(c/u)];case 15:return[i,1-e,s*(c/u),n*(u/c)];default:return[e,i,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,h._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e=super.render();e.classList.add("draw");let i=document.createElement("div");e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";let[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,i,s,n,a){Ct("Not implemented")}static startDrawing(e,i,s,n){let{target:a,offsetX:o,offsetY:c,pointerId:u,pointerType:f}=n;if(h.#l&&h.#l!==f)return;let{viewport:{rotation:m}}=e,{width:b,height:A}=a.getBoundingClientRect(),w=h.#s=new AbortController,x=e.combinedSignal(w);if(h.#n||=u,h.#l??=f,window.addEventListener("pointerup",C=>{h.#n===C.pointerId?this._endDraw(C):h.#o?.delete(C.pointerId)},{signal:x}),window.addEventListener("pointercancel",C=>{h.#n===C.pointerId?this._currentParent.endDrawingSession():h.#o?.delete(C.pointerId)},{signal:x}),window.addEventListener("pointerdown",C=>{h.#l===C.pointerType&&((h.#o||=new Set).add(C.pointerId),h.#i.isCancellable()&&(h.#i.removeLastElement(),h.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:x}),window.addEventListener("contextmenu",xe,{signal:x}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:x}),a.addEventListener("touchmove",C=>{C.timeStamp===h.#c&&pe(C)},{signal:x}),e.toggleDrawing(),i._editorUndoBar?.hide(),h.#i){e.drawLayer.updateProperties(this._currentDrawId,h.#i.startNew(o,c,b,A,m));return}i.updateUIForDefaultProperties(this),h.#i=this.createDrawerInstance(o,c,b,A,m),h.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(h.#r.toSVGProperties(),h.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(h.#c=-1,!h.#i)return;let{offsetX:i,offsetY:s,pointerId:n}=e;if(h.#n===n){if(h.#o?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,h.#i.add(i,s)),h.#c=e.timeStamp,pe(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,h.#i=null,h.#r=null,h.#l=null,h.#c=NaN),h.#s&&(h.#s.abort(),h.#s=null,h.#n=NaN,h.#o=null)}static _endDraw(e){let i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),e&&i.drawLayer.updateProperties(this._currentDrawId,h.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){let s=h.#i,n=this._currentDrawId,a=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(a))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:At.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){let i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(At.DRAW_STEP),!h.#i.isEmpty()){let{pageDimensions:[s,n],scale:a}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:h.#i.getOutlines(s*a,n*a,a,this._INNER_MARGIN),drawingOptions:h.#r,mustBeCommitted:!e});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,s,n,a,o){Ct("Not implemented")}static deserialize(e,i,s){return Y(this,null,function*(){let{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:c}}=i.viewport,u=this.deserializeDraw(o,c,n,a,this._INNER_MARGIN,e),f=yield ri(h,this,"deserialize").call(this,e,i,s);return f.createDrawingOptions(e),f.#h({drawOutlines:u}),f.#f(),f.onScaleChanging(),f.rotate(),f})}serializeDraw(e){let[i,s]=this.pageTranslation,[n,a]=this.pageDimensions;return this.#t.serialize([i,s,n,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return h})(),Ia=class{#t=new Float64Array(6);#e;#i;#s;#r;#n;#l="";#o=0;#c=new En;#h;#d;constructor(t,e,i,s,n,a){this.#h=i,this.#d=s,this.#s=n,this.#r=a,[t,e]=this.#u(t,e);let o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e],this.#i=[{line:o,points:this.#n}],this.#t.set(o,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#u(t,e){return K._normalizePoint(t,e,this.#h,this.#d,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#n.length<=10}add(t,e){[t,e]=this.#u(t,e);let[i,s,n,a]=this.#t.subarray(2,6),o=t-n,c=e-a;return Math.hypot(this.#h*o,this.#d*c)<=2?null:(this.#n.push(t,e),isNaN(i)?(this.#t.set([n,a,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,s,n,a,t,e],0),this.#e.push(...K.createBezierPoints(i,s,n,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){let i=this.add(t,e);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){this.#h=i,this.#d=s,this.#s=n,[t,e]=this.#u(t,e);let a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e];let o=this.#i.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#i.push({line:a,points:this.#n}),this.#t.set(a,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#n=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#l="";for(let t=0,e=this.#i.length;t<e;t++){let{line:i,points:s}=this.#i[t];this.#e=i,this.#n=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){let t=K.svgRound(this.#e[4]),e=K.svgRound(this.#e[5]);if(this.#n.length===2)return this.#l=`${this.#l} M ${t} ${e} Z`,this.#l;if(this.#n.length<=6){let s=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,s)} M ${t} ${e}`,this.#o=6}if(this.#n.length===4){let s=K.svgRound(this.#e[10]),n=K.svgRound(this.#e[11]);return this.#l=`${this.#l} L ${s} ${n}`,this.#o=12,this.#l}let i=[];this.#o===0&&(i.push(`M ${t} ${e}`),this.#o=6);for(let s=this.#o,n=this.#e.length;s<n;s+=6){let[a,o,c,u,f,m]=this.#e.slice(s,s+6).map(K.svgRound);i.push(`C${a} ${o} ${c} ${u} ${f} ${m}`)}return this.#l+=i.join(" "),this.#o=this.#e.length,this.#l}getOutlines(t,e,i,s){let n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#c.build(this.#i,t,e,i,this.#s,this.#r,s),this.#t=null,this.#e=null,this.#i=null,this.#l=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},En=class h extends K{#t;#e=0;#i;#s;#r;#n;#l;#o;#c;build(t,e,i,s,n,a,o){this.#r=e,this.#n=i,this.#l=s,this.#o=n,this.#c=a,this.#i=o??0,this.#s=t,this.#u()}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:e}of this.#s){if(t.push(`M${K.svgRound(e[4])} ${K.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12){t.push(`L${K.svgRound(e[10])} ${K.svgRound(e[11])}`);continue}for(let i=6,s=e.length;i<s;i+=6){let[n,a,o,c,u,f]=e.subarray(i,i+6).map(K.svgRound);t.push(`C${n} ${a} ${o} ${c} ${u} ${f}`)}}return t.join("")}serialize([t,e,i,s],n){let a=[],o=[],[c,u,f,m]=this.#d(),b,A,w,x,C,k,D,O,B;switch(this.#o){case 0:B=K._rescale,b=t,A=e+s,w=i,x=-s,C=t+c*i,k=e+(1-u-m)*s,D=t+(c+f)*i,O=e+(1-u)*s;break;case 90:B=K._rescaleAndSwap,b=t,A=e,w=i,x=s,C=t+u*i,k=e+c*s,D=t+(u+m)*i,O=e+(c+f)*s;break;case 180:B=K._rescale,b=t+i,A=e,w=-i,x=s,C=t+(1-c-f)*i,k=e+u*s,D=t+(1-c)*i,O=e+(u+m)*s;break;case 270:B=K._rescaleAndSwap,b=t+i,A=e+s,w=-i,x=-s,C=t+(1-u-m)*i,k=e+(1-c-f)*s,D=t+(1-u)*i,O=e+(1-c)*s;break}for(let{line:j,points:p}of this.#s)a.push(B(j,b,A,w,x,n?new Array(j.length):null)),o.push(B(p,b,A,w,x,n?new Array(p.length):null));return{lines:a,points:o,rect:[C,k,D,O]}}static deserialize(t,e,i,s,n,{paths:{lines:a,points:o},rotation:c,thickness:u}){let f=[],m,b,A,w,x;switch(c){case 0:x=K._rescale,m=-t/i,b=e/s+1,A=1/i,w=-1/s;break;case 90:x=K._rescaleAndSwap,m=-e/s,b=-t/i,A=1/s,w=1/i;break;case 180:x=K._rescale,m=t/i+1,b=-e/s,A=-1/i,w=1/s;break;case 270:x=K._rescaleAndSwap,m=e/s+1,b=t/i+1,A=-1/s,w=-1/i;break}if(!a){a=[];for(let k of o){let D=k.length;if(D===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1]]));continue}if(D===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,k[0],k[1],NaN,NaN,NaN,NaN,k[2],k[3]]));continue}let O=new Float32Array(3*(D-2));a.push(O);let[B,j,p,V]=k.subarray(0,4);O.set([NaN,NaN,NaN,NaN,B,j],0);for(let U=4;U<D;U+=2){let rt=k[U],yt=k[U+1];O.set(K.createBezierPoints(B,j,p,V,rt,yt),(U-2)*3),[B,j,p,V]=[p,V,rt,yt]}}}for(let k=0,D=a.length;k<D;k++)f.push({line:x(a[k].map(O=>O??NaN),m,b,A,w),points:x(o[k].map(O=>O??NaN),m,b,A,w)});let C=new h;return C.build(f,i,s,1,c,u,n),C}#h(t=this.#c){let e=this.#i+t/2*this.#l;return this.#o%180===0?[e/this.#r,e/this.#n]:[e/this.#n,e/this.#r]}#d(){let[t,e,i,s]=this.#t,[n,a]=this.#h(0);return[t+n,e+a,i-2*n,s-2*a]}#u(){let t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:s}of this.#s){if(s.length<=12){for(let o=4,c=s.length;o<c;o+=6){let[u,f]=s.subarray(o,o+2);t[0]=Math.min(t[0],u),t[1]=Math.min(t[1],f),t[2]=Math.max(t[2],u),t[3]=Math.max(t[3],f)}continue}let n=s[4],a=s[5];for(let o=6,c=s.length;o<c;o+=6){let[u,f,m,b,A,w]=s.subarray(o,o+6);tt.bezierBoundingBox(n,a,u,f,m,b,A,w,t),n=A,a=w}}let[e,i]=this.#h();t[0]=Math.min(1,Math.max(0,t[0]-e)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+e)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){let[e,i]=this.#h();this.#c=t;let[s,n]=this.#h(),[a,o]=[s-e,n-i],c=this.#t;return c[0]-=a,c[1]-=o,c[2]+=2*a,c[3]+=2*o,c}updateParentDimensions([t,e],i){let[s,n]=this.#h();this.#r=t,this.#n=e,this.#l=i;let[a,o]=this.#h(),c=a-s,u=o-n,f=this.#t;return f[0]-=c,f[1]-=u,f[2]+=2*c,f[3]+=2*u,f}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(K.svgRound).join(" ")}get defaultProperties(){let[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${K.svgRound(t)} ${K.svgRound(e)}`}}}get rotationTransform(){let[,,t,e]=this.#t,i=0,s=0,n=0,a=0,o=0,c=0;switch(this.#e){case 90:s=e/t,n=-t/e,o=t;break;case 180:i=-1,a=-1,o=t,c=e;break;case 270:s=-e/t,n=t/e,c=e;break;default:return""}return`matrix(${i} ${s} ${n} ${a} ${K.svgRound(o)} ${K.svgRound(c)})`}getPathResizingSVGProperties([t,e,i,s]){let[n,a]=this.#h(),[o,c,u,f]=this.#t;if(Math.abs(u-n)<=K.PRECISION||Math.abs(f-a)<=K.PRECISION){let x=t+i/2-(o+u/2),C=e+s/2-(c+f/2);return{path:{"transform-origin":`${K.svgRound(t)} ${K.svgRound(e)}`,transform:`${this.rotationTransform} translate(${x} ${C})`}}}let m=(i-2*n)/(u-2*n),b=(s-2*a)/(f-2*a),A=u/i,w=f/s;return{path:{"transform-origin":`${K.svgRound(o)} ${K.svgRound(c)}`,transform:`${this.rotationTransform} scale(${A} ${w}) translate(${K.svgRound(n)} ${K.svgRound(a)}) scale(${m} ${b}) translate(${K.svgRound(-n)} ${K.svgRound(-a)})`}}}getPathResizedSVGProperties([t,e,i,s]){let[n,a]=this.#h(),o=this.#t,[c,u,f,m]=o;if(o[0]=t,o[1]=e,o[2]=i,o[3]=s,Math.abs(f-n)<=K.PRECISION||Math.abs(m-a)<=K.PRECISION){let C=t+i/2-(c+f/2),k=e+s/2-(u+m/2);for(let{line:D,points:O}of this.#s)K._translate(D,C,k,D),K._translate(O,C,k,O);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${K.svgRound(t)} ${K.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let b=(i-2*n)/(f-2*n),A=(s-2*a)/(m-2*a),w=-b*(c+n)+t+n,x=-A*(u+a)+e+a;if(b!==1||A!==1||w!==0||x!==0)for(let{line:C,points:k}of this.#s)K._rescale(C,w,x,b,A,C),K._rescale(k,w,x,b,A,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${K.svgRound(t)} ${K.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],i){let[s,n]=i,a=this.#t,o=t-a[0],c=e-a[1];if(this.#r===s&&this.#n===n)for(let{line:u,points:f}of this.#s)K._translate(u,o,c,u),K._translate(f,o,c,f);else{let u=this.#r/s,f=this.#n/n;this.#r=s,this.#n=n;for(let{line:m,points:b}of this.#s)K._rescale(m,o,c,u,f,m),K._rescale(b,o,c,u,f,b);a[2]*=u,a[3]*=f}return a[0]=t,a[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${K.svgRound(t)} ${K.svgRound(e)}`}}}get defaultSVGProperties(){let t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${K.svgRound(t[0])} ${K.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}},Da=class h extends La{#t;constructor(t){super(),this.#t=t,super.updateProperties({fill:"none",stroke:Dt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this.#t.realScale),super.updateSVGProperty(t,e)}clone(){let t=new h(this.#t);return t.updateAll(this),t}},Na=class h extends Cc{static _type="ink";static _editorType=ut.INK;static _defaultDrawingOptions=null;constructor(t){super(Ci(Be({},t),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(t,e){Dt.initialize(t,e),this._defaultDrawingOptions=new Da(e.viewParameters)}static getDefaultDrawingOptions(t){let e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return gt(this,"typesMap",new Map([[At.INK_THICKNESS,"stroke-width"],[At.INK_COLOR,"stroke"],[At.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,i,s,n){return new Ia(t,e,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,i,s,n,a){return En.deserialize(t,e,i,s,n,a)}static deserialize(t,e,i){return Y(this,null,function*(){let s=null;if(t instanceof ps){let{data:{inkLists:a,rect:o,rotation:c,id:u,color:f,opacity:m,borderStyle:{rawWidth:b},popupRef:A},parent:{page:{pageNumber:w}}}=t;s=t={annotationType:ut.INK,color:Array.from(f),thickness:b,opacity:m,paths:{points:a},boxes:null,pageIndex:w-1,rect:o.slice(0),rotation:c,id:u,deleted:!1,popupRef:A}}let n=yield ri(h,this,"deserialize").call(this,t,e,i);return n.annotationElementId=t.id||null,n._initialData=s,n})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:e,parent:i}=this;e.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:i}){this._drawingOptions=h.getDefaultDrawingOptions({stroke:tt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:e,points:i,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":a,"stroke-width":o}}=this,c={annotationType:ut.INK,color:Dt._colorManager.convert(n),opacity:a,thickness:o,paths:{lines:e,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!this.#t(c)?null:(c.id=this.annotationElementId,c)}#t(t){let{color:e,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,o)=>a!==e[o])||t.thickness!==i||t.opacity!==s||t.pageIndex!==n}renderAnnotationElement(t){let{points:e,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:e}),null}},Oa=class h extends Dt{#t=null;#e=null;#i=null;#s=null;#r=null;#n="";#l=null;#o=null;#c=!1;#h=!1;static _type="stamp";static _editorType=ut.STAMP;constructor(t){super(Ci(Be({},t),{name:"stampEditor"})),this.#s=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,e){Dt.initialize(t,e)}static get supportedTypes(){return gt(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(e=>`image/${e}`))}static get supportedTypesStr(){return gt(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(ut.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){let e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#c=t.isSvg),t.file&&(this.#n=t.file.name),this.#a()}#u(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(t=null,e=!0){return Y(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!(yield i.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:s,width:n,height:a}=t||this.copyCanvas(null,null,!0).imageData,o=yield i.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");let c=o.output;return yield this.setGuessedAltText(c),e&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c})}#f(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#d(i,!0)).finally(()=>this.#u());return}if(this.#s){let i=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#d(s)).finally(()=>this.#u());return}if(this.#r){let i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#d(s)).finally(()=>this.#u());return}let t=document.createElement("input");t.type="file",t.accept=h.supportedTypesStr;let e=this._uiManager._signal;this.#i=new Promise(i=>{t.addEventListener("change",()=>Y(this,null,function*(){if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let s=yield this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(s)}i()}),{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#u()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#l?.remove(),this.#l=null,this.#o&&(clearTimeout(this.#o),this.#o=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#f();return}super.rebuild(),this.div!==null&&(this.#e&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;if(this.width&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#a():this.#f(),this.width&&!this.annotationElementId){let[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#o!==null&&clearTimeout(this.#o);let t=200;this.#o=setTimeout(()=>{this.#o=null,this.#m()},t)}#a(){let{div:t}=this,{width:e,height:i}=this.#t,[s,n]=this.pageDimensions,a=.75;if(this.width)e=this.width*s,i=this.height*n;else if(e>a*s||i>a*n){let f=Math.min(a*s/e,a*n/i);e*=f,i*=f}let[o,c]=this.parentDimensions;this.setDims(e*o/s,i*c/n),this._uiManager.enableWaiting(!1);let u=this.#l=document.createElement("canvas");u.setAttribute("role","img"),this.addContainer(u),this.width=e/s,this.height=i/n,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&u.setAttribute("aria-label",this.#n)}copyCanvas(t,e,i=!1){t||(t=224);let{width:s,height:n}=this.#t,a=new as,o=this.#t,c=s,u=n,f=null;if(e){if(s>e||n>e){let p=Math.min(e/s,e/n);c=Math.floor(s*p),u=Math.floor(n*p)}f=document.createElement("canvas");let b=f.width=Math.ceil(c*a.sx),A=f.height=Math.ceil(u*a.sy);this.#c||(o=this.#p(b,A));let w=f.getContext("2d");w.filter=this._uiManager.hcmFilter;let x="white",C="#cfcfd8";this._uiManager.hcmFilter!=="none"?C="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(x="#8f8f9d",C="#42414d");let k=15,D=k*a.sx,O=k*a.sy,B=new OffscreenCanvas(D*2,O*2),j=B.getContext("2d");j.fillStyle=x,j.fillRect(0,0,D*2,O*2),j.fillStyle=C,j.fillRect(0,0,D,O),j.fillRect(D,O,D,O),w.fillStyle=w.createPattern(B,"repeat"),w.fillRect(0,0,b,A),w.drawImage(o,0,0,o.width,o.height,0,0,b,A)}let m=null;if(i){let b,A;if(a.symmetric&&o.width<t&&o.height<t)b=o.width,A=o.height;else if(o=this.#t,s>t||n>t){let C=Math.min(t/s,t/n);b=Math.floor(s*C),A=Math.floor(n*C),this.#c||(o=this.#p(b,A))}let x=new OffscreenCanvas(b,A).getContext("2d",{willReadFrequently:!0});x.drawImage(o,0,0,o.width,o.height,0,0,b,A),m={width:b,height:A,data:x.getImageData(0,0,b,A).data}}return{canvas:f,width:c,height:u,imageData:m}}#p(t,e){let{width:i,height:s}=this.#t,n=i,a=s,o=this.#t;for(;n>2*t||a>2*e;){let c=n,u=a;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let f=new OffscreenCanvas(n,a);f.getContext("2d").drawImage(o,0,0,c,u,0,0,n,a),o=f.transferToImageBitmap()}return o}#m(){let[t,e]=this.parentDimensions,{width:i,height:s}=this,n=new as,a=Math.ceil(i*t*n.sx),o=Math.ceil(s*e*n.sy),c=this.#l;if(!c||c.width===a&&c.height===o)return;c.width=a,c.height=o;let u=this.#c?this.#t:this.#p(a,o),f=c.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(u,0,0,u.width,u.height,0,0,a,o)}getImageForAltText(){return this.#l}#g(t){if(t){if(this.#c){let s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}let e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#c){let[e,i]=this.pageDimensions,s=Math.round(this.width*e*Qe.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*Qe.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,n);return a.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,n),a.transferToImageBitmap()}return structuredClone(this.#t)}static deserialize(t,e,i){return Y(this,null,function*(){let s=null;if(t instanceof An){let{data:{rect:w,rotation:x,id:C,structParent:k,popupRef:D},container:O,parent:{page:{pageNumber:B}}}=t,j=O.querySelector("canvas"),p=i.imageManager.getFromCanvas(O.id,j);j.remove();let V=(yield e._structTree.getAriaAttributes(`${Ba}${C}`))?.get("aria-label")||"";s=t={annotationType:ut.STAMP,bitmapId:p.id,bitmap:p.bitmap,pageIndex:B-1,rect:w.slice(0),rotation:x,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:V},isSvg:!1,structParent:k,popupRef:D}}let n=yield ri(h,this,"deserialize").call(this,t,e,i),{rect:a,bitmap:o,bitmapUrl:c,bitmapId:u,isSvg:f,accessibilityData:m}=t;u&&i.imageManager.isValidId(u)?(n.#e=u,o&&(n.#t=o)):n.#s=c,n.#c=f;let[b,A]=n.pageDimensions;return n.width=(a[2]-a[0])/b,n.height=(a[3]-a[1])/A,n.annotationElementId=t.id||null,m&&(n.altTextData=m),n._initialData=s,n.#h=!!s,n})}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:ut.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=this.#g(!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let o=this.#b(i);if(o.isSame)return null;o.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,e===null)return i;e.stamps||=new Map;let a=this.#c?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:a,serialized:i}),i.bitmap=this.#g(!1);else if(this.#c){let o=e.stamps.get(this.#e);a>o.area&&(o.area=a,o.serialized.bitmap.close(),o.serialized.bitmap=this.#g(!1))}return i}#b(t){let{pageIndex:e,accessibilityData:{altText:i}}=this._initialData,s=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}},Tc=(()=>{class h{#t;#e=!1;#i=null;#s=null;#r=null;#n=new Map;#l=!1;#o=!1;#c=!1;#h=null;#d=null;#u=null;#f=null;#a;static _initialized=!1;static#p=new Map([Pa,Na,Oa,Sn].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:i,div:s,structTreeLayer:n,accessibilityManager:a,annotationLayer:o,drawLayer:c,textLayer:u,viewport:f,l10n:m}){let b=[...h.#p.values()];if(!h._initialized){h._initialized=!0;for(let A of b)A.initialize(m,e)}e.registerEditorTypes(b),this.#a=e,this.pageIndex=i,this.div=s,this.#t=a,this.#i=o,this.viewport=f,this.#u=u,this.drawLayer=c,this._structTree=n,this.#a.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===ut.NONE}updateToolbar(e){this.#a.updateToolbar(e)}updateMode(e=this.#a.getMode()){switch(this.#v(),e){case ut.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ut.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ut.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:i}=this.div;for(let s of h.#p.values())i.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#u?.div}setEditingState(e){this.#a.setEditingState(e)}addCommands(e){this.#a.addCommands(e)}cleanUndoStack(e){this.#a.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.div.classList.toggle("disabled",!e)}enable(){return Y(this,null,function*(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let s of this.#n.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#a.removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!this.#i){this.#c=!1;return}let i=this.#i.getEditableAnnotations();for(let s of i){if(s.hide(),this.#a.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;let n=yield this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}this.#c=!1})}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,i=new Map;for(let n of this.#n.values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else i.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(this.#i){let n=this.#i.getEditableAnnotations();for(let a of n){let{id:o}=a.data;if(this.#a.isDeletedAnnotationElement(o))continue;let c=i.get(o);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=e.get(o),c&&(this.#a.addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);let{classList:s}=this.div;for(let n of h.#p.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#a.getActive()!==e&&this.#a.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#u?.div&&!this.#f){this.#f=new AbortController;let e=this.#a.combinedSignal(this.#f);this.#u.div.addEventListener("pointerdown",this.#m.bind(this),{signal:e}),this.#u.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#u?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#u.div.classList.remove("highlighting"))}#m(e){this.#a.unselectAll();let{target:i}=e;if(i===this.#u.div||(i.getAttribute("role")==="img"||i.classList.contains("endOfContent"))&&this.#u.div.contains(i)){let{isMac:s}=Wt.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#a.showAllEditors("highlight",!0,!0),this.#u.div.classList.add("free"),this.toggleDrawing(),Sn.startHighlighting(this,this.#a.direction==="ltr",{target:this.#u.div,x:e.x,y:e.y}),this.#u.div.addEventListener("pointerup",()=>{this.#u.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),e.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;let e=this.#a.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let i=this.pointerup.bind(this);this.div.addEventListener("pointerup",i,{signal:e}),this.div.addEventListener("pointercancel",i,{signal:e})}disableClick(){this.#s?.abort(),this.#s=null}attach(e){this.#n.set(e.id,e);let{annotationElementId:i}=e;i&&this.#a.isDeletedAnnotationElement(i)&&this.#a.removeDeletedAnnotationElement(e)}detach(e){this.#n.delete(e.id),this.#t?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#a.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#a.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#a.addDeletedAnnotationElement(e.annotationElementId),Dt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#a.addEditor(e),this.attach(e),!e.isAttachedToDOM){let i=e.render();this.div.append(i),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#a.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:i}=document;e.div.contains(i)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),i.focus())},0)),e._structTreeParentId=this.#t?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let i=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:i,undo:s,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return h.#p.get(this.#a.getMode())}combinedSignal(e){return this.#a.combinedSignal(e)}#b(e){let i=this.#g;return i?new i.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(e,i){this.#a.updateToolbar(e),this.#a.updateMode(e);let{offsetX:s,offsetY:n}=this.#A(),a=this.getNextId(),o=this.#b(Be({parent:this,id:a,x:s,y:n,uiManager:this.#a,isCentered:!0},i));o&&this.add(o)}deserialize(e){return Y(this,null,function*(){return(yield h.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#a))||null})}createAndAddNewEditor(e,i,s={}){let n=this.getNextId(),a=this.#b(Be({parent:this,id:n,x:e.offsetX,y:e.offsetY,uiManager:this.#a,isCentered:i},s));return a&&this.add(a),a}#A(){let{x:e,y:i,width:s,height:n}=this.div.getBoundingClientRect(),a=Math.max(0,e),o=Math.max(0,i),c=Math.min(window.innerWidth,e+s),u=Math.min(window.innerHeight,i+n),f=(a+c)/2-e,m=(o+u)/2-i,[b,A]=this.viewport.rotation%180===0?[f,m]:[m,f];return{offsetX:b,offsetY:A}}addNewEditor(){this.createAndAddNewEditor(this.#A(),!0)}setSelected(e){this.#a.setSelected(e)}toggleSelected(e){this.#a.toggleSelected(e)}unselect(e){this.#a.unselect(e)}pointerup(e){let{isMac:i}=Wt.platform;if(!(e.button!==0||e.ctrlKey&&i)&&e.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#a.getMode()===ut.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(this.#a.getMode()===ut.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}let{isMac:i}=Wt.platform;if(e.button!==0||e.ctrlKey&&i||e.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(e);return}let s=this.#a.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(e){if(this.div.focus(),this.#h){this.#g.startDrawing(this,this.#a,!1,e);return}this.#a.setCurrentDrawingSession(this),this.#h=new AbortController;let i=this.#a.combinedSignal(this.#h);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:i}),this.#g.startDrawing(this,this.#a,!1,e)}pause(e){if(e){let{activeElement:i}=document;this.div.contains(i)&&(this.#d=i);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(e=!1){return this.#h?(this.#a.setCurrentDrawingSession(null),this.#h.abort(),this.#h=null,this.#d=null,this.#g.endDrawing(e)):null}findNewParent(e,i,s){let n=this.#a.findParent(i,s);return n===null||n===this?!1:(n.changeParent(e),!0)}commitOrRemove(){return this.#h?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#h&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(let e of this.#n.values())this.#t?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#n.clear(),this.#a.removeLayer(this)}#v(){for(let e of this.#n.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,di(this.div,e);for(let i of this.#a.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:e}){this.#a.commitOrRemove(),this.#v();let i=this.viewport.rotation,s=e.rotation;if(this.viewport=e,di(this.div,{rotation:s}),i!==s)for(let n of this.#n.values())n.rotate(s)}get pageDimensions(){let{pageWidth:e,pageHeight:i}=this.viewport.rawDims;return[e,i]}get scale(){return this.#a.viewParameters.realScale}}return h})(),Fa=class h{#t=null;#e=0;#i=new Map;#s=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#i.size>0)for(let e of this.#i.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return gt(this,"_svgFactory",new ds)}static#r(t,[e,i,s,n]){let{style:a}=t;a.top=`${100*i}%`,a.left=`${100*e}%`,a.width=`${100*s}%`,a.height=`${100*n}%`}#n(){let t=h._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#l(t,e){let i=h._svgFactory.createElement("clipPath");t.append(i);let s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");let n=h._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s}#o(t,e){for(let[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)}draw(t,e=!1,i=!1){let s=this.#e++,n=this.#n(),a=h._svgFactory.createElement("defs");n.append(a);let o=h._svgFactory.createElement("path");a.append(o);let c=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(s,o);let u=i?this.#l(a,c):null,f=h._svgFactory.createElement("use");return n.append(f),f.setAttribute("href",`#${c}`),this.updateProperties(n,t),this.#i.set(s,n),{id:s,clipPathId:`url(#${u})`}}drawOutline(t,e){let i=this.#e++,s=this.#n(),n=h._svgFactory.createElement("defs");s.append(n);let a=h._svgFactory.createElement("path");n.append(a);let o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let c;if(e){let m=h._svgFactory.createElement("mask");n.append(m),c=`mask_p${this.pageIndex}_${i}`,m.setAttribute("id",c),m.setAttribute("maskUnits","objectBoundingBox");let b=h._svgFactory.createElement("rect");m.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");let A=h._svgFactory.createElement("use");m.append(A),A.setAttribute("href",`#${o}`),A.setAttribute("stroke","none"),A.setAttribute("fill","black"),A.setAttribute("fill-rule","nonzero"),A.classList.add("mask")}let u=h._svgFactory.createElement("use");s.append(u),u.setAttribute("href",`#${o}`),c&&u.setAttribute("mask",`url(#${c})`);let f=u.cloneNode();return s.append(f),u.classList.add("mainOutline"),f.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#i.set(i,s),i}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;let{root:i,bbox:s,rootClass:n,path:a}=e,o=typeof t=="number"?this.#i.get(t):t;if(o){if(i&&this.#o(o,i),s&&h.#r(o,s),n){let{classList:c}=o;for(let[u,f]of Object.entries(n))c.toggle(u,f)}if(a){let u=o.firstChild.firstChild;this.#o(u,a)}}}updateParent(t,e){if(e===this)return;let i=this.#i.get(t);i&&(e.#t.append(i),this.#i.delete(t),e.#i.set(t,i))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#i.get(t).remove(),this.#i.delete(t))}destroy(){this.#t=null;for(let t of this.#i.values())t.remove();this.#i.clear(),this.#s.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:gs};var Xc=lt.AbortException,Yc=lt.AnnotationEditorLayer,Kc=lt.AnnotationEditorParamsType,Qc=lt.AnnotationEditorType,Jc=lt.AnnotationEditorUIManager,Zc=lt.AnnotationLayer,tu=lt.AnnotationMode,eu=lt.ColorPicker,iu=lt.DOMSVGFactory,su=lt.DrawLayer,nu=lt.FeatureTest,wl=lt.GlobalWorkerOptions,ru=lt.ImageKind,au=lt.InvalidPDFException,ou=lt.MissingPDFException,lu=lt.OPS,hu=lt.OutputScale,cu=lt.PDFDataRangeTransport,uu=lt.PDFDateString,du=lt.PDFWorker,fu=lt.PasswordResponses,pu=lt.PermissionFlag,gu=lt.PixelsPerInch,mu=lt.RenderingCancelledException,bu=lt.TextLayer,vu=lt.TouchManager,yu=lt.UnexpectedResponseException,Au=lt.Util,_u=lt.VerbosityLevel,wu=lt.XfaLayer,xu=lt.build,Su=lt.createValidAbsoluteUrl,Eu=lt.fetchData,Va=lt.getDocument,Cu=lt.getFilenameFromUrl,Tu=lt.getPdfFilenameFromUrl,ku=lt.getXfaPageViewport,Pu=lt.isDataScheme,Mu=lt.isPdfFile,Ru=lt.noContextMenu,Lu=lt.normalizeUnicode,Iu=lt.setLayerDimensions,Du=lt.shadow,Nu=lt.stopEvent,Ou=lt.version;var kc=["wrap"],Pc=["flipbook"];function Mc(h,t){if(h&1){let e=ki();J(0,"div",10)(1,"button",11),Ft("click",function(){Ut(e);let s=It();return Gt(s.volver())}),it(2,"Volver"),W(),J(3,"button",12),Ft("click",function(){Ut(e);let s=It();return Gt(s.prev())}),it(4,"Anterior"),W(),J(5,"button",12),Ft("click",function(){Ut(e);let s=It();return Gt(s.next())}),it(6,"Siguiente"),W(),ee(7,"div",13),J(8,"button",14),Ft("click",function(){Ut(e);let s=It();return Gt(s.zoomOut())}),ee(9,"i",15),W(),J(10,"button",14),Ft("click",function(){Ut(e);let s=It();return Gt(s.zoomIn())}),ee(11,"i",16),W(),J(12,"button",14),Ft("click",function(){Ut(e);let s=It();return Gt(s.resetZoom())}),it(13),Ro(14,"number"),W(),J(15,"button",14),Ft("click",function(){Ut(e);let s=It();return Gt(s.fitToScreen())}),it(16," Ajustar "),W(),J(17,"button",14),Ft("click",function(){Ut(e);let s=It();return Gt(s.fitWide())}),it(18," Ancho 100% "),W(),J(19,"button",17),Ft("click",function(){Ut(e);let s=It();return Gt(s.toggleFullscreen())}),ee(20,"i",18),W()()}if(h&2){let e=It();ct(8),xt("disabled",e.isLoading),ct(2),xt("disabled",e.isLoading),ct(2),xt("disabled",e.isLoading),ct(),Ds(" ",Lo(14,8,e.zoom*100,"1.0-0"),"% "),ct(2),xt("disabled",e.isLoading),ct(2),xt("disabled",e.isLoading),ct(2),xt("disabled",e.isLoading),ct(),xt("ngClass",e.isFullscreen?"bi-fullscreen-exit":"bi-fullscreen")}}function Rc(h,t){h&1&&(J(0,"div",19)(1,"span",20),it(2,"Teclado: \u2190/\u2192 para p\xE1ginas | PageUp/PageDown | Home/End"),W(),J(3,"span",21),it(4,"Usa botones/esquinas para pasar p\xE1ginas"),W()())}function Lc(h,t){if(h&1){let e=ki();J(0,"div",22)(1,"div",23),it(2,"Abriendo el PDF en otra pesta\xF1a\u2026"),W(),J(3,"div",24)(4,"a",25),it(5,"Abrir PDF"),W(),J(6,"a",26),it(7,"Descargar"),W(),J(8,"button",27),Ft("click",function(){Ut(e);let s=It();return Gt(s.volver())}),it(9,"Volver"),W()(),J(10,"div",28),it(11," Si tu navegador bloquea ventanas emergentes, usa \u201CAbrir PDF\u201D. "),W()()}if(h&2){let e=It();ct(4),xt("href",e.mobilePdfUrl,ar),ct(2),xt("href",e.mobilePdfUrl,ar)}}function Ic(h,t){h&1&&(J(0,"div",34)(1,"div",35),it(2,"Cargando PDF..."),W()())}function Dc(h,t){if(h&1&&(J(0,"div",34)(1,"div",36),it(2),W()()),h&2){let e=It(2);ct(2),ze(e.errorMsg)}}function Nc(h,t){if(h&1){let e=ki();J(0,"div",29,0),Ft("contextmenu",function(s){return Ut(e),Gt(s.preventDefault())}),ee(2,"div",30,1),J(4,"button",31),Ft("click",function(){Ut(e);let s=It();return Gt(s.prev())}),it(5," \u2039 "),W(),J(6,"button",32),Ft("click",function(){Ut(e);let s=It();return Gt(s.next())}),it(7," \u203A "),W(),Xe(8,Ic,3,0,"div",33)(9,Dc,3,1,"div",33),W()}if(h&2){let e=It();cr("mobile-mode",e.displayMode==="single"),ct(2),cr("is-hidden",!!e.errorMsg),ct(2),xt("disabled",e.isLoading||!!e.errorMsg),ct(2),xt("disabled",e.isLoading||!!e.errorMsg),ct(2),xt("ngIf",e.isLoading),ct(),xt("ngIf",!e.isLoading&&e.errorMsg)}}var Hi=class Hi{constructor(t,e,i,s){this.route=t;this.router=e;this.api=i;this.http=s;this.ruta=Pi.ruta;this.id=0;this.titulo="";this.pdfUrl="";this.mobileExternal=!1;this.mobilePdfUrl="";this.mobilePopup=null;this.isLoading=!0;this.errorMsg="";this.zoom=1;this.isFullscreen=!1;this.zoomOverridden=!1;this.turnInitialized=!1;this.pdfDisableWorker=!1;this.pageCount=0;this.currentPage=1;this.basePageWidth=0;this.basePageHeight=0;this.zoomMin=.5;this.zoomMax=2.5;this.zoomStep=.1;this.displayMode="double";this.onFullscreenChangeBound=()=>this.onFullscreenChange();this.onKeydownBound=t=>this.onKeydown(t);this.touchStartX=0;this.touchStartY=0;this.onTouchStartBound=t=>this.onTouchStart(t);this.onTouchEndBound=t=>this.onTouchEnd(t);wl.workerSrc=new URL("assets/pdfjs/pdf.worker.min.mjs",document.baseURI).toString()}fetchPdfAsArrayBuffer(t){return Y(this,null,function*(){let e=yield To(this.http.get(t,{responseType:"arraybuffer"})),i=new Uint8Array(e.slice(0,5));if(String.fromCharCode(...Array.from(i))!=="%PDF-")throw new Error("El recurso no parece ser un PDF (posible login/HTML/JSON).");return e})}ngAfterViewInit(){if(document.addEventListener("fullscreenchange",this.onFullscreenChangeBound),document.addEventListener("keydown",this.onKeydownBound),this.displayMode=this.computeDisplayMode(),this.displayMode==="single")try{this.mobilePopup=window.open("about:blank","_blank","noopener,noreferrer")}catch{this.mobilePopup=null}if(this.bindTouchNavigation(),typeof ResizeObserver<"u"&&(this.resizeObs=new ResizeObserver(()=>{this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{let t=this.computeDisplayMode();t!==this.displayMode&&this.switchDisplayMode(t),!this.isLoading&&!this.errorMsg&&this.applyBestFit(!1)},80)}),this.wrapRef?.nativeElement&&this.resizeObs.observe(this.wrapRef.nativeElement)),this.id=Number(this.route.snapshot.paramMap.get("id")??0),!this.id){this.errorMsg="ID inv\xE1lido",this.isLoading=!1;return}this.api.seleccionar(this.id).subscribe({next:t=>Y(this,null,function*(){let e=t?.data;this.titulo=e?.nombre_documento??"";let i=(e?.archivo??"").toString();if(i.startsWith("http://")||i.startsWith("https://"))this.pdfUrl=i;else{let s=(this.ruta??"").toString().trim();s.startsWith("http://")||s.startsWith("https://")?this.pdfUrl=new URL(i,s).toString():this.pdfUrl=i.startsWith("/")?i:"/"+i}if(this.displayMode==="single"){this.mobileExternal=!0,this.mobilePdfUrl=this.pdfUrl,this.isLoading=!1,this.openPdfPuroMobile();return}try{yield this.ensureTurnLoaded(),yield this.renderPdfToFlipbook(this.pdfUrl),this.isLoading=!1}catch(s){console.error(s),this.errorMsg=this.toUserError(s),this.isLoading=!1}}),error:t=>{console.error(t),this.errorMsg="No se pudo cargar el documento",this.isLoading=!1}})}ngOnDestroy(){document.removeEventListener("fullscreenchange",this.onFullscreenChangeBound),document.removeEventListener("keydown",this.onKeydownBound),this.unbindTouchNavigation();try{this.resizeObs?.disconnect()}catch{}this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.destroyTurn()}openPdfPuroMobile(){let t=this.mobilePdfUrl||this.pdfUrl;if(t){try{if(this.mobilePopup&&!this.mobilePopup.closed){this.mobilePopup.location.href=t;return}}catch{}try{if(window.open(t,"_blank","noopener,noreferrer"))return}catch{}window.location.href=t}}volver(){this.router.navigate(["/gestioninstitucion/biblioteca"])}prev(){if(this.displayMode==="single"){this.setCurrentPage(this.currentPage-1);return}if(!this.turnInitialized)return;let t=this.getJQuery();t&&t(this.flipbookRef.nativeElement).turn("previous")}next(){if(this.displayMode==="single"){this.setCurrentPage(this.currentPage+1);return}if(!this.turnInitialized)return;let t=this.getJQuery();t&&t(this.flipbookRef.nativeElement).turn("next")}zoomIn(){this.setZoomManual(this.zoom+this.zoomStep)}zoomOut(){this.setZoomManual(this.zoom-this.zoomStep)}resetZoom(){this.setZoomManual(1)}fitToScreen(){let t=this.computeFitZoom("fit");this.setZoomAuto(t)}fitWide(){let t=this.computeFitZoom("wide");this.setZoomAuto(t)}applyBestFit(t=!1){!t&&this.zoomOverridden||(this.displayMode==="single"?this.fitToScreen():this.fitWide())}setZoomManual(t){this.zoomOverridden=!0,this.setZoom(t)}setZoomAuto(t){this.zoomOverridden=!1,this.setZoom(t)}toggleFullscreen(){return Y(this,null,function*(){let t=this.wrapRef?.nativeElement;if(t)try{document.fullscreenElement?yield document.exitFullscreen():yield t.requestFullscreen()}catch(e){console.warn("No se pudo activar fullscreen",e)}})}destroyTurn(){try{if(this.turnInitialized&&this.flipbookRef?.nativeElement){let t=this.getJQuery();if(!t)return;t(this.flipbookRef.nativeElement).turn("destroy")}}catch{}this.turnInitialized=!1}setZoom(t){let e=Math.max(this.zoomMin,Math.min(this.zoomMax,Number(t.toFixed(2))));this.zoom=e,this.applyBookSize()}computeFitZoom(t){if(!this.basePageWidth||!this.basePageHeight)return 1;let e=this.wrapRef?.nativeElement;if(!e)return 1;let i=24,s=Math.max(200,e.clientWidth-i-2),n=Math.max(200,e.clientHeight-i),a=this.displayMode==="double"?2:1,o=this.basePageWidth*a,c=this.basePageHeight,u=s/o,f=n/c;if(t==="fit"){let b=Math.min(u,f);return Math.max(this.zoomMin,Math.min(this.zoomMax,Number(b.toFixed(2))))}let m=u;return Math.max(this.zoomMin,Math.min(this.zoomMax,Number(m.toFixed(2))))}applyBookSize(){if(!this.flipbookRef?.nativeElement||!this.basePageWidth||!this.basePageHeight)return;let t=this.zoom||1,e=Math.round(this.basePageWidth*t),i=Math.round(this.basePageHeight*t),s=this.displayMode==="double"?2:1,n=e*s,a=i,o=this.flipbookRef.nativeElement;if(o.style.width=n+"px",o.style.height=a+"px",o.querySelectorAll(".page").forEach(u=>{u.style.width=e+"px",u.style.height=i+"px"}),this.turnInitialized){let u=this.getJQuery();if(!u)return;try{u(o).turn("size",n,a)}catch{}}}computeDisplayMode(){return(window.innerWidth||1024)<992?"single":"double"}applyTurnDisplayMode(){if(!this.turnInitialized||!this.flipbookRef?.nativeElement)return;let t=this.getJQuery();if(t){try{t(this.flipbookRef.nativeElement).turn("display",this.displayMode)}catch{}this.applyBookSize()}}onFullscreenChange(){this.isFullscreen=!!document.fullscreenElement,setTimeout(()=>{this.applyBestFit(!1)},50)}onKeydown(t){if(!this.isLoading&&!this.errorMsg&&!this.mobileExternal){let n=(t.key||"").toLowerCase();if((t.ctrlKey||t.metaKey)&&(n==="s"||n==="p"||n==="u")){t.preventDefault();return}}if(!this.turnInitialized||this.isLoading||this.errorMsg)return;let e=t.target,i=(e?.tagName??"").toLowerCase();if(!(i==="input"||i==="textarea"||e?.isContentEditable||i==="select")){if(t.key==="ArrowLeft"||t.key==="PageUp"){t.preventDefault(),this.prev();return}if(t.key==="ArrowRight"||t.key==="PageDown"||t.key===" "){t.preventDefault(),this.next();return}if(t.key==="Home"){t.preventDefault();let n=this.getJQuery();if(!n)return;try{n(this.flipbookRef.nativeElement).turn("page",1)}catch{}}if(t.key==="End"){t.preventDefault();let n=this.getJQuery();if(!n)return;try{n(this.flipbookRef.nativeElement).turn("page","last")}catch{}}}}renderPdfToFlipbook(t){return Y(this,null,function*(){if(!this.flipbookRef?.nativeElement)return;this.destroyTurn(),this.flipbookRef.nativeElement.innerHTML="";let e;try{let o=yield this.fetchPdfAsArrayBuffer(t),c=new Uint8Array(o);e=yield Va({data:c,disableWorker:this.pdfDisableWorker}).promise}catch(o){let c=(o?.message??"").toString();if(!this.pdfDisableWorker&&/worker|pdf\.worker|ERR_ABORTED|404/i.test(c)){this.pdfDisableWorker=!0;let u=yield this.fetchPdfAsArrayBuffer(t),f=new Uint8Array(u);e=yield Va({data:f,disableWorker:!0}).promise}else throw o}let i=0,s=0;this.pageCount=e.numPages,this.currentPage=1;for(let o=1;o<=e.numPages;o++){let c=yield e.getPage(o),u=c.getViewport({scale:1.35});o===1&&(i=Math.round(u.width),s=Math.round(u.height));let f=document.createElement("canvas");f.width=Math.round(u.width),f.height=Math.round(u.height);let m=f.getContext("2d");if(!m)continue;yield c.render({canvasContext:m,viewport:u}).promise;let b=document.createElement("div");b.className="page",b.dataset.page=String(o),b.style.width=f.width+"px",b.style.height=f.height+"px",b.appendChild(f),this.flipbookRef.nativeElement.appendChild(b)}let n=i>0?i:900,a=s>0?s:600;this.basePageWidth=n,this.basePageHeight=a,this.displayMode=this.computeDisplayMode(),this.zoomOverridden=!1,this.displayMode==="double"?yield this.initTurnDouble():(this.destroyTurn(),this.turnInitialized=!1,this.setZoomAuto(this.computeFitZoom("fit")),this.setCurrentPage(1)),setTimeout(()=>this.applyBestFit(!1),0)})}initTurnDouble(){return Y(this,null,function*(){this.showAllPages(),this.zoom=this.computeFitZoom("wide"),this.applyBookSize();let t=Math.round(this.basePageWidth*2*this.zoom),e=Math.round(this.basePageHeight*this.zoom);this.assertTurnLoaded()(this.flipbookRef.nativeElement).turn({width:t,height:e,display:"double",autoCenter:!0,gradients:!0,elevation:50}),this.turnInitialized=!0,this.applyBookSize(),this.setTurnPageSafe(this.currentPage)})}switchDisplayMode(t){if(this.displayMode==="double"&&(this.currentPage=this.getTurnPageSafe()??this.currentPage),this.displayMode=t,this.zoomOverridden=!1,t==="single"){this.destroyTurn(),this.turnInitialized=!1,this.setZoomAuto(this.computeFitZoom("fit")),this.setCurrentPage(this.currentPage);return}!this.basePageWidth||!this.basePageHeight||this.initTurnDouble().catch(()=>{})}setCurrentPage(t){let e=Math.max(1,Math.min(this.pageCount||1,t));if(this.currentPage=e,this.displayMode==="double"){this.setTurnPageSafe(e);return}this.showOnlyPage(e)}showOnlyPage(t){let e=this.flipbookRef?.nativeElement;if(!e)return;e.querySelectorAll(".page").forEach(s=>{let n=Number(s.dataset.page??"0")===t;s.classList.toggle("is-active",n)})}showAllPages(){let t=this.flipbookRef?.nativeElement;if(!t)return;t.querySelectorAll(".page").forEach(i=>i.classList.add("is-active"))}getTurnPageSafe(){if(!this.turnInitialized)return null;let t=this.getJQuery();if(!t)return null;try{let e=t(this.flipbookRef.nativeElement).turn("page"),i=Number(e);return Number.isFinite(i)?i:null}catch{return null}}setTurnPageSafe(t){if(!this.turnInitialized)return;let e=this.getJQuery();if(e)try{e(this.flipbookRef.nativeElement).turn("page",t)}catch{}}bindTouchNavigation(){let t=this.wrapRef?.nativeElement;t&&(t.addEventListener("touchstart",this.onTouchStartBound,{passive:!0}),t.addEventListener("touchend",this.onTouchEndBound,{passive:!1}))}unbindTouchNavigation(){let t=this.wrapRef?.nativeElement;t&&(t.removeEventListener("touchstart",this.onTouchStartBound),t.removeEventListener("touchend",this.onTouchEndBound))}onTouchStart(t){if(!t.touches?.length)return;let e=t.touches[0];this.touchStartX=e.clientX,this.touchStartY=e.clientY}onTouchEnd(t){if(this.displayMode==="single"||!this.turnInitialized||this.isLoading||this.errorMsg)return;let e=t.changedTouches?.[0];if(!e)return;let i=e.clientX-this.touchStartX,s=e.clientY-this.touchStartY;Math.abs(i)<45||Math.abs(i)<Math.abs(s)||(t.preventDefault(),i>0?this.prev():this.next())}toUserError(t){let e=t?.message?String(t.message):"";return/Turn\.js no est[a] cargado/i.test(e)||/turn/i.test(e)?"No se pudo iniciar el visor (Turn.js no est\xE1 cargado)":/jQuery no est[a] cargado/i.test(e)||/jquery/i.test(e)?"No se pudo iniciar el visor (jQuery no est\xE1 cargado)":/worker|pdf\.worker|ERR_ABORTED|404/i.test(e)?"No se pudo cargar el worker de PDF.js (se intentar\xE1 sin worker). Recarga e intenta de nuevo.":/Invalid PDF structure/i.test(e)||/no parece ser un PDF/i.test(e)?"El archivo no se pudo abrir: el servidor no devolvi\xF3 un PDF v\xE1lido (revisar que el enlace sea p\xFAblico o que el token est\xE9 activo).":"No se pudo renderizar el PDF"}getJQuery(){return window.jQuery||window.$||null}ensureWindowJQuery(){let t=this.getJQuery();if(t)return t;let e=$a.default??$a;return window.jQuery=e,window.$=e,e}loadScriptOnce(t){return new Promise((e,i)=>{let s=document.querySelector(`script[data-lcch-src="${t}"]`);if(s){if(s.dataset?.loaded==="1")return e();s.addEventListener("load",()=>e()),s.addEventListener("error",()=>i(new Error(`No se pudo cargar: ${t}`)));return}let n=document.createElement("script");n.src=t,n.defer=!0,n.dataset.lcchSrc=t,n.addEventListener("load",()=>{n.dataset.loaded="1",e()}),n.addEventListener("error",()=>i(new Error(`No se pudo cargar: ${t}`))),document.head.appendChild(n)})}assertTurnLoaded(){let t=this.ensureWindowJQuery();if(!t)throw new Error("jQuery no est\xE1 cargado");if(!t.fn||!t.fn.turn)throw new Error("Turn.js no est\xE1 cargado");return t}ensureTurnLoaded(t=4e3){return Y(this,null,function*(){if(this.ensureWindowJQuery(),!this.getJQuery()?.fn?.turn){let i=["/assets/angular/browser/assets/turnlcch/lib/turn.min.js","/assets/turnlcch/lib/turn.min.js"],s=!1;for(let n of i)try{yield this.loadScriptOnce(n),s=!0;break}catch{}}let e=Date.now();for(;Date.now()-e<t;)try{this.assertTurnLoaded();return}catch{yield new Promise(i=>setTimeout(i,50))}this.assertTurnLoaded()})}};Hi.\u0275fac=function(e){return new(e||Hi)(je(Ho),je(Fs),je(Mi),je(Os))},Hi.\u0275cmp=Ls({type:Hi,selectors:[["app-visor-biblioteca"]],viewQuery:function(e,i){if(e&1&&(or(kc,5),or(Pc,5)),e&2){let s;lr(s=hr())&&(i.wrapRef=s.first),lr(s=hr())&&(i.flipbookRef=s.first)}},standalone:!1,decls:11,vars:5,consts:[["wrap",""],["flipbook",""],[1,"container-fluid","py-3","px-2"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],[1,"small","text-muted"],[1,"fw-semibold"],["class","d-flex gap-2 flex-wrap justify-content-end",4,"ngIf"],["class","small text-muted mb-2",4,"ngIf"],["class","p-3",4,"ngIf"],["class","flipbook-wrap",3,"mobile-mode","contextmenu",4,"ngIf"],[1,"d-flex","gap-2","flex-wrap","justify-content-end"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"vr","d-none","d-md-block"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-zoom-out"],[1,"bi","bi-zoom-in"],[1,"btn","btn-outline-dark","btn-sm",3,"click","disabled"],[1,"bi",3,"ngClass"],[1,"small","text-muted","mb-2"],[1,"d-none","d-lg-inline"],[1,"d-lg-none"],[1,"p-3"],[1,"alert","alert-info","mb-2"],[1,"d-flex","gap-2","flex-wrap"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-primary",3,"href"],["download","",1,"btn","btn-outline-secondary",3,"href"],[1,"btn","btn-outline-secondary",3,"click"],[1,"small","text-muted","mt-2"],[1,"flipbook-wrap",3,"contextmenu"],[1,"flipbook"],["type","button","aria-label","P\xE1gina anterior",1,"corner-nav","corner-left","d-lg-none",3,"click","disabled"],["type","button","aria-label","P\xE1gina siguiente",1,"corner-nav","corner-right","d-lg-none",3,"click","disabled"],["class","overlay",4,"ngIf"],[1,"overlay"],[1,"text-center","py-4"],[1,"alert","alert-danger","m-0"]],template:function(e,i){e&1&&(J(0,"div",2)(1,"div",3)(2,"div")(3,"div",4),it(4,"Visor"),W(),J(5,"div",5),it(6),W()(),Xe(7,Mc,21,11,"div",6),W(),Xe(8,Rc,5,0,"div",7)(9,Lc,12,2,"div",8)(10,Nc,10,8,"div",9),W()),e&2&&(ct(6),ze(i.titulo),ct(),xt("ngIf",!i.mobileExternal),ct(),xt("ngIf",!i.mobileExternal),ct(),xt("ngIf",i.mobileExternal),ct(),xt("ngIf",!i.mobileExternal))},dependencies:[Io,Ns,No],styles:['@charset "UTF-8";.flipbook-wrap[_ngcontent-%COMP%]{position:relative;width:100%;min-height:520px;overflow-x:auto;overflow-y:auto;-webkit-overflow-scrolling:touch;display:flex;align-items:flex-start;justify-content:center;padding:10px;background:#f5f6f8;border-radius:12px;user-select:none;-webkit-user-select:none}.flipbook-wrap[_ngcontent-%COMP%]:fullscreen{width:100vw;height:100vh;min-height:100vh;padding:16px;background:#f5f6f8;border-radius:0}.flipbook[_ngcontent-%COMP%]{background:#fff;box-shadow:0 12px 30px #0000001f;overflow:hidden}.flipbook.is-hidden[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]{background:#fff;overflow:hidden}.flipbook-wrap.mobile-mode[_ngcontent-%COMP%]   .page[_ngcontent-%COMP%]{display:none}.flipbook-wrap.mobile-mode[_ngcontent-%COMP%]   .page.is-active[_ngcontent-%COMP%]{display:block}.page[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:12px;background:#f5f6f8e6;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.corner-nav[_ngcontent-%COMP%]{position:absolute;bottom:12px;z-index:5;width:44px;height:44px;border-radius:999px;border:1px solid rgba(0,0,0,.15);background:#ffffffe6;box-shadow:0 8px 18px #0000001f;color:#111;font-size:26px;line-height:1;display:inline-flex;align-items:center;justify-content:center}.corner-nav[_ngcontent-%COMP%]:disabled{opacity:.45}.corner-left[_ngcontent-%COMP%]{left:12px}.corner-right[_ngcontent-%COMP%]{right:12px}@media (max-width: 991.98px){.flipbook-wrap[_ngcontent-%COMP%]{height:calc(100dvh - 210px);max-height:calc(100dvh - 210px);min-height:320px;padding:8px}}']});var Nn=Hi;var Oc=[{path:"biblioteca",component:Bs},{path:"visor-biblioteca/:id",component:Nn}],gi=class gi{};gi.\u0275fac=function(e){return new(e||gi)},gi.\u0275mod=Is({type:gi}),gi.\u0275inj=Rs({imports:[dr.forChild(Oc),dr]});var On=gi;var mi=class mi{};mi.\u0275fac=function(e){return new(e||mi)},mi.\u0275mod=Is({type:mi}),mi.\u0275inj=Rs({imports:[Oo,Xo,qo,On]});var xl=mi;export{xl as SistemaarchivoslcchModule};
