import{a as ot}from"./chunk-OOKT7CA3.js";import{a as ye}from"./chunk-OZBMU6CO.js";import{a as nt}from"./chunk-ZKP6LLI3.js";import"./chunk-FP75KMDZ.js";import"./chunk-MQTYL4CM.js";import{a as Ce}from"./chunk-5EUTDLE7.js";import{a as Ze}from"./chunk-BDYLTSXV.js";import{a as tt}from"./chunk-X2UZLZXS.js";import{b as he}from"./chunk-A5M3HUGQ.js";import{b as it}from"./chunk-2XFHIHYO.js";import{b as Je}from"./chunk-OXONTOT5.js";import"./chunk-DV43CXZZ.js";import"./chunk-NCIXDP2C.js";import{k as Oe}from"./chunk-2UZ5XJOB.js";import{b as xe}from"./chunk-5XGECW57.js";import{g as et}from"./chunk-3IGMLI3N.js";import{b as ge,c as G,f as B,g as fe,i as He,k as U,l as be,m as ve,p as Qe,q as Xe,r as $,s as j,t as K,u as qe,v as Ye}from"./chunk-F4JB6MJU.js";import{a as _e}from"./chunk-5RMZ5E5A.js";import{Ab as de,Ac as pe,Ba as se,Bb as ue,Ca as s,Cc as F,Dc as D,Eb as ie,Fb as Ue,Gb as P,Jb as c,Ka as M,Kb as v,Kc as Ke,Lb as C,Lc as We,Mb as me,Pa as L,Qa as le,Qb as y,Rb as S,Rc as Ne,Sb as E,Ua as b,Vc as ze,Wb as A,Z as Fe,_ as re,_a as k,ac as $e,ba as De,dc as je,ec as W,ga as p,gb as d,ha as _,hb as o,ia as Ge,ib as a,jb as x,nb as Pe,ob as Ae,qb as h,ta as Be,tb as g,vb as u,za as te,zb as ce}from"./chunk-4IB5NCLX.js";import{a as oe,b as Le,m as ae}from"./chunk-GG76335P.js";function lt(r,t){if(r&1){let e=h();o(0,"div",35)(1,"button",36),g("click",function(){p(e);let n=u();return _(n.infoPrev())}),c(2,"Prev"),a(),o(3,"button",36),g("click",function(){p(e);let n=u();return _(n.infoNext())}),c(4,"Next"),a()()}if(r&2){let e=u();s(),d("disabled",!e.infoTienePrev()||e.isLoadingInfo),s(2),d("disabled",!e.infoTieneNext()||e.isLoadingInfo)}}function ct(r,t){if(r&1){let e=h();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=u();return _(l.onEvalEnabledChange(0,n))}),a(),o(2,"span",21),c(3,"1"),a()()}if(r&2){let e=u();s(),d("ngModel",e.evalEnabled[0])}}function dt(r,t){if(r&1){let e=h();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=u();return _(l.onEvalEnabledChange(1,n))}),a(),o(2,"span",21),c(3,"2"),a()()}if(r&2){let e=u();s(),d("ngModel",e.evalEnabled[1])}}function ut(r,t){if(r&1){let e=h();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=u();return _(l.onEvalEnabledChange(2,n))}),a(),o(2,"span",21),c(3,"3"),a()()}if(r&2){let e=u();s(),d("ngModel",e.evalEnabled[2])}}function mt(r,t){if(r&1){let e=h();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=u();return _(l.onEvalEnabledChange(3,n))}),a(),o(2,"span",21),c(3,"4"),a()()}if(r&2){let e=u();s(),d("ngModel",e.evalEnabled[3])}}function pt(r,t){if(r&1&&(o(0,"span"),c(1),a()),r&2){let e=u(2);s(),me("\xB7 P\xE1gina ",e.infoMeta.current_page," / ",e.infoMeta.last_page)}}function _t(r,t){if(r&1&&(o(0,"span"),c(1),a()),r&2){let e=u().$implicit;s(),C("\xB7 ",e.NombreInstitucion)}}function gt(r,t){if(r&1){let e=h();o(0,"button",46),g("click",function(){let n=p(e).$implicit,l=u(2);return _(l.seleccionarInfo(n))}),o(1,"div",47),c(2),a(),o(3,"div",48),c(4),b(5,_t,2,1,"span",43),a()()}if(r&2){let e=t.$implicit,i=u(2);P("active",(i.selectedInfo==null?null:i.selectedInfo.id)===e.id),s(2),v(i.infoLabel(e)),s(2),C(" ID Inscripci\xF3n: ",e.id," "),s(),d("ngIf",i.esSuperAdmin&&e.NombreInstitucion)}}function ft(r,t){if(r&1&&(o(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41)(4,"div",42),c(5),b(6,pt,2,2,"span",43),a(),o(7,"div",44),b(8,gt,6,5,"button",45),a()()()()()),r&2){let e=u();s(5),C(" Resultados: ",(e.infoMeta==null?null:e.infoMeta.total)??e.infoItems.length," "),s(),d("ngIf",e.infoMeta),s(2),d("ngForOf",e.infoItems)("ngForTrackBy",e.trackByRowIndex)}}function bt(r,t){r&1&&(o(0,"div",49)(1,"div",50),c(2," Primero busca una "),o(3,"strong"),c(4,"inscripci\xF3n"),a(),c(5," y selecci\xF3nala para cargar sus materias. "),a(),o(6,"div",51),c(7," Columnas calculadas: "),o(8,"strong"),c(9,"Prom Teo"),a(),c(10,", "),o(11,"strong"),c(12,"Prom Prac"),a(),c(13," y "),o(14,"strong"),c(15,"Prom"),a(),c(16," (solo lectura). "),a()())}function vt(r,t){r&1&&(o(0,"span"),c(1,"Cargando calificaciones\u2026"),a())}function ht(r,t){r&1&&(o(0,"span"),c(1,"Guardando cambios\u2026"),a())}function xt(r,t){if(r&1&&(o(0,"div",52)(1,"div",51),b(2,vt,2,0,"span",43)(3,ht,2,0,"span",43),a()()),r&2){let e=u();s(2),d("ngIf",e.isLoadingCalificaciones),s(),d("ngIf",e.isSaving)}}function Ct(r,t){if(r&1&&(o(0,"div",53)(1,"div",51),c(2),a()()),r&2){let e=u();s(2),v(e.saveError)}}function yt(r,t){if(r&1&&(o(0,"span"),c(1),a()),r&2){let e=u(2);s(),C("/ ",e.califMeta.last_page)}}function St(r,t){if(r&1){let e=h();o(0,"div",56)(1,"button",36),g("click",function(){p(e);let n=u(2);return _(n.califPrev())}),c(2,"Prev"),a(),o(3,"button",36),g("click",function(){p(e);let n=u(2);return _(n.califNext())}),c(4,"Next"),a()()}if(r&2){let e=u(2);s(),d("disabled",!e.califTienePrev()||e.isLoadingCalificaciones),s(2),d("disabled",!e.califTieneNext()||e.isLoadingCalificaciones)}}function Et(r,t){if(r&1){let e=h();o(0,"div",2)(1,"div",54),c(2," Inscripci\xF3n seleccionada: "),o(3,"strong"),c(4),a(),c(5," \xB7 P\xE1gina materias: "),o(6,"strong"),c(7),a(),b(8,yt,2,1,"span",43),a(),o(9,"div",5)(10,"div",51),c(11,"Cambios pendientes: "),o(12,"strong"),c(13),a()(),b(14,St,5,2,"div",55),o(15,"button",12),g("click",function(){p(e);let n=u();return _(n.cargarCalificaciones(n.califPage))}),c(16," Recargar "),a()()()}if(r&2){let e=u();s(4),v(e.selectedInfo.id),s(3),v((e.califMeta==null?null:e.califMeta.current_page)??e.califPage),s(),d("ngIf",e.califMeta),s(5),v(e.dirtyIds.size),s(),d("ngIf",e.califMeta),s(),d("disabled",e.isLoadingCalificaciones)}}function It(r,t){if(r&1&&(o(0,"span",4),c(1),a()),r&2){let e=t.ngIf;s(),C("(",e,")")}}function Tt(r,t){if(r&1&&(o(0,"th",62),c(1),b(2,It,2,1,"span",63),a()),r&2){let e=t.$implicit,i=u(2);Ue("width",e.widthPx,"px"),d("ngClass",i.headerThClass(e.key)),s(),C(" ",e.label," "),s(),d("ngIf",i.maxForColumn(e))}}function Mt(r,t){if(r&1&&(o(0,"tr",68)(1,"td",59)(2,"div",47),c(3),a()()()),r&2){let e=u().$implicit,i=u(2);s(),k("colspan",i.tableColspan()),s(2),v(i.groupKey(e))}}function wt(r,t){if(r&1){let e=h();Pe(0),o(1,"input",71),g("ngModelChange",function(n){p(e);let l=u().$implicit,m=u().index,f=u(2);return _(f.onCellValueInput(m,l.key,n))})("focus",function(){p(e);let n=u().index,l=u().index,m=u(2);return _(m.onCellFocus(l,n))})("keydown",function(n){p(e);let l=u().index,m=u().index,f=u(2);return _(f.onKeyDown(n,m,l))})("paste",function(n){p(e);let l=u().index,m=u().index,f=u(2);return _(f.onPaste(n,m,l))}),a(),Ae()}if(r&2){let e=u(),i=e.$implicit,n=e.index,l=u(),m=l.$implicit,f=l.index,I=u(2);s(),P("readonly-cell",i.readonly),d("readOnly",!!i.readonly||!I.isColumnEditable(i.key))("ngModel",m[i.key]),k("data-cell",f+"-"+n)("min",0)("max",I.maxForColumn(i))}}function Pt(r,t){if(r&1){let e=h();o(0,"input",72),g("focus",function(){p(e);let n=u().index,l=u().index,m=u(2);return _(m.onCellFocus(l,n))})("keydown",function(n){p(e);let l=u().index,m=u().index,f=u(2);return _(f.onKeyDown(n,m,l))})("paste",function(n){p(e);let l=u().index,m=u().index,f=u(2);return _(f.onPaste(n,m,l))}),a()}if(r&2){let e=u(),i=e.$implicit,n=e.index,l=u(),m=l.$implicit,f=l.index,I=u(2);d("readOnly",!0)("value",I.sumForColumn(m,i.key)??""),k("data-cell",f+"-"+n)}}function At(r,t){if(r&1&&(o(0,"td",69),b(1,wt,2,7,"ng-container",70)(2,Pt,1,3,"ng-template",null,0,W),a()),r&2){let e=t.$implicit,i=t.index,n=ie(3),l=u().$implicit,m=u(2);d("ngClass",m.cellTdClass(l,i,e.key)),s(),d("ngIf",e.kind!=="sum")("ngIfElse",n)}}function Nt(r,t){if(r&1){let e=h();Pe(0),b(1,Mt,4,2,"tr",64),o(2,"tr")(3,"td",59)(4,"div",65)(5,"div")(6,"div",47),c(7),a(),o(8,"div",66),c(9),a()(),o(10,"button",24),g("click",function(){let n=p(e).$implicit,l=u(2);return _(l.openPhoto(n))}),c(11,"Foto"),a()()(),b(12,At,4,3,"td",67),a(),Ae()}if(r&2){let e=t.$implicit,i=t.index,n=u(2);s(),d("ngIf",n.isGroupStart(i)),s(),P("table-active",i===n.activeRowIndex),s(5),v(e.estudiante),s(2),v(e.materia),s(3),d("ngForOf",n.columns)("ngForTrackBy",n.trackByColIndex)}}function Ot(r,t){if(r&1&&(o(0,"div",57)(1,"table",58)(2,"thead")(3,"tr")(4,"th",59),c(5,"Estudiante"),a(),b(6,Tt,3,5,"th",60),a()(),o(7,"tbody"),b(8,Nt,13,7,"ng-container",61),a()()()),r&2){let e=u();s(6),d("ngForOf",e.columns)("ngForTrackBy",e.trackByColIndex),s(2),d("ngForOf",e.rows)("ngForTrackBy",e.trackByRowIndex)}}function Vt(r,t){if(r&1){let e=h();o(0,"div",73)(1,"div",74)(2,"div",75)(3,"div",76)(4,"h5",77),c(5),a(),o(6,"button",78),g("click",function(){p(e);let n=u();return _(n.closePhoto())}),a()(),o(7,"div",79),x(8,"img",80),o(9,"div",81),c(10),a()()()()()}if(r&2){let e=u();s(5),C("Foto - ",e.photoRow==null?null:e.photoRow.estudiante),s(3),d("src",e.photoUrlFor(e.photoRow),te),s(2),v(e.photoRow==null?null:e.photoRow.materia)}}function kt(r,t){if(r&1){let e=h();o(0,"div",82),g("click",function(){p(e);let n=u();return _(n.closePhoto())}),a()}}var q=class q{constructor(t,e,i,n){this.hostEl=t;this._calif=e;this._info=i;this._auth=n;this.esSuperAdmin=!1;this.PASSING_SCORE=61;this.maxTeorico=30;this.maxPractico=70;this.avgEvalCount=4;this.evalEnabled=[!0,!0,!0,!0];this.showSumColumns=!1;this.filterInfo="";this.infoItems=[];this.infoMeta=null;this.infoPage=1;this.infoPerPage=10;this.isLoadingInfo=!1;this.selectedInfo=null;this.isLoadingCalificaciones=!1;this.califMeta=null;this.califPage=1;this.califPerPage=200;this.isSaving=!1;this.saveError=null;this.originalById=new Map;this.dirtyIds=new Set;this.HISTORY_LIMIT=80;this.undoStack=[];this.redoStack=[];this.isRestoring=!1;this.viewMode="intercalado";this.rows=[];this.activeRowIndex=0;this.activeColIndex=0;this.photoModalOpen=!1;this.photoRow=null;this.trackByRowIndex=(t,e)=>e.id;this.trackByColIndex=(t,e)=>e.key}get visibleEvalCount(){return this.avgEvalCount}get columns(){return this.buildColumns(this.viewMode,this.visibleEvalCount)}tableColspan(){return 1+this.columns.length}groupKey(t){let e=(t.Anio??"SIN A\xD1O").toString().trim()||"SIN A\xD1O",i=(t.LvlCurso??"SIN CURSO").toString().trim()||"SIN CURSO";return`${e} | ${i}`}isGroupStart(t){if(t<=0)return!0;let e=this.rows[t-1],i=this.rows[t];return!e||!i?!0:this.groupKey(e)!==this.groupKey(i)}buildColumns(t,e){let i=[],l=e;if(t==="intercalado")for(let m=1;m<=l;m++)i.push({key:`Teorico${m}`,label:`Teo${m}`,type:"number",kind:"input",widthPx:95}),i.push({key:`Practico${m}`,label:`Prac${m}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${m}`,label:`Sum${m}`,type:"number",kind:"sum",readonly:!0,widthPx:90});else{for(let m=1;m<=l;m++)i.push({key:`Teorico${m}`,label:`Teo${m}`,type:"number",kind:"input",widthPx:95});for(let m=1;m<=l;m++)i.push({key:`Practico${m}`,label:`Prac${m}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${m}`,label:`Sum${m}`,type:"number",kind:"sum",readonly:!0,widthPx:90})}return[...i,{key:"PromTeorico",label:"Prom Teo",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"PromPractico",label:"Prom Prac",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"Promedio",label:"Prom",type:"number",kind:"input",readonly:!0,widthPx:90},{key:"PruebaRecuperacion",label:"Recup",type:"number",kind:"input",widthPx:95}]}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>{this.esSuperAdmin=t})}buscarInfo(t=1){if(this.isLoadingInfo)return;let e=(this.filterInfo??"").trim();if(!e||e.length<2){this.infoItems=[],this.infoMeta=null,this.infoPage=1;return}this.isLoadingInfo=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.infoPerPage,search:e,sort_by:"FechInsc",sort_dir:"desc"}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.infoItems=n.map(l=>({id:Number(l?.id),FechInsc:l?.FechInsc??null,Curso_Solicitado:l?.Curso_Solicitado??null,Paralelo_Solicitado:l?.Paralelo_Solicitado??null,Categoria:l?.Categoria??null,Turno:l?.Turno??null,Anio:l?.Anio??null,Ap_Paterno:l?.Ap_Paterno??null,Ap_Materno:l?.Ap_Materno??null,Nombre:l?.Nombre??null,NombreInstitucion:l?.NombreInstitucion??null})).filter(l=>Number.isFinite(l.id)),this.infoMeta=i?.meta??null,this.infoPage=this.infoMeta?.current_page??t},error:i=>{console.error("Error al buscar inscripciones:",i),this.infoItems=[],this.infoMeta=null},complete:()=>{this.isLoadingInfo=!1}})}infoTienePrev(){return(this.infoMeta?.current_page??1)>1}infoTieneNext(){let t=this.infoMeta?.current_page??1,e=this.infoMeta?.last_page??1;return t<e}infoPrev(){this.infoTienePrev()&&this.buscarInfo((this.infoMeta?.current_page??1)-1)}infoNext(){this.infoTieneNext()&&this.buscarInfo((this.infoMeta?.current_page??1)+1)}infoLabel(t){let e=(t.Ap_Paterno??"").toString().trim(),i=(t.Ap_Materno??"").toString().trim(),n=(t.Nombre??"").toString().trim(),l=`${e} ${i} ${n}`.replace(/\s+/g," ").trim()||`Inscripci\xF3n #${t.id}`,m=(t.Anio??"").toString().trim(),f=(t.Curso_Solicitado??"").toString().trim(),I=(t.Paralelo_Solicitado??"").toString().trim(),w=[l];return m&&w.push(`A\xF1o: ${m}`),f&&w.push(`Curso: ${f}${I?" - "+I:""}`),w.join(" \xB7 ")}seleccionarInfo(t){this.selectedInfo=t,this.resetGridForNewInfo(),this.cargarCalificaciones(1)}limpiarInfo(){this.selectedInfo=null,this.resetGridForNewInfo()}resetGridForNewInfo(){this.rows=[],this.originalById.clear(),this.dirtyIds.clear(),this.undoStack=[],this.redoStack=[],this.saveError=null,this.califMeta=null,this.califPage=1}califTienePrev(){return(this.califMeta?.current_page??1)>1}califTieneNext(){let t=this.califMeta?.current_page??1,e=this.califMeta?.last_page??1;return t<e}califPrev(){this.califTienePrev()&&this.cargarCalificaciones((this.califMeta?.current_page??1)-1)}califNext(){this.califTieneNext()&&this.cargarCalificaciones((this.califMeta?.current_page??1)+1)}cargarCalificaciones(t=1){if(!this.selectedInfo||this.isLoadingCalificaciones)return;this.isLoadingCalificaciones=!0,this.saveError=null;let e=this.selectedInfo.id;this._calif.ObtenerCalificacionesPorInfoPaginado(e,{page:t,per_page:this.califPerPage}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.califMeta=i?.meta??null,this.califPage=this.califMeta?.current_page??t;let l=Number(n?.[0]?.CantidadEvaluaciones);Number.isFinite(l)&&(this.avgEvalCount=this.clampInt(l,1,4));let m=this.infoLabel(this.selectedInfo);this.rows=n.map(f=>{let I=(f?.NombreMateria??"").toString().trim(),w=(f?.SiglaMateria??"").toString().trim(),T=(f?.MateriaParalelo??"").toString().trim(),V=[w,I].filter(Boolean).join(" ")+(T?` (${T})`:"");return{id:Number(f?.id),infoestudiantesifas_id:Number(f?.infoestudiantesifas_id??e),materias_id:Number(f?.materias_id),estudiante:m,materia:V||`Materia #${f?.materias_id}`,fotoUrl:null,Anio:f?.Anio??null,LvlCurso:f?.LvlCurso??null,Teorico1:f?.Teorico1??null,Teorico2:f?.Teorico2??null,Teorico3:f?.Teorico3??null,Teorico4:f?.Teorico4??null,Practico1:f?.Practico1??null,Practico2:f?.Practico2??null,Practico3:f?.Practico3??null,Practico4:f?.Practico4??null,PromTeorico:f?.PromTeorico??null,PromPractico:f?.PromPractico??null,Promedio:f?.Promedio??null,PruebaRecuperacion:f?.PruebaRecuperacion??null}}).filter(f=>Number.isFinite(f.id)&&Number.isFinite(f.materias_id));for(let f of this.rows){for(let I of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(f,I);this.recalcInPlace(f)}this.captureBaseline()},error:i=>{console.error("Error al cargar calificaciones:",i),this.rows=[],this.califMeta=null,this.saveError="No se pudieron cargar las calificaciones."},complete:()=>{this.isLoadingCalificaciones=!1}})}captureBaseline(){this.originalById.clear(),this.dirtyIds.clear();for(let t of this.rows)this.originalById.set(t.id,{Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion})}recomputeDirtyForRow(t){let e=this.originalById.get(t.id);if(!e)return;["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"].some(l=>t[l]!==e[l])?this.dirtyIds.add(t.id):this.dirtyIds.delete(t.id)}guardarCambios(){if(!this.selectedInfo||this.isSaving||(this.saveError=null,Array.from(this.dirtyIds.values()).length===0))return;let e=this.rows.filter(i=>this.dirtyIds.has(i.id)).map(i=>({id:i.id,Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion}));this.isSaving=!0,this._calif.GuardarCalificacionesBulk({infoestudiantesifas_id:this.selectedInfo.id,avg_eval_count:this.avgEvalCount,items:e}).subscribe({next:()=>{for(let i of this.rows)this.dirtyIds.has(i.id)&&this.originalById.set(i.id,{Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion});this.dirtyIds.clear()},error:i=>{console.error("Error al guardar cambios:",i),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}onGlobalKeyDown(t){let e=t.target;if(!e||!this.hostEl.nativeElement.contains(e)||!(t.ctrlKey||t.metaKey))return;let n=t.key.toLowerCase();if(n==="z"&&!t.shiftKey){this.canUndo()&&(t.preventDefault(),this.undo());return}(n==="y"||n==="z"&&t.shiftKey)&&this.canRedo()&&(t.preventDefault(),this.redo())}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){let t=this.undoStack.pop();t&&(this.redoStack.push(this.snapshotState()),this.restoreState(t))}redo(){let t=this.redoStack.pop();t&&(this.undoStack.push(this.snapshotState()),this.restoreState(t))}beginUserChange(){this.isRestoring||(this.undoStack.push(this.snapshotState()),this.undoStack.length>this.HISTORY_LIMIT&&this.undoStack.shift(),this.redoStack=[])}copyAllToClipboard(){return ae(this,null,function*(){let t=this.buildTsvExport();if(navigator.clipboard?.writeText){yield navigator.clipboard.writeText(t);return}let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}onShowSumColumnsChange(t){this.beginUserChange(),this.showSumColumns=!!t}onMaxTeoricoInput(t){this.beginUserChange(),this.maxTeorico=t,this.onLimitsChange()}onMaxPracticoInput(t){this.beginUserChange(),this.maxPractico=t,this.onLimitsChange()}onLimitsChange(){this.maxTeorico=this.clampInt(this.maxTeorico,1,100),this.maxPractico=this.clampInt(this.maxPractico,1,100);for(let t of this.rows){for(let e of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(t,e);this.recalcInPlace(t)}}onAvgEvalCountInput(t){this.beginUserChange(),this.avgEvalCount=t,this.onAvgEvalCountChange()}onAvgEvalCountChange(){this.avgEvalCount=this.clampInt(this.avgEvalCount,1,4);for(let t of this.rows)this.recalcInPlace(t)}setAllEvaluations(t){this.beginUserChange(),this.evalEnabled=[t,t,t,t]}onEvalEnabledChange(t,e){t<0||t>3||(this.beginUserChange(),this.evalEnabled[t]=!!e)}setViewMode(t){this.viewMode!==t&&(this.beginUserChange(),this.viewMode=t)}onCellFocus(t,e){this.activeRowIndex=t,this.activeColIndex=e}maxForKey(t){return this.isTeoricoKey(t)?this.maxTeorico:this.isPracticoKey(t)?this.maxPractico:t==="PruebaRecuperacion"?100:null}maxForColumn(t){if(t.kind!=="input")return null;let e=t.key;return this.isReadonlyKey(e)?null:this.maxForKey(e)}isColumnEditable(t){return this.isSumKey(t)?!1:this.isCellEditable(t)}isSumColumn(t){return this.isSumKey(t)}sumForColumn(t,e){let i=this.evalIndexFromColumnKey(e);return i===null?null:this.evalSum(t,i)}openPhoto(t){this.photoRow=t,this.photoModalOpen=!0}closePhoto(){this.photoModalOpen=!1,this.photoRow=null}photoUrlFor(t){return t?.fotoUrl??"assets/images/client6.png"}isCellEditable(t){if(this.isReadonlyKey(t))return!1;let e=this.evalIndexFromKey(t);return e!==null?!!this.evalEnabled[e-1]:!0}evalSum(t,e){let i=t[`Teorico${e}`],n=t[`Practico${e}`];return typeof i=="number"&&typeof n=="number"?i+n:null}isSumKey(t){return typeof t=="string"&&t.startsWith("Sum")}evalIndexFromColumnKey(t){if(this.isSumKey(t)){let e=Number(t.replace("Sum",""));return e>=1&&e<=4?e:null}return this.evalIndexFromKey(t)}cellTdClass(t,e,i){return{"eval-end":this.isEvaluationSeparator(i),"section-start":this.isSectionStart(i),"cell-danger":this.isDangerCell(t,i)}}headerThClass(t){return{"eval-end":this.isEvaluationSeparator(t),"section-start":this.isSectionStart(t)}}onCellValueInput(t,e,i){if(!this.isCellEditable(e)||this.isReadonlyKey(e))return;this.beginUserChange();let n=this.rows[t];n[e]=this.parseNullableInt(String(i??"").trim()),this.sanitizeCellValue(n,e),this.recalcInPlace(n),this.recomputeDirtyForRow(this.rows[t])}onPaste(t,e,i){let n=t.clipboardData?.getData("text/plain");n&&(t.preventDefault(),this.beginUserChange(),this.applyPaste(n,e,i))}onKeyDown(t,e,i){if(t.key!=="ArrowUp"&&t.key!=="ArrowDown"&&t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return;t.preventDefault();let n=this.keyToDelta(t.key),l=this.clamp(e+n.dr,0,this.rows.length-1),m=this.clamp(i+n.dc,0,this.columns.length-1);this.focusCell(l,m)}focusCell(t,e){this.activeRowIndex=t,this.activeColIndex=e,queueMicrotask(()=>{let i=document.querySelector(`[data-cell="${t}-${e}"]`);i?.focus(),i?.select()})}pasteHere(t){this.applyPaste(t,this.activeRowIndex,this.activeColIndex)}applyPaste(t,e,i){let n=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),l=this.trimEmptyTrailingLines(n);for(let m=0;m<l.length;m++){let f=e+m;if(f>=this.rows.length)break;let I=l[m].split("	");for(let w=0;w<I.length;w++){let T=i+w;if(T>=this.columns.length)break;let V=this.columns[T];if(V.readonly||V.kind==="sum"||this.isSumKey(V.key))continue;let N=I[w].trim(),R=V.key;if(!this.isCellEditable(R))continue;let X=this.parseNullableInt(N);this.rows[f][R]=X,this.sanitizeCellValue(this.rows[f],R)}this.recalcInPlace(this.rows[f]),this.recomputeDirtyForRow(this.rows[f])}}recalcInPlace(t){let e=this.findZeroCascadeIndex(t),i=t,n=!!i.__cascadeActive,l=i.__cascadeLockFrom??null;if(e!==null){n||(i.__cascadeBackup={1:{teo:t.Teorico1,prac:t.Practico1},2:{teo:t.Teorico2,prac:t.Practico2},3:{teo:t.Teorico3,prac:t.Practico3},4:{teo:t.Teorico4,prac:t.Practico4}}),i.__cascadeActive=!0,i.__cascadeLockFrom=e;for(let T=e;T<=4;T++)t[`Teorico${T}`]=0,t[`Practico${T}`]=0}else if(n){let T=i.__cascadeBackup,V=l??1;if(T)for(let N=V+1;N<=4;N++){let R=T[N];if(!R)continue;let X=t[`Teorico${N}`],ne=t[`Practico${N}`];typeof X=="number"&&typeof ne=="number"&&X===0&&ne===0&&(t[`Teorico${N}`]=R.teo,t[`Practico${N}`]=R.prac)}i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null}let m=e!==null,f=this.getAvgEvalIndices(),I=f.map(T=>t[`Teorico${T}`]),w=f.map(T=>t[`Practico${T}`]);if(t.PromTeorico=m?0:this.avg(I),t.PromPractico=m?0:this.avg(w),t.PromTeorico===null&&t.PromPractico===null)t.Promedio=null;else{let T=(t.PromTeorico??0)+(t.PromPractico??0);t.Promedio=Math.max(0,Math.min(100,Math.round(T)))}}avg(t){let e=t.filter(n=>typeof n=="number"&&Number.isFinite(n));if(e.length===0)return null;let i=e.reduce((n,l)=>n+l,0);return Math.round(i/e.length)}parseNullableInt(t){if(!t)return null;let e=t.replace(",","."),i=Number(e);return Number.isFinite(i)?Math.trunc(i):null}sanitizeCellValue(t,e){if(this.isReadonlyKey(e))return;let i=t[e];if(i==null||!Number.isFinite(i)){t[e]=null;return}let n=Math.trunc(i),l=this.maxForKey(e);l!==null&&(n=Math.min(n,l)),n=Math.max(n,0),t[e]=n}clampInt(t,e,i){let n=Number(t);return Number.isFinite(n)?Math.trunc(this.clamp(n,e,i)):e}getAvgEvalIndices(){let t=[];for(let e=1;e<=this.avgEvalCount;e++)t.push(e);return t}findZeroCascadeIndex(t){for(let e=1;e<=4;e=e+1){let i=t[`Teorico${e}`],n=t[`Practico${e}`];if(typeof i=="number"&&typeof n=="number"&&i===0&&n===0)return e}return null}buildTsvExport(){let t=[{key:"Teorico1",label:"Teo1"},{key:"Practico1",label:"Prac1"},{key:"Teorico2",label:"Teo2"},{key:"Practico2",label:"Prac2"},{key:"Teorico3",label:"Teo3"},{key:"Practico3",label:"Prac3"},{key:"Teorico4",label:"Teo4"},{key:"Practico4",label:"Prac4"},{key:"PromTeorico",label:"Prom Teo"},{key:"PromPractico",label:"Prom Prac"},{key:"Promedio",label:"Prom"},{key:"PruebaRecuperacion",label:"Recup"}],e=["Estudiante","Materia",...t.map(n=>n.label)].join("	"),i=this.rows.map(n=>{let l=t.map(m=>{let f=n[m.key];return f==null?"":String(f)});return[n.estudiante,n.materia,...l].join("	")});return[e,...i].join(`
`)}snapshotState(){return{maxTeorico:this.maxTeorico,maxPractico:this.maxPractico,avgEvalCount:this.avgEvalCount,viewMode:this.viewMode,evalEnabled:[...this.evalEnabled],showSumColumns:this.showSumColumns,rows:this.rows.map(t=>({id:t.id,Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion}))}}restoreState(t){this.isRestoring=!0;try{this.maxTeorico=t.maxTeorico,this.maxPractico=t.maxPractico,this.avgEvalCount=t.avgEvalCount,this.viewMode=t.viewMode,this.evalEnabled=[...t.evalEnabled],this.showSumColumns=!!t.showSumColumns;let e=new Map(t.rows.map(i=>[i.id,i]));for(let i of this.rows){let n=e.get(i.id);n&&(i.Teorico1=n.Teorico1,i.Teorico2=n.Teorico2,i.Teorico3=n.Teorico3,i.Teorico4=n.Teorico4,i.Practico1=n.Practico1,i.Practico2=n.Practico2,i.Practico3=n.Practico3,i.Practico4=n.Practico4,i.PruebaRecuperacion=n.PruebaRecuperacion,i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null,this.recalcInPlace(i),this.recomputeDirtyForRow(i))}}finally{this.isRestoring=!1}}isTeoricoKey(t){return t==="Teorico1"||t==="Teorico2"||t==="Teorico3"||t==="Teorico4"}isPracticoKey(t){return t==="Practico1"||t==="Practico2"||t==="Practico3"||t==="Practico4"}isReadonlyKey(t){return t==="PromTeorico"||t==="PromPractico"||t==="Promedio"}isEvaluationSeparator(t){if(this.viewMode==="intercalado"){let e=i=>this.showSumColumns?`Sum${i}`:`Practico${i}`;return this.visibleEvalCount>=1&&t===e(1)||this.visibleEvalCount>=2&&t===e(2)||this.visibleEvalCount>=3&&t===e(3)||this.visibleEvalCount>=4&&t===e(4)}return t===`Teorico${this.visibleEvalCount}`||t===`Practico${this.visibleEvalCount}`||this.showSumColumns&&t===`Sum${this.visibleEvalCount}`}isSectionStart(t){return t==="PromTeorico"}isDangerCell(t,e){let i=this.evalIndexFromColumnKey(e);if(i!==null){let n=t[`Teorico${i}`],l=t[`Practico${i}`];return typeof n=="number"&&typeof l=="number"?n+l<this.PASSING_SCORE:!1}return e==="PromTeorico"?t.PromTeorico===null?!1:t.PromTeorico*100<this.PASSING_SCORE*this.maxTeorico:e==="PromPractico"?t.PromPractico===null?!1:t.PromPractico*100<this.PASSING_SCORE*this.maxPractico:e==="Promedio"?t.Promedio!==null&&t.Promedio<this.PASSING_SCORE:e==="PruebaRecuperacion"?t.PruebaRecuperacion!==null&&t.PruebaRecuperacion<this.PASSING_SCORE:!1}evalIndexFromKey(t){switch(t){case"Teorico1":case"Practico1":return 1;case"Teorico2":case"Practico2":return 2;case"Teorico3":case"Practico3":return 3;case"Teorico4":case"Practico4":return 4;default:return null}}trimEmptyTrailingLines(t){let e=[...t];for(;e.length>0&&e[e.length-1].trim()==="";)e.pop();return e}keyToDelta(t){switch(t){case"ArrowUp":return{dr:-1,dc:0};case"ArrowDown":return{dr:1,dc:0};case"ArrowLeft":return{dr:0,dc:-1};case"ArrowRight":return{dr:0,dc:1};default:return{dr:0,dc:0}}}clamp(t,e,i){return Math.max(e,Math.min(i,t))}makeRow(t,e,i,n,l,m,f,I,w,T,V,N,R,X,ne){return{id:t,infoestudiantesifas_id:e,materias_id:i,estudiante:n,materia:l,fotoUrl:m,Teorico1:f,Teorico2:I,Teorico3:w,Teorico4:T,Practico1:V,Practico2:N,Practico3:R,Practico4:X,PromTeorico:null,PromPractico:null,Promedio:null,PruebaRecuperacion:ne}}};q.\u0275fac=function(e){return new(e||q)(M(Be),M(ot),M(ye),M(he))},q.\u0275cmp=L({type:q,selectors:[["app-calificacionessolo"]],hostBindings:function(e,i){e&1&&g("keydown",function(l){return i.onGlobalKeyDown(l)},se)},standalone:!1,decls:73,vars:34,consts:[["sumCell",""],[1,"container-fluid","py-2"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-2"],[1,"mb-0"],[1,"text-body-secondary"],[1,"d-flex","align-items-center","gap-2"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"input-group","input-group-sm",2,"width","380px"],[1,"input-group-text"],["placeholder","Apellido o nombre (min 2 letras)",1,"form-control",3,"ngModelChange","keydown.enter","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n inscripci\xF3n",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],["role","group","aria-label","Modo de visualizaci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn",3,"click"],[1,"d-flex","align-items-center","gap-1","small"],["type","number","min","1","max","100",1,"form-control","form-control-sm",2,"width","78px",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",2,"width","110px",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"form-check","small","mb-0"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label"],[1,"d-flex","align-items-center","gap-2","small"],["class","form-check form-check-inline mb-0",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],["class","row g-2 mb-2",4,"ngIf"],["class","alert alert-info py-2 mb-2",4,"ngIf"],["class","alert alert-warning py-2 mb-2",4,"ngIf"],["class","alert alert-danger py-2 mb-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2",4,"ngIf"],["class","table-responsive cali-grid-wrap",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","role","dialog","aria-modal","true",4,"ngIf"],["class","modal-backdrop fade show",3,"click",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n inscripci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"form-check","form-check-inline","mb-0"],[1,"row","g-2","mb-2"],[1,"col-12"],[1,"card"],[1,"card-body","py-2"],[1,"small","text-body-secondary","mb-2"],[4,"ngIf"],[1,"list-group","list-group-flush"],["type","button","class","list-group-item list-group-item-action py-2",3,"active","click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"list-group-item","list-group-item-action","py-2",3,"click"],[1,"fw-semibold"],[1,"small","opacity-75"],[1,"alert","alert-info","py-2","mb-2"],[1,"small","mb-1"],[1,"small"],[1,"alert","alert-warning","py-2","mb-2"],[1,"alert","alert-danger","py-2","mb-2"],[1,"small","text-body-secondary"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n calificaciones",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n calificaciones",1,"btn-group","btn-group-sm"],[1,"table-responsive","cali-grid-wrap"],[1,"table","table-sm","table-bordered","align-middle","cali-grid"],[1,"sticky-col","col-meta"],["class","text-center",3,"width","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center",3,"ngClass"],["class","text-body-secondary",4,"ngIf"],["class","table-secondary",4,"ngIf"],[1,"d-flex","align-items-start","justify-content-between","gap-2"],[1,"text-body-secondary","small"],["class","p-1",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-secondary"],[1,"p-1",3,"ngClass"],[4,"ngIf","ngIfElse"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center",3,"ngModelChange","focus","keydown","paste","readOnly","ngModel"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center","readonly-cell",3,"focus","keydown","paste","readOnly","value"],["tabindex","-1","role","dialog","aria-modal","true",1,"modal","fade","show","d-block"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"modal-body","text-center"],["alt","Foto del estudiante",1,"img-fluid","rounded",3,"src"],[1,"text-body-secondary","small","mt-2"],[1,"modal-backdrop","fade","show",3,"click"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h5",3),c(4,"Editor de calificaciones (BD) tipo Excel"),a(),o(5,"small",4),c(6," Edita directo en celdas. Puedes copiar desde Excel y pegar (Ctrl+V) dentro de una celda; soporta pegar bloques (tab + saltos de l\xEDnea). "),a()(),o(7,"div",5)(8,"div",6)(9,"div",7)(10,"span",8),c(11,"Buscar inscripci\xF3n"),a(),o(12,"input",9),g("ngModelChange",function(l){return i.filterInfo=l})("keydown.enter",function(){return i.buscarInfo(1)}),a(),o(13,"button",10),g("click",function(){return i.buscarInfo(1)}),c(14," Buscar "),a()(),b(15,lt,5,2,"div",11),o(16,"button",12),g("click",function(){return i.limpiarInfo()}),c(17," Limpiar "),a()(),o(18,"div",13)(19,"button",14),g("click",function(){return i.setViewMode("intercalado")}),c(20," Intercalado (Eval1..4) "),a(),o(21,"button",14),g("click",function(){return i.setViewMode("agrupado")}),c(22," Agrupado (Teo/Prac) "),a()(),o(23,"div",6)(24,"div",15)(25,"span",4),c(26,"L\xEDmite Teo"),a(),o(27,"input",16),g("ngModelChange",function(l){return i.onMaxTeoricoInput(l)}),a()(),o(28,"div",15)(29,"span",4),c(30,"L\xEDmite Prac"),a(),o(31,"input",16),g("ngModelChange",function(l){return i.onMaxPracticoInput(l)}),a()(),o(32,"div",6)(33,"div",15)(34,"span",4),c(35,"Promedio usa"),a(),o(36,"select",17),g("ngModelChange",function(l){return i.onAvgEvalCountInput(l)}),o(37,"option",18),c(38,"1 eval"),a(),o(39,"option",18),c(40,"2 eval"),a(),o(41,"option",18),c(42,"3 eval"),a(),o(43,"option",18),c(44,"4 eval"),a()()()()(),o(45,"div",6)(46,"label",19)(47,"input",20),g("ngModelChange",function(l){return i.onShowSumColumnsChange(l)}),a(),o(48,"span",21),c(49,"Mostrar sumas"),a()(),o(50,"div",22)(51,"span",4),c(52,"Evaluaciones"),a(),b(53,ct,4,1,"label",23)(54,dt,4,1,"label",23)(55,ut,4,1,"label",23)(56,mt,4,1,"label",23),a(),o(57,"button",24),g("click",function(){return i.setAllEvaluations(!0)}),c(58," Todas "),a()(),o(59,"button",12),g("click",function(){return i.focusCell(0,0)}),c(60," Ir a primera celda "),a(),o(61,"button",25),g("click",function(){return i.copyAllToClipboard()}),c(62," Copiar todo "),a(),o(63,"button",26),g("click",function(){return i.guardarCambios()}),c(64," Guardar cambios "),a()()(),b(65,ft,9,4,"div",27)(66,bt,17,0,"div",28)(67,xt,4,2,"div",29)(68,Ct,3,1,"div",30)(69,Et,17,6,"div",31)(70,Ot,9,4,"div",32)(71,Vt,11,3,"div",33)(72,kt,1,0,"div",34),a()),e&2&&(s(12),d("ngModel",i.filterInfo),s(),d("disabled",i.isLoadingInfo),s(2),d("ngIf",i.infoMeta),s(),d("disabled",!i.selectedInfo),s(3),P("btn-primary",i.viewMode==="intercalado")("btn-outline-primary",i.viewMode!=="intercalado"),s(2),P("btn-primary",i.viewMode==="agrupado")("btn-outline-primary",i.viewMode!=="agrupado"),s(6),d("ngModel",i.maxTeorico),s(4),d("ngModel",i.maxPractico),s(5),d("ngModel",i.avgEvalCount),s(),d("ngValue",1),s(2),d("ngValue",2),s(2),d("ngValue",3),s(2),d("ngValue",4),s(4),d("ngModel",i.showSumColumns),s(6),d("ngIf",i.visibleEvalCount>=1),s(),d("ngIf",i.visibleEvalCount>=2),s(),d("ngIf",i.visibleEvalCount>=3),s(),d("ngIf",i.visibleEvalCount>=4),s(3),d("disabled",i.rows.length===0),s(4),d("disabled",!i.selectedInfo||i.dirtyIds.size===0||i.isSaving),s(2),d("ngIf",i.infoItems.length>0),s(),d("ngIf",!i.selectedInfo),s(),d("ngIf",i.selectedInfo&&(i.isLoadingCalificaciones||i.isSaving)),s(),d("ngIf",i.saveError),s(),d("ngIf",i.selectedInfo),s(),d("ngIf",i.selectedInfo),s(),d("ngIf",i.photoModalOpen),s(),d("ngIf",i.photoModalOpen))},dependencies:[pe,F,D,j,K,G,ve,ge,$,B,Ye,qe,U],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.cali-grid-wrap[_ngcontent-%COMP%]{max-height:calc(100vh - 220px)}.cali-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:3;background:var(--bs-body-bg)}.col-meta[_ngcontent-%COMP%]{min-width:240px;background:inherit}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.col-meta[_ngcontent-%COMP%]{background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bs-table-active-bg)}.cali-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.readonly-cell[_ngcontent-%COMP%]{background:#0000000a}.cali-grid[_ngcontent-%COMP%]   td.eval-end[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.eval-end[_ngcontent-%COMP%]{border-right-width:3px;border-right-style:solid;border-right-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.section-start[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.section-start[_ngcontent-%COMP%]{border-left-width:3px;border-left-style:solid;border-left-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{color:var(--bs-danger);font-weight:600}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control.readonly-cell[_ngcontent-%COMP%]{color:var(--bs-danger)}.cali-grid[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{border-radius:0}']});var Se=q;var Lt=["modalgestioncontroles"];function Ft(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),v(e)}}function Dt(r,t){r&1&&(o(0,"div",29),c(1," Cargando controles... "),a())}function Gt(r,t){if(r&1&&(o(0,"div",49),c(1),a()),r&2){let e=u().$implicit,i=u(3).$implicit,n=u(3);s(),me(" ",n.labelEdadesCategoria(i),": ",e.Edades||"-"," ")}}function Bt(r,t){if(r&1&&(o(0,"span",49),c(1),a()),r&2){let e=u().$implicit,i=u(6);s(),C("Instituci\xF3n: ",i.getNombreInstitucion(e)||(e.instituciones_id??"GLOBAL"))}}function Ut(r,t){r&1&&(o(0,"span",49),c(1,"|"),a())}function $t(r,t){if(r&1){let e=h();o(0,"div",44)(1,"div",45)(2,"div",46),c(3),a(),b(4,Gt,2,2,"div",47)(5,Bt,2,1,"span",47)(6,Ut,2,0,"span",47),o(7,"div",48)(8,"span",49),c(9,"Estado:"),a(),o(10,"button",50),g("click",function(n){let l=p(e).$implicit,m=u(6);return _(m.toggleEstadoFila(l,n))}),c(11),a(),o(12,"span",49),c(13,"|"),a(),o(14,"span",49),c(15,"Visibilidad:"),a(),o(16,"button",51),g("click",function(n){let l=p(e).$implicit,m=u(6);return _(m.toggleVisibilidadFila(l,n))}),c(17),a()()(),o(18,"div",52)(19,"button",53),g("click",function(){let n=p(e).$implicit,l=u(6);return _(l.Seleccionarcontroles(n.id))}),c(20,"Editar"),a(),o(21,"button",54),g("click",function(){let n=p(e).$implicit,l=u(6);return _(l.Eliminarcontroles(n.id))}),c(22,"Eliminar"),a()()()}if(r&2){let e=t.$implicit,i=u(3).$implicit,n=u(3);s(3),v(e.ParaI),s(),d("ngIf",n.showEdadesCategoria(i)),s(),d("ngIf",n.esSuperlcchs),s(),d("ngIf",n.esSuperlcchs),s(4),d("ngClass",e.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(e.id)),s(),C(" ",e.Estado," "),s(5),d("ngClass",e.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(e.id)),s(),C(" ",e.Visibilidad," ")}}function jt(r,t){if(r&1&&(o(0,"div",42),b(1,$t,23,10,"div",43),a()),r&2){let e=u().ngIf;s(),d("ngForOf",e)}}function Kt(r,t){r&1&&(o(0,"div",55),c(1,"Sin datos"),a())}function Wt(r,t){if(r&1){let e=h();o(0,"div",34)(1,"div",35)(2,"div",36)(3,"h4",37),c(4),a()(),o(5,"div",38),c(6),a(),o(7,"button",39),g("click",function(){p(e);let n=u().$implicit,l=u(3);return _(l.abrirNuevoPorCategoria(n))}),c(8," Nuevo "),a()(),o(9,"div",40),b(10,jt,2,1,"div",41)(11,Kt,2,0,"ng-template",null,1,W),a()()}if(r&2){let e=t.ngIf,i=ie(12),n=u().$implicit;s(4),C("",n," "),s(2),C(" ",e.length," item(s) "),s(4),d("ngIf",e.length>0)("ngIfElse",i)}}function zt(r,t){if(r&1&&(o(0,"div",32),b(1,Wt,13,4,"div",33),a()),r&2){let e=t.$implicit,i=u(3);s(),d("ngIf",i.getControlesPorCategoria(e))}}function Ht(r,t){if(r&1&&(o(0,"div",30),b(1,zt,2,1,"div",31),a()),r&2){let e=u(2);s(),d("ngForOf",e.categoriasParaMostrar)}}function Qt(r,t){if(r&1&&(o(0,"div",26),b(1,Dt,2,0,"div",27)(2,Ht,2,1,"div",28),a()),r&2){let e=u();s(),d("ngIf",e.isLoadingcontroles),s(),d("ngIf",!e.isLoadingcontroles)}}function Xt(r,t){r&1&&(o(0,"th",67),c(1,"NombreInstitucion"),a())}function qt(r,t){if(r&1&&(o(0,"tr")(1,"td",59)(2,"div",68)(3,"span",69),c(4,"Cargando..."),a()()()()),r&2){let e=u(2);s(),k("colspan",e.esSuperlcchs?9:8)}}function Yt(r,t){if(r&1&&(o(0,"tr")(1,"td",59),c(2,"No hay datos disponibles"),a()()),r&2){let e=u(2);s(),k("colspan",e.esSuperlcchs?9:8)}}function Zt(r,t){if(r&1&&(o(0,"td"),c(1),a()),r&2){let e=u().$implicit,i=u(2);s(),v(i.getNombreInstitucion(e))}}function Jt(r,t){if(r&1&&x(0,"img",76),r&2){let e=u(3);d("src",e._tools.rutabtniconsanimaciones+"pencil.svg",te)}}function ei(r,t){if(r&1&&x(0,"ng-lottie",77),r&2){let e=u(3);d("options",e._tools.optionsEditar)}}function ti(r,t){if(r&1&&x(0,"img",76),r&2){let e=u(3);d("src",e._tools.rutabtniconsanimaciones+"delete.svg",te)}}function ii(r,t){if(r&1&&x(0,"ng-lottie",77),r&2){let e=u(3);d("options",e._tools.optionsEliminar)}}function ni(r,t){if(r&1){let e=h();o(0,"tr",70),g("contextmenu",function(n){let l=p(e).$implicit,m=u(2);return _(m.abrirMenucontroles(n,l))}),o(1,"td",59),c(2),a(),o(3,"td"),c(4),a(),b(5,Zt,2,1,"td",62),o(6,"td"),c(7),a(),o(8,"td"),c(9),a(),o(10,"td"),c(11),a(),o(12,"td")(13,"button",50),g("click",function(n){let l=p(e).$implicit,m=u(2);return _(m.toggleEstadoFila(l,n))}),c(14),a()(),o(15,"td")(16,"button",51),g("click",function(n){let l=p(e).$implicit,m=u(2);return _(m.toggleVisibilidadFila(l,n))}),c(17),a()(),o(18,"td",71)(19,"button",72),g("click",function(){let n=p(e).$implicit,l=u(2);return _(l.Seleccionarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,l=u(2);return _(l._tools.hoverBotonMap["edicioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,l=u(2);return _(l._tools.hoverBotonMap["edicioncontroles-"+n.id]=!1)}),b(20,Jt,1,1,"img",73)(21,ei,1,1,"ng-lottie",74),a(),o(22,"button",75),g("click",function(){let n=p(e).$implicit,l=u(2);return _(l.Eliminarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,l=u(2);return _(l._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,l=u(2);return _(l._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!1)}),b(23,ti,1,1,"img",73)(24,ii,1,1,"ng-lottie",74),a()()()}if(r&2){let e=t.index,i=t.$implicit,n=u(2);s(2),v((n.paginacontroles-1)*n.pageSizecontroles+(e+1)),s(2),v(i.instituciones_id??"GLOBAL"),s(),d("ngIf",n.esSuperlcchs),s(2),v(i.Categoria),s(2),v(i.ParaI),s(2),v(i.Edades),s(2),d("ngClass",i.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(i.id)),s(),C(" ",i.Estado," "),s(2),d("ngClass",i.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(i.id)),s(),C(" ",i.Visibilidad," "),s(3),d("ngIf",!n._tools.hoverBotonMap["edicioncontroles-"+i.id]),s(),d("ngIf",n._tools.hoverBotonMap["edicioncontroles-"+i.id]),s(2),d("ngIf",!n._tools.hoverBotonMap["eliminacioncontroles-"+i.id]),s(),d("ngIf",n._tools.hoverBotonMap["eliminacioncontroles-"+i.id])}}function oi(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),C("",e," por p\xE1gina")}}function ai(r,t){if(r&1){let e=h();o(0,"div",26)(1,"div",56)(2,"table",57)(3,"thead",58)(4,"tr")(5,"th",59),c(6,"#"),a(),o(7,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("instituciones_id",n))}),c(8,"Instituci\xF3n"),a(),b(9,Xt,2,0,"th",61),o(10,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("Categoria",n))}),c(11,"Categoria"),a(),o(12,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("ParaI",n))}),c(13,"ParaI"),a(),o(14,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("Edades",n))}),c(15,"Edades"),a(),o(16,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("Estado",n))}),c(17,"Estado"),a(),o(18,"th",60),g("click",function(n){p(e);let l=u();return _(l.sortBycontroles("Visibilidad",n))}),c(19,"Visibilidad"),a(),o(20,"th",59),c(21,"ACCIONES"),a()()(),o(22,"tbody"),b(23,qt,5,1,"tr",62)(24,Yt,3,1,"tr",62)(25,ni,25,16,"tr",63),$e(26,"slice"),a()()(),o(27,"div",64)(28,"ngb-pagination",65),E("pageChange",function(n){p(e);let l=u();return S(l.paginacontroles,n)||(l.paginacontroles=n),_(n)}),a(),o(29,"select",66),E("ngModelChange",function(n){p(e);let l=u();return S(l.pageSizecontroles,n)||(l.pageSizecontroles=n),_(n)}),g("change",function(){p(e);let n=u();return _(n.onPageSizeChangecontroles())}),b(30,oi,2,2,"option",23),a()()()}if(r&2){let e=u();s(9),d("ngIf",e.esSuperlcchs),s(14),d("ngIf",e.isLoadingcontroles),s(),d("ngIf",!e.isLoadingcontroles&&(!e.controles||e.controles.length===0)),s(),d("ngForOf",je(26,13,e.controlesFiltrados,(e.paginacontroles-1)*e.pageSizecontroles,e.paginacontroles*e.pageSizecontroles)),s(3),y("page",e.paginacontroles),d("collectionSize",e.controlesFiltrados.length)("pageSize",e.pageSizecontroles)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0),s(),y("ngModel",e.pageSizecontroles),s(),d("ngForOf",e.pageSizeOptionscontroles)}}function ri(r,t){if(r&1&&(o(0,"option",97),c(1),a()),r&2){let e=t.$implicit;d("ngValue",e.id),s(),v(e.Nombre)}}function si(r,t){if(r&1&&(o(0,"div",84)(1,"select",96)(2,"option",97),c(3,"GLOBAL"),a(),b(4,ri,2,2,"option",98),a(),o(5,"label"),c(6,"Instituci\xF3n"),a()()),r&2){let e=u(2);s(2),d("ngValue",""),s(2),d("ngForOf",e.institucionesInfo)}}function li(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),v(e)}}function ci(r,t){if(r&1&&(o(0,"div",84),x(1,"input",99),o(2,"label"),c(3),a()()),r&2){let e=u(2);s(3),v(e.labelNivelCurso)}}function di(r,t){if(r&1&&(o(0,"div",84),x(1,"input",100),o(2,"label"),c(3),a()()),r&2){let e=u(2);s(3),v(e.labelEdades)}}function ui(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),v(e)}}function mi(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),v(e)}}function pi(r,t){if(r&1){let e=h();o(0,"button",103),g("click",function(){p(e);let n=u(3);return _(n.AutoCompletarLastcontroles())}),o(1,"span",104),x(2,"ng-lottie",105),a(),o(3,"span"),c(4,"AUTO COMPLETAR "),a(),x(5,"span",10),a()}if(r&2){let e=u(3);s(2),d("options",e._tools.optionsautocompletar)}}function _i(r,t){if(r&1&&(o(0,"div",101),b(1,pi,6,1,"button",102),a()),r&2){let e=u(2);s(),d("ngIf",!e.AnimacionCargabtnModalcontroles)}}function gi(r,t){if(r&1){let e=h();o(0,"button",106),g("click",function(){p(e);let n=u().$implicit,l=u();return n.dismiss(),_(l.resetcontroles())}),o(1,"span",104),x(2,"ng-lottie",105),a(),o(3,"span"),c(4,"CANCELAR"),a(),x(5,"span",10),a()}if(r&2){let e=u(2);s(2),d("options",e._tools.optionscancelar)}}function fi(r,t){if(r&1){let e=h();o(0,"button",107),g("click",function(){p(e);let n=u(2);return _(n.AgregarModificarcontroles())}),x(1,"span",108),a()}r&2&&d("disabled",!0)}function bi(r,t){if(r&1){let e=h();o(0,"button",109),g("click",function(){p(e);let n=u(2);return _(n.AgregarModificarcontroles())}),o(1,"span",104),x(2,"ng-lottie",105),a(),o(3,"span"),c(4),a(),x(5,"span",10),a()}if(r&2){let e,i,n=u(2);s(2),d("options",(e=n.newcontroles.get("id"))!=null&&e.value?n._tools.optionsEditar:n._tools.optionsAdicionar),s(2),v((i=n.newcontroles.get("id"))!=null&&i.value?"MODIFICAR":"REGISTRAR")}}function vi(r,t){if(r&1){let e=h();o(0,"div",78)(1,"h4",79),c(2),a(),o(3,"button",80),g("click",function(){let n=p(e).$implicit,l=u();return n.dismiss(),_(l.resetcontroles())}),a()(),o(4,"div",81)(5,"form",82),b(6,si,7,2,"div",83),o(7,"div",84)(8,"select",85)(9,"option",22),c(10,"SELECCIONE"),a(),b(11,li,2,2,"option",23),a(),o(12,"label"),c(13,"Categoria"),a()(),o(14,"div",84),x(15,"input",86),o(16,"label"),c(17),a()(),b(18,ci,4,1,"div",83)(19,di,4,1,"div",83),o(20,"div",84)(21,"select",87),b(22,ui,2,2,"option",23),a(),o(23,"label"),c(24,"Estado"),a()(),o(25,"div",84)(26,"select",88),b(27,mi,2,2,"option",23),a(),o(28,"label"),c(29,"Visibilidad"),a()()()(),o(30,"div",89),b(31,_i,2,1,"div",90),o(32,"div",91),b(33,gi,6,1,"button",92),a(),o(34,"div",93),b(35,fi,2,1,"button",94)(36,bi,6,2,"button",95),a()()}if(r&2){let e,i=u();s(2),C("",(e=i.newcontroles.get("id"))!=null&&e.value?"Modificar":"Registrar"," control"),s(3),d("formGroup",i.newcontroles),s(),d("ngIf",i.esSuperlcchs),s(5),d("ngForOf",i.categoriasOptionsForm),s(6),v(i.labelParaI),s(),d("ngIf",i.showNivelCurso),s(),d("ngIf",i.showEdades),s(3),d("ngForOf",i.estadoOptions),s(5),d("ngForOf",i.visibilidadOptions),s(4),d("ngIf",!i.newcontroles.get("id").value),s(2),d("ngIf",!i.AnimacionCargabtnModalcontroles),s(2),d("ngIf",i.AnimacionCargabtnModalcontroles),s(),d("ngIf",!i.AnimacionCargabtnModalcontroles)}}var Z=class Z{constructor(t,e,i,n){this._cont=t;this._tools=e;this._auth=i;this._inst=n;this.esSuperlcchs=!1;this.esAdministrativo=!1;this.institucionesIdSesion=null;this.institucionesInfo=[];this.institucionesById=new Map;this.estadoOptions=["ACTIVO","INACTIVO"];this.visibilidadOptions=["VISIBLE","OCULTO"];this.categoriasGlobales=["CARGOS SUPERADMINISTRATIVOS","PERMISO","ESTADO","VISIBILIDAD","SEXO","CARACTER\xCDSTICAS DE INSTITUCI\xD3N","EDICI\xD3N DE INSCRIPCIONES","EDICI\xD3N DE CALIFICACIONES","PREDETERMINADO","TIPOS SUPERADMINISTRATIVOS","TIPOS PLANTEL ADMINISTRATIVOS","TIPOS DOCENTES","ESTADO DE HABILITACI\xD3N","TIPOS MATERIAS","MODOS MATERIAS","RELACI\xD3N DOCENTE ESTUDIANTES","PROGRAMA","MODALIDAD","TIPO DE ESTUDIANTE"];this.categoriasPorInstitucion=["CARGOS ADMINISTRATIVOS","CARGOS DOCENTES","NIVEL DE CARRERA","ESPECIALIDAD","ESPECIALIDAD SECUNDARIA","LVLCURSO","NIVEL EN COLEGIO","GRADO DE COLEGIO","TIPO COLEGIO","TIPO REGISTRO DE MATERIA","ESTADO PAGO","EXPEDIDO","TURNO","VERIFICACI\xD3N INSCRIPCIONES"];this.togglingEstadoIds=new Set;this.togglingVisibilidadIds=new Set;this.viewMode="interactive";this.categoriaFiltro="";this.menuStatecontroles$=this._tools.state$;this.controles=[];this.paginacontroles=1;this.isLoadingcontroles=!0;this.AnimacionCargabtnModalcontroles=!1;this.filtertxtcontroles="";this.collectionSizecontroles=0;this.pageSizecontroles=10;this.pageSizeOptionscontroles=[5,10,20,50];this.sortColumnscontroles=[]}get categoriasOptions(){return this.esSuperlcchs?[...this.categoriasGlobales,...this.categoriasPorInstitucion]:[...this.categoriasPorInstitucion]}get categoriasOptionsForm(){return this.categoriasOptions}ngOnInit(){this.newcontroles=this._cont.createFormGroupcontroles(),this.newcontrolesAnteriorAccion=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this.cargarSesionYPermisos()}cargarSesionYPermisos(){this._auth.pedirPerfil().subscribe({next:t=>{let e=(t?.tipo??"").toString().toLowerCase();this.esSuperlcchs=e==="superlcchs",this.esAdministrativo=e==="planteladministrativos";let i=Number(t?.usuario?.instituciones_id??0);this.institucionesIdSesion=Number.isFinite(i)&&i>0?i:null,this.applyCategoriaRules(),this.esSuperlcchs&&this._inst.Obtenerinstituciones().subscribe({next:n=>{this.institucionesInfo=n?.data||[],this.institucionesById=new Map((this.institucionesInfo||[]).map(l=>[String(l?.id??""),l]))},error:()=>{this.institucionesInfo=[],this.institucionesById=new Map}}),this.Cargarcontroles()},error:()=>{this.esSuperlcchs=!1,this.esAdministrativo=!1,this.institucionesIdSesion=null,this.applyCategoriaRules(),this.Cargarcontroles()}})}upperTrim(t){return(t??"").toString().trim().toUpperCase()}isCategoriaGlobal(t){return this.categoriasGlobales.includes(t)}puedeEditarFila(t){if(this.esSuperlcchs)return!0;let e=Number(this.institucionesIdSesion??0),i=Number(t?.instituciones_id??0);return e>0&&i===e}getNombreInstitucion(t){let e=(t?.NombreInstitucion??t?.nombre_institucion??t?.institucion_nombre??"").toString().trim();if(e)return e;let i=String(t?.instituciones_id??""),n=this.institucionesById.get(i);return(n?.Nombre??n?.nombre??"").toString().trim()}get categoriaActual(){return this.upperTrim(this.newcontroles?.get("Categoria")?.value)}get categoriaFiltroActual(){return this.upperTrim(this.categoriaFiltro)}get categoriasParaMostrar(){let t=this.categoriaFiltroActual;return t?this.categoriasOptions.filter(e=>this.upperTrim(e)===t):this.categoriasOptions}get showEdades(){return this.categoriaActual==="LVLCURSO"||this.categoriaActual==="TURNO"}categoriaUsaNivelCurso(t){let e=this.upperTrim(t);return e==="TIPOS DOCENTES"||e==="MODOS MATERIAS"||e==="RELACI\xD3N DOCENTE ESTUDIANTES"}get showNivelCurso(){let t=this.categoriaActual,e=(this.newcontroles?.get("NivelCurso")?.value??"").toString().trim();return this.categoriaUsaNivelCurso(t)||e.length>0}get labelNivelCurso(){switch(this.categoriaActual){case"TIPOS DOCENTES":case"MODOS MATERIAS":case"RELACI\xD3N DOCENTE ESTUDIANTES":return"Detalle";default:return"NivelCurso"}}get labelEdades(){return this.categoriaActual==="TURNO"?"Horas":"Edades"}get labelParaI(){switch(this.categoriaActual){case"LVLCURSO":return"Nivel/Curso";case"TURNO":return"Turno";case"EXPEDIDO":return"Sigla";default:return"Valor"}}applyCategoriaRules(){let t=this.categoriaActual;t&&this.newcontroles.get("Categoria")?.value!==t&&this.newcontroles.get("Categoria")?.setValue(t,{emitEvent:!1});let e=this.upperTrim(this.newcontroles.get("Estado")?.value);this.estadoOptions.includes(e)||this.newcontroles.get("Estado")?.setValue("ACTIVO",{emitEvent:!1});let i=this.upperTrim(this.newcontroles.get("Visibilidad")?.value);this.visibilidadOptions.includes(i)||this.newcontroles.get("Visibilidad")?.setValue("VISIBLE",{emitEvent:!1});let n=this.newcontroles.get("instituciones_id");n&&(this.esSuperlcchs?t&&this.isCategoriaGlobal(t)?(n.setValue("",{emitEvent:!1}),n.disable({emitEvent:!1})):n.enable({emitEvent:!1}):(this.institucionesIdSesion&&n.setValue(this.institucionesIdSesion,{emitEvent:!1}),n.disable({emitEvent:!1}))),this.showEdades||this.newcontroles.get("Edades")?.setValue("",{emitEvent:!1}),this.showNivelCurso||this.newcontroles.get("NivelCurso")?.setValue("",{emitEvent:!1})}buildPayloadFromForm(){let t=this.newcontroles.getRawValue(),e=oe({},t);return delete e.created_at,delete e.updated_at,this.showEdades||(e.Edades=""),this.showNivelCurso||(e.NivelCurso=""),e}setViewMode(t){this.viewMode=t,this.paginacontroles=1}onCategoriaFiltroChange(){this.paginacontroles=1}get controlesFiltrados(){let t=this.categoriaFiltroActual,e=this.upperTrim(this.filtertxtcontroles);return(this.controles||[]).filter(i=>{if(t&&this.upperTrim(i?.Categoria)!==t)return!1;if(!e)return!0;let n=[i?.instituciones_id,i?.Categoria,i?.ParaI,i?.Edades,i?.Estado,i?.Visibilidad].map(l=>(l??"").toString()).join(" ");return this.upperTrim(n).includes(e)})}getControlesPorCategoria(t){let e=this.upperTrim(t);return this.controlesFiltrados.filter(i=>this.upperTrim(i?.Categoria)===e)}labelEdadesCategoria(t){return this.upperTrim(t)==="TURNO"?"Horas":"Edades"}showEdadesCategoria(t){let e=this.upperTrim(t);return e==="LVLCURSO"||e==="TURNO"}abrirNuevoPorCategoria(t){this.resetcontroles();let e=this.upperTrim(t);e&&(this.newcontroles.get("Categoria")?.setValue(e),this.applyCategoriaRules()),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl")}isTogglingEstado(t){return this.togglingEstadoIds.has(Number(t))}isTogglingVisibilidad(t){return this.togglingVisibilidadIds.has(Number(t))}toggleEstadoFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingEstadoIds.has(i))return;let n=this.upperTrim(t?.Estado),l=n==="ACTIVO"?"INACTIVO":"ACTIVO";this.togglingEstadoIds.add(i),t.Estado=l,this._cont.Modificarcontroles({id:i,Estado:l},i).subscribe({next:m=>{t.Estado=this.upperTrim(m?.data?.Estado??l)},error:m=>{console.error("Error toggling Estado",m),t.Estado=n},complete:()=>{this.togglingEstadoIds.delete(i)}})}toggleVisibilidadFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingVisibilidadIds.has(i))return;let n=this.upperTrim(t?.Visibilidad),l=n==="VISIBLE"?"OCULTO":"VISIBLE";this.togglingVisibilidadIds.add(i),t.Visibilidad=l,this._cont.Modificarcontroles({id:i,Visibilidad:l},i).subscribe({next:m=>{t.Visibilidad=this.upperTrim(m?.data?.Visibilidad??l)},error:m=>{console.error("Error toggling Visibilidad",m),t.Visibilidad=n},complete:()=>{this.togglingVisibilidadIds.delete(i)}})}setupCategoriaWatcher(){this.categoriaSub&&(this.categoriaSub.unsubscribe(),this.categoriaSub=void 0),this.categoriaSub=this.newcontroles.get("Categoria")?.valueChanges.subscribe(()=>{this.applyCategoriaRules()}),this.applyCategoriaRules()}closeMenu(){this._tools.close()}abrirMenucontroles(t,e){t.preventDefault(),t.stopPropagation();let i=[{label:"\u270F Editar",action:()=>this.Seleccionarcontroles(e.id)},{label:"\u{1F5D1}\uFE0F Eliminar",action:()=>this.Eliminarcontroles(e.id)}];this._tools.open(t.clientX,t.clientY,i)}Cargarcontroles(){this.isLoadingcontroles=!0,this._cont.Obtenercontroles().subscribe({next:t=>{let e=t.data||[];if(!this.esSuperlcchs&&this.institucionesIdSesion){let i=Number(this.institucionesIdSesion);this.controles=e.filter(n=>Number(n?.instituciones_id??0)===i)}else this.esSuperlcchs?this.controles=e:this.controles=[];this.collectionSizecontroles=this.controles.length,this.isLoadingcontroles=!1},error:t=>{console.error("Error al cargar controles",t),this.controles=[],this.collectionSizecontroles=0,this.isLoadingcontroles=!1}})}AgregarModificarcontroles(){if(this.newcontroles.invalid){this.ValidacionTodoElementocontroles(),this._tools.MostrarMensajeFrmIncompleto(),this.AnimacionCargabtnModalcontroles=!1;return}this.AnimarCargaTablacontroles(),this.AnimacionCargabtnModalcontroles=!0,this._tools.MostrarMensajeLoading(),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue());let t=this.newcontroles.controls.id.value,e=this.buildPayloadFromForm();t?this._cont.Modificarcontroles(e,e.id).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL MODIFICAR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()}):this._cont.Agregarcontroles(e).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL A\xD1ADIR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()})}Seleccionarcontroles(t){if(this._tools.MostrarMensajeLoading(),!t)return;let e=this.controles.find(i=>i.id===t);if(e){if(!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._cont.Seleccionarcontroles(t).subscribe(i=>{Object.keys(this.newcontroles.controls).forEach(n=>{this.newcontroles.controls[n].setValue(i.data[n])}),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue()),this.applyCategoriaRules(),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl"),this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL SELECCIONAR controles",i),this._tools.MostrarMensajeError()})}}Eliminarcontroles(t){let e=this.controles.find(i=>i.id===t);if(e&&!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._tools.mostrarMensajeConfirm("\xBFSEGURO QUE DESEA ELIMINAR?","SE ELIMINARA EL DATO Y NO SE PODR\xC1 RECUPERAR EL DATO","warning","SI, ESTOY SEGURO","NO").then(i=>{i&&(this._tools.MostrarMensajeLoading(),this._cont.Eliminarcontroles(t).subscribe(n=>{this.Cargarcontroles(),this._tools.MostrarMensajeSuccess()},n=>{console.log("ERROR AL ELIMINAR controles",n),this._tools.MostrarMensajeError()}))})}resetcontroles(){this.newcontroles=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this._tools.closeModal(this.modalGestioncontrolesRef)}AutoCompletarLastcontroles(){this.newcontroles.patchValue(this.newcontrolesAnteriorAccion.getRawValue()),this.newcontroles.patchValue({id:0})}AnimarCargaTablacontroles(){this.controles=[],this.isLoadingcontroles=!0}ValidacioncontrolesxElemento(t){return this._tools.obtenerValidationClass(this.newcontroles,t)}ValidacionTodoElementocontroles(){Object.values(this.newcontroles.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()})}onPageSizeChangecontroles(){this.paginacontroles=1}sortBycontroles(t,e){this.sortColumnscontroles=this._tools.handleSort(t,e,this.sortColumnscontroles),this.controles=this._tools.applyMultiSort(this.controles,this.sortColumnscontroles)}isSortedcontroles(t){return this._tools.isSorted(this.sortColumnscontroles,t)}getSortDircontroles(t){return this._tools.getSortDirection(this.sortColumnscontroles,t)}};Z.\u0275fac=function(e){return new(e||Z)(M(tt),M(xe),M(he),M(Ze))},Z.\u0275cmp=L({type:Z,selectors:[["app-controles"]],viewQuery:function(e,i){if(e&1&&ce(Lt,7),e&2){let n;de(n=ue())&&(i.modalgestioncontroles=n.first)}},hostBindings:function(e,i){e&1&&g("click",function(){return i.closeMenu()},se)},standalone:!1,decls:41,vars:11,consts:[["modalgestioncontroles",""],["emptyCat",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"button","col-sm-3","d-flex","justify-content-start"],[1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"],["width","30px","height","30px",3,"options"],[1,"dir-part"],[1,"col-sm-3","ms-auto","d-flex","justify-content-end"],[1,"input-group"],[1,"input-group-text"],[1,"form-floating"],["type","text","placeholder","Buscar","title","Filtrar/Buscar",1,"form-control",3,"input","ngModelChange","ngModel"],[1,"row","mt-3","align-items-end",2,"row-gap","10px"],[1,"col-sm-4"],["role","group","aria-label","Modo",1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"col-sm-5"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[3,"value"],[1,"mt-4"],["class","alert alert-secondary","style","margin-bottom: 0;",4,"ngIf"],["class","row","style","row-gap: 14px;",4,"ngIf"],[1,"alert","alert-secondary",2,"margin-bottom","0"],[1,"row",2,"row-gap","14px"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],["class","card",4,"ngIf"],[1,"card"],[1,"card-header","d-flex","align-items-center","justify-content-between","col-sm-12",2,"gap","10px"],[1,"col-sm-8"],[1,"fw-bold","text-center","text-danger"],[1,"small","text-secondary","col-sm-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"card-body",2,"padding","0"],["class","list-group list-group-flush",4,"ngIf","ngIfElse"],[1,"list-group","list-group-flush"],["class","list-group-item d-flex align-items-center justify-content-between flex-row","style","gap: 12px;",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","align-items-center","justify-content-between","flex-row",2,"gap","12px"],[1,"d-flex","align-items-center","flex-wrap","justify-content-between",2,"gap","12px","min-width","0","width","100%"],[1,"fw-semibold","text-truncate",2,"max-width","180px"],["class","small text-secondary",4,"ngIf"],[1,"d-flex","align-items-center","ms-auto",2,"gap","8px"],[1,"small","text-secondary"],["type","button","title","Cambiar Estado",1,"btn","btn-sm",3,"click","ngClass","disabled"],["type","button","title","Cambiar Visibilidad",1,"btn","btn-sm",3,"click","ngClass","disabled"],[1,"d-flex",2,"gap","8px","flex-shrink","0"],["title","Editar",1,"btn","btn-outline-warning","btn-sm",3,"click"],["title","Eliminar",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"p-3","text-center","text-secondary"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,""],[1,"text-center"],[2,"user-select","none",3,"click"],["style","user-select:none;",4,"ngIf"],[4,"ngIf"],["style","cursor: pointer;",3,"contextmenu",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-3"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[2,"user-select","none"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[2,"cursor","pointer",3,"contextmenu"],[1,"text-center","d-flex","justify-content-center","align-items-center",2,"gap","5px"],["title","Modificar informaci\xF3n",1,"btn","btn-outline-warning","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src",4,"ngIf"],["width","30px","height","35px",3,"options",4,"ngIf"],["title","Eliminar informaci\xF3n",1,"btn","btn-outline-danger","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src"],["width","30px","height","35px",3,"options"],[1,"modal-header"],[1,"modal-title"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],["class","form-floating mb-3 col-sm-12",4,"ngIf"],[1,"form-floating","mb-3","col-sm-12"],["formControlName","Categoria",1,"form-select"],["type","text","placeholder","","formControlName","ParaI",1,"form-control",2,"text-transform","uppercase"],["formControlName","Estado",1,"form-select"],["formControlName","Visibilidad",1,"form-select"],[1,"modal-footer"],["class","button d-flex justify-content-start",4,"ngIf"],[1,"button","me-2"],["title","Cancelar y cerrar","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],[1,"button"],["class","btn mouse-dir success","title","Procesando informaci\xF3n",3,"disabled","click",4,"ngIf"],["class","btn mouse-dir primary d-flex align-items-center","style"," gap: 8px;","title","Accionar",3,"click",4,"ngIf"],["formControlName","instituciones_id",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","placeholder","","formControlName","NivelCurso",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","","formControlName","Edades",1,"form-control",2,"text-transform","uppercase"],[1,"button","d-flex","justify-content-start"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],["title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],["title","Procesando informaci\xF3n",1,"btn","mouse-dir","success",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["title","Accionar",1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"]],template:function(e,i){if(e&1){let n=h();o(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),c(4,"Gesti\xF3n de controles"),a(),o(5,"p",6),c(6,"Administra los controles (selects/autocompletados) del sistema"),a()()()(),o(7,"div",3)(8,"div",7)(9,"button",8),g("click",function(){p(n);let m=ie(40);return _(i.modalGestioncontrolesRef=i._tools.openModal(m,"xl"))}),x(10,"ng-lottie",9),o(11,"span"),c(12,"A\xF1adir control"),a(),x(13,"span",10),a()(),o(14,"div",11)(15,"div",12)(16,"span",13),x(17,"ng-lottie",9),a(),o(18,"div",14)(19,"input",15),g("input",function(){return p(n),_(i.paginacontroles=1)}),E("ngModelChange",function(m){return p(n),S(i.filtertxtcontroles,m)||(i.filtertxtcontroles=m),_(m)}),a(),o(20,"label"),c(21,"Buscar"),a()()()()(),o(22,"div",16)(23,"div",17)(24,"div",18)(25,"button",19),g("click",function(){return p(n),_(i.setViewMode("interactive"))}),c(26,"Modo interactivo"),a(),o(27,"button",19),g("click",function(){return p(n),_(i.setViewMode("table"))}),c(28,"Modo tabla"),a()()(),o(29,"div",20)(30,"div",14)(31,"select",21),E("ngModelChange",function(m){return p(n),S(i.categoriaFiltro,m)||(i.categoriaFiltro=m),_(m)}),g("change",function(){return p(n),_(i.onCategoriaFiltroChange())}),o(32,"option",22),c(33,"TODAS"),a(),b(34,Ft,2,2,"option",23),a(),o(35,"label"),c(36,"Filtrar por categor\xEDa"),a()()()(),b(37,Qt,3,2,"div",24)(38,ai,31,17,"div",24)(39,vi,37,13,"ng-template",null,0,W)}e&2&&(s(10),d("options",i._tools.optionsAdicionar),s(7),d("options",i._tools.optionslupa),s(2),y("ngModel",i.filtertxtcontroles),s(6),P("active",i.viewMode==="interactive"),s(2),P("active",i.viewMode==="table"),s(4),y("ngModel",i.categoriaFiltro),s(3),d("ngForOf",i.categoriasOptions),s(3),d("ngIf",i.viewMode==="interactive"),s(),d("ngIf",i.viewMode==="table"))},dependencies:[pe,F,D,be,j,K,G,$,B,fe,U,Qe,Xe,et,Je,Ke],encapsulation:2});var Ee=Z;var xi=["modalListasPreliminaresCursos"],O=()=>({standalone:!0});function Ci(r,t){if(r&1&&(o(0,"option",50),c(1),a()),r&2){let e=t.$implicit;d("value",e.id),s(),v(e.Anio)}}function yi(r,t){if(r&1){let e=h();o(0,"div",51)(1,"div",19)(2,"label",23),c(3,"\xC1rea:"),a(),o(4,"input",52),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.AreaManual,n)||(l.AreaManual=n),_(n)}),a()(),o(5,"div",19)(6,"label",23),c(7,"Carrera:"),a(),o(8,"input",52),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.CarreraManual,n)||(l.CarreraManual=n),_(n)}),a()(),o(9,"div",19)(10,"label",23),c(11,"Resoluci\xF3n:"),a(),o(12,"input",52),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.ResolucionManual,n)||(l.ResolucionManual=n),_(n)}),a()(),o(13,"div",19)(14,"label",23),c(15,"Texto Nivel:"),a(),o(16,"input",52),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.NivelManual,n)||(l.NivelManual=n),_(n)}),a()(),o(17,"div",19)(18,"label",23),c(19,"Bicentenario:"),a(),o(20,"input",52),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.BicentenarioManual,n)||(l.BicentenarioManual=n),_(n)}),a()(),o(21,"div",53)(22,"div",34)(23,"input",54),E("ngModelChange",function(n){p(e);let l=u(2);return S(l.ContadorManual,n)||(l.ContadorManual=n),_(n)}),a(),o(24,"label",55),c(25," \xBFCon contador de P\xE1gina? "),a()()()()}if(r&2){let e=u(2);s(4),d("ngModelOptions",A(12,O)),y("ngModel",e.AreaManual),s(4),d("ngModelOptions",A(13,O)),y("ngModel",e.CarreraManual),s(4),d("ngModelOptions",A(14,O)),y("ngModel",e.ResolucionManual),s(4),d("ngModelOptions",A(15,O)),y("ngModel",e.NivelManual),s(4),d("ngModelOptions",A(16,O)),y("ngModel",e.BicentenarioManual),s(3),d("ngModelOptions",A(17,O)),y("ngModel",e.ContadorManual)}}function Si(r,t){r&1&&(o(0,"span"),c(1,"Generar"),a())}function Ei(r,t){r&1&&(o(0,"span"),c(1,"Generando..."),a())}function Ii(r,t){if(r&1){let e=h();o(0,"div",12)(1,"div",13)(2,"span",14),x(3,"i",15),a(),o(4,"h2",16),c(5,"CUADRO DE INSCRIPCIONES DE ALUMNOS - GENERAL"),a()(),o(6,"div",17)(7,"p",9),c(8,"Ac\xE1 obtendremos la lista del Cuadro de Inscripciones de Alumnos Nuevos y Antiguos de la Instituci\xF3n."),a(),o(9,"form",18)(10,"div",19)(11,"label",20),c(12,"Por Favor introducir Numero de Paginaci\xF3n Inicial:"),a(),o(13,"input",21),E("ngModelChange",function(n){p(e);let l=u();return S(l.numeroPaginaCuadro,n)||(l.numeroPaginaCuadro=n),_(n)}),a()(),o(14,"div",22)(15,"label",23),c(16,"Seleccione Gesti\xF3n"),a(),o(17,"select",24),E("ngModelChange",function(n){p(e);let l=u();return S(l.gestion_id_seleccionado,n)||(l.gestion_id_seleccionado=n),_(n)}),o(18,"optgroup",25),b(19,Ci,2,2,"option",26),a()()(),o(20,"div",27)(21,"label",23),c(22,"Seleccione Nivel"),a(),o(23,"select",28),E("ngModelChange",function(n){p(e);let l=u();return S(l.NivelCuadro,n)||(l.NivelCuadro=n),_(n)}),o(24,"optgroup",29)(25,"option",30),c(26,"MIXTO (TODOS)"),a(),o(27,"option",31),c(28,"TECNICO SUPERIOR"),a(),o(29,"option",32),c(30,"CAPACITACI\xD3N"),a()()()(),o(31,"div",33)(32,"div",34)(33,"input",35),E("ngModelChange",function(n){p(e);let l=u();return S(l.showContenidoManual,n)||(l.showContenidoManual=n),_(n)}),a(),o(34,"label",36),c(35," Mostrar/Ocultar Contenido Manual "),a()()(),o(36,"div",37)(37,"div",34)(38,"input",38),E("ngModelChange",function(n){p(e);let l=u();return S(l.incluirSinAsignar,n)||(l.incluirSinAsignar=n),_(n)}),a(),o(39,"label",39),c(40," INCLUIR LOS SIN ASIGNACIONES "),a()()()(),b(41,yi,26,18,"div",40),o(42,"div",41)(43,"div",42)(44,"button",43),g("click",function(){p(e);let n=u();return _(n.abrirModalListasPreliminaresCursos())}),x(45,"i",44),o(46,"span"),c(47,"LISTAS POR CURSO"),a()(),o(48,"button",45),g("click",function(){p(e);let n=u();return _(n.GenerarCuadroInscripciones2026())}),Ge(),o(49,"svg",46),x(50,"path",47)(51,"path",48),a(),b(52,Si,2,0,"span",49)(53,Ei,2,0,"span",49),a()()()()()}if(r&2){let e=u();s(13),d("ngModelOptions",A(16,O)),y("ngModel",e.numeroPaginaCuadro),s(4),d("ngModelOptions",A(17,O)),y("ngModel",e.gestion_id_seleccionado),s(2),d("ngForOf",e.anio),s(4),d("ngModelOptions",A(18,O)),y("ngModel",e.NivelCuadro),s(10),d("ngModelOptions",A(19,O)),y("ngModel",e.showContenidoManual),s(5),d("ngModelOptions",A(20,O)),y("ngModel",e.incluirSinAsignar),s(3),d("ngIf",e.showContenidoManual),s(3),d("disabled",e.isLoadingCursosParaListas||e.isGenerandoListasPreliminares),s(4),d("disabled",e.isGenerandoCuadro),s(4),d("ngIf",!e.isGenerandoCuadro),s(),d("ngIf",e.isGenerandoCuadro)}}function Ti(r,t){r&1&&(o(0,"div",67),c(1,"Incluye SIN ASIGNAR"),a())}function Mi(r,t){r&1&&(o(0,"div",68),c(1,"Solo asignados"),a())}function wi(r,t){r&1&&(o(0,"div",69)(1,"div",70),c(2,"Cargando cursos..."),a()())}function Pi(r,t){r&1&&(o(0,"div",71),c(1," No se encontraron cursos para el filtro actual. "),a())}function Ai(r,t){if(r&1){let e=h();o(0,"tr")(1,"td")(2,"input",79),E("ngModelChange",function(n){let l=p(e).$implicit;return S(l.selected,n)||(l.selected=n),_(n)}),a()(),o(3,"td",80),c(4),a(),o(5,"td"),c(6),a(),o(7,"td",77),c(8),a()()}if(r&2){let e=t.$implicit;s(2),y("ngModel",e.selected),d("ngModelOptions",A(5,O)),s(2),v(e.curso),s(2),v(e.paraleloLabel),s(2),v(e.total)}}function Ni(r,t){if(r&1){let e=h();o(0,"div",72)(1,"table",73)(2,"thead",74)(3,"tr")(4,"th",75)(5,"input",76),g("change",function(n){p(e);let l=u(2);return _(l.toggleSeleccionarTodosCursosParaListas(n.target.checked))}),a()(),o(6,"th"),c(7,"Curso"),a(),o(8,"th"),c(9,"Paralelo"),a(),o(10,"th",77),c(11,"Total"),a()()(),o(12,"tbody"),b(13,Ai,9,6,"tr",78),a()()()}if(r&2){let e=u(2);s(13),d("ngForOf",e.cursosParaListas)}}function Oi(r,t){r&1&&(o(0,"span"),c(1,"Generar PDF"),a())}function Vi(r,t){r&1&&(o(0,"span"),c(1,"Generando..."),a())}function ki(r,t){if(r&1){let e=h();o(0,"div",5)(1,"h5",6),c(2,"LISTAS PRELIMINARES POR CURSO"),a(),o(3,"button",56),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",8)(5,"div",57)(6,"div",58),c(7),a(),b(8,Ti,2,0,"div",59)(9,Mi,2,0,"div",60),a(),b(10,wi,3,0,"div",61)(11,Pi,2,0,"div",62)(12,Ni,14,1,"div",63),a(),o(13,"div",10)(14,"div",64),c(15),a(),o(16,"button",65),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),c(17,"Cancelar"),a(),o(18,"button",66),g("click",function(){p(e);let n=u();return _(n.generarListasPreliminaresSeleccionadas())}),b(19,Oi,2,0,"span",49)(20,Vi,2,0,"span",49),a()()}if(r&2){let e=u();s(7),C("Gesti\xF3n: ",e.getGestionLabel()),s(),d("ngIf",e.incluirSinAsignar),s(),d("ngIf",!e.incluirSinAsignar),s(),d("ngIf",e.isLoadingCursosParaListas),s(),d("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length===0),s(),d("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length>0),s(3),C("Seleccionados: ",e.getCursosParaListasSeleccionadosCount()),s(3),d("disabled",e.isGenerandoListasPreliminares||e.getCursosParaListasSeleccionadosCount()===0),s(),d("ngIf",!e.isGenerandoListasPreliminares),s(),d("ngIf",e.isGenerandoListasPreliminares)}}var J=class J{constructor(t,e,i,n){this._repo=t;this._anios=e;this._infoest=i;this._tools=n;this.numeroPaginaCuadro=1;this.anio=[];this.gestion_id_seleccionado="";this.NivelCuadro="MIXTO";this.incluirSinAsignar=!0;this.isGenerandoCuadro=!1;this.showContenidoManual=!1;this.AreaManual="";this.CarreraManual="";this.ResolucionManual="";this.NivelManual="";this.BicentenarioManual="";this.ContadorManual=!1;this.cursosParaListas=[];this.isLoadingCursosParaListas=!1;this.isGenerandoListasPreliminares=!1}ngOnInit(){this.cargarAnios()}cargarAnios(){this._anios.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anio=t?.anios||[];let e=t?.predeterminado??null,i=Number(this.gestion_id_seleccionado);(Number.isFinite(i)&&i>0?(this.anio||[]).some(l=>Number(l?.id)===i):!1)||(e?.id?this.gestion_id_seleccionado=e.id:this.anio?.length?this.gestion_id_seleccionado=this.anio[0]?.id??"":this.gestion_id_seleccionado="")},error:t=>{console.error("Error al cargar anios",t),this.anio=[]}})}getGestionLabel(){let t=Number(this.gestion_id_seleccionado),e=(this.anio||[]).find(n=>Number(n?.id)===t);return(e?.Anio??e?.anio??"").toString().trim()||(Number.isFinite(t)&&t>0?String(t):"")}GenerarCuadroInscripciones2026(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}if(this.isGenerandoCuadro)return;this.isGenerandoCuadro=!0;let t=Number(this.numeroPaginaCuadro||1),e=Number(this.gestion_id_seleccionado),i=this.NivelCuadro||"MIXTO";try{this._repo.GenerarCuadroInscripciones2026(t,e,i,this.incluirSinAsignar)}catch(n){console.error(n),this._tools.MostrarMensaje("error","No se pudo generar el cuadro de inscripciones")}finally{setTimeout(()=>this.isGenerandoCuadro=!1,1200)}}abrirModalListasPreliminaresCursos(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}let t=Number(this.gestion_id_seleccionado);if(!Number.isFinite(t)||t<=0){this._tools.MostrarMensaje("warning","Seleccione un a\xF1o v\xE1lido");return}this.cursosParaListas=[],this.isLoadingCursosParaListas=!0,this.modalListasPreliminaresCursosRef=this._tools.openModal(this.modalListasPreliminaresCursos,"lg"),this._infoest.ObtenerEstadisticasInscripciones({anio_id:t,include_sin_asignar:this.incluirSinAsignar?1:0}).subscribe({next:e=>{let i=Array.isArray(e?.por_curso_paralelo)?e.por_curso_paralelo:[];this.cursosParaListas=i.map(n=>{let l=(n?.curso??"").toString().trim(),m=(n?.paralelo??"").toString().trim(),f=(n?.paralelo_label??(m||"SIN DETERMINAR")).toString().trim(),I=Number(n?.total??0);return{curso:l,paralelo:m,paraleloLabel:f||"SIN DETERMINAR",total:Number.isFinite(I)?I:0,selected:!1}}).filter(n=>n.curso!=="").sort((n,l)=>{let m=n.curso.localeCompare(l.curso);return m!==0?m:(n.paraleloLabel||"").localeCompare(l.paraleloLabel||"")}),this.isLoadingCursosParaListas=!1},error:e=>{console.error(e),this.cursosParaListas=[],this.isLoadingCursosParaListas=!1,this._tools.MostrarMensaje("error","No se pudieron cargar los cursos")}})}toggleSeleccionarTodosCursosParaListas(t){(this.cursosParaListas||[]).forEach(e=>e.selected=t)}getCursosParaListasSeleccionadosCount(){return(this.cursosParaListas||[]).filter(t=>!!t.selected).length}generarListasPreliminaresSeleccionadas(){return ae(this,null,function*(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}let t=Number(this.gestion_id_seleccionado);if(!Number.isFinite(t)||t<=0){this._tools.MostrarMensaje("warning","Seleccione un a\xF1o v\xE1lido");return}let e=(this.cursosParaListas||[]).filter(i=>!!i.selected).map(i=>({curso:i.curso,paralelo:i.paralelo}));if(e.length===0){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}if(!this.isGenerandoListasPreliminares){this.isGenerandoListasPreliminares=!0;try{yield this._repo.GenerarListaPreliminarAlumnos2026(t,e,null,this.incluirSinAsignar);try{this.modalListasPreliminaresCursosRef?.close?.()}catch{}}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudieron generar las listas")}finally{this.isGenerandoListasPreliminares=!1}}})}};J.\u0275fac=function(e){return new(e||J)(M(nt),M(Ce),M(ye),M(xe))},J.\u0275cmp=L({type:J,selectors:[["app-documentosimportantes"]],viewQuery:function(e,i){if(e&1&&ce(xi,7),e&2){let n;de(n=ue())&&(i.modalListasPreliminaresCursos=n.first)}},standalone:!1,decls:15,vars:1,consts:[["modalListasPreliminaresCursos",""],["class","card shadow mb-4",4,"ngIf"],["id","modalGeneracionCuadroEstudiantes","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body"],[1,"mb-4"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"card","shadow","mb-4"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center"],[1,"me-2"],[1,"bi","bi-file-earmark-text"],[1,"mb-0","fw-bold","fs-4"],[1,"card-body"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-4"],[1,"form-label","fw-bold","fst-italic","text-warning"],["type","number","placeholder","NUMERO PAGINA",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-2"],[1,"form-label"],["name","Curso_id","id","Curso_idModal",1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Gestion"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3"],[1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Nivel"],["value","MIXTO"],["value","TECNICO SUPERIOR"],["value","CAPACITACI\xD3N"],[1,"col-md-3","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","id","toggleContent",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","toggleContent",1,"form-check-label"],[1,"col-md-12"],["type","checkbox","id","chkSinAsignarCuadro",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","chkSinAsignarCuadro",1,"form-check-label","text-danger","fw-bold"],["class","row g-3",4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-outline-primary","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],[1,"bi","bi-list-check"],["type","button",1,"btn","btn-success","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","28","height","28","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-download"],["d","M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"],["d","M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"],[4,"ngIf"],[3,"value"],[1,"row","g-3"],["type","text",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-4","d-flex","align-items-center"],["type","checkbox","id","contadormanual",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","contadormanual",1,"form-check-label"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"d-flex","flex-wrap","gap-2","align-items-center"],[1,"badge","bg-secondary"],["class","badge bg-danger",4,"ngIf"],["class","badge bg-light text-dark",4,"ngIf"],["class","mt-3",4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],["class","table-responsive mt-3","style","max-height: 55vh;",4,"ngIf"],[1,"me-auto","text-muted"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"badge","bg-danger"],[1,"badge","bg-light","text-dark"],[1,"mt-3"],[1,"text-center","py-4"],[1,"alert","alert-warning","mt-3"],[1,"table-responsive","mt-3",2,"max-height","55vh"],[1,"table","table-sm","table-hover","align-middle"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"width","46px"],["type","checkbox",1,"form-check-input",3,"change"],[1,"text-end"],[4,"ngFor","ngForOf"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel","ngModelOptions"],[1,"fw-semibold"]],template:function(e,i){e&1&&(b(0,Ii,54,21,"div",1)(1,ki,21,10,"ng-template",null,0,W),o(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),c(8,"FORMULARIO - CUADRO ESTUDIANTES"),a(),x(9,"button",7),a(),o(10,"div",8),x(11,"div",9),a(),o(12,"div",10)(13,"button",11),c(14,"Cancelar"),a()()()()()),e&2&&d("ngIf",!0)},dependencies:[F,D,be,j,K,G,ve,ge,$,B,fe,U,He],encapsulation:2});var Ie=J;var z=class z{constructor(t){this.http=t;this.ruta=_e.ruta}ObtenerAsignacionesPorMaterias(t){let e=new Ne;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let l=String(n).trim();l&&(e=e.set(i,l))}),this.http.get(this.ruta+"api/estadisticas/asignaciones/materias",{params:e})}ObtenerEstudiantesAsignados(t){let e=new Ne;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let l=String(n).trim();l&&(e=e.set(i,l))}),this.http.get(this.ruta+"api/estadisticas/asignaciones/materias/estudiantes",{params:e})}};z.\u0275fac=function(e){return new(e||z)(De(ze))},z.\u0275prov=Fe({token:z,factory:z.\u0275fac,providedIn:"root"});var Te=z;function Li(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e.id),s(),v(e.Anio)}}function Fi(r,t){if(r&1&&(o(0,"option",25),c(1),a()),r&2){let e=t.$implicit;d("value",e),s(),v(e)}}function Di(r,t){r&1&&x(0,"span",32)}function Gi(r,t){if(r&1){let e=h();o(0,"div",26)(1,"div",27)(2,"button",28),g("click",function(){p(e);let n=u();return _(n.cargarEstadisticas())}),b(3,Di,1,0,"span",29),c(4," Recargar estad\xEDsticas "),a()(),o(5,"div",30)(6,"div",31),c(7,"Registros: "),o(8,"strong"),c(9),a()()()()}if(r&2){let e=u();s(2),d("disabled",e.isLoading),s(),d("ngIf",e.isLoading),s(6),v(e.totalFiltrado)}}function Bi(r,t){r&1&&(o(0,"th"),c(1,"Materia"),a())}function Ui(r,t){r&1&&(o(0,"th"),c(1,"Materias (diferenciado)"),a())}function $i(r,t){if(r&1&&(o(0,"tr")(1,"td",33)(2,"div",34)(3,"span",35),c(4,"Cargando..."),a()()()()),r&2){let e=u();s(),k("colspan",e.modo==="NORMAL"?18:e.modo==="SIMPLE_DIFERENCIADO"?17:16)}}function ji(r,t){if(r&1&&(o(0,"tr")(1,"td",36),c(2," No hay estad\xEDsticas para la gesti\xF3n seleccionada. "),a()()),r&2){let e=u();s(),k("colspan",e.modo==="NORMAL"?18:e.modo==="SIMPLE_DIFERENCIADO"?17:16)}}function Ki(r,t){if(r&1&&(o(0,"td"),c(1),a()),r&2){let e=u().$implicit;s(),v(e.NombreMateria)}}function Wi(r,t){if(r&1&&(o(0,"td"),c(1),a()),r&2){let e=u().$implicit;s(),v(e.Materias)}}function zi(r,t){if(r&1){let e=h();o(0,"tr")(1,"td",19),c(2),a(),o(3,"td",37),c(4),o(5,"div",38),c(6),a()(),o(7,"td"),c(8),a(),o(9,"td",19),c(10),o(11,"div",38),c(12),a()(),b(13,Ki,2,1,"td",20)(14,Wi,2,1,"td",20),o(15,"td",21)(16,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"NUEVO","MASCULINO","Nuevos M"))}),c(17),a()(),o(18,"td",21)(19,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"NUEVO","FEMENINO","Nuevos F"))}),c(20),a()(),o(21,"td",21)(22,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"NUEVO","","Total nuevos"))}),c(23),a()(),o(24,"td",21)(25,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"ANTIGUO","MASCULINO","Antiguos M"))}),c(26),a()(),o(27,"td",21)(28,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"ANTIGUO","FEMENINO","Antiguos F"))}),c(29),a()(),o(30,"td",21)(31,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"ANTIGUO","","Total antiguos"))}),c(32),a()(),o(33,"td",21)(34,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"","MASCULINO","Total M"))}),c(35),a()(),o(36,"td",21)(37,"button",39),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"","FEMENINO","Total F"))}),c(38),a()(),o(39,"td",40)(40,"button",41),g("click",function(){let n=p(e).$implicit,l=u();return _(l.abrirModalCantidad(n,"","","Total general"))}),c(41),a()()()}if(r&2){let e=t.$implicit,i=t.index,n=u();s(2),v(i+1),s(2),C("",e.Anio," "),s(2),v(e.Resolucion),s(2),v(e.LvlCurso),s(2),C("",e.Paralelo," "),s(2),v(e.Turno),s(),d("ngIf",n.modo==="NORMAL"),s(),d("ngIf",n.modo==="SIMPLE_DIFERENCIADO"),s(2),d("title","Ver estudiantes ("+e.Nuevos_M+")"),s(),v(e.Nuevos_M),s(2),d("title","Ver estudiantes ("+e.Nuevos_F+")"),s(),v(e.Nuevos_F),s(2),d("title","Ver estudiantes ("+e.Total_Nuevos+")"),s(),v(e.Total_Nuevos),s(2),d("title","Ver estudiantes ("+e.Antiguos_M+")"),s(),v(e.Antiguos_M),s(2),d("title","Ver estudiantes ("+e.Antiguos_F+")"),s(),v(e.Antiguos_F),s(2),d("title","Ver estudiantes ("+e.Total_Antiguos+")"),s(),v(e.Total_Antiguos),s(2),d("title","Ver estudiantes ("+e.Total_M+")"),s(),v(e.Total_M),s(2),d("title","Ver estudiantes ("+e.Total_F+")"),s(),v(e.Total_F),s(2),d("title","Ver estudiantes ("+e.Total_Gral+")"),s(),v(e.Total_Gral)}}function Hi(r,t){r&1&&(o(0,"div",33)(1,"div",34)(2,"span",35),c(3,"Cargando..."),a()()())}function Qi(r,t){r&1&&(o(0,"div",54),c(1," No hay estudiantes para este criterio. "),a())}function Xi(r,t){if(r&1&&(o(0,"tr")(1,"td",19),c(2),a(),o(3,"td"),c(4),a(),o(5,"td",37),c(6),a(),o(7,"td",19),c(8),a(),o(9,"td",19),c(10),a()()),r&2){let e=t.$implicit,i=t.index;s(2),v(i+1),s(2),v(e.Nombre),s(2),v(e.CI),s(2),v(e.Edad??"-"),s(2),v(e.Sexo)}}function qi(r,t){if(r&1&&(o(0,"div",17)(1,"table",55)(2,"thead")(3,"tr")(4,"th",19),c(5,"#"),a(),o(6,"th"),c(7,"Nombre"),a(),o(8,"th"),c(9,"CI"),a(),o(10,"th",19),c(11,"Edad"),a(),o(12,"th",19),c(13,"Sexo"),a()()(),o(14,"tbody"),b(15,Xi,11,5,"tr",22),a()()()),r&2){let e=u(2);s(15),d("ngForOf",e.modalEstudiantes)}}function Yi(r,t){if(r&1){let e=h();o(0,"div",42),g("click",function(){p(e);let n=u();return _(n.cerrarModal())}),o(1,"div",43),g("click",function(n){return p(e),_(n.stopPropagation())}),o(2,"div",44)(3,"div",45)(4,"h5",46),c(5),a(),o(6,"button",47),g("click",function(){p(e);let n=u();return _(n.cerrarModal())}),a()(),o(7,"div",48),b(8,Hi,4,0,"div",49)(9,Qi,2,0,"div",50)(10,qi,16,1,"div",51),a(),o(11,"div",52)(12,"button",53),g("click",function(){p(e);let n=u();return _(n.cerrarModal())}),c(13,"Cerrar"),a()()()()()}if(r&2){let e=u();s(5),v(e.modalTitulo),s(3),d("ngIf",e.modalLoading),s(),d("ngIf",!e.modalLoading&&(!e.modalEstudiantes||e.modalEstudiantes.length===0)),s(),d("ngIf",!e.modalLoading&&e.modalEstudiantes&&e.modalEstudiantes.length>0)}}function Zi(r,t){r&1&&x(0,"div",56)}var ee=class ee{constructor(t,e){this.aniosService=t;this.estadisticasService=e;this.ruta=_e.ruta;this.anios=[];this.anioIdSeleccionado="";this.modo="NORMAL";this.isLoading=!1;this.filtroNivel="";this.filtroTexto="";this.dataRaw=[];this.dataTabla=[];this.modalAbierto=!1;this.modalTitulo="";this.modalLoading=!1;this.modalEstudiantes=[]}cerrarModal(){this.modalAbierto=!1,this.modalTitulo="",this.modalEstudiantes=[],this.modalLoading=!1}abrirModalCantidad(t,e,i,n){let l=String(this.anioIdSeleccionado??"").trim();l&&(this.modalAbierto=!0,this.modalTitulo=`${n} \u2014 ${t.Resolucion} / ${t.LvlCurso} ${t.Paralelo} (${t.Turno})`,this.modalLoading=!0,this.modalEstudiantes=[],this.estadisticasService.ObtenerEstudiantesAsignados({anio_id:l,modo:this.modo==="SIMPLE_DIFERENCIADO"?"SIMPLE_DIFERENCIADO":this.modo==="SIMPLIFICADO"?"SIMPLIFICADO":"NORMAL",resolucion:String(t.Resolucion??""),lvl_curso:String(t.LvlCurso??""),paralelo:String(t.Paralelo??""),turno:String(t.Turno??""),nombre_materia:this.modo==="NORMAL"?String(t.NombreMateria??""):void 0,rango:this.modo==="NORMAL"&&t.Rango!==void 0?Number(t.Rango):void 0,materias:this.modo==="SIMPLE_DIFERENCIADO"?String(t.Materias??""):void 0,categoria:e,sexo:i,limit:2e3}).subscribe({next:m=>{this.modalEstudiantes=m?.data??[],this.modalLoading=!1},error:()=>{this.modalEstudiantes=[],this.modalLoading=!1}}))}ngOnInit(){this.cargarAnios()}cargarAnios(){this.aniosService.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anios=t?.anios??[];let e=t?.predeterminado;e?.id&&(this.anioIdSeleccionado=String(e.id),this.cargarEstadisticas())},error:()=>{this.anios=[]}})}onChangeGestion(){this.cargarEstadisticas()}setModo(t){this.modo=t,this.cargarEstadisticas()}cargarEstadisticas(){let t=String(this.anioIdSeleccionado??"").trim();if(!t){this.dataRaw=[],this.dataTabla=[];return}this.isLoading=!0,this.estadisticasService.ObtenerAsignacionesPorMaterias({anio_id:t,modo:this.modo}).subscribe({next:e=>{this.dataRaw=(e?.data??[]).map(i=>Le(oe({},i),{RangoLvlCurso:Number(i?.RangoLvlCurso??0),Rango:i?.Rango===null||i?.Rango===void 0?void 0:Number(i?.Rango??0),Nuevos_M:Number(i?.Nuevos_M??0),Nuevos_F:Number(i?.Nuevos_F??0),Total_Nuevos:Number(i?.Total_Nuevos??0),Antiguos_M:Number(i?.Antiguos_M??0),Antiguos_F:Number(i?.Antiguos_F??0),Total_Antiguos:Number(i?.Total_Antiguos??0),Total_M:Number(i?.Total_M??0),Total_F:Number(i?.Total_F??0),Total_Gral:Number(i?.Total_Gral??0)})),this.dataTabla=[...this.dataRaw],this.isLoading=!1},error:()=>{this.dataRaw=[],this.dataTabla=[],this.isLoading=!1}})}get nivelesCursos(){let t=new Set;for(let e of this.dataTabla??[]){let i=String(e?.LvlCurso??"").trim();i&&t.add(i)}return Array.from(t).sort((e,i)=>e.localeCompare(i))}get dataFiltrada(){let t=String(this.filtroNivel??"").trim(),e=String(this.filtroTexto??"").trim().toUpperCase();return(this.dataTabla??[]).filter(i=>t&&String(i.LvlCurso??"").trim()!==t?!1:e?[i.Anio,i.Resolucion,i.LvlCurso,i.Paralelo,i.Turno,i.NombreMateria,i.Materias].map(l=>String(l??"").toUpperCase()).join(" ").includes(e):!0)}get totalFiltrado(){return this.dataFiltrada.length}};ee.\u0275fac=function(e){return new(e||ee)(M(Ce),M(Te))},ee.\u0275cmp=L({type:ee,selectors:[["app-estadisticas"]],standalone:!1,decls:76,vars:22,consts:[[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["role","group",1,"btn-group","w-100"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"form-select",3,"ngModelChange","ngModel"],["placeholder","Materia / resoluci\xF3n / nivel / paralelo",1,"form-control",3,"ngModelChange","ngModel"],["class","row mt-3",4,"ngIf"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center"],[4,"ngIf"],[1,"text-end"],[4,"ngFor","ngForOf"],["class","modal fade show d-block","tabindex","-1","role","dialog",3,"click",4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],[3,"value"],[1,"row","mt-3"],[1,"col-12","col-md-4"],[1,"btn","btn-outline-primary","w-100",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],[1,"col-12","col-md-8","text-md-end","mt-2","mt-md-0"],[1,"text-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-center","text-secondary","py-4"],[2,"white-space","nowrap"],[1,"small","text-muted"],["type","button",1,"btn","btn-link","text-black","p-0","text-end","w-100",3,"click","title"],[1,"text-end","fw-bold"],["type","button",1,"btn","btn-link","text-black","p-0","text-end","w-100","fw-bold",3,"click","title"],["tabindex","-1","role","dialog",1,"modal","fade","show","d-block",3,"click"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","text-secondary text-center py-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-secondary","text-center","py-3"],[1,"table","table-sm","table-striped","align-middle"],[1,"modal-backdrop","fade","show"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),c(4,"Estad\xEDsticas de asignaciones estudiantiles"),a(),o(5,"p",4),c(6,"Conteo oficial desde asignaciones (tabla calificaciones)"),a()()()(),o(7,"div",5)(8,"div",6)(9,"label",7),c(10,"Gesti\xF3n"),a(),o(11,"select",8),E("ngModelChange",function(l){return S(i.anioIdSeleccionado,l)||(i.anioIdSeleccionado=l),l}),g("change",function(){return i.onChangeGestion()}),o(12,"option",9),c(13,"Seleccione"),a(),b(14,Li,2,2,"option",10),a()(),o(15,"div",6)(16,"label",7),c(17,"Modo"),a(),o(18,"div",11)(19,"button",12),g("click",function(){return i.setModo("NORMAL")}),c(20," Normal "),a(),o(21,"button",12),g("click",function(){return i.setModo("SIMPLIFICADO")}),c(22," Simplificado "),a(),o(23,"button",12),g("click",function(){return i.setModo("SIMPLE_DIFERENCIADO")}),c(24," Simple diferenciado "),a()()(),o(25,"div",6)(26,"label",7),c(27,"Filtrar por nivel"),a(),o(28,"select",13),E("ngModelChange",function(l){return S(i.filtroNivel,l)||(i.filtroNivel=l),l}),o(29,"option",9),c(30,"Todos"),a(),b(31,Fi,2,2,"option",10),a()(),o(32,"div",6)(33,"label",7),c(34,"Buscar"),a(),o(35,"input",14),E("ngModelChange",function(l){return S(i.filtroTexto,l)||(i.filtroTexto=l),l}),a()()(),b(36,Gi,10,3,"div",15),o(37,"div",16)(38,"div",17)(39,"table",18)(40,"thead")(41,"tr")(42,"th",19),c(43,"#"),a(),o(44,"th"),c(45,"Gesti\xF3n"),a(),o(46,"th"),c(47,"Nivel"),a(),o(48,"th",19),c(49,"Paralelo"),a(),b(50,Bi,2,0,"th",20)(51,Ui,2,0,"th",20),o(52,"th",21),c(53,"Nuevos M"),a(),o(54,"th",21),c(55,"Nuevos F"),a(),o(56,"th",21),c(57,"Total nuevos"),a(),o(58,"th",21),c(59,"Antiguos M"),a(),o(60,"th",21),c(61,"Antiguos F"),a(),o(62,"th",21),c(63,"Total antiguos"),a(),o(64,"th",21),c(65,"Total M"),a(),o(66,"th",21),c(67,"Total F"),a(),o(68,"th",21),c(69,"Total gral"),a()()(),o(70,"tbody"),b(71,$i,5,1,"tr",20)(72,ji,3,1,"tr",20)(73,zi,42,26,"tr",22),a()()()(),b(74,Yi,14,4,"div",23)(75,Zi,1,0,"div",24)),e&2&&(s(11),y("ngModel",i.anioIdSeleccionado),s(3),d("ngForOf",i.anios),s(5),P("active",i.modo==="NORMAL"),d("disabled",i.isLoading),s(2),P("active",i.modo==="SIMPLIFICADO"),d("disabled",i.isLoading),s(2),P("active",i.modo==="SIMPLE_DIFERENCIADO"),d("disabled",i.isLoading),s(5),y("ngModel",i.filtroNivel),s(3),d("ngForOf",i.nivelesCursos),s(4),y("ngModel",i.filtroTexto),s(),d("ngIf",i.anioIdSeleccionado),s(14),d("ngIf",i.modo==="NORMAL"),s(),d("ngIf",i.modo==="SIMPLE_DIFERENCIADO"),s(20),d("ngIf",i.isLoading),s(),d("ngIf",!i.isLoading&&(!i.dataFiltrada||i.dataFiltrada.length===0)),s(),d("ngForOf",i.dataFiltrada),s(),d("ngIf",i.modalAbierto),s(),d("ngIf",i.modalAbierto))},dependencies:[F,D,j,K,G,$,B,U],encapsulation:2});var Me=ee;var Ji=[{path:"calificacionessolo",component:Se},{path:"controles",component:Ee},{path:"documentosifasimportantes",component:Ie},{path:"estadisticasasignaciones",component:Me}],H=class H{};H.\u0275fac=function(e){return new(e||H)},H.\u0275mod=le({type:H}),H.\u0275inj=re({imports:[Oe.forChild(Ji),Oe]});var we=H;var Q=class Q{};Q.\u0275fac=function(e){return new(e||Q)},Q.\u0275mod=le({type:Q}),Q.\u0275inj=re({imports:[We,it,we]});var at=Q;export{at as AdministrativosModule};
