import{a as pe,b as ue}from"./chunk-CLWIE2HP.js";import{a as me}from"./chunk-NIYGNZSD.js";import{a as _e}from"./chunk-3DE6BWMZ.js";import{b as ce}from"./chunk-JE6LV5ZR.js";import{b as de}from"./chunk-LTFYI7W4.js";import{a as ge}from"./chunk-S3DBHG6W.js";import"./chunk-AOSTFOLC.js";import{a as D}from"./chunk-KFXCIGMC.js";import"./chunk-VZTZK4BY.js";import{c as te,f as ie,h as ne,i as h,m as ae,p as re,q as oe,r as se,x as le}from"./chunk-F4ZU2PK6.js";import{$a as k,Da as c,Ea as n,Fa as i,Ga as v,J as U,K as I,Ka as F,La as A,M as Y,Na as b,P as _,Pb as Z,Q as f,Qa as u,Qb as W,Sa as d,Zb as X,ab as K,bb as J,bc as w,ca as Q,dc as L,ea as l,eb as r,fb as g,fc as ee,gb as x,ib as O,jb as V,la as y,na as q,oa as M,rc as j,sa as p,va as z,zb as G}from"./chunk-LW4OU2FI.js";import{a as $,g as H}from"./chunk-ATDPNAVO.js";var S=class S{constructor(t){this.http=t;this.ruta=D.ruta}ObtenerPagoslcch(t){let e=new w;return t?.infoestudiantesifas_id&&(e=e.set("infoestudiantesifas_id",String(t.infoestudiantesifas_id))),t?.gestion&&(e=e.set("gestion",String(t.gestion))),t?.mes&&(e=e.set("mes",String(t.mes))),this.http.get(this.ruta+"api/pagoslcch",{params:e})}ObtenerPagoslcchPorInfo(t){return this.http.get(this.ruta+"api/pagoslcch/by-info/"+t)}ObtenerDeudaPorInfo(t,e){let a=new w;return e&&(a=a.set("gestion",String(e))),this.http.get(this.ruta+"api/pagoslcch/deuda/by-info/"+t,{params:a})}ObtenerGestionesAsignaciones(){return this.http.get(this.ruta+"api/pagoslcch/gestiones-asignaciones")}ObtenerDeudores(t){let e=new w;return e=e.set("gestion",String(t.gestion??"")),t.gestion_pago&&(e=e.set("gestion_pago",String(t.gestion_pago))),t.search&&(e=e.set("search",String(t.search))),t.page&&(e=e.set("page",String(t.page))),t.per_page&&(e=e.set("per_page",String(t.per_page))),this.http.get(this.ruta+"api/pagoslcch/deudores",{params:e})}AgregarPagoslcch(t){return this.http.post(this.ruta+"api/pagoslcch",t)}ModificarPagoslcch(t,e){return this.http.put(this.ruta+"api/pagoslcch/"+e,t)}SeleccionarPagoslcch(t){return this.http.get(this.ruta+"api/pagoslcch/"+t)}EliminarPagoslcch(t){return this.http.delete(this.ruta+"api/pagoslcch/"+t)}createFormGroupPagoslcch(){return new ne({id:new h(0),infoestudiantesifas_id:new h(null),mes:new h(1),gestion:new h(String(new Date().getFullYear())),monto:new h(""),fechapago:new h(""),horapago:new h(""),estadopago:new h("PAGADO"),observacion:new h(""),file:new h("")})}};S.\u0275fac=function(e){return new(e||S)(Y(ee))},S.\u0275prov=U({token:S,factory:S.\u0275fac,providedIn:"root"});var T=S;function ve(o,t){if(o&1&&(n(0,"option",38),r(1),i()),o&2){let e=t.$implicit;c("value",e),l(),g(e)}}function be(o,t){if(o&1){let e=b();n(0,"div",39)(1,"button",40),u("click",function(){_(e);let s=d(2);return f(s.deudoresPrev())}),r(2,"Anterior"),i(),n(3,"small",41),r(4),i(),n(5,"button",40),u("click",function(){_(e);let s=d(2);return f(s.deudoresNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d(2);l(),c("disabled",!e.deudoresTienePrev()||e.isLoadingDeudores),l(3),O(" P\xE1gina ",e.deudoresMeta.current_page," / ",e.deudoresMeta.last_page," (",e.deudoresMeta.total," resultados) "),l(),c("disabled",!e.deudoresTieneNext()||e.isLoadingDeudores)}}function xe(o,t){o&1&&(n(0,"th"),r(1,"Instituci\xF3n"),i())}function Se(o,t){if(o&1&&(n(0,"td"),r(1),i()),o&2){let e=d().$implicit;l(),g(e.NombreInstitucion||"-")}}function Ce(o,t){if(o&1){let e=b();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),p(9,Se,2,1,"td",35),n(10,"td"),r(11),i(),n(12,"td"),r(13),i(),n(14,"td")(15,"button",42),u("click",function(){let s=_(e).$implicit,m=d(2);return f(m.seleccionarInscripcion(s))}),r(16," Cobrar "),i()()()}if(o&2){let e=t.$implicit,a=d(2);l(2),x("#",e.id),l(2),O("",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre),l(2),g(e.CI||"-"),l(2),g(e.Matricula||"-"),l(),c("ngIf",a.esSuperAdmin),l(2),g(e.Anio||"SIN ASIGNAR"),l(2),g(a.mesLabels(e.meses_deuda))}}function Ee(o,t){if(o&1&&(n(0,"tr")(1,"td",43),r(2,"Sin registros"),i()()),o&2){let e=d(2);l(),z("colspan",e.esSuperAdmin?8:7)}}function ye(o,t){if(o&1){let e=b();n(0,"div",7)(1,"div",27)(2,"span"),r(3,"Estudiantes con deuda (paginado)"),i(),n(4,"div",28)(5,"label",29),r(6,"Gesti\xF3n"),i(),n(7,"select",30),u("change",function(){_(e);let s=d();return f(s.cargarDeudores(1))}),p(8,ve,2,2,"option",31),i()()(),n(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"span",12),v(14,"i",13),i(),n(15,"div",14)(16,"input",32),u("input",function(s){_(e);let m=d();return f(m.filterDeudores=s.target.value)})("keyup.enter",function(){_(e);let s=d();return f(s.cargarDeudores(1))}),i(),n(17,"label"),r(18,"Buscar (nombre/CI/matr\xEDcula)"),i()(),n(19,"button",16),u("click",function(){_(e);let s=d();return f(s.cargarDeudores(1))}),r(20," Buscar "),i()(),p(21,be,7,5,"div",17),i(),n(22,"div",23)(23,"label",24),r(24,"Total deudores"),i(),v(25,"input",25),i()()(),n(26,"div",33)(27,"table",34)(28,"thead")(29,"tr")(30,"th"),r(31,"Inscripci\xF3n"),i(),n(32,"th"),r(33,"Estudiante"),i(),n(34,"th"),r(35,"CI"),i(),n(36,"th"),r(37,"Matr\xEDcula"),i(),p(38,xe,2,0,"th",35),n(39,"th"),r(40,"Gesti\xF3n (asignaci\xF3n)"),i(),n(41,"th"),r(42,"Meses adeudados"),i(),n(43,"th",36),r(44,"Acciones"),i()()(),n(45,"tbody"),p(46,Ce,17,9,"tr",37)(47,Ee,3,1,"tr",35),i()()()()}if(o&2){let e=d();l(7),c("formControl",e.gestionDeudores),l(),c("ngForOf",e.gestionesAsignaciones),l(8),c("value",e.filterDeudores),l(3),c("disabled",e.isLoadingDeudores),l(2),c("ngIf",e.deudoresMeta),l(4),c("value",(e.deudoresMeta==null?null:e.deudoresMeta.total)||0),l(13),c("ngIf",e.esSuperAdmin),l(8),c("ngForOf",e.deudores),l(),c("ngIf",e.deudores.length===0)}}function Pe(o,t){if(o&1){let e=b();n(0,"div",39)(1,"button",40),u("click",function(){_(e);let s=d();return f(s.resPrev())}),r(2,"Anterior"),i(),n(3,"small",41),r(4),i(),n(5,"button",40),u("click",function(){_(e);let s=d();return f(s.resNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d();l(),c("disabled",!e.resTienePrev()||e.isLoadingResultados),l(3),O(" P\xE1gina ",e.resMeta.current_page," / ",e.resMeta.last_page," (",e.resMeta.total," resultados) "),l(),c("disabled",!e.resTieneNext()||e.isLoadingResultados)}}function Ie(o,t){if(o&1){let e=b();n(0,"button",40),u("click",function(){let s=_(e).$implicit,m=d();return f(m.seleccionarInscripcion(s))}),r(1),n(2,"span",41),r(3),i()()}if(o&2){let e=t.$implicit,a=d();J("active",a.infoCtrl.value===e.id),c("disabled",a.isLoadingResultados),l(),V(" ",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre,"",a.esSuperAdmin?" | "+e.NombreInstitucion:""," | ",e.Anio," "),l(2),x("(#",e.id,")")}}function Me(o,t){o&1&&(n(0,"small",41),r(1,"Busca y selecciona una inscripci\xF3n para registrar pagos."),i())}function Fe(o,t){if(o&1&&(n(0,"span",41),r(1),i()),o&2){let e=d(2);l(),V(" (",e.infoSeleccionada.Ap_Paterno," ",e.infoSeleccionada.Ap_Materno," ",e.infoSeleccionada.Nombre,"",e.esSuperAdmin?" | "+e.infoSeleccionada.NombreInstitucion:""," | ",e.infoSeleccionada.Anio,") ")}}function Ae(o,t){if(o&1){let e=b();n(0,"div",44)(1,"small",45),r(2," Inscripci\xF3n seleccionada: "),n(3,"b"),r(4),i(),p(5,Fe,2,5,"span",21),i(),n(6,"button",46),u("click",function(){_(e);let s=d();return f(s.limpiarSeleccion())}),r(7,"Quitar selecci\xF3n"),i()()}if(o&2){let e=d();l(4),x("#",e.infoCtrl.value),l(),c("ngIf",e.infoSeleccionada)}}function Oe(o,t){if(o&1){let e=b();n(0,"button",70),u("click",function(){_(e);let s=d(2);return f(s.limpiarFormulario())}),r(1,"Cancelar edici\xF3n"),i()}}function we(o,t){if(o&1&&(n(0,"span",72),r(1),i()),o&2){let e=t.$implicit,a=d(3);l(),g(a.mesLabel(e))}}function De(o,t){if(o&1&&(F(0),p(1,we,2,1,"span",71),A()),o&2){let e=d(2);l(),c("ngForOf",e.mesesPagadosGestion)}}function Te(o,t){o&1&&(n(0,"span",41),r(1,"-"),i())}function Ne(o,t){o&1&&(n(0,"span",41),r(1,"Calculando..."),i())}function Re(o,t){if(o&1&&(n(0,"span",74),r(1),i()),o&2){let e=t.$implicit,a=d(4);l(),g(a.mesLabel(e))}}function ke(o,t){if(o&1&&(F(0),p(1,Re,2,1,"span",73),A()),o&2){let e=d(3);l(),c("ngForOf",e.deudaMeses)}}function Ve(o,t){o&1&&(n(0,"span",41),r(1,"Sin deuda detectada"),i())}function Ge(o,t){if(o&1&&(F(0),p(1,ke,2,1,"ng-container",52)(2,Ve,2,0,"ng-template",null,1,G),A()),o&2){let e=k(3),a=d(2);l(),c("ngIf",a.deudaMeses.length>0)("ngIfElse",e)}}function Le(o,t){if(o&1&&(n(0,"small",41),r(1),i()),o&2){let e=d(2);l(),x(" Referencia: un compa\xF1ero lleg\xF3 hasta ",e.mesLabel(e.deudaMaxMesCompaneros),". ")}}function je(o,t){if(o&1&&(n(0,"option",38),r(1),i()),o&2){let e=t.$implicit;c("value",e.value),l(),g(e.label)}}function Be(o,t){if(o&1&&(n(0,"option",75),r(1),i()),o&2){let e=t.$implicit;c("value",e.value)("disabled",e.disabled),l(),g(e.label)}}function $e(o,t){if(o&1&&(n(0,"div",76)(1,"div",77)(2,"div",78),r(3),i()()()),o&2){let e=d(2);l(2),K("width",e.uploadProgress,"%"),l(),x("",e.uploadProgress,"%")}}function He(o,t){if(o&1){let e=b();n(0,"div",7)(1,"div",47)(2,"span"),r(3),i(),p(4,Oe,2,0,"button",48),i(),n(5,"div",8)(6,"div",49)(7,"div",44)(8,"small",41),r(9,"Gesti\xF3n:"),i(),n(10,"span",50),r(11),i(),n(12,"small",51),r(13,"Meses pagados (PAGADO):"),i(),p(14,De,2,1,"ng-container",52)(15,Te,2,0,"ng-template",null,0,G),n(17,"small",51),r(18,"Meses adeudados (seg\xFAn compa\xF1eros):"),i(),p(19,Ne,2,0,"span",21)(20,Ge,4,2,"ng-container",35),i(),p(21,Le,2,1,"small",21),i(),n(22,"div",53)(23,"div",54)(24,"label",24),r(25,"Mes"),i(),n(26,"select",55),p(27,je,2,2,"option",31),i()(),n(28,"div",56)(29,"label",24),r(30,"Gesti\xF3n"),i(),v(31,"input",57),i(),n(32,"div",54)(33,"label",24),r(34,"Monto"),i(),v(35,"input",58),i(),n(36,"div",59)(37,"label",24),r(38,"Estado pago"),i(),n(39,"select",55),p(40,Be,2,3,"option",60),i()(),n(41,"div",59)(42,"label",24),r(43,"Fecha de pago"),i(),v(44,"input",61),i(),n(45,"div",59)(46,"label",24),r(47,"Hora"),i(),v(48,"input",62),i(),n(49,"div",59)(50,"label",24),r(51,"Comprobante"),i(),n(52,"input",63),u("change",function(s){_(e);let m=d();return f(m.onFileSelected(s))}),i(),p(53,$e,4,3,"div",64),i(),n(54,"div",65)(55,"label",24),r(56,"Observaci\xF3n"),i(),v(57,"quill-editor",66),i(),n(58,"div",67)(59,"button",68),u("click",function(){_(e);let s=d();return f(s.guardar())}),r(60,"Guardar"),i(),n(61,"button",69),u("click",function(){_(e);let s=d();return f(s.limpiarFormulario())}),r(62,"Limpiar"),i()()()()()}if(o&2){let e,a=k(16),s=d();l(3),g(s.editId?"Editar pago":"Registrar pago"),l(),c("ngIf",s.editId),l(7),g(((e=s.frmPago.get("gestion"))==null?null:e.value)||"-"),l(3),c("ngIf",s.mesesPagadosGestion.length>0)("ngIfElse",a),l(5),c("ngIf",s.isLoadingDeuda),l(),c("ngIf",!s.isLoadingDeuda),l(),c("ngIf",s.deudaMaxMesCompaneros),l(5),c("formControl",s.frmPago.get("mes")),l(),c("ngForOf",s.meses),l(4),c("formControl",s.frmPago.get("gestion")),l(4),c("formControl",s.frmPago.get("monto")),l(4),c("formControl",s.frmPago.get("estadopago")),l(),c("ngForOf",s.estadoPagoOptions),l(4),c("formControl",s.frmPago.get("fechapago")),l(4),c("formControl",s.frmPago.get("horapago")),l(5),c("ngIf",s.uploadProgress!==null),l(4),c("formControl",s.frmPago.get("observacion"))("modules",s.modulesQuillEdicion),l(2),c("disabled",s.uploading)}}function Ue(o,t){if(o&1&&(n(0,"a",85),r(1,"Ver"),i()),o&2){let e=d().$implicit,a=d(2);c("href",a.ruta+e.file,Q)}}function Ye(o,t){o&1&&(n(0,"span"),r(1,"-"),i())}function Qe(o,t){if(o&1){let e=b();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),r(10),i(),n(11,"td"),r(12),i(),n(13,"td"),p(14,Ue,2,1,"a",81)(15,Ye,2,0,"span",35),i(),n(16,"td")(17,"div",82)(18,"button",83),u("click",function(){let s=_(e).$implicit,m=d(2);return f(m.iniciarEditar(s))}),r(19,"Editar"),i(),n(20,"button",84),u("click",function(){let s=_(e).$implicit,m=d(2);return f(m.eliminar(s))}),r(21,"Eliminar"),i()()()()}if(o&2){let e=t.$implicit,a=d(2);l(2),g(e.gestion),l(2),g(a.mesLabel(e.mes)),l(2),g(e.monto),l(2),g(e.fechapago),l(2),g(e.horapago),l(2),g(e.estadopago),l(2),c("ngIf",e.file),l(),c("ngIf",!e.file)}}function qe(o,t){o&1&&(n(0,"tr")(1,"td",86),r(2,"Sin registros"),i()())}function ze(o,t){if(o&1&&(n(0,"div",79)(1,"div",80),r(2,"Pagos registrados"),i(),n(3,"div",33)(4,"table",34)(5,"thead")(6,"tr")(7,"th"),r(8,"Gesti\xF3n"),i(),n(9,"th"),r(10,"Mes"),i(),n(11,"th"),r(12,"Monto"),i(),n(13,"th"),r(14,"Fecha"),i(),n(15,"th"),r(16,"Hora"),i(),n(17,"th"),r(18,"Estado"),i(),n(19,"th"),r(20,"Comprobante"),i(),n(21,"th",36),r(22,"Acciones"),i()()(),n(23,"tbody"),p(24,Qe,22,8,"tr",37)(25,qe,3,0,"tr",35),i()()()()),o&2){let e=d();l(24),c("ngForOf",e.pagos),l(),c("ngIf",e.pagos.length===0)}}var P=class P{constructor(t,e,a,s,m){this._info=t;this._pagos=e;this._tools=a;this._controles=s;this._auth=m;this.ruta=D.ruta;this.modulesQuillEdicion={toolbar:[["bold","italic","underline","strike"],[{align:[]}],[{size:["small",!1,"large"]}],[{color:[]},{background:[]}],[{font:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","video"],["clean"]]};this.modulesQuillShow={toolbar:!1};this.infoCtrl=new h(null);this.filterInscripcion="";this.resultados=[];this.resMeta=null;this.resPage=1;this.resPerPage=10;this.isLoadingResultados=!1;this.infoSeleccionada=null;this.pagos=[];this.frmPago=this._pagos.createFormGroupPagoslcch();this.editId=null;this.meses=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}];this.estadoPagoOptions=[];this.isLoadingDeuda=!1;this.deudaMeses=[];this.deudaMaxMesCompaneros=null;this.mesesPagadosGestion=[];this.deudaKey=null;this.gestionesAsignaciones=[];this.gestionDeudores=new h(String(new Date().getFullYear()));this.verDeudores=!1;this.filterDeudores="";this.deudores=[];this.deudoresMeta=null;this.deudoresPage=1;this.deudoresPerPage=10;this.isLoadingDeudores=!1;this.uploading=!1;this.uploadProgress=null;this.tempFilePath=null;this.originalFilePath=null;this.esSuperAdmin=!1}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>this.esSuperAdmin=t),this.cargarEstadoPagoOptions(),this.cargarGestionesAsignaciones(),this.infoCtrl.valueChanges.subscribe(t=>{let e=Number(t||0);e>0?(this.resetFormForInfo(e),this.cargarPagos(e),this.cargarDeudaActual()):(this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.infoSeleccionada=null,this.resetFormForInfo(null))}),this.frmPago.get("gestion")?.valueChanges.subscribe(()=>{this.recalcularMesesPagadosGestion(),this.cargarDeudaActual()})}cargarGestionesAsignaciones(){this._pagos.ObtenerGestionesAsignaciones().subscribe({next:t=>{let e=Array.isArray(t?.data)?t.data:[];this.gestionesAsignaciones=e},error:()=>{this.gestionesAsignaciones=["SIN ASIGNAR"]}})}toggleVerDeudores(){this.verDeudores=!this.verDeudores,this.verDeudores&&this.cargarDeudores(1)}cargarDeudores(t=1){if(this.isLoadingDeudores)return;let e=String(this.gestionDeudores.value??"").trim()||String(new Date().getFullYear()),a=(this.filterDeudores??"").trim();this.isLoadingDeudores=!0,this._pagos.ObtenerDeudores({gestion:e,page:t,per_page:this.deudoresPerPage,search:a||void 0}).subscribe({next:s=>{this.deudores=Array.isArray(s?.data)?s.data:[],this.deudoresMeta=s?.meta??null,this.deudoresPage=this.deudoresMeta?.current_page??t},error:s=>{console.log("ERROR CARGANDO DEUDORES",s),this.deudores=[],this.deudoresMeta=null,this.deudoresPage=1},complete:()=>{this.isLoadingDeudores=!1}})}deudoresTienePrev(){return(this.deudoresMeta?.current_page??1)>1}deudoresTieneNext(){let t=this.deudoresMeta?.current_page??1,e=this.deudoresMeta?.last_page??1;return t<e}deudoresPrev(){this.deudoresTienePrev()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)-1)}deudoresNext(){this.deudoresTieneNext()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)+1)}mesLabels(t){return(Array.isArray(t)?t:[]).map(a=>this.mesLabel(a)).filter(a=>!!a).join(", ")}cargarEstadoPagoOptions(){this._controles.ObtenerOptionsSelectPorCategoria("ESTADO PAGO").subscribe({next:t=>this.estadoPagoOptions=t||[],error:()=>this.estadoPagoOptions=[]})}buscarInscripciones(t=1){if(this.isLoadingResultados)return;let e=(this.filterInscripcion??"").trim();if(!e||e.length<2){this.resultados=[],this.resMeta=null,this.resPage=1;return}this.isLoadingResultados=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.resPerPage,search:e,sort_by:"Ap_Paterno",sort_dir:"asc"}).subscribe({next:a=>{this.resultados=Array.isArray(a?.data)?a.data:[],this.resMeta=a?.meta??null,this.resPage=this.resMeta?.current_page??t},error:a=>{console.log("ERROR BUSCANDO INSCRIPCIONES",a),this.resultados=[],this.resMeta=null,this.resPage=1},complete:()=>{this.isLoadingResultados=!1}})}resTienePrev(){return(this.resMeta?.current_page??1)>1}resTieneNext(){let t=this.resMeta?.current_page??1,e=this.resMeta?.last_page??1;return t<e}resPrev(){this.resTienePrev()&&this.buscarInscripciones((this.resMeta?.current_page??1)-1)}resNext(){this.resTieneNext()&&this.buscarInscripciones((this.resMeta?.current_page??1)+1)}seleccionarInscripcion(t){let e=Number(t?.id??0);e&&(this.infoSeleccionada=t,this.infoCtrl.setValue(e))}limpiarSeleccion(){this.infoCtrl.setValue(null),this.infoSeleccionada=null,this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.resetFormForInfo(null)}cargarPagos(t){this._pagos.ObtenerPagoslcchPorInfo(t).subscribe({next:e=>{this.pagos=Array.isArray(e?.data)?e.data:[],this.recalcularMesesPagadosGestion()},error:e=>{console.log("ERROR CARGANDO PAGOS LCCH",e),this.pagos=[],this.mesesPagadosGestion=[]}})}recalcularMesesPagadosGestion(){let t=String(this.frmPago.get("gestion")?.value??"").trim();if(!t){this.mesesPagadosGestion=[];return}let e=(this.pagos??[]).filter(a=>String(a?.gestion??"").trim()===t).filter(a=>String(a?.estadopago??"").trim().toUpperCase()==="PAGADO").map(a=>Number(a?.mes??0)).filter(a=>Number.isFinite(a)&&a>=1&&a<=12);this.mesesPagadosGestion=Array.from(new Set(e)).sort((a,s)=>a-s)}cargarDeudaActual(){let t=Number(this.infoCtrl.value??0);if(!t)return;let e=String(this.frmPago.get("gestion")?.value??"").trim()||String(new Date().getFullYear()),a=`${t}|${e}`;this.deudaKey!==a&&(this.deudaKey=a,this.isLoadingDeuda=!0,this._pagos.ObtenerDeudaPorInfo(t,e).subscribe({next:s=>{let m=s?.data;this.deudaMeses=Array.isArray(m?.meses_deuda)?m.meses_deuda:[],this.deudaMaxMesCompaneros=Number.isFinite(Number(m?.max_mes_companeros))?Number(m?.max_mes_companeros):null},error:s=>{console.log("ERROR CARGANDO DEUDA",s),this.deudaMeses=[],this.deudaMaxMesCompaneros=null},complete:()=>{this.isLoadingDeuda=!1}}))}resetFormForInfo(t){this.cancelarEdicion(),this.frmPago.reset({id:0,infoestudiantesifas_id:t,mes:1,gestion:String(new Date().getFullYear()),monto:"",fechapago:"",horapago:"",estadopago:"PAGADO",observacion:"",file:""}),this.deudaKey=null}limpiarFormulario(){let t=this.infoCtrl.value??null;this.cancelarEdicion(),this.resetFormForInfo(t?Number(t):null)}iniciarEditar(t){this.cancelarEdicion(),this.editId=t?.id??null,this.originalFilePath=t?.file??null,this.frmPago.reset({id:t?.id??0,infoestudiantesifas_id:t?.infoestudiantesifas_id??this.infoCtrl.value,mes:t?.mes??1,gestion:t?.gestion??String(new Date().getFullYear()),monto:t?.monto??"",fechapago:t?.fechapago??"",horapago:t?.horapago??"",estadopago:t?.estadopago??"PAGADO",observacion:t?.observacion??"",file:t?.file??""})}cancelarEdicion(){this.tempFilePath&&this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null,this.originalFilePath=null,this.uploading=!1,this.uploadProgress=null,this.editId=null}onFileSelected(t){let e=t.target;if(!e?.files||e.files.length===0)return;let a=e.files[0];this.tempFilePath&&(this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null),this.uploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(a,"pagoslcchcomprobantes").subscribe({next:s=>{if(s.type===L.UploadProgress){let m=s.total??0;m>0&&(this.uploadProgress=Math.round(s.loaded/m*100))}if(s.type===L.Response){let m=s.body?.filePath;m&&(this.frmPago.patchValue({file:m}),this.tempFilePath=m),this.uploading=!1,this.uploadProgress=100}},error:s=>{console.log("ERROR SUBIENDO COMPROBANTE",s),this.uploading=!1,this.uploadProgress=null,this._tools.MostrarMensaje("error","Error al subir comprobante")}})}guardar(){let t=Number(this.infoCtrl.value||0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}if(this.uploading){this._tools.MostrarMensaje("warning","Espere a que termine la subida");return}let e=$({},this.frmPago.value);if(e.infoestudiantesifas_id=t,e.monto!==""&&e.monto!==null&&e.monto!==void 0){let a=Number(e.monto);e.monto=Number.isFinite(a)?a:null}if(!this.editId){delete e.id,this._pagos.AgregarPagoslcch(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago registrado"),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual()},error:a=>{console.log("ERROR CREANDO PAGO",a),this._tools.MostrarMensaje("error","Error al guardar")}});return}this._pagos.ModificarPagoslcch(e,this.editId).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago actualizado"),this.tempFilePath&&this.originalFilePath&&this.tempFilePath!==this.originalFilePath&&this._tools.EliminarArchivo(this.originalFilePath),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual()},error:a=>{console.log("ERROR ACTUALIZANDO PAGO",a),this._tools.MostrarMensaje("error","Error al actualizar")}})}eliminar(t){return H(this,null,function*(){if(!(yield this._tools.mostrarMensajeConfirm("Eliminar","\xBFEliminar este pago?","warning","Eliminar")))return;let a=Number(this.infoCtrl.value||0);this._pagos.EliminarPagoslcch(t.id).subscribe({next:()=>{t?.file&&this._tools.EliminarArchivo(t.file),this._tools.MostrarMensaje("success","Eliminado"),this.cargarPagos(a),this.cargarDeudaActual()},error:s=>{console.log("ERROR ELIMINANDO PAGO",s),this._tools.MostrarMensaje("error","Error al eliminar")}})})}mesLabel(t){let e=this.meses.find(a=>a.value===Number(t));return e?e.label:String(t??"")}};P.\u0275fac=function(e){return new(e||P)(y(_e),y(T),y(de),y(me),y(ce))},P.\u0275cmp=q({type:P,selectors:[["app-sistemapagoslcch"]],standalone:!1,decls:32,vars:11,consts:[["sinPagados",""],["sinDeuda",""],[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],["type","button",1,"btn","btn-outline-primary",3,"click"],["class","card mb-3",4,"ngIf"],[1,"card","mb-3"],[1,"card-body"],[1,"row","align-items-end","g-2"],[1,"col-lg-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],[1,"form-floating","flex-grow-1"],["type","text","placeholder","Buscar inscripci\xF3n",1,"form-control",3,"input","keyup.enter","value"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","mt-2 d-flex align-items-center gap-2",4,"ngIf"],[1,"mt-2","d-flex","flex-wrap","gap-2"],["class","btn btn-outline-secondary btn-sm","type","button",3,"active","disabled","click",4,"ngFor","ngForOf"],[1,"mt-2"],["class","text-muted",4,"ngIf"],["class","d-flex flex-wrap align-items-center gap-2",4,"ngIf"],[1,"col-lg-4"],[1,"form-label"],["readonly","",1,"form-control",3,"value"],["class","card",4,"ngIf"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"d-flex","align-items-center","gap-2"],[1,"form-label","m-0"],[1,"form-select","form-select-sm",2,"width","180px",3,"change","formControl"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Buscar deudores",1,"form-control",3,"input","keyup.enter","value"],[1,"table-responsive"],[1,"table","table-sm","table-striped","align-middle","mb-0"],[4,"ngIf"],[2,"width","160px"],[4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","d-flex","align-items-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"text-muted"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"text-center","py-3"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"text-success"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"card-header","d-flex","align-items-center","justify-content-between"],["class","btn btn-sm btn-outline-secondary","type","button",3,"click",4,"ngIf"],[1,"mb-2"],[1,"badge","bg-secondary"],[1,"text-muted","ms-2"],[4,"ngIf","ngIfElse"],[1,"row","g-2"],[1,"col-md-3"],[1,"form-select",3,"formControl"],[1,"col-md-2"],["placeholder","2025",1,"form-control",3,"formControl"],["placeholder","0",1,"form-control",3,"formControl"],[1,"col-md-4"],[3,"value","disabled",4,"ngFor","ngForOf"],["type","date",1,"form-control",3,"formControl"],["type","time",1,"form-control",3,"formControl"],["type","file",1,"form-control",3,"change"],["class","mt-1",4,"ngIf"],[1,"col-12"],["placeholder","",1,"quill-container-wrapper",3,"formControl","modules"],[1,"col-12","d-flex","gap-2"],["type","button",1,"btn","btn-success",3,"click","disabled"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["class","badge bg-success",4,"ngFor","ngForOf"],[1,"badge","bg-success"],["class","badge bg-danger",4,"ngFor","ngForOf"],[1,"badge","bg-danger"],[3,"value","disabled"],[1,"mt-1"],[1,"progress"],["role","progressbar",1,"progress-bar"],[1,"card"],[1,"card-header"],["target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["target","_blank","rel","noopener noreferrer",3,"href"],["colspan","8",1,"text-center","py-3"]],template:function(e,a){e&1&&(n(0,"div",2)(1,"div",3)(2,"h4",4),r(3,"Sistema de Pagos (Mensualidades)"),i(),n(4,"button",5),u("click",function(){return a.toggleVerDeudores()}),r(5),i()(),p(6,ye,48,9,"div",6),n(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10)(11,"div",11)(12,"span",12),v(13,"i",13),i(),n(14,"div",14)(15,"input",15),u("input",function(m){return a.filterInscripcion=m.target.value})("keyup.enter",function(){return a.buscarInscripciones(1)}),i(),n(16,"label"),r(17,"Buscar inscripci\xF3n (m\xEDn. 2 caracteres)"),i()(),n(18,"button",16),u("click",function(){return a.buscarInscripciones(1)}),r(19," Buscar "),i()(),p(20,Pe,7,5,"div",17),n(21,"div",18),p(22,Ie,4,9,"button",19),i(),n(23,"div",20),p(24,Me,2,0,"small",21)(25,Ae,8,2,"div",22),i()(),n(26,"div",23)(27,"label",24),r(28,"Total registros"),i(),v(29,"input",25),i()()()(),p(30,He,63,20,"div",6)(31,ze,26,2,"div",26),i()),e&2&&(l(5),x(" ",a.verDeudores?"Ocultar deudores":"Ver estudiantes con deuda"," "),l(),c("ngIf",a.verDeudores),l(9),c("value",a.filterInscripcion),l(3),c("disabled",a.isLoadingResultados),l(2),c("ngIf",a.resMeta),l(2),c("ngForOf",a.resultados),l(2),c("ngIf",!a.infoCtrl.value),l(),c("ngIf",a.infoCtrl.value),l(4),c("value",a.pagos.length),l(),c("ngIf",a.infoCtrl.value),l(),c("ngIf",a.infoCtrl.value))},dependencies:[Z,W,oe,se,te,re,ie,ae,pe],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var N=P;var Ke=[{path:"sistemapagoslcch",component:N}],C=class C{};C.\u0275fac=function(e){return new(e||C)},C.\u0275mod=M({type:C}),C.\u0275inj=I({imports:[j.forChild(Ke),j]});var R=C;var E=class E{};E.\u0275fac=function(e){return new(e||E)},E.\u0275mod=M({type:E}),E.\u0275inj=I({imports:[X,ge,le,ue,R]});var fe=E;export{fe as SistemapagoslcchModule};
