import{a as We}from"./chunk-OOKT7CA3.js";import{a as fe}from"./chunk-OZBMU6CO.js";import{a as $e}from"./chunk-QQ5CTZ3Y.js";import"./chunk-FP75KMDZ.js";import"./chunk-MQTYL4CM.js";import{a as Ue}from"./chunk-5EUTDLE7.js";import{a as De}from"./chunk-BDYLTSXV.js";import{a as Ke}from"./chunk-X2UZLZXS.js";import{b as _e}from"./chunk-A5M3HUGQ.js";import{b as je}from"./chunk-2XFHIHYO.js";import{b as Be}from"./chunk-OXONTOT5.js";import"./chunk-GNB3GLIJ.js";import"./chunk-NCIXDP2C.js";import{k as Ee}from"./chunk-2UZ5XJOB.js";import{b as ge}from"./chunk-5XGECW57.js";import{g as Ge}from"./chunk-3IGMLI3N.js";import{b as de,c as U,f as $,g as ue,i as ke,k as W,l as me,m as pe,p as Ne,q as Re,r as z,s as H,t as Q,u as Le,v as Fe}from"./chunk-F4JB6MJU.js";import"./chunk-5RMZ5E5A.js";import{Ab as ae,Ac as ce,Ba as ne,Bb as le,Ca as s,Cc as K,Dc as j,Eb as J,Fb as Te,Gb as N,Jb as c,Ka as P,Kb as b,Kc as Ae,Lb as S,Lc as Oe,Mb as se,Pa as G,Qa as oe,Qb as E,Rb as I,Sb as w,Ua as h,Wb as M,_ as ie,_a as R,ac as Me,dc as Ve,ec as L,ga as p,gb as u,ha as _,hb as o,ia as we,ib as r,jb as C,nb as ye,ob as Se,qb as v,ta as Pe,tb as g,vb as d,za as Z,zb as re}from"./chunk-4IB5NCLX.js";import{a as Ie,m as te}from"./chunk-GG76335P.js";function Ze(a,t){if(a&1){let e=v();o(0,"div",35)(1,"button",36),g("click",function(){p(e);let n=d();return _(n.infoPrev())}),c(2,"Prev"),r(),o(3,"button",36),g("click",function(){p(e);let n=d();return _(n.infoNext())}),c(4,"Next"),r()()}if(a&2){let e=d();s(),u("disabled",!e.infoTienePrev()||e.isLoadingInfo),s(2),u("disabled",!e.infoTieneNext()||e.isLoadingInfo)}}function Je(a,t){if(a&1){let e=v();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=d();return _(l.onEvalEnabledChange(0,n))}),r(),o(2,"span",21),c(3,"1"),r()()}if(a&2){let e=d();s(),u("ngModel",e.evalEnabled[0])}}function et(a,t){if(a&1){let e=v();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=d();return _(l.onEvalEnabledChange(1,n))}),r(),o(2,"span",21),c(3,"2"),r()()}if(a&2){let e=d();s(),u("ngModel",e.evalEnabled[1])}}function tt(a,t){if(a&1){let e=v();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=d();return _(l.onEvalEnabledChange(2,n))}),r(),o(2,"span",21),c(3,"3"),r()()}if(a&2){let e=d();s(),u("ngModel",e.evalEnabled[2])}}function it(a,t){if(a&1){let e=v();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let l=d();return _(l.onEvalEnabledChange(3,n))}),r(),o(2,"span",21),c(3,"4"),r()()}if(a&2){let e=d();s(),u("ngModel",e.evalEnabled[3])}}function nt(a,t){if(a&1&&(o(0,"span"),c(1),r()),a&2){let e=d(2);s(),se("\xB7 P\xE1gina ",e.infoMeta.current_page," / ",e.infoMeta.last_page)}}function ot(a,t){if(a&1&&(o(0,"span"),c(1),r()),a&2){let e=d().$implicit;s(),S("\xB7 ",e.NombreInstitucion)}}function rt(a,t){if(a&1){let e=v();o(0,"button",46),g("click",function(){let n=p(e).$implicit,l=d(2);return _(l.seleccionarInfo(n))}),o(1,"div",47),c(2),r(),o(3,"div",48),c(4),h(5,ot,2,1,"span",43),r()()}if(a&2){let e=t.$implicit,i=d(2);N("active",(i.selectedInfo==null?null:i.selectedInfo.id)===e.id),s(2),b(i.infoLabel(e)),s(2),S(" ID Inscripci\xF3n: ",e.id," "),s(),u("ngIf",i.esSuperAdmin&&e.NombreInstitucion)}}function at(a,t){if(a&1&&(o(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41)(4,"div",42),c(5),h(6,nt,2,2,"span",43),r(),o(7,"div",44),h(8,rt,6,5,"button",45),r()()()()()),a&2){let e=d();s(5),S(" Resultados: ",(e.infoMeta==null?null:e.infoMeta.total)??e.infoItems.length," "),s(),u("ngIf",e.infoMeta),s(2),u("ngForOf",e.infoItems)("ngForTrackBy",e.trackByRowIndex)}}function lt(a,t){a&1&&(o(0,"div",49)(1,"div",50),c(2," Primero busca una "),o(3,"strong"),c(4,"inscripci\xF3n"),r(),c(5," y selecci\xF3nala para cargar sus materias. "),r(),o(6,"div",51),c(7," Columnas calculadas: "),o(8,"strong"),c(9,"Prom Teo"),r(),c(10,", "),o(11,"strong"),c(12,"Prom Prac"),r(),c(13," y "),o(14,"strong"),c(15,"Prom"),r(),c(16," (solo lectura). "),r()())}function st(a,t){a&1&&(o(0,"span"),c(1,"Cargando calificaciones\u2026"),r())}function ct(a,t){a&1&&(o(0,"span"),c(1,"Guardando cambios\u2026"),r())}function dt(a,t){if(a&1&&(o(0,"div",52)(1,"div",51),h(2,st,2,0,"span",43)(3,ct,2,0,"span",43),r()()),a&2){let e=d();s(2),u("ngIf",e.isLoadingCalificaciones),s(),u("ngIf",e.isSaving)}}function ut(a,t){if(a&1&&(o(0,"div",53)(1,"div",51),c(2),r()()),a&2){let e=d();s(2),b(e.saveError)}}function mt(a,t){if(a&1&&(o(0,"span"),c(1),r()),a&2){let e=d(2);s(),S("/ ",e.califMeta.last_page)}}function pt(a,t){if(a&1){let e=v();o(0,"div",56)(1,"button",36),g("click",function(){p(e);let n=d(2);return _(n.califPrev())}),c(2,"Prev"),r(),o(3,"button",36),g("click",function(){p(e);let n=d(2);return _(n.califNext())}),c(4,"Next"),r()()}if(a&2){let e=d(2);s(),u("disabled",!e.califTienePrev()||e.isLoadingCalificaciones),s(2),u("disabled",!e.califTieneNext()||e.isLoadingCalificaciones)}}function _t(a,t){if(a&1){let e=v();o(0,"div",2)(1,"div",54),c(2," Inscripci\xF3n seleccionada: "),o(3,"strong"),c(4),r(),c(5," \xB7 P\xE1gina materias: "),o(6,"strong"),c(7),r(),h(8,mt,2,1,"span",43),r(),o(9,"div",5)(10,"div",51),c(11,"Cambios pendientes: "),o(12,"strong"),c(13),r()(),h(14,pt,5,2,"div",55),o(15,"button",12),g("click",function(){p(e);let n=d();return _(n.cargarCalificaciones(n.califPage))}),c(16," Recargar "),r()()()}if(a&2){let e=d();s(4),b(e.selectedInfo.id),s(3),b((e.califMeta==null?null:e.califMeta.current_page)??e.califPage),s(),u("ngIf",e.califMeta),s(5),b(e.dirtyIds.size),s(),u("ngIf",e.califMeta),s(),u("disabled",e.isLoadingCalificaciones)}}function gt(a,t){if(a&1&&(o(0,"span",4),c(1),r()),a&2){let e=t.ngIf;s(),S("(",e,")")}}function ft(a,t){if(a&1&&(o(0,"th",62),c(1),h(2,gt,2,1,"span",63),r()),a&2){let e=t.$implicit,i=d(2);Te("width",e.widthPx,"px"),u("ngClass",i.headerThClass(e.key)),s(),S(" ",e.label," "),s(),u("ngIf",i.maxForColumn(e))}}function ht(a,t){if(a&1&&(o(0,"tr",68)(1,"td",59)(2,"div",47),c(3),r()()()),a&2){let e=d().$implicit,i=d(2);s(),R("colspan",i.tableColspan()),s(2),b(i.groupKey(e))}}function bt(a,t){if(a&1){let e=v();ye(0),o(1,"input",71),g("ngModelChange",function(n){p(e);let l=d().$implicit,m=d().index,f=d(2);return _(f.onCellValueInput(m,l.key,n))})("focus",function(){p(e);let n=d().index,l=d().index,m=d(2);return _(m.onCellFocus(l,n))})("keydown",function(n){p(e);let l=d().index,m=d().index,f=d(2);return _(f.onKeyDown(n,m,l))})("paste",function(n){p(e);let l=d().index,m=d().index,f=d(2);return _(f.onPaste(n,m,l))}),r(),Se()}if(a&2){let e=d(),i=e.$implicit,n=e.index,l=d(),m=l.$implicit,f=l.index,x=d(2);s(),N("readonly-cell",i.readonly),u("readOnly",!!i.readonly||!x.isColumnEditable(i.key))("ngModel",m[i.key]),R("data-cell",f+"-"+n)("min",0)("max",x.maxForColumn(i))}}function vt(a,t){if(a&1){let e=v();o(0,"input",72),g("focus",function(){p(e);let n=d().index,l=d().index,m=d(2);return _(m.onCellFocus(l,n))})("keydown",function(n){p(e);let l=d().index,m=d().index,f=d(2);return _(f.onKeyDown(n,m,l))})("paste",function(n){p(e);let l=d().index,m=d().index,f=d(2);return _(f.onPaste(n,m,l))}),r()}if(a&2){let e=d(),i=e.$implicit,n=e.index,l=d(),m=l.$implicit,f=l.index,x=d(2);u("readOnly",!0)("value",x.sumForColumn(m,i.key)??""),R("data-cell",f+"-"+n)}}function Ct(a,t){if(a&1&&(o(0,"td",69),h(1,bt,2,7,"ng-container",70)(2,vt,1,3,"ng-template",null,0,L),r()),a&2){let e=t.$implicit,i=t.index,n=J(3),l=d().$implicit,m=d(2);u("ngClass",m.cellTdClass(l,i,e.key)),s(),u("ngIf",e.kind!=="sum")("ngIfElse",n)}}function xt(a,t){if(a&1){let e=v();ye(0),h(1,ht,4,2,"tr",64),o(2,"tr")(3,"td",59)(4,"div",65)(5,"div")(6,"div",47),c(7),r(),o(8,"div",66),c(9),r()(),o(10,"button",24),g("click",function(){let n=p(e).$implicit,l=d(2);return _(l.openPhoto(n))}),c(11,"Foto"),r()()(),h(12,Ct,4,3,"td",67),r(),Se()}if(a&2){let e=t.$implicit,i=t.index,n=d(2);s(),u("ngIf",n.isGroupStart(i)),s(),N("table-active",i===n.activeRowIndex),s(5),b(e.estudiante),s(2),b(e.materia),s(3),u("ngForOf",n.columns)("ngForTrackBy",n.trackByColIndex)}}function yt(a,t){if(a&1&&(o(0,"div",57)(1,"table",58)(2,"thead")(3,"tr")(4,"th",59),c(5,"Estudiante"),r(),h(6,ft,3,5,"th",60),r()(),o(7,"tbody"),h(8,xt,13,7,"ng-container",61),r()()()),a&2){let e=d();s(6),u("ngForOf",e.columns)("ngForTrackBy",e.trackByColIndex),s(2),u("ngForOf",e.rows)("ngForTrackBy",e.trackByRowIndex)}}function St(a,t){if(a&1){let e=v();o(0,"div",73)(1,"div",74)(2,"div",75)(3,"div",76)(4,"h5",77),c(5),r(),o(6,"button",78),g("click",function(){p(e);let n=d();return _(n.closePhoto())}),r()(),o(7,"div",79),C(8,"img",80),o(9,"div",81),c(10),r()()()()()}if(a&2){let e=d();s(5),S("Foto - ",e.photoRow==null?null:e.photoRow.estudiante),s(3),u("src",e.photoUrlFor(e.photoRow),Z),s(2),b(e.photoRow==null?null:e.photoRow.materia)}}function Et(a,t){if(a&1){let e=v();o(0,"div",82),g("click",function(){p(e);let n=d();return _(n.closePhoto())}),r()}}var X=class X{constructor(t,e,i,n){this.hostEl=t;this._calif=e;this._info=i;this._auth=n;this.esSuperAdmin=!1;this.PASSING_SCORE=61;this.maxTeorico=30;this.maxPractico=70;this.avgEvalCount=4;this.evalEnabled=[!0,!0,!0,!0];this.showSumColumns=!1;this.filterInfo="";this.infoItems=[];this.infoMeta=null;this.infoPage=1;this.infoPerPage=10;this.isLoadingInfo=!1;this.selectedInfo=null;this.isLoadingCalificaciones=!1;this.califMeta=null;this.califPage=1;this.califPerPage=200;this.isSaving=!1;this.saveError=null;this.originalById=new Map;this.dirtyIds=new Set;this.HISTORY_LIMIT=80;this.undoStack=[];this.redoStack=[];this.isRestoring=!1;this.viewMode="intercalado";this.rows=[];this.activeRowIndex=0;this.activeColIndex=0;this.photoModalOpen=!1;this.photoRow=null;this.trackByRowIndex=(t,e)=>e.id;this.trackByColIndex=(t,e)=>e.key}get visibleEvalCount(){return this.avgEvalCount}get columns(){return this.buildColumns(this.viewMode,this.visibleEvalCount)}tableColspan(){return 1+this.columns.length}groupKey(t){let e=(t.Anio??"SIN A\xD1O").toString().trim()||"SIN A\xD1O",i=(t.LvlCurso??"SIN CURSO").toString().trim()||"SIN CURSO";return`${e} | ${i}`}isGroupStart(t){if(t<=0)return!0;let e=this.rows[t-1],i=this.rows[t];return!e||!i?!0:this.groupKey(e)!==this.groupKey(i)}buildColumns(t,e){let i=[],l=e;if(t==="intercalado")for(let m=1;m<=l;m++)i.push({key:`Teorico${m}`,label:`Teo${m}`,type:"number",kind:"input",widthPx:95}),i.push({key:`Practico${m}`,label:`Prac${m}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${m}`,label:`Sum${m}`,type:"number",kind:"sum",readonly:!0,widthPx:90});else{for(let m=1;m<=l;m++)i.push({key:`Teorico${m}`,label:`Teo${m}`,type:"number",kind:"input",widthPx:95});for(let m=1;m<=l;m++)i.push({key:`Practico${m}`,label:`Prac${m}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${m}`,label:`Sum${m}`,type:"number",kind:"sum",readonly:!0,widthPx:90})}return[...i,{key:"PromTeorico",label:"Prom Teo",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"PromPractico",label:"Prom Prac",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"Promedio",label:"Prom",type:"number",kind:"input",readonly:!0,widthPx:90},{key:"PruebaRecuperacion",label:"Recup",type:"number",kind:"input",widthPx:95}]}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>{this.esSuperAdmin=t})}buscarInfo(t=1){if(this.isLoadingInfo)return;let e=(this.filterInfo??"").trim();if(!e||e.length<2){this.infoItems=[],this.infoMeta=null,this.infoPage=1;return}this.isLoadingInfo=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.infoPerPage,search:e,sort_by:"FechInsc",sort_dir:"desc"}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.infoItems=n.map(l=>({id:Number(l?.id),FechInsc:l?.FechInsc??null,Curso_Solicitado:l?.Curso_Solicitado??null,Paralelo_Solicitado:l?.Paralelo_Solicitado??null,Categoria:l?.Categoria??null,Turno:l?.Turno??null,Anio:l?.Anio??null,Ap_Paterno:l?.Ap_Paterno??null,Ap_Materno:l?.Ap_Materno??null,Nombre:l?.Nombre??null,NombreInstitucion:l?.NombreInstitucion??null})).filter(l=>Number.isFinite(l.id)),this.infoMeta=i?.meta??null,this.infoPage=this.infoMeta?.current_page??t},error:i=>{console.error("Error al buscar inscripciones:",i),this.infoItems=[],this.infoMeta=null},complete:()=>{this.isLoadingInfo=!1}})}infoTienePrev(){return(this.infoMeta?.current_page??1)>1}infoTieneNext(){let t=this.infoMeta?.current_page??1,e=this.infoMeta?.last_page??1;return t<e}infoPrev(){this.infoTienePrev()&&this.buscarInfo((this.infoMeta?.current_page??1)-1)}infoNext(){this.infoTieneNext()&&this.buscarInfo((this.infoMeta?.current_page??1)+1)}infoLabel(t){let e=(t.Ap_Paterno??"").toString().trim(),i=(t.Ap_Materno??"").toString().trim(),n=(t.Nombre??"").toString().trim(),l=`${e} ${i} ${n}`.replace(/\s+/g," ").trim()||`Inscripci\xF3n #${t.id}`,m=(t.Anio??"").toString().trim(),f=(t.Curso_Solicitado??"").toString().trim(),x=(t.Paralelo_Solicitado??"").toString().trim(),T=[l];return m&&T.push(`A\xF1o: ${m}`),f&&T.push(`Curso: ${f}${x?" - "+x:""}`),T.join(" \xB7 ")}seleccionarInfo(t){this.selectedInfo=t,this.resetGridForNewInfo(),this.cargarCalificaciones(1)}limpiarInfo(){this.selectedInfo=null,this.resetGridForNewInfo()}resetGridForNewInfo(){this.rows=[],this.originalById.clear(),this.dirtyIds.clear(),this.undoStack=[],this.redoStack=[],this.saveError=null,this.califMeta=null,this.califPage=1}califTienePrev(){return(this.califMeta?.current_page??1)>1}califTieneNext(){let t=this.califMeta?.current_page??1,e=this.califMeta?.last_page??1;return t<e}califPrev(){this.califTienePrev()&&this.cargarCalificaciones((this.califMeta?.current_page??1)-1)}califNext(){this.califTieneNext()&&this.cargarCalificaciones((this.califMeta?.current_page??1)+1)}cargarCalificaciones(t=1){if(!this.selectedInfo||this.isLoadingCalificaciones)return;this.isLoadingCalificaciones=!0,this.saveError=null;let e=this.selectedInfo.id;this._calif.ObtenerCalificacionesPorInfoPaginado(e,{page:t,per_page:this.califPerPage}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.califMeta=i?.meta??null,this.califPage=this.califMeta?.current_page??t;let l=Number(n?.[0]?.CantidadEvaluaciones);Number.isFinite(l)&&(this.avgEvalCount=this.clampInt(l,1,4));let m=this.infoLabel(this.selectedInfo);this.rows=n.map(f=>{let x=(f?.NombreMateria??"").toString().trim(),T=(f?.SiglaMateria??"").toString().trim(),y=(f?.MateriaParalelo??"").toString().trim(),O=[T,x].filter(Boolean).join(" ")+(y?` (${y})`:"");return{id:Number(f?.id),infoestudiantesifas_id:Number(f?.infoestudiantesifas_id??e),materias_id:Number(f?.materias_id),estudiante:m,materia:O||`Materia #${f?.materias_id}`,fotoUrl:null,Anio:f?.Anio??null,LvlCurso:f?.LvlCurso??null,Teorico1:f?.Teorico1??null,Teorico2:f?.Teorico2??null,Teorico3:f?.Teorico3??null,Teorico4:f?.Teorico4??null,Practico1:f?.Practico1??null,Practico2:f?.Practico2??null,Practico3:f?.Practico3??null,Practico4:f?.Practico4??null,PromTeorico:f?.PromTeorico??null,PromPractico:f?.PromPractico??null,Promedio:f?.Promedio??null,PruebaRecuperacion:f?.PruebaRecuperacion??null}}).filter(f=>Number.isFinite(f.id)&&Number.isFinite(f.materias_id));for(let f of this.rows){for(let x of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(f,x);this.recalcInPlace(f)}this.captureBaseline()},error:i=>{console.error("Error al cargar calificaciones:",i),this.rows=[],this.califMeta=null,this.saveError="No se pudieron cargar las calificaciones."},complete:()=>{this.isLoadingCalificaciones=!1}})}captureBaseline(){this.originalById.clear(),this.dirtyIds.clear();for(let t of this.rows)this.originalById.set(t.id,{Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion})}recomputeDirtyForRow(t){let e=this.originalById.get(t.id);if(!e)return;["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"].some(l=>t[l]!==e[l])?this.dirtyIds.add(t.id):this.dirtyIds.delete(t.id)}guardarCambios(){if(!this.selectedInfo||this.isSaving||(this.saveError=null,Array.from(this.dirtyIds.values()).length===0))return;let e=this.rows.filter(i=>this.dirtyIds.has(i.id)).map(i=>({id:i.id,Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion}));this.isSaving=!0,this._calif.GuardarCalificacionesBulk({infoestudiantesifas_id:this.selectedInfo.id,avg_eval_count:this.avgEvalCount,items:e}).subscribe({next:()=>{for(let i of this.rows)this.dirtyIds.has(i.id)&&this.originalById.set(i.id,{Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion});this.dirtyIds.clear()},error:i=>{console.error("Error al guardar cambios:",i),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}onGlobalKeyDown(t){let e=t.target;if(!e||!this.hostEl.nativeElement.contains(e)||!(t.ctrlKey||t.metaKey))return;let n=t.key.toLowerCase();if(n==="z"&&!t.shiftKey){this.canUndo()&&(t.preventDefault(),this.undo());return}(n==="y"||n==="z"&&t.shiftKey)&&this.canRedo()&&(t.preventDefault(),this.redo())}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){let t=this.undoStack.pop();t&&(this.redoStack.push(this.snapshotState()),this.restoreState(t))}redo(){let t=this.redoStack.pop();t&&(this.undoStack.push(this.snapshotState()),this.restoreState(t))}beginUserChange(){this.isRestoring||(this.undoStack.push(this.snapshotState()),this.undoStack.length>this.HISTORY_LIMIT&&this.undoStack.shift(),this.redoStack=[])}copyAllToClipboard(){return te(this,null,function*(){let t=this.buildTsvExport();if(navigator.clipboard?.writeText){yield navigator.clipboard.writeText(t);return}let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}onShowSumColumnsChange(t){this.beginUserChange(),this.showSumColumns=!!t}onMaxTeoricoInput(t){this.beginUserChange(),this.maxTeorico=t,this.onLimitsChange()}onMaxPracticoInput(t){this.beginUserChange(),this.maxPractico=t,this.onLimitsChange()}onLimitsChange(){this.maxTeorico=this.clampInt(this.maxTeorico,1,100),this.maxPractico=this.clampInt(this.maxPractico,1,100);for(let t of this.rows){for(let e of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(t,e);this.recalcInPlace(t)}}onAvgEvalCountInput(t){this.beginUserChange(),this.avgEvalCount=t,this.onAvgEvalCountChange()}onAvgEvalCountChange(){this.avgEvalCount=this.clampInt(this.avgEvalCount,1,4);for(let t of this.rows)this.recalcInPlace(t)}setAllEvaluations(t){this.beginUserChange(),this.evalEnabled=[t,t,t,t]}onEvalEnabledChange(t,e){t<0||t>3||(this.beginUserChange(),this.evalEnabled[t]=!!e)}setViewMode(t){this.viewMode!==t&&(this.beginUserChange(),this.viewMode=t)}onCellFocus(t,e){this.activeRowIndex=t,this.activeColIndex=e}maxForKey(t){return this.isTeoricoKey(t)?this.maxTeorico:this.isPracticoKey(t)?this.maxPractico:t==="PruebaRecuperacion"?100:null}maxForColumn(t){if(t.kind!=="input")return null;let e=t.key;return this.isReadonlyKey(e)?null:this.maxForKey(e)}isColumnEditable(t){return this.isSumKey(t)?!1:this.isCellEditable(t)}isSumColumn(t){return this.isSumKey(t)}sumForColumn(t,e){let i=this.evalIndexFromColumnKey(e);return i===null?null:this.evalSum(t,i)}openPhoto(t){this.photoRow=t,this.photoModalOpen=!0}closePhoto(){this.photoModalOpen=!1,this.photoRow=null}photoUrlFor(t){return t?.fotoUrl??"assets/images/client6.png"}isCellEditable(t){if(this.isReadonlyKey(t))return!1;let e=this.evalIndexFromKey(t);return e!==null?!!this.evalEnabled[e-1]:!0}evalSum(t,e){let i=t[`Teorico${e}`],n=t[`Practico${e}`];return typeof i=="number"&&typeof n=="number"?i+n:null}isSumKey(t){return typeof t=="string"&&t.startsWith("Sum")}evalIndexFromColumnKey(t){if(this.isSumKey(t)){let e=Number(t.replace("Sum",""));return e>=1&&e<=4?e:null}return this.evalIndexFromKey(t)}cellTdClass(t,e,i){return{"eval-end":this.isEvaluationSeparator(i),"section-start":this.isSectionStart(i),"cell-danger":this.isDangerCell(t,i)}}headerThClass(t){return{"eval-end":this.isEvaluationSeparator(t),"section-start":this.isSectionStart(t)}}onCellValueInput(t,e,i){if(!this.isCellEditable(e)||this.isReadonlyKey(e))return;this.beginUserChange();let n=this.rows[t];n[e]=this.parseNullableInt(String(i??"").trim()),this.sanitizeCellValue(n,e),this.recalcInPlace(n),this.recomputeDirtyForRow(this.rows[t])}onPaste(t,e,i){let n=t.clipboardData?.getData("text/plain");n&&(t.preventDefault(),this.beginUserChange(),this.applyPaste(n,e,i))}onKeyDown(t,e,i){if(t.key!=="ArrowUp"&&t.key!=="ArrowDown"&&t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return;t.preventDefault();let n=this.keyToDelta(t.key),l=this.clamp(e+n.dr,0,this.rows.length-1),m=this.clamp(i+n.dc,0,this.columns.length-1);this.focusCell(l,m)}focusCell(t,e){this.activeRowIndex=t,this.activeColIndex=e,queueMicrotask(()=>{let i=document.querySelector(`[data-cell="${t}-${e}"]`);i?.focus(),i?.select()})}pasteHere(t){this.applyPaste(t,this.activeRowIndex,this.activeColIndex)}applyPaste(t,e,i){let n=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),l=this.trimEmptyTrailingLines(n);for(let m=0;m<l.length;m++){let f=e+m;if(f>=this.rows.length)break;let x=l[m].split("	");for(let T=0;T<x.length;T++){let y=i+T;if(y>=this.columns.length)break;let O=this.columns[y];if(O.readonly||O.kind==="sum"||this.isSumKey(O.key))continue;let V=x[T].trim(),k=O.key;if(!this.isCellEditable(k))continue;let B=this.parseNullableInt(V);this.rows[f][k]=B,this.sanitizeCellValue(this.rows[f],k)}this.recalcInPlace(this.rows[f]),this.recomputeDirtyForRow(this.rows[f])}}recalcInPlace(t){let e=this.findZeroCascadeIndex(t),i=t,n=!!i.__cascadeActive,l=i.__cascadeLockFrom??null;if(e!==null){n||(i.__cascadeBackup={1:{teo:t.Teorico1,prac:t.Practico1},2:{teo:t.Teorico2,prac:t.Practico2},3:{teo:t.Teorico3,prac:t.Practico3},4:{teo:t.Teorico4,prac:t.Practico4}}),i.__cascadeActive=!0,i.__cascadeLockFrom=e;for(let y=e;y<=4;y++)t[`Teorico${y}`]=0,t[`Practico${y}`]=0}else if(n){let y=i.__cascadeBackup,O=l??1;if(y)for(let V=O+1;V<=4;V++){let k=y[V];if(!k)continue;let B=t[`Teorico${V}`],ee=t[`Practico${V}`];typeof B=="number"&&typeof ee=="number"&&B===0&&ee===0&&(t[`Teorico${V}`]=k.teo,t[`Practico${V}`]=k.prac)}i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null}let m=e!==null,f=this.getAvgEvalIndices(),x=f.map(y=>t[`Teorico${y}`]),T=f.map(y=>t[`Practico${y}`]);if(t.PromTeorico=m?0:this.avg(x),t.PromPractico=m?0:this.avg(T),t.PromTeorico===null&&t.PromPractico===null)t.Promedio=null;else{let y=(t.PromTeorico??0)+(t.PromPractico??0);t.Promedio=Math.max(0,Math.min(100,Math.round(y)))}}avg(t){let e=t.filter(n=>typeof n=="number"&&Number.isFinite(n));if(e.length===0)return null;let i=e.reduce((n,l)=>n+l,0);return Math.round(i/e.length)}parseNullableInt(t){if(!t)return null;let e=t.replace(",","."),i=Number(e);return Number.isFinite(i)?Math.trunc(i):null}sanitizeCellValue(t,e){if(this.isReadonlyKey(e))return;let i=t[e];if(i==null||!Number.isFinite(i)){t[e]=null;return}let n=Math.trunc(i),l=this.maxForKey(e);l!==null&&(n=Math.min(n,l)),n=Math.max(n,0),t[e]=n}clampInt(t,e,i){let n=Number(t);return Number.isFinite(n)?Math.trunc(this.clamp(n,e,i)):e}getAvgEvalIndices(){let t=[];for(let e=1;e<=this.avgEvalCount;e++)t.push(e);return t}findZeroCascadeIndex(t){for(let e=1;e<=4;e=e+1){let i=t[`Teorico${e}`],n=t[`Practico${e}`];if(typeof i=="number"&&typeof n=="number"&&i===0&&n===0)return e}return null}buildTsvExport(){let t=[{key:"Teorico1",label:"Teo1"},{key:"Practico1",label:"Prac1"},{key:"Teorico2",label:"Teo2"},{key:"Practico2",label:"Prac2"},{key:"Teorico3",label:"Teo3"},{key:"Practico3",label:"Prac3"},{key:"Teorico4",label:"Teo4"},{key:"Practico4",label:"Prac4"},{key:"PromTeorico",label:"Prom Teo"},{key:"PromPractico",label:"Prom Prac"},{key:"Promedio",label:"Prom"},{key:"PruebaRecuperacion",label:"Recup"}],e=["Estudiante","Materia",...t.map(n=>n.label)].join("	"),i=this.rows.map(n=>{let l=t.map(m=>{let f=n[m.key];return f==null?"":String(f)});return[n.estudiante,n.materia,...l].join("	")});return[e,...i].join(`
`)}snapshotState(){return{maxTeorico:this.maxTeorico,maxPractico:this.maxPractico,avgEvalCount:this.avgEvalCount,viewMode:this.viewMode,evalEnabled:[...this.evalEnabled],showSumColumns:this.showSumColumns,rows:this.rows.map(t=>({id:t.id,Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion}))}}restoreState(t){this.isRestoring=!0;try{this.maxTeorico=t.maxTeorico,this.maxPractico=t.maxPractico,this.avgEvalCount=t.avgEvalCount,this.viewMode=t.viewMode,this.evalEnabled=[...t.evalEnabled],this.showSumColumns=!!t.showSumColumns;let e=new Map(t.rows.map(i=>[i.id,i]));for(let i of this.rows){let n=e.get(i.id);n&&(i.Teorico1=n.Teorico1,i.Teorico2=n.Teorico2,i.Teorico3=n.Teorico3,i.Teorico4=n.Teorico4,i.Practico1=n.Practico1,i.Practico2=n.Practico2,i.Practico3=n.Practico3,i.Practico4=n.Practico4,i.PruebaRecuperacion=n.PruebaRecuperacion,i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null,this.recalcInPlace(i),this.recomputeDirtyForRow(i))}}finally{this.isRestoring=!1}}isTeoricoKey(t){return t==="Teorico1"||t==="Teorico2"||t==="Teorico3"||t==="Teorico4"}isPracticoKey(t){return t==="Practico1"||t==="Practico2"||t==="Practico3"||t==="Practico4"}isReadonlyKey(t){return t==="PromTeorico"||t==="PromPractico"||t==="Promedio"}isEvaluationSeparator(t){if(this.viewMode==="intercalado"){let e=i=>this.showSumColumns?`Sum${i}`:`Practico${i}`;return this.visibleEvalCount>=1&&t===e(1)||this.visibleEvalCount>=2&&t===e(2)||this.visibleEvalCount>=3&&t===e(3)||this.visibleEvalCount>=4&&t===e(4)}return t===`Teorico${this.visibleEvalCount}`||t===`Practico${this.visibleEvalCount}`||this.showSumColumns&&t===`Sum${this.visibleEvalCount}`}isSectionStart(t){return t==="PromTeorico"}isDangerCell(t,e){let i=this.evalIndexFromColumnKey(e);if(i!==null){let n=t[`Teorico${i}`],l=t[`Practico${i}`];return typeof n=="number"&&typeof l=="number"?n+l<this.PASSING_SCORE:!1}return e==="PromTeorico"?t.PromTeorico===null?!1:t.PromTeorico*100<this.PASSING_SCORE*this.maxTeorico:e==="PromPractico"?t.PromPractico===null?!1:t.PromPractico*100<this.PASSING_SCORE*this.maxPractico:e==="Promedio"?t.Promedio!==null&&t.Promedio<this.PASSING_SCORE:e==="PruebaRecuperacion"?t.PruebaRecuperacion!==null&&t.PruebaRecuperacion<this.PASSING_SCORE:!1}evalIndexFromKey(t){switch(t){case"Teorico1":case"Practico1":return 1;case"Teorico2":case"Practico2":return 2;case"Teorico3":case"Practico3":return 3;case"Teorico4":case"Practico4":return 4;default:return null}}trimEmptyTrailingLines(t){let e=[...t];for(;e.length>0&&e[e.length-1].trim()==="";)e.pop();return e}keyToDelta(t){switch(t){case"ArrowUp":return{dr:-1,dc:0};case"ArrowDown":return{dr:1,dc:0};case"ArrowLeft":return{dr:0,dc:-1};case"ArrowRight":return{dr:0,dc:1};default:return{dr:0,dc:0}}}clamp(t,e,i){return Math.max(e,Math.min(i,t))}makeRow(t,e,i,n,l,m,f,x,T,y,O,V,k,B,ee){return{id:t,infoestudiantesifas_id:e,materias_id:i,estudiante:n,materia:l,fotoUrl:m,Teorico1:f,Teorico2:x,Teorico3:T,Teorico4:y,Practico1:O,Practico2:V,Practico3:k,Practico4:B,PromTeorico:null,PromPractico:null,Promedio:null,PruebaRecuperacion:ee}}};X.\u0275fac=function(e){return new(e||X)(P(Pe),P(We),P(fe),P(_e))},X.\u0275cmp=G({type:X,selectors:[["app-calificacionessolo"]],hostBindings:function(e,i){e&1&&g("keydown",function(l){return i.onGlobalKeyDown(l)},ne)},standalone:!1,decls:73,vars:34,consts:[["sumCell",""],[1,"container-fluid","py-2"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-2"],[1,"mb-0"],[1,"text-body-secondary"],[1,"d-flex","align-items-center","gap-2"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"input-group","input-group-sm",2,"width","380px"],[1,"input-group-text"],["placeholder","Apellido o nombre (min 2 letras)",1,"form-control",3,"ngModelChange","keydown.enter","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n inscripci\xF3n",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],["role","group","aria-label","Modo de visualizaci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn",3,"click"],[1,"d-flex","align-items-center","gap-1","small"],["type","number","min","1","max","100",1,"form-control","form-control-sm",2,"width","78px",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",2,"width","110px",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"form-check","small","mb-0"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label"],[1,"d-flex","align-items-center","gap-2","small"],["class","form-check form-check-inline mb-0",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],["class","row g-2 mb-2",4,"ngIf"],["class","alert alert-info py-2 mb-2",4,"ngIf"],["class","alert alert-warning py-2 mb-2",4,"ngIf"],["class","alert alert-danger py-2 mb-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2",4,"ngIf"],["class","table-responsive cali-grid-wrap",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","role","dialog","aria-modal","true",4,"ngIf"],["class","modal-backdrop fade show",3,"click",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n inscripci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"form-check","form-check-inline","mb-0"],[1,"row","g-2","mb-2"],[1,"col-12"],[1,"card"],[1,"card-body","py-2"],[1,"small","text-body-secondary","mb-2"],[4,"ngIf"],[1,"list-group","list-group-flush"],["type","button","class","list-group-item list-group-item-action py-2",3,"active","click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"list-group-item","list-group-item-action","py-2",3,"click"],[1,"fw-semibold"],[1,"small","opacity-75"],[1,"alert","alert-info","py-2","mb-2"],[1,"small","mb-1"],[1,"small"],[1,"alert","alert-warning","py-2","mb-2"],[1,"alert","alert-danger","py-2","mb-2"],[1,"small","text-body-secondary"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n calificaciones",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n calificaciones",1,"btn-group","btn-group-sm"],[1,"table-responsive","cali-grid-wrap"],[1,"table","table-sm","table-bordered","align-middle","cali-grid"],[1,"sticky-col","col-meta"],["class","text-center",3,"width","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center",3,"ngClass"],["class","text-body-secondary",4,"ngIf"],["class","table-secondary",4,"ngIf"],[1,"d-flex","align-items-start","justify-content-between","gap-2"],[1,"text-body-secondary","small"],["class","p-1",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-secondary"],[1,"p-1",3,"ngClass"],[4,"ngIf","ngIfElse"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center",3,"ngModelChange","focus","keydown","paste","readOnly","ngModel"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center","readonly-cell",3,"focus","keydown","paste","readOnly","value"],["tabindex","-1","role","dialog","aria-modal","true",1,"modal","fade","show","d-block"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"modal-body","text-center"],["alt","Foto del estudiante",1,"img-fluid","rounded",3,"src"],[1,"text-body-secondary","small","mt-2"],[1,"modal-backdrop","fade","show",3,"click"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h5",3),c(4,"Editor de calificaciones (BD) tipo Excel"),r(),o(5,"small",4),c(6," Edita directo en celdas. Puedes copiar desde Excel y pegar (Ctrl+V) dentro de una celda; soporta pegar bloques (tab + saltos de l\xEDnea). "),r()(),o(7,"div",5)(8,"div",6)(9,"div",7)(10,"span",8),c(11,"Buscar inscripci\xF3n"),r(),o(12,"input",9),g("ngModelChange",function(l){return i.filterInfo=l})("keydown.enter",function(){return i.buscarInfo(1)}),r(),o(13,"button",10),g("click",function(){return i.buscarInfo(1)}),c(14," Buscar "),r()(),h(15,Ze,5,2,"div",11),o(16,"button",12),g("click",function(){return i.limpiarInfo()}),c(17," Limpiar "),r()(),o(18,"div",13)(19,"button",14),g("click",function(){return i.setViewMode("intercalado")}),c(20," Intercalado (Eval1..4) "),r(),o(21,"button",14),g("click",function(){return i.setViewMode("agrupado")}),c(22," Agrupado (Teo/Prac) "),r()(),o(23,"div",6)(24,"div",15)(25,"span",4),c(26,"L\xEDmite Teo"),r(),o(27,"input",16),g("ngModelChange",function(l){return i.onMaxTeoricoInput(l)}),r()(),o(28,"div",15)(29,"span",4),c(30,"L\xEDmite Prac"),r(),o(31,"input",16),g("ngModelChange",function(l){return i.onMaxPracticoInput(l)}),r()(),o(32,"div",6)(33,"div",15)(34,"span",4),c(35,"Promedio usa"),r(),o(36,"select",17),g("ngModelChange",function(l){return i.onAvgEvalCountInput(l)}),o(37,"option",18),c(38,"1 eval"),r(),o(39,"option",18),c(40,"2 eval"),r(),o(41,"option",18),c(42,"3 eval"),r(),o(43,"option",18),c(44,"4 eval"),r()()()()(),o(45,"div",6)(46,"label",19)(47,"input",20),g("ngModelChange",function(l){return i.onShowSumColumnsChange(l)}),r(),o(48,"span",21),c(49,"Mostrar sumas"),r()(),o(50,"div",22)(51,"span",4),c(52,"Evaluaciones"),r(),h(53,Je,4,1,"label",23)(54,et,4,1,"label",23)(55,tt,4,1,"label",23)(56,it,4,1,"label",23),r(),o(57,"button",24),g("click",function(){return i.setAllEvaluations(!0)}),c(58," Todas "),r()(),o(59,"button",12),g("click",function(){return i.focusCell(0,0)}),c(60," Ir a primera celda "),r(),o(61,"button",25),g("click",function(){return i.copyAllToClipboard()}),c(62," Copiar todo "),r(),o(63,"button",26),g("click",function(){return i.guardarCambios()}),c(64," Guardar cambios "),r()()(),h(65,at,9,4,"div",27)(66,lt,17,0,"div",28)(67,dt,4,2,"div",29)(68,ut,3,1,"div",30)(69,_t,17,6,"div",31)(70,yt,9,4,"div",32)(71,St,11,3,"div",33)(72,Et,1,0,"div",34),r()),e&2&&(s(12),u("ngModel",i.filterInfo),s(),u("disabled",i.isLoadingInfo),s(2),u("ngIf",i.infoMeta),s(),u("disabled",!i.selectedInfo),s(3),N("btn-primary",i.viewMode==="intercalado")("btn-outline-primary",i.viewMode!=="intercalado"),s(2),N("btn-primary",i.viewMode==="agrupado")("btn-outline-primary",i.viewMode!=="agrupado"),s(6),u("ngModel",i.maxTeorico),s(4),u("ngModel",i.maxPractico),s(5),u("ngModel",i.avgEvalCount),s(),u("ngValue",1),s(2),u("ngValue",2),s(2),u("ngValue",3),s(2),u("ngValue",4),s(4),u("ngModel",i.showSumColumns),s(6),u("ngIf",i.visibleEvalCount>=1),s(),u("ngIf",i.visibleEvalCount>=2),s(),u("ngIf",i.visibleEvalCount>=3),s(),u("ngIf",i.visibleEvalCount>=4),s(3),u("disabled",i.rows.length===0),s(4),u("disabled",!i.selectedInfo||i.dirtyIds.size===0||i.isSaving),s(2),u("ngIf",i.infoItems.length>0),s(),u("ngIf",!i.selectedInfo),s(),u("ngIf",i.selectedInfo&&(i.isLoadingCalificaciones||i.isSaving)),s(),u("ngIf",i.saveError),s(),u("ngIf",i.selectedInfo),s(),u("ngIf",i.selectedInfo),s(),u("ngIf",i.photoModalOpen),s(),u("ngIf",i.photoModalOpen))},dependencies:[ce,K,j,H,Q,U,pe,de,z,$,Fe,Le,W],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.cali-grid-wrap[_ngcontent-%COMP%]{max-height:calc(100vh - 220px)}.cali-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:3;background:var(--bs-body-bg)}.col-meta[_ngcontent-%COMP%]{min-width:240px;background:inherit}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.col-meta[_ngcontent-%COMP%]{background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bs-table-active-bg)}.cali-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.readonly-cell[_ngcontent-%COMP%]{background:#0000000a}.cali-grid[_ngcontent-%COMP%]   td.eval-end[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.eval-end[_ngcontent-%COMP%]{border-right-width:3px;border-right-style:solid;border-right-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.section-start[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.section-start[_ngcontent-%COMP%]{border-left-width:3px;border-left-style:solid;border-left-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{color:var(--bs-danger);font-weight:600}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control.readonly-cell[_ngcontent-%COMP%]{color:var(--bs-danger)}.cali-grid[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{border-radius:0}']});var he=X;var wt=["modalgestioncontroles"];function Pt(a,t){if(a&1&&(o(0,"option",25),c(1),r()),a&2){let e=t.$implicit;u("value",e),s(),b(e)}}function Tt(a,t){a&1&&(o(0,"div",29),c(1," Cargando controles... "),r())}function Mt(a,t){if(a&1&&(o(0,"div",49),c(1),r()),a&2){let e=d().$implicit,i=d(3).$implicit,n=d(3);s(),se(" ",n.labelEdadesCategoria(i),": ",e.Edades||"-"," ")}}function Vt(a,t){if(a&1&&(o(0,"span",49),c(1),r()),a&2){let e=d().$implicit,i=d(6);s(),S("Instituci\xF3n: ",i.getNombreInstitucion(e)||(e.instituciones_id??"GLOBAL"))}}function At(a,t){a&1&&(o(0,"span",49),c(1,"|"),r())}function Ot(a,t){if(a&1){let e=v();o(0,"div",44)(1,"div",45)(2,"div",46),c(3),r(),h(4,Mt,2,2,"div",47)(5,Vt,2,1,"span",47)(6,At,2,0,"span",47),o(7,"div",48)(8,"span",49),c(9,"Estado:"),r(),o(10,"button",50),g("click",function(n){let l=p(e).$implicit,m=d(6);return _(m.toggleEstadoFila(l,n))}),c(11),r(),o(12,"span",49),c(13,"|"),r(),o(14,"span",49),c(15,"Visibilidad:"),r(),o(16,"button",51),g("click",function(n){let l=p(e).$implicit,m=d(6);return _(m.toggleVisibilidadFila(l,n))}),c(17),r()()(),o(18,"div",52)(19,"button",53),g("click",function(){let n=p(e).$implicit,l=d(6);return _(l.Seleccionarcontroles(n.id))}),c(20,"Editar"),r(),o(21,"button",54),g("click",function(){let n=p(e).$implicit,l=d(6);return _(l.Eliminarcontroles(n.id))}),c(22,"Eliminar"),r()()()}if(a&2){let e=t.$implicit,i=d(3).$implicit,n=d(3);s(3),b(e.ParaI),s(),u("ngIf",n.showEdadesCategoria(i)),s(),u("ngIf",n.esSuperlcchs),s(),u("ngIf",n.esSuperlcchs),s(4),u("ngClass",e.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(e.id)),s(),S(" ",e.Estado," "),s(5),u("ngClass",e.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(e.id)),s(),S(" ",e.Visibilidad," ")}}function kt(a,t){if(a&1&&(o(0,"div",42),h(1,Ot,23,10,"div",43),r()),a&2){let e=d().ngIf;s(),u("ngForOf",e)}}function Nt(a,t){a&1&&(o(0,"div",55),c(1,"Sin datos"),r())}function Rt(a,t){if(a&1){let e=v();o(0,"div",34)(1,"div",35)(2,"div",36)(3,"h4",37),c(4),r()(),o(5,"div",38),c(6),r(),o(7,"button",39),g("click",function(){p(e);let n=d().$implicit,l=d(3);return _(l.abrirNuevoPorCategoria(n))}),c(8," Nuevo "),r()(),o(9,"div",40),h(10,kt,2,1,"div",41)(11,Nt,2,0,"ng-template",null,1,L),r()()}if(a&2){let e=t.ngIf,i=J(12),n=d().$implicit;s(4),S("",n," "),s(2),S(" ",e.length," item(s) "),s(4),u("ngIf",e.length>0)("ngIfElse",i)}}function Lt(a,t){if(a&1&&(o(0,"div",32),h(1,Rt,13,4,"div",33),r()),a&2){let e=t.$implicit,i=d(3);s(),u("ngIf",i.getControlesPorCategoria(e))}}function Ft(a,t){if(a&1&&(o(0,"div",30),h(1,Lt,2,1,"div",31),r()),a&2){let e=d(2);s(),u("ngForOf",e.categoriasParaMostrar)}}function Dt(a,t){if(a&1&&(o(0,"div",26),h(1,Tt,2,0,"div",27)(2,Ft,2,1,"div",28),r()),a&2){let e=d();s(),u("ngIf",e.isLoadingcontroles),s(),u("ngIf",!e.isLoadingcontroles)}}function Bt(a,t){a&1&&(o(0,"th",67),c(1,"NombreInstitucion"),r())}function Gt(a,t){if(a&1&&(o(0,"tr")(1,"td",59)(2,"div",68)(3,"span",69),c(4,"Cargando..."),r()()()()),a&2){let e=d(2);s(),R("colspan",e.esSuperlcchs?9:8)}}function Kt(a,t){if(a&1&&(o(0,"tr")(1,"td",59),c(2,"No hay datos disponibles"),r()()),a&2){let e=d(2);s(),R("colspan",e.esSuperlcchs?9:8)}}function jt(a,t){if(a&1&&(o(0,"td"),c(1),r()),a&2){let e=d().$implicit,i=d(2);s(),b(i.getNombreInstitucion(e))}}function Ut(a,t){if(a&1&&C(0,"img",76),a&2){let e=d(3);u("src",e._tools.rutabtniconsanimaciones+"pencil.svg",Z)}}function $t(a,t){if(a&1&&C(0,"ng-lottie",77),a&2){let e=d(3);u("options",e._tools.optionsEditar)}}function Wt(a,t){if(a&1&&C(0,"img",76),a&2){let e=d(3);u("src",e._tools.rutabtniconsanimaciones+"delete.svg",Z)}}function zt(a,t){if(a&1&&C(0,"ng-lottie",77),a&2){let e=d(3);u("options",e._tools.optionsEliminar)}}function Ht(a,t){if(a&1){let e=v();o(0,"tr",70),g("contextmenu",function(n){let l=p(e).$implicit,m=d(2);return _(m.abrirMenucontroles(n,l))}),o(1,"td",59),c(2),r(),o(3,"td"),c(4),r(),h(5,jt,2,1,"td",62),o(6,"td"),c(7),r(),o(8,"td"),c(9),r(),o(10,"td"),c(11),r(),o(12,"td")(13,"button",50),g("click",function(n){let l=p(e).$implicit,m=d(2);return _(m.toggleEstadoFila(l,n))}),c(14),r()(),o(15,"td")(16,"button",51),g("click",function(n){let l=p(e).$implicit,m=d(2);return _(m.toggleVisibilidadFila(l,n))}),c(17),r()(),o(18,"td",71)(19,"button",72),g("click",function(){let n=p(e).$implicit,l=d(2);return _(l.Seleccionarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,l=d(2);return _(l._tools.hoverBotonMap["edicioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,l=d(2);return _(l._tools.hoverBotonMap["edicioncontroles-"+n.id]=!1)}),h(20,Ut,1,1,"img",73)(21,$t,1,1,"ng-lottie",74),r(),o(22,"button",75),g("click",function(){let n=p(e).$implicit,l=d(2);return _(l.Eliminarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,l=d(2);return _(l._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,l=d(2);return _(l._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!1)}),h(23,Wt,1,1,"img",73)(24,zt,1,1,"ng-lottie",74),r()()()}if(a&2){let e=t.index,i=t.$implicit,n=d(2);s(2),b((n.paginacontroles-1)*n.pageSizecontroles+(e+1)),s(2),b(i.instituciones_id??"GLOBAL"),s(),u("ngIf",n.esSuperlcchs),s(2),b(i.Categoria),s(2),b(i.ParaI),s(2),b(i.Edades),s(2),u("ngClass",i.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(i.id)),s(),S(" ",i.Estado," "),s(2),u("ngClass",i.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(i.id)),s(),S(" ",i.Visibilidad," "),s(3),u("ngIf",!n._tools.hoverBotonMap["edicioncontroles-"+i.id]),s(),u("ngIf",n._tools.hoverBotonMap["edicioncontroles-"+i.id]),s(2),u("ngIf",!n._tools.hoverBotonMap["eliminacioncontroles-"+i.id]),s(),u("ngIf",n._tools.hoverBotonMap["eliminacioncontroles-"+i.id])}}function Qt(a,t){if(a&1&&(o(0,"option",25),c(1),r()),a&2){let e=t.$implicit;u("value",e),s(),S("",e," por p\xE1gina")}}function Xt(a,t){if(a&1){let e=v();o(0,"div",26)(1,"div",56)(2,"table",57)(3,"thead",58)(4,"tr")(5,"th",59),c(6,"#"),r(),o(7,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("instituciones_id",n))}),c(8,"Instituci\xF3n"),r(),h(9,Bt,2,0,"th",61),o(10,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("Categoria",n))}),c(11,"Categoria"),r(),o(12,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("ParaI",n))}),c(13,"ParaI"),r(),o(14,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("Edades",n))}),c(15,"Edades"),r(),o(16,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("Estado",n))}),c(17,"Estado"),r(),o(18,"th",60),g("click",function(n){p(e);let l=d();return _(l.sortBycontroles("Visibilidad",n))}),c(19,"Visibilidad"),r(),o(20,"th",59),c(21,"ACCIONES"),r()()(),o(22,"tbody"),h(23,Gt,5,1,"tr",62)(24,Kt,3,1,"tr",62)(25,Ht,25,16,"tr",63),Me(26,"slice"),r()()(),o(27,"div",64)(28,"ngb-pagination",65),w("pageChange",function(n){p(e);let l=d();return I(l.paginacontroles,n)||(l.paginacontroles=n),_(n)}),r(),o(29,"select",66),w("ngModelChange",function(n){p(e);let l=d();return I(l.pageSizecontroles,n)||(l.pageSizecontroles=n),_(n)}),g("change",function(){p(e);let n=d();return _(n.onPageSizeChangecontroles())}),h(30,Qt,2,2,"option",23),r()()()}if(a&2){let e=d();s(9),u("ngIf",e.esSuperlcchs),s(14),u("ngIf",e.isLoadingcontroles),s(),u("ngIf",!e.isLoadingcontroles&&(!e.controles||e.controles.length===0)),s(),u("ngForOf",Ve(26,13,e.controlesFiltrados,(e.paginacontroles-1)*e.pageSizecontroles,e.paginacontroles*e.pageSizecontroles)),s(3),E("page",e.paginacontroles),u("collectionSize",e.controlesFiltrados.length)("pageSize",e.pageSizecontroles)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0),s(),E("ngModel",e.pageSizecontroles),s(),u("ngForOf",e.pageSizeOptionscontroles)}}function qt(a,t){if(a&1&&(o(0,"option",97),c(1),r()),a&2){let e=t.$implicit;u("ngValue",e.id),s(),b(e.Nombre)}}function Yt(a,t){if(a&1&&(o(0,"div",84)(1,"select",96)(2,"option",97),c(3,"GLOBAL"),r(),h(4,qt,2,2,"option",98),r(),o(5,"label"),c(6,"Instituci\xF3n"),r()()),a&2){let e=d(2);s(2),u("ngValue",""),s(2),u("ngForOf",e.institucionesInfo)}}function Zt(a,t){if(a&1&&(o(0,"option",25),c(1),r()),a&2){let e=t.$implicit;u("value",e),s(),b(e)}}function Jt(a,t){if(a&1&&(o(0,"div",84),C(1,"input",99),o(2,"label"),c(3),r()()),a&2){let e=d(2);s(3),b(e.labelNivelCurso)}}function ei(a,t){if(a&1&&(o(0,"div",84),C(1,"input",100),o(2,"label"),c(3),r()()),a&2){let e=d(2);s(3),b(e.labelEdades)}}function ti(a,t){if(a&1&&(o(0,"option",25),c(1),r()),a&2){let e=t.$implicit;u("value",e),s(),b(e)}}function ii(a,t){if(a&1&&(o(0,"option",25),c(1),r()),a&2){let e=t.$implicit;u("value",e),s(),b(e)}}function ni(a,t){if(a&1){let e=v();o(0,"button",103),g("click",function(){p(e);let n=d(3);return _(n.AutoCompletarLastcontroles())}),o(1,"span",104),C(2,"ng-lottie",105),r(),o(3,"span"),c(4,"AUTO COMPLETAR "),r(),C(5,"span",10),r()}if(a&2){let e=d(3);s(2),u("options",e._tools.optionsautocompletar)}}function oi(a,t){if(a&1&&(o(0,"div",101),h(1,ni,6,1,"button",102),r()),a&2){let e=d(2);s(),u("ngIf",!e.AnimacionCargabtnModalcontroles)}}function ri(a,t){if(a&1){let e=v();o(0,"button",106),g("click",function(){p(e);let n=d().$implicit,l=d();return n.dismiss(),_(l.resetcontroles())}),o(1,"span",104),C(2,"ng-lottie",105),r(),o(3,"span"),c(4,"CANCELAR"),r(),C(5,"span",10),r()}if(a&2){let e=d(2);s(2),u("options",e._tools.optionscancelar)}}function ai(a,t){if(a&1){let e=v();o(0,"button",107),g("click",function(){p(e);let n=d(2);return _(n.AgregarModificarcontroles())}),C(1,"span",108),r()}a&2&&u("disabled",!0)}function li(a,t){if(a&1){let e=v();o(0,"button",109),g("click",function(){p(e);let n=d(2);return _(n.AgregarModificarcontroles())}),o(1,"span",104),C(2,"ng-lottie",105),r(),o(3,"span"),c(4),r(),C(5,"span",10),r()}if(a&2){let e,i,n=d(2);s(2),u("options",(e=n.newcontroles.get("id"))!=null&&e.value?n._tools.optionsEditar:n._tools.optionsAdicionar),s(2),b((i=n.newcontroles.get("id"))!=null&&i.value?"MODIFICAR":"REGISTRAR")}}function si(a,t){if(a&1){let e=v();o(0,"div",78)(1,"h4",79),c(2),r(),o(3,"button",80),g("click",function(){let n=p(e).$implicit,l=d();return n.dismiss(),_(l.resetcontroles())}),r()(),o(4,"div",81)(5,"form",82),h(6,Yt,7,2,"div",83),o(7,"div",84)(8,"select",85)(9,"option",22),c(10,"SELECCIONE"),r(),h(11,Zt,2,2,"option",23),r(),o(12,"label"),c(13,"Categoria"),r()(),o(14,"div",84),C(15,"input",86),o(16,"label"),c(17),r()(),h(18,Jt,4,1,"div",83)(19,ei,4,1,"div",83),o(20,"div",84)(21,"select",87),h(22,ti,2,2,"option",23),r(),o(23,"label"),c(24,"Estado"),r()(),o(25,"div",84)(26,"select",88),h(27,ii,2,2,"option",23),r(),o(28,"label"),c(29,"Visibilidad"),r()()()(),o(30,"div",89),h(31,oi,2,1,"div",90),o(32,"div",91),h(33,ri,6,1,"button",92),r(),o(34,"div",93),h(35,ai,2,1,"button",94)(36,li,6,2,"button",95),r()()}if(a&2){let e,i=d();s(2),S("",(e=i.newcontroles.get("id"))!=null&&e.value?"Modificar":"Registrar"," control"),s(3),u("formGroup",i.newcontroles),s(),u("ngIf",i.esSuperlcchs),s(5),u("ngForOf",i.categoriasOptionsForm),s(6),b(i.labelParaI),s(),u("ngIf",i.showNivelCurso),s(),u("ngIf",i.showEdades),s(3),u("ngForOf",i.estadoOptions),s(5),u("ngForOf",i.visibilidadOptions),s(4),u("ngIf",!i.newcontroles.get("id").value),s(2),u("ngIf",!i.AnimacionCargabtnModalcontroles),s(2),u("ngIf",i.AnimacionCargabtnModalcontroles),s(),u("ngIf",!i.AnimacionCargabtnModalcontroles)}}var q=class q{constructor(t,e,i,n){this._cont=t;this._tools=e;this._auth=i;this._inst=n;this.esSuperlcchs=!1;this.esAdministrativo=!1;this.institucionesIdSesion=null;this.institucionesInfo=[];this.institucionesById=new Map;this.estadoOptions=["ACTIVO","INACTIVO"];this.visibilidadOptions=["VISIBLE","OCULTO"];this.categoriasGlobales=["CARGOS SUPERADMINISTRATIVOS","PERMISO","ESTADO","VISIBILIDAD","SEXO","CARACTER\xCDSTICAS DE INSTITUCI\xD3N","EDICI\xD3N DE INSCRIPCIONES","EDICI\xD3N DE CALIFICACIONES","PREDETERMINADO","TIPOS SUPERADMINISTRATIVOS","TIPOS PLANTEL ADMINISTRATIVOS","TIPOS DOCENTES","ESTADO DE HABILITACI\xD3N","TIPOS MATERIAS","MODOS MATERIAS","RELACI\xD3N DOCENTE ESTUDIANTES","PROGRAMA","MODALIDAD","TIPO DE ESTUDIANTE"];this.categoriasPorInstitucion=["CARGOS ADMINISTRATIVOS","CARGOS DOCENTES","NIVEL DE CARRERA","ESPECIALIDAD","ESPECIALIDAD SECUNDARIA","LVLCURSO","NIVEL EN COLEGIO","GRADO DE COLEGIO","TIPO COLEGIO","TIPO REGISTRO DE MATERIA","ESTADO PAGO","EXPEDIDO","TURNO","VERIFICACI\xD3N INSCRIPCIONES"];this.togglingEstadoIds=new Set;this.togglingVisibilidadIds=new Set;this.viewMode="interactive";this.categoriaFiltro="";this.menuStatecontroles$=this._tools.state$;this.controles=[];this.paginacontroles=1;this.isLoadingcontroles=!0;this.AnimacionCargabtnModalcontroles=!1;this.filtertxtcontroles="";this.collectionSizecontroles=0;this.pageSizecontroles=10;this.pageSizeOptionscontroles=[5,10,20,50];this.sortColumnscontroles=[]}get categoriasOptions(){return this.esSuperlcchs?[...this.categoriasGlobales,...this.categoriasPorInstitucion]:[...this.categoriasPorInstitucion]}get categoriasOptionsForm(){return this.categoriasOptions}ngOnInit(){this.newcontroles=this._cont.createFormGroupcontroles(),this.newcontrolesAnteriorAccion=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this.cargarSesionYPermisos()}cargarSesionYPermisos(){this._auth.pedirPerfil().subscribe({next:t=>{let e=(t?.tipo??"").toString().toLowerCase();this.esSuperlcchs=e==="superlcchs",this.esAdministrativo=e==="planteladministrativos";let i=Number(t?.usuario?.instituciones_id??0);this.institucionesIdSesion=Number.isFinite(i)&&i>0?i:null,this.applyCategoriaRules(),this.esSuperlcchs&&this._inst.Obtenerinstituciones().subscribe({next:n=>{this.institucionesInfo=n?.data||[],this.institucionesById=new Map((this.institucionesInfo||[]).map(l=>[String(l?.id??""),l]))},error:()=>{this.institucionesInfo=[],this.institucionesById=new Map}}),this.Cargarcontroles()},error:()=>{this.esSuperlcchs=!1,this.esAdministrativo=!1,this.institucionesIdSesion=null,this.applyCategoriaRules(),this.Cargarcontroles()}})}upperTrim(t){return(t??"").toString().trim().toUpperCase()}isCategoriaGlobal(t){return this.categoriasGlobales.includes(t)}puedeEditarFila(t){if(this.esSuperlcchs)return!0;let e=Number(this.institucionesIdSesion??0),i=Number(t?.instituciones_id??0);return e>0&&i===e}getNombreInstitucion(t){let e=(t?.NombreInstitucion??t?.nombre_institucion??t?.institucion_nombre??"").toString().trim();if(e)return e;let i=String(t?.instituciones_id??""),n=this.institucionesById.get(i);return(n?.Nombre??n?.nombre??"").toString().trim()}get categoriaActual(){return this.upperTrim(this.newcontroles?.get("Categoria")?.value)}get categoriaFiltroActual(){return this.upperTrim(this.categoriaFiltro)}get categoriasParaMostrar(){let t=this.categoriaFiltroActual;return t?this.categoriasOptions.filter(e=>this.upperTrim(e)===t):this.categoriasOptions}get showEdades(){return this.categoriaActual==="LVLCURSO"||this.categoriaActual==="TURNO"}categoriaUsaNivelCurso(t){let e=this.upperTrim(t);return e==="TIPOS DOCENTES"||e==="MODOS MATERIAS"||e==="RELACI\xD3N DOCENTE ESTUDIANTES"}get showNivelCurso(){let t=this.categoriaActual,e=(this.newcontroles?.get("NivelCurso")?.value??"").toString().trim();return this.categoriaUsaNivelCurso(t)||e.length>0}get labelNivelCurso(){switch(this.categoriaActual){case"TIPOS DOCENTES":case"MODOS MATERIAS":case"RELACI\xD3N DOCENTE ESTUDIANTES":return"Detalle";default:return"NivelCurso"}}get labelEdades(){return this.categoriaActual==="TURNO"?"Horas":"Edades"}get labelParaI(){switch(this.categoriaActual){case"LVLCURSO":return"Nivel/Curso";case"TURNO":return"Turno";case"EXPEDIDO":return"Sigla";default:return"Valor"}}applyCategoriaRules(){let t=this.categoriaActual;t&&this.newcontroles.get("Categoria")?.value!==t&&this.newcontroles.get("Categoria")?.setValue(t,{emitEvent:!1});let e=this.upperTrim(this.newcontroles.get("Estado")?.value);this.estadoOptions.includes(e)||this.newcontroles.get("Estado")?.setValue("ACTIVO",{emitEvent:!1});let i=this.upperTrim(this.newcontroles.get("Visibilidad")?.value);this.visibilidadOptions.includes(i)||this.newcontroles.get("Visibilidad")?.setValue("VISIBLE",{emitEvent:!1});let n=this.newcontroles.get("instituciones_id");n&&(this.esSuperlcchs?t&&this.isCategoriaGlobal(t)?(n.setValue("",{emitEvent:!1}),n.disable({emitEvent:!1})):n.enable({emitEvent:!1}):(this.institucionesIdSesion&&n.setValue(this.institucionesIdSesion,{emitEvent:!1}),n.disable({emitEvent:!1}))),this.showEdades||this.newcontroles.get("Edades")?.setValue("",{emitEvent:!1}),this.showNivelCurso||this.newcontroles.get("NivelCurso")?.setValue("",{emitEvent:!1})}buildPayloadFromForm(){let t=this.newcontroles.getRawValue(),e=Ie({},t);return delete e.created_at,delete e.updated_at,this.showEdades||(e.Edades=""),this.showNivelCurso||(e.NivelCurso=""),e}setViewMode(t){this.viewMode=t,this.paginacontroles=1}onCategoriaFiltroChange(){this.paginacontroles=1}get controlesFiltrados(){let t=this.categoriaFiltroActual,e=this.upperTrim(this.filtertxtcontroles);return(this.controles||[]).filter(i=>{if(t&&this.upperTrim(i?.Categoria)!==t)return!1;if(!e)return!0;let n=[i?.instituciones_id,i?.Categoria,i?.ParaI,i?.Edades,i?.Estado,i?.Visibilidad].map(l=>(l??"").toString()).join(" ");return this.upperTrim(n).includes(e)})}getControlesPorCategoria(t){let e=this.upperTrim(t);return this.controlesFiltrados.filter(i=>this.upperTrim(i?.Categoria)===e)}labelEdadesCategoria(t){return this.upperTrim(t)==="TURNO"?"Horas":"Edades"}showEdadesCategoria(t){let e=this.upperTrim(t);return e==="LVLCURSO"||e==="TURNO"}abrirNuevoPorCategoria(t){this.resetcontroles();let e=this.upperTrim(t);e&&(this.newcontroles.get("Categoria")?.setValue(e),this.applyCategoriaRules()),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl")}isTogglingEstado(t){return this.togglingEstadoIds.has(Number(t))}isTogglingVisibilidad(t){return this.togglingVisibilidadIds.has(Number(t))}toggleEstadoFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingEstadoIds.has(i))return;let n=this.upperTrim(t?.Estado),l=n==="ACTIVO"?"INACTIVO":"ACTIVO";this.togglingEstadoIds.add(i),t.Estado=l,this._cont.Modificarcontroles({id:i,Estado:l},i).subscribe({next:m=>{t.Estado=this.upperTrim(m?.data?.Estado??l)},error:m=>{console.error("Error toggling Estado",m),t.Estado=n},complete:()=>{this.togglingEstadoIds.delete(i)}})}toggleVisibilidadFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingVisibilidadIds.has(i))return;let n=this.upperTrim(t?.Visibilidad),l=n==="VISIBLE"?"OCULTO":"VISIBLE";this.togglingVisibilidadIds.add(i),t.Visibilidad=l,this._cont.Modificarcontroles({id:i,Visibilidad:l},i).subscribe({next:m=>{t.Visibilidad=this.upperTrim(m?.data?.Visibilidad??l)},error:m=>{console.error("Error toggling Visibilidad",m),t.Visibilidad=n},complete:()=>{this.togglingVisibilidadIds.delete(i)}})}setupCategoriaWatcher(){this.categoriaSub&&(this.categoriaSub.unsubscribe(),this.categoriaSub=void 0),this.categoriaSub=this.newcontroles.get("Categoria")?.valueChanges.subscribe(()=>{this.applyCategoriaRules()}),this.applyCategoriaRules()}closeMenu(){this._tools.close()}abrirMenucontroles(t,e){t.preventDefault(),t.stopPropagation();let i=[{label:"\u270F Editar",action:()=>this.Seleccionarcontroles(e.id)},{label:"\u{1F5D1}\uFE0F Eliminar",action:()=>this.Eliminarcontroles(e.id)}];this._tools.open(t.clientX,t.clientY,i)}Cargarcontroles(){this.isLoadingcontroles=!0,this._cont.Obtenercontroles().subscribe({next:t=>{let e=t.data||[];if(!this.esSuperlcchs&&this.institucionesIdSesion){let i=Number(this.institucionesIdSesion);this.controles=e.filter(n=>Number(n?.instituciones_id??0)===i)}else this.esSuperlcchs?this.controles=e:this.controles=[];this.collectionSizecontroles=this.controles.length,this.isLoadingcontroles=!1},error:t=>{console.error("Error al cargar controles",t),this.controles=[],this.collectionSizecontroles=0,this.isLoadingcontroles=!1}})}AgregarModificarcontroles(){if(this.newcontroles.invalid){this.ValidacionTodoElementocontroles(),this._tools.MostrarMensajeFrmIncompleto(),this.AnimacionCargabtnModalcontroles=!1;return}this.AnimarCargaTablacontroles(),this.AnimacionCargabtnModalcontroles=!0,this._tools.MostrarMensajeLoading(),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue());let t=this.newcontroles.controls.id.value,e=this.buildPayloadFromForm();t?this._cont.Modificarcontroles(e,e.id).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL MODIFICAR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()}):this._cont.Agregarcontroles(e).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL A\xD1ADIR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()})}Seleccionarcontroles(t){if(this._tools.MostrarMensajeLoading(),!t)return;let e=this.controles.find(i=>i.id===t);if(e){if(!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._cont.Seleccionarcontroles(t).subscribe(i=>{Object.keys(this.newcontroles.controls).forEach(n=>{this.newcontroles.controls[n].setValue(i.data[n])}),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue()),this.applyCategoriaRules(),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl"),this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL SELECCIONAR controles",i),this._tools.MostrarMensajeError()})}}Eliminarcontroles(t){let e=this.controles.find(i=>i.id===t);if(e&&!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._tools.mostrarMensajeConfirm("\xBFSEGURO QUE DESEA ELIMINAR?","SE ELIMINARA EL DATO Y NO SE PODR\xC1 RECUPERAR EL DATO","warning","SI, ESTOY SEGURO","NO").then(i=>{i&&(this._tools.MostrarMensajeLoading(),this._cont.Eliminarcontroles(t).subscribe(n=>{this.Cargarcontroles(),this._tools.MostrarMensajeSuccess()},n=>{console.log("ERROR AL ELIMINAR controles",n),this._tools.MostrarMensajeError()}))})}resetcontroles(){this.newcontroles=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this._tools.closeModal(this.modalGestioncontrolesRef)}AutoCompletarLastcontroles(){this.newcontroles.patchValue(this.newcontrolesAnteriorAccion.getRawValue()),this.newcontroles.patchValue({id:0})}AnimarCargaTablacontroles(){this.controles=[],this.isLoadingcontroles=!0}ValidacioncontrolesxElemento(t){return this._tools.obtenerValidationClass(this.newcontroles,t)}ValidacionTodoElementocontroles(){Object.values(this.newcontroles.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()})}onPageSizeChangecontroles(){this.paginacontroles=1}sortBycontroles(t,e){this.sortColumnscontroles=this._tools.handleSort(t,e,this.sortColumnscontroles),this.controles=this._tools.applyMultiSort(this.controles,this.sortColumnscontroles)}isSortedcontroles(t){return this._tools.isSorted(this.sortColumnscontroles,t)}getSortDircontroles(t){return this._tools.getSortDirection(this.sortColumnscontroles,t)}};q.\u0275fac=function(e){return new(e||q)(P(Ke),P(ge),P(_e),P(De))},q.\u0275cmp=G({type:q,selectors:[["app-controles"]],viewQuery:function(e,i){if(e&1&&re(wt,7),e&2){let n;ae(n=le())&&(i.modalgestioncontroles=n.first)}},hostBindings:function(e,i){e&1&&g("click",function(){return i.closeMenu()},ne)},standalone:!1,decls:41,vars:11,consts:[["modalgestioncontroles",""],["emptyCat",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"button","col-sm-3","d-flex","justify-content-start"],[1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"],["width","30px","height","30px",3,"options"],[1,"dir-part"],[1,"col-sm-3","ms-auto","d-flex","justify-content-end"],[1,"input-group"],[1,"input-group-text"],[1,"form-floating"],["type","text","placeholder","Buscar","title","Filtrar/Buscar",1,"form-control",3,"input","ngModelChange","ngModel"],[1,"row","mt-3","align-items-end",2,"row-gap","10px"],[1,"col-sm-4"],["role","group","aria-label","Modo",1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"col-sm-5"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[3,"value"],[1,"mt-4"],["class","alert alert-secondary","style","margin-bottom: 0;",4,"ngIf"],["class","row","style","row-gap: 14px;",4,"ngIf"],[1,"alert","alert-secondary",2,"margin-bottom","0"],[1,"row",2,"row-gap","14px"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],["class","card",4,"ngIf"],[1,"card"],[1,"card-header","d-flex","align-items-center","justify-content-between","col-sm-12",2,"gap","10px"],[1,"col-sm-8"],[1,"fw-bold","text-center","text-danger"],[1,"small","text-secondary","col-sm-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"card-body",2,"padding","0"],["class","list-group list-group-flush",4,"ngIf","ngIfElse"],[1,"list-group","list-group-flush"],["class","list-group-item d-flex align-items-center justify-content-between flex-row","style","gap: 12px;",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","align-items-center","justify-content-between","flex-row",2,"gap","12px"],[1,"d-flex","align-items-center","flex-wrap","justify-content-between",2,"gap","12px","min-width","0","width","100%"],[1,"fw-semibold","text-truncate",2,"max-width","180px"],["class","small text-secondary",4,"ngIf"],[1,"d-flex","align-items-center","ms-auto",2,"gap","8px"],[1,"small","text-secondary"],["type","button","title","Cambiar Estado",1,"btn","btn-sm",3,"click","ngClass","disabled"],["type","button","title","Cambiar Visibilidad",1,"btn","btn-sm",3,"click","ngClass","disabled"],[1,"d-flex",2,"gap","8px","flex-shrink","0"],["title","Editar",1,"btn","btn-outline-warning","btn-sm",3,"click"],["title","Eliminar",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"p-3","text-center","text-secondary"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,""],[1,"text-center"],[2,"user-select","none",3,"click"],["style","user-select:none;",4,"ngIf"],[4,"ngIf"],["style","cursor: pointer;",3,"contextmenu",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-3"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[2,"user-select","none"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[2,"cursor","pointer",3,"contextmenu"],[1,"text-center","d-flex","justify-content-center","align-items-center",2,"gap","5px"],["title","Modificar informaci\xF3n",1,"btn","btn-outline-warning","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src",4,"ngIf"],["width","30px","height","35px",3,"options",4,"ngIf"],["title","Eliminar informaci\xF3n",1,"btn","btn-outline-danger","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src"],["width","30px","height","35px",3,"options"],[1,"modal-header"],[1,"modal-title"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],["class","form-floating mb-3 col-sm-12",4,"ngIf"],[1,"form-floating","mb-3","col-sm-12"],["formControlName","Categoria",1,"form-select"],["type","text","placeholder","","formControlName","ParaI",1,"form-control",2,"text-transform","uppercase"],["formControlName","Estado",1,"form-select"],["formControlName","Visibilidad",1,"form-select"],[1,"modal-footer"],["class","button d-flex justify-content-start",4,"ngIf"],[1,"button","me-2"],["title","Cancelar y cerrar","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],[1,"button"],["class","btn mouse-dir success","title","Procesando informaci\xF3n",3,"disabled","click",4,"ngIf"],["class","btn mouse-dir primary d-flex align-items-center","style"," gap: 8px;","title","Accionar",3,"click",4,"ngIf"],["formControlName","instituciones_id",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","placeholder","","formControlName","NivelCurso",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","","formControlName","Edades",1,"form-control",2,"text-transform","uppercase"],[1,"button","d-flex","justify-content-start"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],["title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],["title","Procesando informaci\xF3n",1,"btn","mouse-dir","success",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["title","Accionar",1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"]],template:function(e,i){if(e&1){let n=v();o(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),c(4,"Gesti\xF3n de controles"),r(),o(5,"p",6),c(6,"Administra los controles (selects/autocompletados) del sistema"),r()()()(),o(7,"div",3)(8,"div",7)(9,"button",8),g("click",function(){p(n);let m=J(40);return _(i.modalGestioncontrolesRef=i._tools.openModal(m,"xl"))}),C(10,"ng-lottie",9),o(11,"span"),c(12,"A\xF1adir control"),r(),C(13,"span",10),r()(),o(14,"div",11)(15,"div",12)(16,"span",13),C(17,"ng-lottie",9),r(),o(18,"div",14)(19,"input",15),g("input",function(){return p(n),_(i.paginacontroles=1)}),w("ngModelChange",function(m){return p(n),I(i.filtertxtcontroles,m)||(i.filtertxtcontroles=m),_(m)}),r(),o(20,"label"),c(21,"Buscar"),r()()()()(),o(22,"div",16)(23,"div",17)(24,"div",18)(25,"button",19),g("click",function(){return p(n),_(i.setViewMode("interactive"))}),c(26,"Modo interactivo"),r(),o(27,"button",19),g("click",function(){return p(n),_(i.setViewMode("table"))}),c(28,"Modo tabla"),r()()(),o(29,"div",20)(30,"div",14)(31,"select",21),w("ngModelChange",function(m){return p(n),I(i.categoriaFiltro,m)||(i.categoriaFiltro=m),_(m)}),g("change",function(){return p(n),_(i.onCategoriaFiltroChange())}),o(32,"option",22),c(33,"TODAS"),r(),h(34,Pt,2,2,"option",23),r(),o(35,"label"),c(36,"Filtrar por categor\xEDa"),r()()()(),h(37,Dt,3,2,"div",24)(38,Xt,31,17,"div",24)(39,si,37,13,"ng-template",null,0,L)}e&2&&(s(10),u("options",i._tools.optionsAdicionar),s(7),u("options",i._tools.optionslupa),s(2),E("ngModel",i.filtertxtcontroles),s(6),N("active",i.viewMode==="interactive"),s(2),N("active",i.viewMode==="table"),s(4),E("ngModel",i.categoriaFiltro),s(3),u("ngForOf",i.categoriasOptions),s(3),u("ngIf",i.viewMode==="interactive"),s(),u("ngIf",i.viewMode==="table"))},dependencies:[ce,K,j,me,H,Q,U,z,$,ue,W,Ne,Re,Ge,Be,Ae],encapsulation:2});var ve=q;var ci=["modalListasPreliminaresCursos"],A=()=>({standalone:!0});function di(a,t){if(a&1&&(o(0,"option",50),c(1),r()),a&2){let e=t.$implicit;u("value",e.id),s(),b(e.Anio)}}function ui(a,t){if(a&1){let e=v();o(0,"div",51)(1,"div",19)(2,"label",23),c(3,"\xC1rea:"),r(),o(4,"input",52),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.AreaManual,n)||(l.AreaManual=n),_(n)}),r()(),o(5,"div",19)(6,"label",23),c(7,"Carrera:"),r(),o(8,"input",52),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.CarreraManual,n)||(l.CarreraManual=n),_(n)}),r()(),o(9,"div",19)(10,"label",23),c(11,"Resoluci\xF3n:"),r(),o(12,"input",52),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.ResolucionManual,n)||(l.ResolucionManual=n),_(n)}),r()(),o(13,"div",19)(14,"label",23),c(15,"Texto Nivel:"),r(),o(16,"input",52),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.NivelManual,n)||(l.NivelManual=n),_(n)}),r()(),o(17,"div",19)(18,"label",23),c(19,"Bicentenario:"),r(),o(20,"input",52),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.BicentenarioManual,n)||(l.BicentenarioManual=n),_(n)}),r()(),o(21,"div",53)(22,"div",34)(23,"input",54),w("ngModelChange",function(n){p(e);let l=d(2);return I(l.ContadorManual,n)||(l.ContadorManual=n),_(n)}),r(),o(24,"label",55),c(25," \xBFCon contador de P\xE1gina? "),r()()()()}if(a&2){let e=d(2);s(4),u("ngModelOptions",M(12,A)),E("ngModel",e.AreaManual),s(4),u("ngModelOptions",M(13,A)),E("ngModel",e.CarreraManual),s(4),u("ngModelOptions",M(14,A)),E("ngModel",e.ResolucionManual),s(4),u("ngModelOptions",M(15,A)),E("ngModel",e.NivelManual),s(4),u("ngModelOptions",M(16,A)),E("ngModel",e.BicentenarioManual),s(3),u("ngModelOptions",M(17,A)),E("ngModel",e.ContadorManual)}}function mi(a,t){a&1&&(o(0,"span"),c(1,"Generar"),r())}function pi(a,t){a&1&&(o(0,"span"),c(1,"Generando..."),r())}function _i(a,t){if(a&1){let e=v();o(0,"div",12)(1,"div",13)(2,"span",14),C(3,"i",15),r(),o(4,"h2",16),c(5,"CUADRO DE INSCRIPCIONES DE ALUMNOS - GENERAL"),r()(),o(6,"div",17)(7,"p",9),c(8,"Ac\xE1 obtendremos la lista del Cuadro de Inscripciones de Alumnos Nuevos y Antiguos de la Instituci\xF3n."),r(),o(9,"form",18)(10,"div",19)(11,"label",20),c(12,"Por Favor introducir Numero de Paginaci\xF3n Inicial:"),r(),o(13,"input",21),w("ngModelChange",function(n){p(e);let l=d();return I(l.numeroPaginaCuadro,n)||(l.numeroPaginaCuadro=n),_(n)}),r()(),o(14,"div",22)(15,"label",23),c(16,"Seleccione Gesti\xF3n"),r(),o(17,"select",24),w("ngModelChange",function(n){p(e);let l=d();return I(l.gestion_id_seleccionado,n)||(l.gestion_id_seleccionado=n),_(n)}),o(18,"optgroup",25),h(19,di,2,2,"option",26),r()()(),o(20,"div",27)(21,"label",23),c(22,"Seleccione Nivel"),r(),o(23,"select",28),w("ngModelChange",function(n){p(e);let l=d();return I(l.NivelCuadro,n)||(l.NivelCuadro=n),_(n)}),o(24,"optgroup",29)(25,"option",30),c(26,"MIXTO (TODOS)"),r(),o(27,"option",31),c(28,"TECNICO SUPERIOR"),r(),o(29,"option",32),c(30,"CAPACITACI\xD3N"),r()()()(),o(31,"div",33)(32,"div",34)(33,"input",35),w("ngModelChange",function(n){p(e);let l=d();return I(l.showContenidoManual,n)||(l.showContenidoManual=n),_(n)}),r(),o(34,"label",36),c(35," Mostrar/Ocultar Contenido Manual "),r()()(),o(36,"div",37)(37,"div",34)(38,"input",38),w("ngModelChange",function(n){p(e);let l=d();return I(l.incluirSinAsignar,n)||(l.incluirSinAsignar=n),_(n)}),r(),o(39,"label",39),c(40," INCLUIR LOS SIN ASIGNACIONES "),r()()()(),h(41,ui,26,18,"div",40),o(42,"div",41)(43,"div",42)(44,"button",43),g("click",function(){p(e);let n=d();return _(n.abrirModalListasPreliminaresCursos())}),C(45,"i",44),o(46,"span"),c(47,"LISTAS POR CURSO"),r()(),o(48,"button",45),g("click",function(){p(e);let n=d();return _(n.GenerarCuadroInscripciones2026())}),we(),o(49,"svg",46),C(50,"path",47)(51,"path",48),r(),h(52,mi,2,0,"span",49)(53,pi,2,0,"span",49),r()()()()()}if(a&2){let e=d();s(13),u("ngModelOptions",M(16,A)),E("ngModel",e.numeroPaginaCuadro),s(4),u("ngModelOptions",M(17,A)),E("ngModel",e.gestion_id_seleccionado),s(2),u("ngForOf",e.anio),s(4),u("ngModelOptions",M(18,A)),E("ngModel",e.NivelCuadro),s(10),u("ngModelOptions",M(19,A)),E("ngModel",e.showContenidoManual),s(5),u("ngModelOptions",M(20,A)),E("ngModel",e.incluirSinAsignar),s(3),u("ngIf",e.showContenidoManual),s(3),u("disabled",e.isLoadingCursosParaListas||e.isGenerandoListasPreliminares),s(4),u("disabled",e.isGenerandoCuadro),s(4),u("ngIf",!e.isGenerandoCuadro),s(),u("ngIf",e.isGenerandoCuadro)}}function gi(a,t){a&1&&(o(0,"div",67),c(1,"Incluye SIN ASIGNAR"),r())}function fi(a,t){a&1&&(o(0,"div",68),c(1,"Solo asignados"),r())}function hi(a,t){a&1&&(o(0,"div",69)(1,"div",70),c(2,"Cargando cursos..."),r()())}function bi(a,t){a&1&&(o(0,"div",71),c(1," No se encontraron cursos para el filtro actual. "),r())}function vi(a,t){if(a&1){let e=v();o(0,"tr")(1,"td")(2,"input",79),w("ngModelChange",function(n){let l=p(e).$implicit;return I(l.selected,n)||(l.selected=n),_(n)}),r()(),o(3,"td",80),c(4),r(),o(5,"td"),c(6),r(),o(7,"td",77),c(8),r()()}if(a&2){let e=t.$implicit;s(2),E("ngModel",e.selected),u("ngModelOptions",M(5,A)),s(2),b(e.curso),s(2),b(e.paraleloLabel),s(2),b(e.total)}}function Ci(a,t){if(a&1){let e=v();o(0,"div",72)(1,"table",73)(2,"thead",74)(3,"tr")(4,"th",75)(5,"input",76),g("change",function(n){p(e);let l=d(2);return _(l.toggleSeleccionarTodosCursosParaListas(n.target.checked))}),r()(),o(6,"th"),c(7,"Curso"),r(),o(8,"th"),c(9,"Paralelo"),r(),o(10,"th",77),c(11,"Total"),r()()(),o(12,"tbody"),h(13,vi,9,6,"tr",78),r()()()}if(a&2){let e=d(2);s(13),u("ngForOf",e.cursosParaListas)}}function xi(a,t){a&1&&(o(0,"span"),c(1,"Generar PDF"),r())}function yi(a,t){a&1&&(o(0,"span"),c(1,"Generando..."),r())}function Si(a,t){if(a&1){let e=v();o(0,"div",5)(1,"h5",6),c(2,"LISTAS PRELIMINARES POR CURSO"),r(),o(3,"button",56),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),r()(),o(4,"div",8)(5,"div",57)(6,"div",58),c(7),r(),h(8,gi,2,0,"div",59)(9,fi,2,0,"div",60),r(),h(10,hi,3,0,"div",61)(11,bi,2,0,"div",62)(12,Ci,14,1,"div",63),r(),o(13,"div",10)(14,"div",64),c(15),r(),o(16,"button",65),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),c(17,"Cancelar"),r(),o(18,"button",66),g("click",function(){p(e);let n=d();return _(n.generarListasPreliminaresSeleccionadas())}),h(19,xi,2,0,"span",49)(20,yi,2,0,"span",49),r()()}if(a&2){let e=d();s(7),S("Gesti\xF3n: ",e.getGestionLabel()),s(),u("ngIf",e.incluirSinAsignar),s(),u("ngIf",!e.incluirSinAsignar),s(),u("ngIf",e.isLoadingCursosParaListas),s(),u("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length===0),s(),u("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length>0),s(3),S("Seleccionados: ",e.getCursosParaListasSeleccionadosCount()),s(3),u("disabled",e.isGenerandoListasPreliminares||e.getCursosParaListasSeleccionadosCount()===0),s(),u("ngIf",!e.isGenerandoListasPreliminares),s(),u("ngIf",e.isGenerandoListasPreliminares)}}var Y=class Y{constructor(t,e,i,n){this._repo=t;this._anios=e;this._infoest=i;this._tools=n;this.numeroPaginaCuadro=1;this.anio=[];this.gestion_id_seleccionado="";this.NivelCuadro="MIXTO";this.incluirSinAsignar=!0;this.isGenerandoCuadro=!1;this.showContenidoManual=!1;this.AreaManual="";this.CarreraManual="";this.ResolucionManual="";this.NivelManual="";this.BicentenarioManual="";this.ContadorManual=!1;this.cursosParaListas=[];this.isLoadingCursosParaListas=!1;this.isGenerandoListasPreliminares=!1}ngOnInit(){this.cargarAnios()}cargarAnios(){this._anios.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anio=t?.anios||[];let e=t?.predeterminado??null,i=Number(this.gestion_id_seleccionado);(Number.isFinite(i)&&i>0?(this.anio||[]).some(l=>Number(l?.id)===i):!1)||(e?.id?this.gestion_id_seleccionado=e.id:this.anio?.length?this.gestion_id_seleccionado=this.anio[0]?.id??"":this.gestion_id_seleccionado="")},error:t=>{console.error("Error al cargar anios",t),this.anio=[]}})}getGestionLabel(){let t=Number(this.gestion_id_seleccionado),e=(this.anio||[]).find(n=>Number(n?.id)===t);return(e?.Anio??e?.anio??"").toString().trim()||(Number.isFinite(t)&&t>0?String(t):"")}GenerarCuadroInscripciones2026(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}if(this.isGenerandoCuadro)return;this.isGenerandoCuadro=!0;let t=Number(this.numeroPaginaCuadro||1),e=Number(this.gestion_id_seleccionado),i=this.NivelCuadro||"MIXTO";try{this._repo.GenerarCuadroInscripciones2026(t,e,i,this.incluirSinAsignar)}catch(n){console.error(n),this._tools.MostrarMensaje("error","No se pudo generar el cuadro de inscripciones")}finally{setTimeout(()=>this.isGenerandoCuadro=!1,1200)}}abrirModalListasPreliminaresCursos(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}let t=Number(this.gestion_id_seleccionado);if(!Number.isFinite(t)||t<=0){this._tools.MostrarMensaje("warning","Seleccione un a\xF1o v\xE1lido");return}this.cursosParaListas=[],this.isLoadingCursosParaListas=!0,this.modalListasPreliminaresCursosRef=this._tools.openModal(this.modalListasPreliminaresCursos,"lg"),this._infoest.ObtenerEstadisticasInscripciones({anio_id:t,include_sin_asignar:this.incluirSinAsignar?1:0}).subscribe({next:e=>{let i=Array.isArray(e?.por_curso_paralelo)?e.por_curso_paralelo:[];this.cursosParaListas=i.map(n=>{let l=(n?.curso??"").toString().trim(),m=(n?.paralelo??"").toString().trim(),f=(n?.paralelo_label??(m||"SIN DETERMINAR")).toString().trim(),x=Number(n?.total??0);return{curso:l,paralelo:m,paraleloLabel:f||"SIN DETERMINAR",total:Number.isFinite(x)?x:0,selected:!1}}).filter(n=>n.curso!=="").sort((n,l)=>{let m=n.curso.localeCompare(l.curso);return m!==0?m:(n.paraleloLabel||"").localeCompare(l.paraleloLabel||"")}),this.isLoadingCursosParaListas=!1},error:e=>{console.error(e),this.cursosParaListas=[],this.isLoadingCursosParaListas=!1,this._tools.MostrarMensaje("error","No se pudieron cargar los cursos")}})}toggleSeleccionarTodosCursosParaListas(t){(this.cursosParaListas||[]).forEach(e=>e.selected=t)}getCursosParaListasSeleccionadosCount(){return(this.cursosParaListas||[]).filter(t=>!!t.selected).length}generarListasPreliminaresSeleccionadas(){return te(this,null,function*(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}let t=Number(this.gestion_id_seleccionado);if(!Number.isFinite(t)||t<=0){this._tools.MostrarMensaje("warning","Seleccione un a\xF1o v\xE1lido");return}let e=(this.cursosParaListas||[]).filter(i=>!!i.selected).map(i=>({curso:i.curso,paralelo:i.paralelo}));if(e.length===0){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}if(!this.isGenerandoListasPreliminares){this.isGenerandoListasPreliminares=!0;try{yield this._repo.GenerarListaPreliminarAlumnos2026(t,e,null,this.incluirSinAsignar);try{this.modalListasPreliminaresCursosRef?.close?.()}catch{}}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudieron generar las listas")}finally{this.isGenerandoListasPreliminares=!1}}})}};Y.\u0275fac=function(e){return new(e||Y)(P($e),P(Ue),P(fe),P(ge))},Y.\u0275cmp=G({type:Y,selectors:[["app-documentosimportantes"]],viewQuery:function(e,i){if(e&1&&re(ci,7),e&2){let n;ae(n=le())&&(i.modalListasPreliminaresCursos=n.first)}},standalone:!1,decls:15,vars:1,consts:[["modalListasPreliminaresCursos",""],["class","card shadow mb-4",4,"ngIf"],["id","modalGeneracionCuadroEstudiantes","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body"],[1,"mb-4"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"card","shadow","mb-4"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center"],[1,"me-2"],[1,"bi","bi-file-earmark-text"],[1,"mb-0","fw-bold","fs-4"],[1,"card-body"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-4"],[1,"form-label","fw-bold","fst-italic","text-warning"],["type","number","placeholder","NUMERO PAGINA",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-2"],[1,"form-label"],["name","Curso_id","id","Curso_idModal",1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Gestion"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3"],[1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Nivel"],["value","MIXTO"],["value","TECNICO SUPERIOR"],["value","CAPACITACI\xD3N"],[1,"col-md-3","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","id","toggleContent",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","toggleContent",1,"form-check-label"],[1,"col-md-12"],["type","checkbox","id","chkSinAsignarCuadro",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","chkSinAsignarCuadro",1,"form-check-label","text-danger","fw-bold"],["class","row g-3",4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-outline-primary","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],[1,"bi","bi-list-check"],["type","button",1,"btn","btn-success","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","28","height","28","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-download"],["d","M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"],["d","M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"],[4,"ngIf"],[3,"value"],[1,"row","g-3"],["type","text",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-4","d-flex","align-items-center"],["type","checkbox","id","contadormanual",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","contadormanual",1,"form-check-label"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"d-flex","flex-wrap","gap-2","align-items-center"],[1,"badge","bg-secondary"],["class","badge bg-danger",4,"ngIf"],["class","badge bg-light text-dark",4,"ngIf"],["class","mt-3",4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],["class","table-responsive mt-3","style","max-height: 55vh;",4,"ngIf"],[1,"me-auto","text-muted"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"badge","bg-danger"],[1,"badge","bg-light","text-dark"],[1,"mt-3"],[1,"text-center","py-4"],[1,"alert","alert-warning","mt-3"],[1,"table-responsive","mt-3",2,"max-height","55vh"],[1,"table","table-sm","table-hover","align-middle"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"width","46px"],["type","checkbox",1,"form-check-input",3,"change"],[1,"text-end"],[4,"ngFor","ngForOf"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel","ngModelOptions"],[1,"fw-semibold"]],template:function(e,i){e&1&&(h(0,_i,54,21,"div",1)(1,Si,21,10,"ng-template",null,0,L),o(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),c(8,"FORMULARIO - CUADRO ESTUDIANTES"),r(),C(9,"button",7),r(),o(10,"div",8),C(11,"div",9),r(),o(12,"div",10)(13,"button",11),c(14,"Cancelar"),r()()()()()),e&2&&u("ngIf",!0)},dependencies:[K,j,me,H,Q,U,pe,de,z,$,ue,W,ke],encapsulation:2});var Ce=Y;var Ei=[{path:"calificacionessolo",component:he},{path:"controles",component:ve},{path:"documentosifasimportantes",component:Ce}],F=class F{};F.\u0275fac=function(e){return new(e||F)},F.\u0275mod=oe({type:F}),F.\u0275inj=ie({imports:[Ee.forChild(Ei),Ee]});var xe=F;var D=class D{};D.\u0275fac=function(e){return new(e||D)},D.\u0275mod=oe({type:D}),D.\u0275inj=ie({imports:[Oe,je,xe]});var Xe=D;export{Xe as AdministrativosModule};
