import{a as he}from"./chunk-44R4R5AU.js";import{b as pe}from"./chunk-4WRFG2J2.js";import{b as ve}from"./chunk-IOZ5TDSV.js";import"./chunk-N4MEOVMH.js";import{g as ce,k as J}from"./chunk-LEW5N4EV.js";import{b as fe}from"./chunk-YB5XT4DU.js";import"./chunk-OXGEW5OA.js";import{c as ue,f as me,k as _e}from"./chunk-TKGN7DBU.js";import{a as k}from"./chunk-5RMZ5E5A.js";import{Aa as I,Cc as ne,Ea as r,Ec as ae,Fc as re,Gb as Y,Ib as T,Jc as oe,Lb as l,Ma as M,Mb as g,Nb as C,Nc as le,Ob as O,Pb as Z,Ra as X,Sa as j,Sb as b,Sc as se,Tb as h,Tc as de,Ub as w,Wa as p,Xc as F,Z as A,_ as N,_b as $,ba as D,cc as ee,ec as te,ga as m,gc as ie,ha as _,ib as c,jb as a,kb as t,lb as f,sb as x,vb as v,xb as d}from"./chunk-SGF3PIFW.js";import{a as B,f as be,m as q}from"./chunk-GG76335P.js";var ge=be(he());var y=class y{constructor(i){this.http=i;this.ruta=k.ruta}authHeaders(){let i=localStorage.getItem("token");return new se({Authorization:`Bearer ${i}`})}obtenerMaterias(){return this.http.get(`${this.ruta}api/v1/perfil/materias`,{headers:this.authHeaders()})}actualizarMateriaDocente(i,e){return this.http.put(`${this.ruta}api/v1/perfil/materias/${i}`,e,{headers:this.authHeaders()})}obtenerDeudas(i){let e=new de;return i&&(e=e.set("gestion",i)),this.http.get(`${this.ruta}api/v1/perfil/deudas`,{headers:this.authHeaders(),params:e})}};y.\u0275fac=function(e){return new(e||y)(D(F))},y.\u0275prov=A({token:y,factory:y.\u0275fac,providedIn:"root"});var W=y;var E=class E{constructor(i){this.http=i;this.ruta=k.ruta}authHeaders(){return{Authorization:`Bearer ${localStorage.getItem("token")}`}}get2faStatus(){return this.http.get(`${this.ruta}api/v1/security/2fa/status`,{headers:this.authHeaders()})}startEnroll2fa(){return this.http.post(`${this.ruta}api/v1/security/2fa/enroll/start`,{},{headers:this.authHeaders()})}confirmEnroll2fa(i){return this.http.post(`${this.ruta}api/v1/security/2fa/enroll/confirm`,{code:i},{headers:this.authHeaders()})}disable2fa(i){return this.http.post(`${this.ruta}api/v1/security/2fa/disable`,{code:i},{headers:this.authHeaders()})}};E.\u0275fac=function(e){return new(e||E)(D(F))},E.\u0275prov=A({token:E,factory:E.\u0275fac,providedIn:"root"});var U=E;var Ee=(n,i)=>({"d-none d-md-block":n,"sidebar-collapsed":i});function Se(n,i){n&1&&(a(0,"div",5)(1,"div",6),f(2,"div",7),a(3,"div"),l(4,"Cargando perfil\u2026"),t()()())}function Pe(n,i){n&1&&(a(0,"div",5)(1,"div",8),l(2,"No hay sesi\xF3n activa."),t()())}function Ie(n,i){if(n&1&&(a(0,"div",34)(1,"div",35),l(2,"Instituci\xF3n"),t(),a(3,"div",36),l(4),t()()),n&2){let e=d(2);r(4),g(e.datasesion.nameInst)}}function Me(n,i){n&1&&(a(0,"span",37),l(1,"Inicio"),t())}function Te(n,i){n&1&&(a(0,"span",37),l(1,"Cuenta"),t())}function ke(n,i){n&1&&(a(0,"span",37),l(1,"Seguridad"),t())}function Ve(n,i){n&1&&(a(0,"span",37),l(1,"Mis Materias"),t())}function Oe(n,i){n&1&&(a(0,"span",37),l(1,"Mis Deudas"),t())}function Le(n,i){if(n&1){let e=x();a(0,"li")(1,"button",19),v("click",function(){m(e);let o=d(2);return _(o.setTab("deudas"))}),f(2,"i",38),p(3,Oe,2,0,"span",18),t()()}if(n&2){let e=d(2);r(),T("active",e.activeTab==="deudas"),r(2),c("ngIf",e.menuOpen)}}function Ae(n,i){if(n&1&&(a(0,"div",39),l(1),t()),n&2){let e=d(2);r(),g(e.perfilError)}}function Ne(n,i){if(n&1){let e=x();a(0,"button",51),v("click",function(){m(e);let o=d(3);return _(o.setTab("deudas"))}),l(1,"Ver Deudas"),t()}}function De(n,i){if(n&1&&(a(0,"div",35),l(1),t()),n&2){let e=d(3);r(),C(" Deudas: ",(e.deudasPorInstitucion==null?null:e.deudasPorInstitucion.length)||0," instituci\xF3n(es) ")}}function je(n,i){if(n&1){let e=x();a(0,"div")(1,"div",40)(2,"div",41)(3,"div",42)(4,"div",43)(5,"div",36),l(6,"Accesos r\xE1pidos"),t(),a(7,"div",44)(8,"button",45),v("click",function(){m(e);let o=d(2);return _(o.setTab("misMaterias"))}),l(9,"Ver Mis Materias"),t(),a(10,"button",46),v("click",function(){m(e);let o=d(2);return _(o.setTab("cuenta"))}),l(11,"Ver Cuenta"),t(),a(12,"button",47),v("click",function(){m(e);let o=d(2);return _(o.setTab("seguridad"))}),l(13,"Seguridad"),t(),p(14,Ne,2,0,"button",48),t()()()(),a(15,"div",41)(16,"div",42)(17,"div",43)(18,"div",36),l(19,"Resumen"),t(),a(20,"div",49),l(21),t(),p(22,De,2,1,"div",50),t()()()()()}if(n&2){let e=d(2);r(14),c("ngIf",e.esEstudiante),r(7),C(" Materias cargadas: ",(e.materiasPorInstitucion==null?null:e.materiasPorInstitucion.length)||0," instituci\xF3n(es) "),r(),c("ngIf",e.esEstudiante)}}function Fe(n,i){if(n&1&&(a(0,"div",69),l(1),t()),n&2){let e=d(3);r(),g(e.errorClave)}}function We(n,i){if(n&1){let e=x();a(0,"div",41)(1,"div",58)(2,"div",43)(3,"div",59),l(4,"Hoja de Vida (vista)"),t(),a(5,"quill-editor",70),w("ngModelChange",function(o){m(e);let u=d(3);return h(u.datasesion.usuario.hojadevida,o)||(u.datasesion.usuario.hojadevida=o),_(o)}),t()()()()}if(n&2){let e=d(3);r(5),c("modules",e._tools.modulesQuillShow),b("ngModel",e.datasesion.usuario.hojadevida)}}function He(n,i){if(n&1){let e=x();a(0,"div")(1,"div",42)(2,"div",43)(3,"div",40)(4,"div",52),f(5,"img",53),t(),a(6,"div",54)(7,"table",55)(8,"tbody")(9,"tr")(10,"th",56),l(11,"Usuario"),t(),a(12,"td"),l(13),t()(),a(14,"tr")(15,"th"),l(16,"Carnet"),t(),a(17,"td"),l(18),t()(),a(19,"tr")(20,"th"),l(21,"Celular"),t(),a(22,"td"),l(23),t()()()()()(),f(24,"hr",57),a(25,"div",40)(26,"div",41)(27,"div",58)(28,"div",43)(29,"div",59),l(30,"Cambiar contrase\xF1a"),t(),p(31,Fe,2,1,"div",60),a(32,"div",61)(33,"label",62),l(34,"Contrase\xF1a actual"),t(),a(35,"input",63),w("ngModelChange",function(o){m(e);let u=d(2);return h(u.claveActual,o)||(u.claveActual=o),_(o)}),t()(),a(36,"div",61)(37,"label",62),l(38,"Nueva contrase\xF1a"),t(),a(39,"input",64),w("ngModelChange",function(o){m(e);let u=d(2);return h(u.nuevaClave,o)||(u.nuevaClave=o),_(o)}),t()(),a(40,"div",65)(41,"label",62),l(42,"Confirmar nueva contrase\xF1a"),t(),a(43,"input",64),w("ngModelChange",function(o){m(e);let u=d(2);return h(u.confirmarClave,o)||(u.confirmarClave=o),_(o)}),t()(),a(44,"button",66),v("click",function(){m(e);let o=d(2);return _(o.cambiarClave())}),f(45,"i",67),l(46," Cambiar contrase\xF1a "),t()()()(),p(47,We,6,2,"div",68),t()()()()}if(n&2){let e=d(2);r(5),c("src",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.foto)==null?e.ruta+"fijos/sinperfil.jpg":e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.foto,I),r(8),g((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.usuario)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Usuario)||"\u2014"),r(5),g((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.carnet)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Carnet)||"\u2014"),r(5),g((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.celular)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Celular)||"\u2014"),r(8),c("ngIf",e.errorClave),r(4),b("ngModel",e.claveActual),r(4),b("ngModel",e.nuevaClave),r(4),b("ngModel",e.confirmarClave),r(4),c("ngIf",!e.esEstudiante)}}function Ue(n,i){n&1&&(a(0,"div",77),f(1,"div",7),a(2,"div"),l(3,"Procesando\u2026"),t()())}function Re(n,i){if(n&1&&(a(0,"div",82),f(1,"img",85),a(2,"div",49),l(3,"Si no puedes escanear, usa este secreto:"),t(),a(4,"div",86),l(5),t()()),n&2){let e=d(5);r(),c("src",e.twofaQrDataUrl,I),r(4),g(e.twofaSecret||"\u2014")}}function ze(n,i){if(n&1){let e=x();a(0,"div",41)(1,"div",78)(2,"div",43)(3,"div",59),l(4,"Vincular Google Authenticator"),t(),a(5,"ol",79)(6,"li"),l(7,"Instala Google Authenticator en tu celular."),t(),a(8,"li"),l(9,"Presiona \u201CGenerar QR\u201D."),t(),a(10,"li"),l(11,"Escanea el QR y escribe el c\xF3digo de 6 d\xEDgitos para confirmar."),t()(),a(12,"button",80),v("click",function(){m(e);let o=d(4);return _(o.generarQrTwofa())}),l(13," Generar QR "),t(),p(14,Re,6,2,"div",81),a(15,"div",82)(16,"label",62),l(17,"C\xF3digo (6 d\xEDgitos)"),t(),a(18,"input",83),w("ngModelChange",function(o){m(e);let u=d(4);return h(u.twofaCode,o)||(u.twofaCode=o),_(o)}),t()(),a(19,"button",84),v("click",function(){m(e);let o=d(4);return _(o.confirmarVinculoTwofa())}),l(20," Confirmar vinculaci\xF3n "),t()()()()}if(n&2){let e=d(4);r(14),c("ngIf",e.twofaQrDataUrl),r(4),b("ngModel",e.twofaCode),r(),c("disabled",!e.twofaSecret)}}function Ge(n,i){if(n&1&&(a(0,"div",35),l(1),ee(2,"date"),t()),n&2){let e=d(5);r(),C("Confirmado: ",te(2,1,e.twofaConfirmedAt,"medium"))}}function Qe(n,i){n&1&&(a(0,"div",35),l(1,"Confirmado: \u2014"),t())}function Be(n,i){if(n&1){let e=x();a(0,"div",41)(1,"div",78)(2,"div",43)(3,"div",59),l(4,"Google Authenticator vinculado"),t(),p(5,Ge,3,4,"div",50)(6,Qe,2,0,"div",50),f(7,"hr"),a(8,"div",61)(9,"label",62),l(10,"C\xF3digo para desvincular"),t(),a(11,"input",83),w("ngModelChange",function(o){m(e);let u=d(4);return h(u.twofaDisableCode,o)||(u.twofaDisableCode=o),_(o)}),t()(),a(12,"button",87),v("click",function(){m(e);let o=d(4);return _(o.desvincularTwofa())}),l(13," Desvincular "),t()()()()}if(n&2){let e=d(4);r(5),c("ngIf",e.twofaConfirmedAt),r(),c("ngIf",!e.twofaConfirmedAt),r(5),b("ngModel",e.twofaDisableCode)}}function qe(n,i){if(n&1&&(a(0,"div",40),p(1,ze,21,3,"div",68)(2,Be,14,3,"div",68),t()),n&2){let e=d(3);r(),c("ngIf",!e.twofaEnabled),r(),c("ngIf",e.twofaEnabled)}}function Je(n,i){if(n&1&&(a(0,"div")(1,"div",42)(2,"div",43)(3,"div",71)(4,"div")(5,"div",72),l(6,"Seguridad"),t(),a(7,"div",32),l(8,"Vincula Google Authenticator para recuperar tu contrase\xF1a."),t()(),a(9,"span",73),l(10),t()(),f(11,"hr",74),p(12,Ue,4,0,"div",75)(13,qe,3,2,"div",76),t()()()),n&2){let e=d(2);r(9),c("ngClass",e.twofaEnabled?"bg-success":"bg-secondary"),r(),C(" ",e.twofaEnabled?"VINCULADO":"NO VINCULADO"," "),r(2),c("ngIf",e.twofaLoading),r(),c("ngIf",!e.twofaLoading)}}function Ke(n,i){if(n&1&&(a(0,"div",39),l(1),t()),n&2){let e=d(3);r(),g(e.materiasError)}}function Xe(n,i){n&1&&(a(0,"div",93),f(1,"div",7),a(2,"div"),l(3,"Cargando materias\u2026"),t()())}function Ye(n,i){n&1&&(a(0,"div",94),l(1," No hay materias para mostrar. "),t())}function Ze(n,i){if(n&1&&f(0,"img",100),n&2){let e=d().$implicit,s=d(3);c("src",s.ruta+e.institucion_logo,I)("alt",e==null?null:e.institucion_nombre)}}function $e(n,i){if(n&1&&(a(0,"span",33),l(1),t()),n&2){let e=d().$implicit;r(),g((e==null?null:e.EstadoRegistroMateria)||(e==null?null:e.materia_estado_habilitacion))}}function et(n,i){if(n&1&&(a(0,"div",82)(1,"div",112)(2,"div",113)(3,"div",35),l(4,"Promedio"),t(),a(5,"div",36),l(6),t()(),a(7,"div",113)(8,"div",35),l(9,"Recuperaci\xF3n"),t(),a(10,"div",36),l(11),t()()()()),n&2){let e=d().$implicit;r(6),g((e==null?null:e.Promedio)??"\u2014"),r(5),g((e==null?null:e.PruebaRecuperacion)??"\u2014")}}function tt(n,i){if(n&1){let e=x();a(0,"div",114)(1,"button",45),v("click",function(){m(e);let o=d().$implicit,u=d(5);return _(u.abrirEdicionMateria(o))}),l(2," Modificar materia "),t()()}}function it(n,i){if(n&1&&(a(0,"div",103)(1,"div",104)(2,"div",43)(3,"div",105)(4,"div")(5,"div",106),l(6),t(),a(7,"div",32),l(8),t()(),p(9,$e,2,1,"span",107),t(),a(10,"div",108),f(11,"img",109),a(12,"div",110)(13,"div",35),l(14,"Docente"),t(),a(15,"div",36),l(16),t()()(),p(17,et,12,2,"div",81)(18,tt,3,0,"div",111),t()()()),n&2){let e=i.$implicit,s=d(5);r(6),O("",e==null?null:e.sigla_materia," \u2014 ",e==null?null:e.nombre_materia),r(2),Z("",e==null?null:e.lvl_curso," \u2022 Paralelo ",e==null?null:e.materia_paralelo," \u2022 ",e==null?null:e.materia_turno),r(),c("ngIf",(e==null?null:e.EstadoRegistroMateria)||(e==null?null:e.materia_estado_habilitacion)),r(2),c("src",s.fotoUrl(e==null?null:e.docente_foto),I),r(5),g(s.docenteNombre(e)),r(),c("ngIf",s.esEstudiante),r(),c("ngIf",s.esDocente)}}function nt(n,i){if(n&1&&(a(0,"div",65)(1,"div",101)(2,"div",36),l(3),t(),a(4,"span",98),l(5),t()(),a(6,"div",40),p(7,it,19,10,"div",102),t()()),n&2){let e=i.$implicit;r(3),C("Gesti\xF3n: ",e.gestion),r(2),g(e.items.length),r(2),c("ngForOf",e.items)}}function at(n,i){if(n&1&&(a(0,"div",95)(1,"div",96),p(2,Ze,1,2,"img",97),a(3,"div",36),l(4),t(),a(5,"span",98),l(6),t()(),p(7,nt,8,3,"div",99),t()),n&2){let e=i.$implicit,s=d(3);r(2),c("ngIf",e==null?null:e.institucion_logo),r(2),g((e==null?null:e.institucion_nombre)||"INSTITUCI\xD3N"),r(2),g((e==null||e.items==null?null:e.items.length)||0),r(),c("ngForOf",s.agruparPorGestion(e.items))}}function rt(n,i){if(n&1){let e=x();a(0,"div")(1,"div",88)(2,"div",72),l(3,"Mis Materias"),t(),a(4,"button",89),v("click",function(){m(e);let o=d(2);return _(o.cargarMaterias())}),l(5,"Recargar"),t()(),p(6,Ke,2,1,"div",29)(7,Xe,4,0,"div",90)(8,Ye,2,0,"div",91)(9,at,8,4,"div",92),t()}if(n&2){let e=d(2);r(4),c("disabled",e.materiasLoading),r(2),c("ngIf",e.materiasError),r(),c("ngIf",e.materiasLoading),r(),c("ngIf",!e.materiasLoading&&(!e.materiasPorInstitucion||e.materiasPorInstitucion.length===0)),r(),c("ngForOf",e.materiasPorInstitucion)}}function ot(n,i){if(n&1&&(a(0,"div",39),l(1),t()),n&2){let e=d(3);r(),g(e.deudasError)}}function lt(n,i){n&1&&(a(0,"div",93),f(1,"div",7),a(2,"div"),l(3,"Cargando deudas\u2026"),t()())}function st(n,i){n&1&&(a(0,"div",94),l(1," No hay deudas para mostrar. "),t())}function dt(n,i){if(n&1&&f(0,"img",100),n&2){let e=d().$implicit,s=d(3);c("src",s.ruta+e.institucion_logo,I)("alt",e==null?null:e.institucion_nombre)}}function ct(n,i){if(n&1&&(a(0,"div",36),l(1),t()),n&2){let e=d().$implicit;r(),C(" ",e==null||e.meses_deuda==null?null:e.meses_deuda.join(", ")," ")}}function ut(n,i){n&1&&(a(0,"span",119),l(1,"Sin deuda"),t())}function mt(n,i){if(n&1&&(a(0,"div",116)(1,"div",42)(2,"div",43)(3,"div",32),l(4),t(),a(5,"div",117)(6,"div",35),l(7,"Meses deuda"),t(),p(8,ct,2,1,"div",118)(9,ut,2,0,"ng-template",null,0,ie),t()()()()),n&2){let e=i.$implicit,s=Y(10);r(4),O("Inscripci\xF3n: #",e==null?null:e.infoestudiantesifas_id," \u2022 Cohorte: ",e==null?null:e.anio_asignacion),r(4),c("ngIf",e==null||e.meses_deuda==null?null:e.meses_deuda.length)("ngIfElse",s)}}function _t(n,i){if(n&1&&(a(0,"div",65)(1,"div",101)(2,"div",36),l(3),t(),a(4,"span",98),l(5),t()(),a(6,"div",40),p(7,mt,11,4,"div",115),t()()),n&2){let e=i.$implicit;r(3),C("Gesti\xF3n: ",e.gestion),r(2),g(e.items.length),r(2),c("ngForOf",e.items)}}function pt(n,i){if(n&1&&(a(0,"div",95)(1,"div",96),p(2,dt,1,2,"img",97),a(3,"div",36),l(4),t()(),p(5,_t,8,3,"div",99),t()),n&2){let e=i.$implicit,s=d(3);r(2),c("ngIf",e==null?null:e.institucion_logo),r(2),g((e==null?null:e.institucion_nombre)||"INSTITUCI\xD3N"),r(),c("ngForOf",s.agruparPorGestion(e.items))}}function ft(n,i){if(n&1){let e=x();a(0,"div")(1,"div",88)(2,"div",72),l(3,"Mis Deudas"),t(),a(4,"button",89),v("click",function(){m(e);let o=d(2);return _(o.cargarDeudas())}),l(5,"Recargar"),t()(),p(6,ot,2,1,"div",29)(7,lt,4,0,"div",90)(8,st,2,0,"div",91)(9,pt,6,3,"div",92),t()}if(n&2){let e=d(2);r(4),c("disabled",e.deudasLoading),r(2),c("ngIf",e.deudasError),r(),c("ngIf",e.deudasLoading),r(),c("ngIf",!e.deudasLoading&&(!e.deudasPorInstitucion||e.deudasPorInstitucion.length===0)),r(),c("ngForOf",e.deudasPorInstitucion)}}function vt(n,i){if(n&1){let e=x();a(0,"div",9)(1,"div",10)(2,"button",11),v("click",function(){m(e);let o=d();return _(o.toggleMenu())}),l(3,"\u2630"),t(),a(4,"div",12),p(5,Ie,5,1,"div",13),a(6,"ul",14)(7,"li",15)(8,"button",16),v("click",function(){m(e);let o=d();return _(o.setTab("home"))}),f(9,"i",17),p(10,Me,2,0,"span",18),t()(),a(11,"li")(12,"button",19),v("click",function(){m(e);let o=d();return _(o.setTab("cuenta"))}),f(13,"i",20),p(14,Te,2,0,"span",18),t()(),a(15,"li")(16,"button",19),v("click",function(){m(e);let o=d();return _(o.setTab("seguridad"))}),f(17,"i",21),p(18,ke,2,0,"span",18),t()(),a(19,"li")(20,"button",19),v("click",function(){m(e);let o=d();return _(o.setTab("misMaterias"))}),f(21,"i",22),p(22,Ve,2,0,"span",18),t()(),p(23,Le,4,3,"li",23),t(),f(24,"hr"),t()(),a(25,"div",24)(26,"button",25),v("click",function(){m(e);let o=d();return _(o.toggleMenu())}),f(27,"i",26),t()(),a(28,"div",27)(29,"div",28),p(30,Ae,2,1,"div",29),a(31,"div",30)(32,"div")(33,"div",31),l(34),t(),a(35,"div",32),l(36),t()(),a(37,"span",33),l(38),t()(),p(39,je,23,3,"div",23)(40,He,48,9,"div",23)(41,Je,14,4,"div",23)(42,rt,10,5,"div",23)(43,ft,10,5,"div",23),t()()()}if(n&2){let e=d();r(),c("ngClass",$(25,Ee,!e.menuOpen,!e.menuOpen)),r(4),c("ngIf",e.datasesion==null?null:e.datasesion.nameInst),r(3),T("active",e.activeTab==="home"),r(2),c("ngIf",e.menuOpen),r(2),T("active",e.activeTab==="cuenta"),r(2),c("ngIf",e.menuOpen),r(2),T("active",e.activeTab==="seguridad"),r(2),c("ngIf",e.menuOpen),r(2),T("active",e.activeTab==="misMaterias"),r(2),c("ngIf",e.menuOpen),r(),c("ngIf",e.esEstudiante),r(7),c("ngIf",e.perfilError),r(4),O("",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.nombres)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Nombres)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Nombre)," ",(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.apellidos)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Apellidos)||""),r(2),C("Rol: ",e.tipoSesion),r(2),g((e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.estado)||(e.datasesion==null||e.datasesion.usuario==null?null:e.datasesion.usuario.Estado)||"ACTIVO"),r(),c("ngIf",e.activeTab==="home"),r(),c("ngIf",e.activeTab==="cuenta"),r(),c("ngIf",e.activeTab==="seguridad"),r(),c("ngIf",e.activeTab==="misMaterias"),r(),c("ngIf",e.activeTab==="deudas"&&e.esEstudiante)}}function gt(n,i){n&1&&f(0,"span",133)}function xt(n,i){if(n&1){let e=x();a(0,"div",120)(1,"div",121)(2,"div",122)(3,"div",123)(4,"h5",124),l(5,"Modificar materia"),t(),a(6,"button",125),v("click",function(){m(e);let o=d();return _(o.cerrarEdicionMateria())}),t()(),a(7,"div",126)(8,"div",61)(9,"div",36),l(10),t(),a(11,"div",32),l(12),t()(),a(13,"div",112)(14,"div",113)(15,"label",62),l(16,"Paralelo"),t(),a(17,"input",127),w("ngModelChange",function(o){m(e);let u=d();return h(u.editMateriaPayload.Paralelo,o)||(u.editMateriaPayload.Paralelo=o),_(o)}),t()(),a(18,"div",113)(19,"label",62),l(20,"Turno"),t(),a(21,"input",127),w("ngModelChange",function(o){m(e);let u=d();return h(u.editMateriaPayload.Turno,o)||(u.editMateriaPayload.Turno=o),_(o)}),t()(),a(22,"div",128)(23,"label",62),l(24,"Modo asistencia"),t(),a(25,"input",127),w("ngModelChange",function(o){m(e);let u=d();return h(u.editMateriaPayload.ModoAsistencia,o)||(u.editMateriaPayload.ModoAsistencia=o),_(o)}),t()(),a(26,"div",128)(27,"label",62),l(28,"Estado habilitaci\xF3n"),t(),a(29,"input",127),w("ngModelChange",function(o){m(e);let u=d();return h(u.editMateriaPayload.EstadoHabilitacion,o)||(u.editMateriaPayload.EstadoHabilitacion=o),_(o)}),t()(),a(30,"div",128)(31,"label",62),l(32,"Estado env\xEDo"),t(),a(33,"input",127),w("ngModelChange",function(o){m(e);let u=d();return h(u.editMateriaPayload.EstadoEnvio,o)||(u.editMateriaPayload.EstadoEnvio=o),_(o)}),t()()()(),a(34,"div",129)(35,"button",130),v("click",function(){m(e);let o=d();return _(o.cerrarEdicionMateria())}),l(36,"Cancelar"),t(),a(37,"button",131),v("click",function(){m(e);let o=d();return _(o.guardarEdicionMateria())}),p(38,gt,1,0,"span",132),l(39," Guardar "),t()()()()()}if(n&2){let e=d();r(10),O("",e.editMateria==null?null:e.editMateria.sigla_materia," \u2014 ",e.editMateria==null?null:e.editMateria.nombre_materia),r(2),g(e.editMateria==null?null:e.editMateria.lvl_curso),r(5),b("ngModel",e.editMateriaPayload.Paralelo),r(4),b("ngModel",e.editMateriaPayload.Turno),r(4),b("ngModel",e.editMateriaPayload.ModoAsistencia),r(4),b("ngModel",e.editMateriaPayload.EstadoHabilitacion),r(4),b("ngModel",e.editMateriaPayload.EstadoEnvio),r(2),c("disabled",e.editSaving),r(2),c("disabled",e.editSaving),r(),c("ngIf",e.editSaving)}}var V=class V{constructor(i,e,s,o,u){this.router=i;this._auth=e;this._perfil=s;this._tools=o;this._security=u;this.ruta=k.ruta;this.infoHJVida="";this.apunteSeleccionado="";this.datasesion=null;this.perfilLoading=!0;this.perfilError="";this.activeTab="home";this.menuOpen=!0;this.twofaLoading=!1;this.twofaEnabled=!1;this.twofaConfirmedAt=null;this.twofaSecret="";this.twofaOtpAuthUrl="";this.twofaQrDataUrl="";this.twofaCode="";this.twofaDisableCode="";this.materiasLoading=!1;this.materiasPorInstitucion=[];this.materiasError="";this.deudasLoading=!1;this.deudasPorInstitucion=[];this.deudasError="";this.editMateriaOpen=!1;this.editMateria=null;this.editMateriaPayload={Paralelo:"",Turno:"",ModoAsistencia:"",EstadoHabilitacion:"",EstadoEnvio:""};this.editSaving=!1;this.claveActual="";this.nuevaClave="";this.confirmarClave="";this.errorClave="";this.mostrarModalCambioClave=!1}ngOnInit(){this.PedirInformacionPerfil()}setTab(i){this.activeTab=i,i==="misMaterias"&&this.cargarMaterias(),i==="deudas"&&this.cargarDeudas()}get tipoSesion(){return(this.datasesion?.tipo??"").toString()}get esDocente(){return this.tipoSesion==="planteldocentes"}get esEstudiante(){return this.tipoSesion==="estudiantesifas"}get esAdministrativo(){return this.tipoSesion==="planteladministrativos"}get esSuper(){return this.tipoSesion==="superlcchs"}normalizarTexto(i){return(i??"").toString().trim()}docenteNombre(i){let e=this.normalizarTexto(i?.docente_nombre);return e!==""?e:"SIN DOCENTE"}fotoUrl(i){let e=this.normalizarTexto(i);if(e===""||e.toLowerCase()==="null"||e.toLowerCase()==="undefined")return this.ruta+"fijos/sinperfil.jpg";let s=e.toLowerCase();return s.startsWith("http://")||s.startsWith("https://")||s.startsWith("data:")?e:this.ruta+e}agruparPorGestion(i){let e=new Map;(i??[]).forEach(o=>{let u=this.normalizarTexto(o?.gestion)||"SIN GESTI\xD3N";e.has(u)||e.set(u,[]),e.get(u).push(o)});let s=Array.from(e.keys());return s.sort((o,u)=>{let L=Number(o),K=Number(u),G=!Number.isNaN(L)&&o!=="SIN GESTI\xD3N",Q=!Number.isNaN(K)&&u!=="SIN GESTI\xD3N";return G&&Q?K-L:G&&!Q?-1:!G&&Q?1:o.localeCompare(u)}),s.map(o=>({gestion:o,items:e.get(o)??[]}))}PedirInformacionPerfil(){this.perfilLoading=!0,this.perfilError="",this._auth.pedirPerfil().subscribe({next:i=>{this.datasesion=i,this.infoHJVida=this.datasesion?.usuario?.hojadevida??"",this.perfilLoading=!1,this.cargarTwofaStatus(),this.cargarMaterias(),this.esEstudiante&&this.cargarDeudas()},error:i=>{console.error("Error al obtener el perfil:",i),this.perfilLoading=!1,this.perfilError="No se pudo cargar el perfil."}})}cargarTwofaStatus(){this.datasesion&&(this.twofaLoading||(this.twofaLoading=!0,this._security.get2faStatus().subscribe({next:i=>{this.twofaEnabled=!!i?.enabled,this.twofaConfirmedAt=i?.confirmed_at??null,this.twofaLoading=!1},error:i=>{console.log("Error 2FA status",i),this.twofaLoading=!1}})))}generarQrTwofa(){return q(this,null,function*(){this.twofaLoading||(this.twofaLoading=!0,this.twofaSecret="",this.twofaOtpAuthUrl="",this.twofaQrDataUrl="",this.twofaCode="",this._security.startEnroll2fa().subscribe({next:i=>q(this,null,function*(){this.twofaSecret=i?.secret??"",this.twofaOtpAuthUrl=i?.otpauth_url??"";try{this.twofaOtpAuthUrl&&(this.twofaQrDataUrl=yield ge.default.toDataURL(this.twofaOtpAuthUrl,{width:220,margin:1}))}catch(e){console.log("Error generando QR",e),this.twofaQrDataUrl=""}this.twofaLoading=!1,this._tools.MensajeInformacion("Seguridad","QR generado. Escan\xE9alo con Google Authenticator.","info")}),error:i=>{this.twofaLoading=!1;let e=i?.error?.message||"No se pudo generar el QR.";this._tools.MensajeInformacion("Error",e,"error")}}))})}confirmarVinculoTwofa(){if(!this.twofaLoading){if(!this.twofaCode||this.twofaCode.trim()===""){this._tools.MensajeInformacion("Falta c\xF3digo","Ingresa el c\xF3digo de 6 d\xEDgitos.","warning");return}this.twofaLoading=!0,this._security.confirmEnroll2fa(this.twofaCode).subscribe({next:i=>{this.twofaLoading=!1,this.twofaEnabled=!0,this.twofaConfirmedAt=i?.confirmed_at??null,this.twofaCode="",this._tools.MensajeInformacion("\xC9xito","Google Authenticator vinculado.","success")},error:i=>{this.twofaLoading=!1;let e=i?.error?.message||"No se pudo confirmar el c\xF3digo.";this._tools.MensajeInformacion("Error",e,"error")}})}}desvincularTwofa(){if(!this.twofaLoading){if(!this.twofaDisableCode||this.twofaDisableCode.trim()===""){this._tools.MensajeInformacion("Falta c\xF3digo","Ingresa el c\xF3digo para desvincular.","warning");return}this.twofaLoading=!0,this._security.disable2fa(this.twofaDisableCode).subscribe({next:()=>{this.twofaLoading=!1,this.twofaEnabled=!1,this.twofaConfirmedAt=null,this.twofaSecret="",this.twofaOtpAuthUrl="",this.twofaQrDataUrl="",this.twofaDisableCode="",this._tools.MensajeInformacion("OK","Google Authenticator desvinculado.","success")},error:i=>{this.twofaLoading=!1;let e=i?.error?.message||"No se pudo desvincular.";this._tools.MensajeInformacion("Error",e,"error")}})}}toggleMenu(){this.menuOpen=!this.menuOpen}cargarMaterias(){this.datasesion&&(this.materiasLoading||(this.materiasLoading=!0,this.materiasError="",this._perfil.obtenerMaterias().subscribe({next:i=>{this.materiasPorInstitucion=Array.isArray(i?.data)?i.data:[],this.materiasLoading=!1},error:i=>{console.log("Error al cargar materias de perfil",i),this.materiasLoading=!1,this.materiasError="No se pudo cargar la lista de materias."}})))}cargarDeudas(){!this.datasesion||!this.esEstudiante||this.deudasLoading||(this.deudasLoading=!0,this.deudasError="",this._perfil.obtenerDeudas().subscribe({next:i=>{this.deudasPorInstitucion=Array.isArray(i?.data)?i.data:[],this.deudasLoading=!1},error:i=>{console.log("Error al cargar deudas de perfil",i),this.deudasLoading=!1,this.deudasError="No se pudo cargar las deudas."}}))}abrirEdicionMateria(i){this.esDocente&&(this.editMateria=i,this.editMateriaPayload={Paralelo:i?.materia_paralelo??"",Turno:i?.materia_turno??"",ModoAsistencia:i?.materia_modo_asistencia??"",EstadoHabilitacion:i?.materia_estado_habilitacion??"",EstadoEnvio:i?.materia_estado_envio??""},this.editMateriaOpen=!0)}cerrarEdicionMateria(){this.editMateriaOpen=!1,this.editMateria=null,this.editSaving=!1}guardarEdicionMateria(){if(!this.esDocente||!this.editMateria?.materia_id||this.editSaving)return;this.editSaving=!0;let i=Number(this.editMateria.materia_id);this._perfil.actualizarMateriaDocente(i,this.editMateriaPayload).subscribe({next:e=>{let s=e?.data;s&&this.materiasPorInstitucion.forEach(o=>{(o?.items??[]).forEach((u,L)=>{Number(u?.materia_id)===i&&(o.items[L]=B(B({},u),s))})}),this.editSaving=!1,this.editMateriaOpen=!1,this._tools.MensajeInformacion("\xC9xito","Materia actualizada.","success")},error:e=>{console.log("Error al actualizar materia",e),this.editSaving=!1;let s=e?.error?.message||"No se pudo actualizar la materia.";this._tools.MensajeInformacion("Error",s,"error")}})}cambiarClave(){if(this.errorClave="",!this.claveActual||!this.nuevaClave||!this.confirmarClave){this.errorClave="Todos los campos son obligatorios.";return}if(this.nuevaClave!==this.confirmarClave){this.errorClave="Las contrase\xF1as nuevas no coinciden.";return}if(this.nuevaClave.length<6){this.errorClave="La nueva contrase\xF1a debe tener al menos 6 caracteres.";return}this._auth.cambiarClave({claveActual:this.claveActual,nuevaClave:this.nuevaClave}).subscribe({next:i=>{this.mostrarModalCambioClave=!1,this.claveActual="",this.nuevaClave="",this.confirmarClave="",this.errorClave="",this._tools.MensajeInformacion("\xC9xito","Contrase\xF1a cambiada correctamente.","success")},error:i=>{this.errorClave=i?.error?.mensaje||"Error al cambiar la contrase\xF1a."}})}};V.\u0275fac=function(e){return new(e||V)(M(ce),M(pe),M(W),M(fe),M(U))},V.\u0275cmp=X({type:V,selectors:[["app-perfil"]],standalone:!1,decls:5,vars:4,consts:[["sinDeuda",""],[1,"container-fluid"],["class","p-4",4,"ngIf"],["class","row flex-nowrap",4,"ngIf"],["class","modal d-block","tabindex","-1","style","background: rgba(0,0,0,.5);",4,"ngIf"],[1,"p-4"],[1,"d-flex","align-items-center","gap-2"],["role","status",1,"spinner-border"],[1,"alert","alert-warning","mb-0"],[1,"row","flex-nowrap"],[1,"col-auto","col-md-3","col-xl-2","px-sm-2","px-0","sidebar",3,"ngClass"],["type","button",1,"navbar-toggler","text-dark","toggle-btn",3,"click"],[1,"d-flex","flex-column","align-items-center","align-items-sm-start","px-3","pt-2","min-vh-100"],["class","w-100 mb-3",4,"ngIf"],["id","menu",1,"nav","nav-pills","flex-column","mb-sm-auto","mb-0","align-items-center","align-items-sm-start"],[1,"nav-item"],[1,"nav-link","align-middle","px-0",3,"click"],[1,"fs-4","bi-house"],["class","ms-1 d-sm-inline",4,"ngIf"],[1,"nav-link","px-0","align-middle",3,"click"],[1,"fs-4","bi-person"],[1,"fs-4","bi-shield-lock"],[1,"fs-4","bi-journal-bookmark"],[4,"ngIf"],["tabindex","-1",1,"d-md-none","position-fixed","top-5","end-0","m-3",2,"z-index","1050"],[1,"btn","btn-primary",2,"border-radius","50%","width","56px","height","56px",3,"click"],[1,"bi","bi-list",2,"font-size","1.5rem"],[1,"col","py-3","bg-light"],[1,"container"],["class","alert alert-danger",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-3"],[1,"h4","mb-0"],[1,"text-muted","small"],[1,"badge","bg-secondary"],[1,"w-100","mb-3"],[1,"small","text-muted"],[1,"fw-semibold"],[1,"ms-1","d-sm-inline"],[1,"fs-4","bi-cash-coin"],[1,"alert","alert-danger"],[1,"row","g-3"],[1,"col-12","col-lg-6"],[1,"card","shadow-sm"],[1,"card-body"],[1,"d-flex","flex-wrap","gap-2","mt-3"],["type","button",1,"btn","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-outline-dark",3,"click"],["class","btn btn-outline-success","type","button",3,"click",4,"ngIf"],[1,"small","text-muted","mt-2"],["class","small text-muted",4,"ngIf"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"col-12","col-md-4","text-center"],["alt","Foto de perfil",1,"img-fluid","rounded-circle","mb-3",2,"width","140px","height","140px","object-fit","cover",3,"src"],[1,"col-12","col-md-8"],[1,"table","table-bordered","mb-0"],[2,"width","220px"],[1,"my-4"],[1,"card","border-0","bg-white","shadow-sm"],[1,"fw-semibold","mb-2"],["class","alert alert-danger py-2",4,"ngIf"],[1,"mb-2"],[1,"form-label"],["type","password","autocomplete","current-password",1,"form-control",3,"ngModelChange","ngModel"],["type","password","autocomplete","new-password",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["type","button",1,"btn","btn-warning",3,"click"],[1,"bi","bi-key-fill","me-1"],["class","col-12 col-lg-6",4,"ngIf"],[1,"alert","alert-danger","py-2"],["disabled","",1,"quill-container-wrapper",3,"ngModelChange","modules","ngModel"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"h5","mb-0"],[1,"badge",3,"ngClass"],[1,"my-3"],["class","d-flex align-items-center gap-2 py-2",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"d-flex","align-items-center","gap-2","py-2"],[1,"card","border-0","bg-white","shadow-sm","h-100"],[1,"small","text-muted","mb-3"],["type","button",1,"btn","btn-primary",3,"click"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["type","text","placeholder","123456",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-success","mt-2",3,"click","disabled"],["alt","QR 2FA",1,"border","rounded",2,"width","220px","height","220px",3,"src"],[1,"fw-semibold",2,"word-break","break-all"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"d-flex","align-items-center","justify-content-between","mb-2"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],["class","d-flex align-items-center gap-2 py-3",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","gap-2","py-3"],[1,"alert","alert-info"],[1,"mb-4"],[1,"d-flex","align-items-center","gap-2","mb-2"],["style","width: 28px; height: 28px; object-fit: contain;",3,"src","alt",4,"ngIf"],[1,"badge","bg-light","text-dark","border"],["class","mb-3",4,"ngFor","ngForOf"],[2,"width","28px","height","28px","object-fit","contain",3,"src","alt"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-2"],["class","col-12 col-md-6 col-lg-4",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","col-lg-4"],[1,"card","h-100","shadow-sm"],[1,"d-flex","justify-content-between","align-items-start","gap-2"],[1,"fw-bold"],["class","badge bg-secondary",4,"ngIf"],[1,"d-flex","align-items-center","gap-2","mt-3"],["alt","Docente",1,"rounded-circle","border",2,"width","36px","height","36px","object-fit","cover",3,"src"],[1,"lh-sm"],["class","d-grid mt-3",4,"ngIf"],[1,"row","g-2"],[1,"col-6"],[1,"d-grid","mt-3"],["class","col-12 col-md-6",4,"ngFor","ngForOf"],[1,"col-12","col-md-6"],[1,"mt-2"],["class","fw-semibold",4,"ngIf","ngIfElse"],[1,"badge","bg-success"],["tabindex","-1",1,"modal","d-block",2,"background","rgba(0,0,0,.5)"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,s){e&1&&(a(0,"div",1),p(1,Se,5,0,"div",2)(2,Pe,3,0,"div",2)(3,vt,44,28,"div",3)(4,xt,40,11,"div",4),t()),e&2&&(r(),c("ngIf",s.perfilLoading),r(),c("ngIf",!s.perfilLoading&&!s.datasesion),r(),c("ngIf",s.datasesion),r(),c("ngIf",s.editMateriaOpen))},dependencies:[ne,ae,re,ue,me,_e,oe],styles:[".sidebar[_ngcontent-%COMP%]{border-right:1px solid rgba(var(--color-basico-institucional-rgb),.25);background-color:#f8f9fa;transition:width .3s}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]{width:60px}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .sidebar.sidebar-collapsed[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}.sidebar.sidebar-expanded[_ngcontent-%COMP%]{width:250px}.sidebar[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]{display:block;margin:1rem;border:none;background:transparent;cursor:pointer;font-size:1.5rem}.sidebar[_ngcontent-%COMP%]   .navbar-toggler[_ngcontent-%COMP%]:focus{outline:none}.sidebar[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{color:#343a40}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#343a40;border-radius:.5rem;width:100%;text-align:left}.sidebar[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:rgba(var(--color-basico-institucional-rgb),.12);color:var(--color-basico-institucional);font-weight:600}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--color-basico-institucional);background-color:rgba(var(--color-basico-institucional-rgb),.08)}.sidebar[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:70%}.sidebar.sidebar-collapsed[_ngcontent-%COMP%]{width:60px}.sidebar.sidebar-expanded[_ngcontent-%COMP%]{width:250px}}"]});var R=V;var bt=[{path:"perfil",component:R}],S=class S{};S.\u0275fac=function(e){return new(e||S)},S.\u0275mod=j({type:S}),S.\u0275inj=N({imports:[J.forChild(bt),J]});var z=S;var P=class P{};P.\u0275fac=function(e){return new(e||P)},P.\u0275mod=j({type:P}),P.\u0275inj=N({imports:[le,ve,z]});var xe=P;export{xe as PrivadosModule};
