import{a as me}from"./chunk-ZSNHXLZQ.js";import{a as pe}from"./chunk-R542E3BI.js";import{a as te}from"./chunk-2THCIOO7.js";import{b as de}from"./chunk-MJQY6A63.js";import{a as ue}from"./chunk-OOC77CZV.js";import"./chunk-54WVOQJ7.js";import"./chunk-M3KGNDQ5.js";import{b as ie,d as ne,f as ae,g as h,k as re,n as oe,o as se,p as le,u as ce}from"./chunk-NILQYPGY.js";import{a as D}from"./chunk-OQPWVW4O.js";import{Bb as G,Ha as c,Ia as n,Ja as i,Ka as v,O as U,Oa as F,P as I,Pa as A,R as Y,Ra as b,Rb as Q,Sb as W,U as _,Ua as u,V as f,Wa as d,Zb as X,a as $,ac as w,cc as L,db as V,dc as ee,eb as J,fb as Z,g as H,ga as K,ia as s,ib as r,jb as g,kb as x,mb as O,nb as k,nc as j,pa as y,ra as z,sa as M,wa as p,za as q}from"./chunk-TNNFIFGQ.js";var S=class S{constructor(t){this.http=t;this.ruta=D.ruta}ObtenerPagoslcch(t){let e=new w;return t?.infoestudiantesifas_id&&(e=e.set("infoestudiantesifas_id",String(t.infoestudiantesifas_id))),t?.gestion&&(e=e.set("gestion",String(t.gestion))),t?.mes&&(e=e.set("mes",String(t.mes))),this.http.get(this.ruta+"api/pagoslcch",{params:e})}ObtenerPagoslcchPorInfo(t){return this.http.get(this.ruta+"api/pagoslcch/by-info/"+t)}ObtenerDeudaPorInfo(t,e){let a=new w;return e&&(a=a.set("gestion",String(e))),this.http.get(this.ruta+"api/pagoslcch/deuda/by-info/"+t,{params:a})}ObtenerGestionesAsignaciones(){return this.http.get(this.ruta+"api/pagoslcch/gestiones-asignaciones")}ObtenerDeudores(t){let e=new w;return e=e.set("gestion",String(t.gestion??"")),t.gestion_pago&&(e=e.set("gestion_pago",String(t.gestion_pago))),t.search&&(e=e.set("search",String(t.search))),t.page&&(e=e.set("page",String(t.page))),t.per_page&&(e=e.set("per_page",String(t.per_page))),this.http.get(this.ruta+"api/pagoslcch/deudores",{params:e})}AgregarPagoslcch(t){return this.http.post(this.ruta+"api/pagoslcch",t)}ModificarPagoslcch(t,e){return this.http.put(this.ruta+"api/pagoslcch/"+e,t)}SeleccionarPagoslcch(t){return this.http.get(this.ruta+"api/pagoslcch/"+t)}EliminarPagoslcch(t){return this.http.delete(this.ruta+"api/pagoslcch/"+t)}createFormGroupPagoslcch(){return new ae({id:new h(0),infoestudiantesifas_id:new h(null),mes:new h(1),gestion:new h(String(new Date().getFullYear())),monto:new h(""),fechapago:new h(""),horapago:new h(""),estadopago:new h("PAGADO"),observacion:new h(""),file:new h("")})}};S.\u0275fac=function(e){return new(e||S)(Y(ee))},S.\u0275prov=U({token:S,factory:S.\u0275fac,providedIn:"root"});var T=S;function fe(o,t){if(o&1&&(n(0,"option",38),r(1),i()),o&2){let e=t.$implicit;c("value",e),s(),g(e)}}function he(o,t){if(o&1){let e=b();n(0,"div",39)(1,"button",40),u("click",function(){_(e);let l=d(2);return f(l.deudoresPrev())}),r(2,"Anterior"),i(),n(3,"small",41),r(4),i(),n(5,"button",40),u("click",function(){_(e);let l=d(2);return f(l.deudoresNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d(2);s(),c("disabled",!e.deudoresTienePrev()||e.isLoadingDeudores),s(3),O(" P\xE1gina ",e.deudoresMeta.current_page," / ",e.deudoresMeta.last_page," (",e.deudoresMeta.total," resultados) "),s(),c("disabled",!e.deudoresTieneNext()||e.isLoadingDeudores)}}function ve(o,t){o&1&&(n(0,"th"),r(1,"Instituci\xF3n"),i())}function be(o,t){if(o&1&&(n(0,"td"),r(1),i()),o&2){let e=d().$implicit;s(),g(e.NombreInstitucion||"-")}}function xe(o,t){if(o&1){let e=b();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),p(9,be,2,1,"td",35),n(10,"td"),r(11),i(),n(12,"td"),r(13),i(),n(14,"td")(15,"button",42),u("click",function(){let l=_(e).$implicit,m=d(2);return f(m.seleccionarInscripcion(l))}),r(16," Cobrar "),i()()()}if(o&2){let e=t.$implicit,a=d(2);s(2),x("#",e.id),s(2),O("",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre),s(2),g(e.CI||"-"),s(2),g(e.Matricula||"-"),s(),c("ngIf",a.esSuperAdmin),s(2),g(e.Anio||"SIN ASIGNAR"),s(2),g(a.mesLabels(e.meses_deuda))}}function Se(o,t){if(o&1&&(n(0,"tr")(1,"td",43),r(2,"Sin registros"),i()()),o&2){let e=d(2);s(),q("colspan",e.esSuperAdmin?8:7)}}function Ce(o,t){if(o&1){let e=b();n(0,"div",7)(1,"div",27)(2,"span"),r(3,"Estudiantes con deuda (paginado)"),i(),n(4,"div",28)(5,"label",29),r(6,"Gesti\xF3n"),i(),n(7,"select",30),u("change",function(){_(e);let l=d();return f(l.cargarDeudores(1))}),p(8,fe,2,2,"option",31),i()()(),n(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"span",12),v(14,"i",13),i(),n(15,"div",14)(16,"input",32),u("input",function(l){_(e);let m=d();return f(m.filterDeudores=l.target.value)})("keyup.enter",function(){_(e);let l=d();return f(l.cargarDeudores(1))}),i(),n(17,"label"),r(18,"Buscar (nombre/CI/matr\xEDcula)"),i()(),n(19,"button",16),u("click",function(){_(e);let l=d();return f(l.cargarDeudores(1))}),r(20," Buscar "),i()(),p(21,he,7,5,"div",17),i(),n(22,"div",23)(23,"label",24),r(24,"Total deudores"),i(),v(25,"input",25),i()()(),n(26,"div",33)(27,"table",34)(28,"thead")(29,"tr")(30,"th"),r(31,"Inscripci\xF3n"),i(),n(32,"th"),r(33,"Estudiante"),i(),n(34,"th"),r(35,"CI"),i(),n(36,"th"),r(37,"Matr\xEDcula"),i(),p(38,ve,2,0,"th",35),n(39,"th"),r(40,"Gesti\xF3n (asignaci\xF3n)"),i(),n(41,"th"),r(42,"Meses adeudados"),i(),n(43,"th",36),r(44,"Acciones"),i()()(),n(45,"tbody"),p(46,xe,17,9,"tr",37)(47,Se,3,1,"tr",35),i()()()()}if(o&2){let e=d();s(7),c("formControl",e.gestionDeudores),s(),c("ngForOf",e.gestionesAsignaciones),s(8),c("value",e.filterDeudores),s(3),c("disabled",e.isLoadingDeudores),s(2),c("ngIf",e.deudoresMeta),s(4),c("value",(e.deudoresMeta==null?null:e.deudoresMeta.total)||0),s(13),c("ngIf",e.esSuperAdmin),s(8),c("ngForOf",e.deudores),s(),c("ngIf",e.deudores.length===0)}}function Ee(o,t){if(o&1){let e=b();n(0,"div",39)(1,"button",40),u("click",function(){_(e);let l=d();return f(l.resPrev())}),r(2,"Anterior"),i(),n(3,"small",41),r(4),i(),n(5,"button",40),u("click",function(){_(e);let l=d();return f(l.resNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d();s(),c("disabled",!e.resTienePrev()||e.isLoadingResultados),s(3),O(" P\xE1gina ",e.resMeta.current_page," / ",e.resMeta.last_page," (",e.resMeta.total," resultados) "),s(),c("disabled",!e.resTieneNext()||e.isLoadingResultados)}}function ye(o,t){if(o&1){let e=b();n(0,"button",40),u("click",function(){let l=_(e).$implicit,m=d();return f(m.seleccionarInscripcion(l))}),r(1),n(2,"span",41),r(3),i()()}if(o&2){let e=t.$implicit,a=d();Z("active",a.infoCtrl.value===e.id),c("disabled",a.isLoadingResultados),s(),k(" ",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre,"",a.esSuperAdmin?" | "+e.NombreInstitucion:""," | ",e.Anio," "),s(2),x("(#",e.id,")")}}function Pe(o,t){o&1&&(n(0,"small",41),r(1,"Busca y selecciona una inscripci\xF3n para registrar pagos."),i())}function Ie(o,t){if(o&1&&(n(0,"span",41),r(1),i()),o&2){let e=d(2);s(),k(" (",e.infoSeleccionada.Ap_Paterno," ",e.infoSeleccionada.Ap_Materno," ",e.infoSeleccionada.Nombre,"",e.esSuperAdmin?" | "+e.infoSeleccionada.NombreInstitucion:""," | ",e.infoSeleccionada.Anio,") ")}}function Me(o,t){if(o&1){let e=b();n(0,"div",44)(1,"small",45),r(2," Inscripci\xF3n seleccionada: "),n(3,"b"),r(4),i(),p(5,Ie,2,5,"span",21),i(),n(6,"button",46),u("click",function(){_(e);let l=d();return f(l.limpiarSeleccion())}),r(7,"Quitar selecci\xF3n"),i()()}if(o&2){let e=d();s(4),x("#",e.infoCtrl.value),s(),c("ngIf",e.infoSeleccionada)}}function Fe(o,t){if(o&1){let e=b();n(0,"button",70),u("click",function(){_(e);let l=d(2);return f(l.limpiarFormulario())}),r(1,"Cancelar edici\xF3n"),i()}}function Ae(o,t){if(o&1&&(n(0,"span",72),r(1),i()),o&2){let e=t.$implicit,a=d(3);s(),g(a.mesLabel(e))}}function Oe(o,t){if(o&1&&(F(0),p(1,Ae,2,1,"span",71),A()),o&2){let e=d(2);s(),c("ngForOf",e.mesesPagadosGestion)}}function we(o,t){o&1&&(n(0,"span",41),r(1,"-"),i())}function De(o,t){o&1&&(n(0,"span",41),r(1,"Calculando..."),i())}function Te(o,t){if(o&1&&(n(0,"span",74),r(1),i()),o&2){let e=t.$implicit,a=d(4);s(),g(a.mesLabel(e))}}function Ne(o,t){if(o&1&&(F(0),p(1,Te,2,1,"span",73),A()),o&2){let e=d(3);s(),c("ngForOf",e.deudaMeses)}}function Re(o,t){o&1&&(n(0,"span",41),r(1,"Sin deuda detectada"),i())}function Ve(o,t){if(o&1&&(F(0),p(1,Ne,2,1,"ng-container",52)(2,Re,2,0,"ng-template",null,1,G),A()),o&2){let e=V(3),a=d(2);s(),c("ngIf",a.deudaMeses.length>0)("ngIfElse",e)}}function ke(o,t){if(o&1&&(n(0,"small",41),r(1),i()),o&2){let e=d(2);s(),x(" Referencia: un compa\xF1ero lleg\xF3 hasta ",e.mesLabel(e.deudaMaxMesCompaneros),". ")}}function Ge(o,t){if(o&1&&(n(0,"option",38),r(1),i()),o&2){let e=t.$implicit;c("value",e.value),s(),g(e.label)}}function Le(o,t){if(o&1&&(n(0,"option",75),r(1),i()),o&2){let e=t.$implicit;c("value",e.value)("disabled",e.disabled),s(),g(e.label)}}function je(o,t){if(o&1&&(n(0,"div",76)(1,"div",77)(2,"div",78),r(3),i()()()),o&2){let e=d(2);s(2),J("width",e.uploadProgress,"%"),s(),x("",e.uploadProgress,"%")}}function Be(o,t){if(o&1){let e=b();n(0,"div",7)(1,"div",47)(2,"span"),r(3),i(),p(4,Fe,2,0,"button",48),i(),n(5,"div",8)(6,"div",49)(7,"div",44)(8,"small",41),r(9,"Gesti\xF3n:"),i(),n(10,"span",50),r(11),i(),n(12,"small",51),r(13,"Meses pagados (PAGADO):"),i(),p(14,Oe,2,1,"ng-container",52)(15,we,2,0,"ng-template",null,0,G),n(17,"small",51),r(18,"Meses adeudados (seg\xFAn compa\xF1eros):"),i(),p(19,De,2,0,"span",21)(20,Ve,4,2,"ng-container",35),i(),p(21,ke,2,1,"small",21),i(),n(22,"div",53)(23,"div",54)(24,"label",24),r(25,"Mes"),i(),n(26,"select",55),p(27,Ge,2,2,"option",31),i()(),n(28,"div",56)(29,"label",24),r(30,"Gesti\xF3n"),i(),v(31,"input",57),i(),n(32,"div",54)(33,"label",24),r(34,"Monto"),i(),v(35,"input",58),i(),n(36,"div",59)(37,"label",24),r(38,"Estado pago"),i(),n(39,"select",55),p(40,Le,2,3,"option",60),i()(),n(41,"div",59)(42,"label",24),r(43,"Fecha de pago"),i(),v(44,"input",61),i(),n(45,"div",59)(46,"label",24),r(47,"Hora"),i(),v(48,"input",62),i(),n(49,"div",59)(50,"label",24),r(51,"Comprobante"),i(),n(52,"input",63),u("change",function(l){_(e);let m=d();return f(m.onFileSelected(l))}),i(),p(53,je,4,3,"div",64),i(),n(54,"div",65)(55,"label",24),r(56,"Observaci\xF3n"),i(),v(57,"textarea",66),i(),n(58,"div",67)(59,"button",68),u("click",function(){_(e);let l=d();return f(l.guardar())}),r(60,"Guardar"),i(),n(61,"button",69),u("click",function(){_(e);let l=d();return f(l.limpiarFormulario())}),r(62,"Limpiar"),i()()()()()}if(o&2){let e,a=V(16),l=d();s(3),g(l.editId?"Editar pago":"Registrar pago"),s(),c("ngIf",l.editId),s(7),g(((e=l.frmPago.get("gestion"))==null?null:e.value)||"-"),s(3),c("ngIf",l.mesesPagadosGestion.length>0)("ngIfElse",a),s(5),c("ngIf",l.isLoadingDeuda),s(),c("ngIf",!l.isLoadingDeuda),s(),c("ngIf",l.deudaMaxMesCompaneros),s(5),c("formControl",l.frmPago.get("mes")),s(),c("ngForOf",l.meses),s(4),c("formControl",l.frmPago.get("gestion")),s(4),c("formControl",l.frmPago.get("monto")),s(4),c("formControl",l.frmPago.get("estadopago")),s(),c("ngForOf",l.estadoPagoOptions),s(4),c("formControl",l.frmPago.get("fechapago")),s(4),c("formControl",l.frmPago.get("horapago")),s(5),c("ngIf",l.uploadProgress!==null),s(4),c("formControl",l.frmPago.get("observacion")),s(2),c("disabled",l.uploading)}}function $e(o,t){if(o&1&&(n(0,"a",85),r(1,"Ver"),i()),o&2){let e=d().$implicit,a=d(2);c("href",a.ruta+e.file,K)}}function He(o,t){o&1&&(n(0,"span"),r(1,"-"),i())}function Ue(o,t){if(o&1){let e=b();n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),r(10),i(),n(11,"td"),r(12),i(),n(13,"td"),p(14,$e,2,1,"a",81)(15,He,2,0,"span",35),i(),n(16,"td")(17,"div",82)(18,"button",83),u("click",function(){let l=_(e).$implicit,m=d(2);return f(m.iniciarEditar(l))}),r(19,"Editar"),i(),n(20,"button",84),u("click",function(){let l=_(e).$implicit,m=d(2);return f(m.eliminar(l))}),r(21,"Eliminar"),i()()()()}if(o&2){let e=t.$implicit,a=d(2);s(2),g(e.gestion),s(2),g(a.mesLabel(e.mes)),s(2),g(e.monto),s(2),g(e.fechapago),s(2),g(e.horapago),s(2),g(e.estadopago),s(2),c("ngIf",e.file),s(),c("ngIf",!e.file)}}function Ye(o,t){o&1&&(n(0,"tr")(1,"td",86),r(2,"Sin registros"),i()())}function Ke(o,t){if(o&1&&(n(0,"div",79)(1,"div",80),r(2,"Pagos registrados"),i(),n(3,"div",33)(4,"table",34)(5,"thead")(6,"tr")(7,"th"),r(8,"Gesti\xF3n"),i(),n(9,"th"),r(10,"Mes"),i(),n(11,"th"),r(12,"Monto"),i(),n(13,"th"),r(14,"Fecha"),i(),n(15,"th"),r(16,"Hora"),i(),n(17,"th"),r(18,"Estado"),i(),n(19,"th"),r(20,"Comprobante"),i(),n(21,"th",36),r(22,"Acciones"),i()()(),n(23,"tbody"),p(24,Ue,22,8,"tr",37)(25,Ye,3,0,"tr",35),i()()()()),o&2){let e=d();s(24),c("ngForOf",e.pagos),s(),c("ngIf",e.pagos.length===0)}}var P=class P{constructor(t,e,a,l,m){this._info=t;this._pagos=e;this._tools=a;this._controles=l;this._auth=m;this.ruta=D.ruta;this.infoCtrl=new h(null);this.filterInscripcion="";this.resultados=[];this.resMeta=null;this.resPage=1;this.resPerPage=10;this.isLoadingResultados=!1;this.infoSeleccionada=null;this.pagos=[];this.frmPago=this._pagos.createFormGroupPagoslcch();this.editId=null;this.meses=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}];this.estadoPagoOptions=[];this.isLoadingDeuda=!1;this.deudaMeses=[];this.deudaMaxMesCompaneros=null;this.mesesPagadosGestion=[];this.deudaKey=null;this.gestionesAsignaciones=[];this.gestionDeudores=new h(String(new Date().getFullYear()));this.verDeudores=!1;this.filterDeudores="";this.deudores=[];this.deudoresMeta=null;this.deudoresPage=1;this.deudoresPerPage=10;this.isLoadingDeudores=!1;this.uploading=!1;this.uploadProgress=null;this.tempFilePath=null;this.originalFilePath=null;this.esSuperAdmin=!1}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>this.esSuperAdmin=t),this.cargarEstadoPagoOptions(),this.cargarGestionesAsignaciones(),this.infoCtrl.valueChanges.subscribe(t=>{let e=Number(t||0);e>0?(this.resetFormForInfo(e),this.cargarPagos(e),this.cargarDeudaActual()):(this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.infoSeleccionada=null,this.resetFormForInfo(null))}),this.frmPago.get("gestion")?.valueChanges.subscribe(()=>{this.recalcularMesesPagadosGestion(),this.cargarDeudaActual()})}cargarGestionesAsignaciones(){this._pagos.ObtenerGestionesAsignaciones().subscribe({next:t=>{let e=Array.isArray(t?.data)?t.data:[];this.gestionesAsignaciones=e},error:()=>{this.gestionesAsignaciones=["SIN ASIGNAR"]}})}toggleVerDeudores(){this.verDeudores=!this.verDeudores,this.verDeudores&&this.cargarDeudores(1)}cargarDeudores(t=1){if(this.isLoadingDeudores)return;let e=String(this.gestionDeudores.value??"").trim()||String(new Date().getFullYear()),a=(this.filterDeudores??"").trim();this.isLoadingDeudores=!0,this._pagos.ObtenerDeudores({gestion:e,page:t,per_page:this.deudoresPerPage,search:a||void 0}).subscribe({next:l=>{this.deudores=Array.isArray(l?.data)?l.data:[],this.deudoresMeta=l?.meta??null,this.deudoresPage=this.deudoresMeta?.current_page??t},error:l=>{console.log("ERROR CARGANDO DEUDORES",l),this.deudores=[],this.deudoresMeta=null,this.deudoresPage=1},complete:()=>{this.isLoadingDeudores=!1}})}deudoresTienePrev(){return(this.deudoresMeta?.current_page??1)>1}deudoresTieneNext(){let t=this.deudoresMeta?.current_page??1,e=this.deudoresMeta?.last_page??1;return t<e}deudoresPrev(){this.deudoresTienePrev()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)-1)}deudoresNext(){this.deudoresTieneNext()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)+1)}mesLabels(t){return(Array.isArray(t)?t:[]).map(a=>this.mesLabel(a)).filter(a=>!!a).join(", ")}cargarEstadoPagoOptions(){this._controles.ObtenerOptionsSelectPorCategoria("ESTADO PAGO").subscribe({next:t=>this.estadoPagoOptions=t||[],error:()=>this.estadoPagoOptions=[]})}buscarInscripciones(t=1){if(this.isLoadingResultados)return;let e=(this.filterInscripcion??"").trim();if(!e||e.length<2){this.resultados=[],this.resMeta=null,this.resPage=1;return}this.isLoadingResultados=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.resPerPage,search:e,sort_by:"Ap_Paterno",sort_dir:"asc"}).subscribe({next:a=>{this.resultados=Array.isArray(a?.data)?a.data:[],this.resMeta=a?.meta??null,this.resPage=this.resMeta?.current_page??t},error:a=>{console.log("ERROR BUSCANDO INSCRIPCIONES",a),this.resultados=[],this.resMeta=null,this.resPage=1},complete:()=>{this.isLoadingResultados=!1}})}resTienePrev(){return(this.resMeta?.current_page??1)>1}resTieneNext(){let t=this.resMeta?.current_page??1,e=this.resMeta?.last_page??1;return t<e}resPrev(){this.resTienePrev()&&this.buscarInscripciones((this.resMeta?.current_page??1)-1)}resNext(){this.resTieneNext()&&this.buscarInscripciones((this.resMeta?.current_page??1)+1)}seleccionarInscripcion(t){let e=Number(t?.id??0);e&&(this.infoSeleccionada=t,this.infoCtrl.setValue(e))}limpiarSeleccion(){this.infoCtrl.setValue(null),this.infoSeleccionada=null,this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.resetFormForInfo(null)}cargarPagos(t){this._pagos.ObtenerPagoslcchPorInfo(t).subscribe({next:e=>{this.pagos=Array.isArray(e?.data)?e.data:[],this.recalcularMesesPagadosGestion()},error:e=>{console.log("ERROR CARGANDO PAGOS LCCH",e),this.pagos=[],this.mesesPagadosGestion=[]}})}recalcularMesesPagadosGestion(){let t=String(this.frmPago.get("gestion")?.value??"").trim();if(!t){this.mesesPagadosGestion=[];return}let e=(this.pagos??[]).filter(a=>String(a?.gestion??"").trim()===t).filter(a=>String(a?.estadopago??"").trim().toUpperCase()==="PAGADO").map(a=>Number(a?.mes??0)).filter(a=>Number.isFinite(a)&&a>=1&&a<=12);this.mesesPagadosGestion=Array.from(new Set(e)).sort((a,l)=>a-l)}cargarDeudaActual(){let t=Number(this.infoCtrl.value??0);if(!t)return;let e=String(this.frmPago.get("gestion")?.value??"").trim()||String(new Date().getFullYear()),a=`${t}|${e}`;this.deudaKey!==a&&(this.deudaKey=a,this.isLoadingDeuda=!0,this._pagos.ObtenerDeudaPorInfo(t,e).subscribe({next:l=>{let m=l?.data;this.deudaMeses=Array.isArray(m?.meses_deuda)?m.meses_deuda:[],this.deudaMaxMesCompaneros=Number.isFinite(Number(m?.max_mes_companeros))?Number(m?.max_mes_companeros):null},error:l=>{console.log("ERROR CARGANDO DEUDA",l),this.deudaMeses=[],this.deudaMaxMesCompaneros=null},complete:()=>{this.isLoadingDeuda=!1}}))}resetFormForInfo(t){this.cancelarEdicion(),this.frmPago.reset({id:0,infoestudiantesifas_id:t,mes:1,gestion:String(new Date().getFullYear()),monto:"",fechapago:"",horapago:"",estadopago:"PAGADO",observacion:"",file:""}),this.deudaKey=null}limpiarFormulario(){let t=this.infoCtrl.value??null;this.cancelarEdicion(),this.resetFormForInfo(t?Number(t):null)}iniciarEditar(t){this.cancelarEdicion(),this.editId=t?.id??null,this.originalFilePath=t?.file??null,this.frmPago.reset({id:t?.id??0,infoestudiantesifas_id:t?.infoestudiantesifas_id??this.infoCtrl.value,mes:t?.mes??1,gestion:t?.gestion??String(new Date().getFullYear()),monto:t?.monto??"",fechapago:t?.fechapago??"",horapago:t?.horapago??"",estadopago:t?.estadopago??"PAGADO",observacion:t?.observacion??"",file:t?.file??""})}cancelarEdicion(){this.tempFilePath&&this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null,this.originalFilePath=null,this.uploading=!1,this.uploadProgress=null,this.editId=null}onFileSelected(t){let e=t.target;if(!e?.files||e.files.length===0)return;let a=e.files[0];this.tempFilePath&&(this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null),this.uploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(a,"pagoslcchcomprobantes").subscribe({next:l=>{if(l.type===L.UploadProgress){let m=l.total??0;m>0&&(this.uploadProgress=Math.round(l.loaded/m*100))}if(l.type===L.Response){let m=l.body?.filePath;m&&(this.frmPago.patchValue({file:m}),this.tempFilePath=m),this.uploading=!1,this.uploadProgress=100}},error:l=>{console.log("ERROR SUBIENDO COMPROBANTE",l),this.uploading=!1,this.uploadProgress=null,this._tools.MostrarMensaje("error","Error al subir comprobante")}})}guardar(){let t=Number(this.infoCtrl.value||0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}if(this.uploading){this._tools.MostrarMensaje("warning","Espere a que termine la subida");return}let e=$({},this.frmPago.value);if(e.infoestudiantesifas_id=t,e.monto!==""&&e.monto!==null&&e.monto!==void 0){let a=Number(e.monto);e.monto=Number.isFinite(a)?a:null}if(!this.editId){delete e.id,this._pagos.AgregarPagoslcch(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago registrado"),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual()},error:a=>{console.log("ERROR CREANDO PAGO",a),this._tools.MostrarMensaje("error","Error al guardar")}});return}this._pagos.ModificarPagoslcch(e,this.editId).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago actualizado"),this.tempFilePath&&this.originalFilePath&&this.tempFilePath!==this.originalFilePath&&this._tools.EliminarArchivo(this.originalFilePath),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual()},error:a=>{console.log("ERROR ACTUALIZANDO PAGO",a),this._tools.MostrarMensaje("error","Error al actualizar")}})}eliminar(t){return H(this,null,function*(){if(!(yield this._tools.mostrarMensajeConfirm("Eliminar","\xBFEliminar este pago?","warning","Eliminar")))return;let a=Number(this.infoCtrl.value||0);this._pagos.EliminarPagoslcch(t.id).subscribe({next:()=>{t?.file&&this._tools.EliminarArchivo(t.file),this._tools.MostrarMensaje("success","Eliminado"),this.cargarPagos(a),this.cargarDeudaActual()},error:l=>{console.log("ERROR ELIMINANDO PAGO",l),this._tools.MostrarMensaje("error","Error al eliminar")}})})}mesLabel(t){let e=this.meses.find(a=>a.value===Number(t));return e?e.label:String(t??"")}};P.\u0275fac=function(e){return new(e||P)(y(pe),y(T),y(de),y(me),y(te))},P.\u0275cmp=z({type:P,selectors:[["app-sistemapagoslcch"]],standalone:!1,decls:32,vars:11,consts:[["sinPagados",""],["sinDeuda",""],[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],["type","button",1,"btn","btn-outline-primary",3,"click"],["class","card mb-3",4,"ngIf"],[1,"card","mb-3"],[1,"card-body"],[1,"row","align-items-end","g-2"],[1,"col-lg-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],[1,"form-floating","flex-grow-1"],["type","text","placeholder","Buscar inscripci\xF3n",1,"form-control",3,"input","keyup.enter","value"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","mt-2 d-flex align-items-center gap-2",4,"ngIf"],[1,"mt-2","d-flex","flex-wrap","gap-2"],["class","btn btn-outline-secondary btn-sm","type","button",3,"active","disabled","click",4,"ngFor","ngForOf"],[1,"mt-2"],["class","text-muted",4,"ngIf"],["class","d-flex flex-wrap align-items-center gap-2",4,"ngIf"],[1,"col-lg-4"],[1,"form-label"],["readonly","",1,"form-control",3,"value"],["class","card",4,"ngIf"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"d-flex","align-items-center","gap-2"],[1,"form-label","m-0"],[1,"form-select","form-select-sm",2,"width","180px",3,"change","formControl"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Buscar deudores",1,"form-control",3,"input","keyup.enter","value"],[1,"table-responsive"],[1,"table","table-sm","table-striped","align-middle","mb-0"],[4,"ngIf"],[2,"width","160px"],[4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","d-flex","align-items-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"text-muted"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"text-center","py-3"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"text-success"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"card-header","d-flex","align-items-center","justify-content-between"],["class","btn btn-sm btn-outline-secondary","type","button",3,"click",4,"ngIf"],[1,"mb-2"],[1,"badge","bg-secondary"],[1,"text-muted","ms-2"],[4,"ngIf","ngIfElse"],[1,"row","g-2"],[1,"col-md-3"],[1,"form-select",3,"formControl"],[1,"col-md-2"],["placeholder","2025",1,"form-control",3,"formControl"],["placeholder","0",1,"form-control",3,"formControl"],[1,"col-md-4"],[3,"value","disabled",4,"ngFor","ngForOf"],["type","date",1,"form-control",3,"formControl"],["type","time",1,"form-control",3,"formControl"],["type","file",1,"form-control",3,"change"],["class","mt-1",4,"ngIf"],[1,"col-12"],["rows","2",1,"form-control",3,"formControl"],[1,"col-12","d-flex","gap-2"],["type","button",1,"btn","btn-success",3,"click","disabled"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],["class","badge bg-success",4,"ngFor","ngForOf"],[1,"badge","bg-success"],["class","badge bg-danger",4,"ngFor","ngForOf"],[1,"badge","bg-danger"],[3,"value","disabled"],[1,"mt-1"],[1,"progress"],["role","progressbar",1,"progress-bar"],[1,"card"],[1,"card-header"],["target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["target","_blank","rel","noopener noreferrer",3,"href"],["colspan","8",1,"text-center","py-3"]],template:function(e,a){e&1&&(n(0,"div",2)(1,"div",3)(2,"h4",4),r(3,"Sistema de Pagos (Mensualidades)"),i(),n(4,"button",5),u("click",function(){return a.toggleVerDeudores()}),r(5),i()(),p(6,Ce,48,9,"div",6),n(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10)(11,"div",11)(12,"span",12),v(13,"i",13),i(),n(14,"div",14)(15,"input",15),u("input",function(m){return a.filterInscripcion=m.target.value})("keyup.enter",function(){return a.buscarInscripciones(1)}),i(),n(16,"label"),r(17,"Buscar inscripci\xF3n (m\xEDn. 2 caracteres)"),i()(),n(18,"button",16),u("click",function(){return a.buscarInscripciones(1)}),r(19," Buscar "),i()(),p(20,Ee,7,5,"div",17),n(21,"div",18),p(22,ye,4,9,"button",19),i(),n(23,"div",20),p(24,Pe,2,0,"small",21)(25,Me,8,2,"div",22),i()(),n(26,"div",23)(27,"label",24),r(28,"Total registros"),i(),v(29,"input",25),i()()()(),p(30,Be,63,19,"div",6)(31,Ke,26,2,"div",26),i()),e&2&&(s(5),x(" ",a.verDeudores?"Ocultar deudores":"Ver estudiantes con deuda"," "),s(),c("ngIf",a.verDeudores),s(9),c("value",a.filterInscripcion),s(3),c("disabled",a.isLoadingResultados),s(2),c("ngIf",a.resMeta),s(2),c("ngForOf",a.resultados),s(2),c("ngIf",!a.infoCtrl.value),s(),c("ngIf",a.infoCtrl.value),s(4),c("value",a.pagos.length),s(),c("ngIf",a.infoCtrl.value),s(),c("ngIf",a.infoCtrl.value))},dependencies:[Q,W,se,le,ie,oe,ne,re],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var N=P;var ze=[{path:"sistemapagoslcch",component:N}],C=class C{};C.\u0275fac=function(e){return new(e||C)},C.\u0275mod=M({type:C}),C.\u0275inj=I({imports:[j.forChild(ze),j]});var R=C;var E=class E{};E.\u0275fac=function(e){return new(e||E)},E.\u0275mod=M({type:E}),E.\u0275inj=I({imports:[X,ue,ce,R]});var ge=E;export{ge as SistemapagoslcchModule};
