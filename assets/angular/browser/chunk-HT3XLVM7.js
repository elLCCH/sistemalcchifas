import{a as kt,b as Ft,c as Nt}from"./chunk-7BRLSK3M.js";import{a as Zt}from"./chunk-HHAG52WO.js";import{a as Kt}from"./chunk-ZPACKHVO.js";import{a as Yt}from"./chunk-BVCCOGXA.js";import{b as Wt}from"./chunk-52NN7TSC.js";import{b as Mt}from"./chunk-GEOJTL7L.js";import{a as Xt}from"./chunk-TFYNVOGS.js";import"./chunk-MDVI344E.js";import"./chunk-5T22I67U.js";import{a as k}from"./chunk-KFXCIGMC.js";import{g as wt}from"./chunk-4W7OKCCT.js";import{c as _t,e as F,f as ft,g as vt,h as bt,i as S,j as xt,k as Ct,l as $t,n as St,o as Tt,p as Pt,q as Et,r as yt,s as It,w as Ht,x as Qt}from"./chunk-S3CK6CTG.js";import{$a as Z,Cb as O,Da as d,Ea as r,Fa as n,Ga as x,J as ot,K as st,M as lt,Na as E,P as g,Q as h,Qa as _,Qb as dt,Sa as p,Sb as pt,Tb as mt,Wa as L,Xa as z,Ya as R,_b as Ut,ab as J,ba as H,bb as Q,ca as N,db as w,dc as Gt,ea as l,eb as o,fb as T,fc as B,gb as y,h as Rt,hb as W,hc as gt,ib as jt,la as I,lb as tt,mb as et,na as ct,nb as it,oa as ut,pb as M,sa as C,sc as ht,ub as at,w as Ot,wc as qt}from"./chunk-T7ZSEIVN.js";import{a as D,f as zt,g as q}from"./chunk-ATDPNAVO.js";var te=zt(Yt());var j=class j{constructor(e){this.http=e;this.ruta=k.ruta}Obtenertalleristas(){return this.http.get(this.ruta+"api/talleristas")}Agregartalleristas(e){return this.http.post(this.ruta+"api/talleristas",e)}Modificartalleristas(e,t){return this.http.put(this.ruta+"api/talleristas/"+t,e)}Seleccionartalleristas(e){return this.http.get(this.ruta+"api/talleristas/"+e)}Eliminartalleristas(e){return this.http.delete(this.ruta+"api/talleristas/"+e)}createFormGrouptalleristas(){return new bt({id:new S(0),instituciones_id:new S(""),Foto:new S(""),Ap_Paterno:new S("",[F.required]),Ap_Materno:new S("",[F.required]),Nombre:new S("",[F.required]),Carnet:new S("",[F.required]),Celular:new S("",[F.required]),Nombre_Padre:new S(""),Celular_Padre:new S(""),Nombre_Madre:new S(""),Celular_Madre:new S("")})}};j.\u0275fac=function(t){return new(t||j)(lt(gt))},j.\u0275prov=ot({token:j,factory:j.\u0275fac,providedIn:"root"});var K=j;var U=class U{constructor(e){this.http=e;this.ruta=k.ruta}Obtenerpagostalleres(e){let t=new Gt;return e?.talleristas_id&&(t=t.set("talleristas_id",String(e.talleristas_id))),e?.planteldocentes_id&&(t=t.set("planteldocentes_id",String(e.planteldocentes_id))),e?.activos!==void 0&&(t=t.set("activos",String(e.activos))),this.http.get(this.ruta+"api/pagostalleres",{params:t})}ObtenerpagostalleresPorTallerista(e){return this.http.get(this.ruta+"api/pagostalleres/by-tallerista/"+e)}Agregarpagostalleres(e){return this.http.post(this.ruta+"api/pagostalleres",e)}Modificarpagostalleres(e,t){return this.http.put(this.ruta+"api/pagostalleres/"+t,e)}Seleccionarpagostalleres(e){return this.http.get(this.ruta+"api/pagostalleres/"+e)}Eliminarpagostalleres(e){return this.http.delete(this.ruta+"api/pagostalleres/"+e)}createFormGrouppagostalleres(){return new bt({id:new S(0),instituciones_id:new S(""),talleristas_id:new S(null,[F.required]),planteldocentes_id:new S(null,[F.required]),Especialidad:new S("",[F.required]),Turno:new S(""),Horario:new S(""),FechaPago:new S("",[F.required]),FechaHasta:new S("",[F.required]),MontoPagado:new S(null),DetallePago:new S(""),Observacion:new S(""),ComprobantePago:new S("")})}};U.\u0275fac=function(t){return new(t||U)(lt(gt))},U.\u0275prov=ot({token:U,factory:U.\u0275fac,providedIn:"root"});var Vt=U;var be=["modalNuevoTallerista"],xe=["modalPago"],Ce=["modalVincularCelular"],ee=(s,e,t)=>({"bg-success":s,"bg-secondary":e,"bg-danger":t});function Se(s,e){s&1&&(r(0,"div",13),o(1,"Cargando talleristas para buscador..."),n())}function Te(s,e){s&1&&(r(0,"div",14),o(1,"Cargando pagos..."),n())}function Pe(s,e){s&1&&(r(0,"div",22),o(1,"Buscando..."),n())}function Ee(s,e){if(s&1){let t=E();r(0,"div",15)(1,"div",16)(2,"div",17)(3,"span",18),o(4,"Buscar"),n(),r(5,"div",19)(6,"input",20),_("keyup.enter",function(){g(t);let a=p();return h(a.buscarPagos())}),n(),r(7,"label"),o(8,"Buscar pago (Tallerista / Carnet / Docente / Especialidad / Turno / Horario)"),n()()(),C(9,Pe,2,0,"div",21),n()()}if(s&2){let t=p();l(6),d("formControl",t.pagoSearchInput),l(3),d("ngIf",t.isBuscandoPagos)}}function ye(s,e){if(s&1&&(r(0,"a",39),o(1,"Ver"),n()),s&2){let t=e.ngIf;d("href",t,N)}}function Ie(s,e){s&1&&(r(0,"span",14),o(1,"-"),n())}function we(s,e){if(s&1){let t=E();r(0,"tr")(1,"td"),o(2),n(),r(3,"td")(4,"div",30),o(5),n(),r(6,"div",31),o(7),n()(),r(8,"td",25)(9,"span",32),o(10),n()(),r(11,"td")(12,"div",30),o(13),n(),r(14,"div",31),o(15),n()(),r(16,"td",26),o(17),n(),r(18,"td",25)(19,"span",32),o(20),n(),r(21,"div",31),o(22,"d\xEDas"),n()(),r(23,"td")(24,"div"),o(25),n(),r(26,"div",31),o(27),n()(),r(28,"td",33)(29,"div",34),o(30),n(),r(31,"div",35),o(32),n()(),r(33,"td"),C(34,ye,2,1,"a",36)(35,Ie,2,0,"span",10),n(),r(36,"td",26)(37,"button",37),_("click",function(){let a=g(t).$implicit,c=p(2);return h(c.AbrirModalPagoEditar(a))}),o(38,"Editar"),n(),r(39,"button",38),_("click",function(){let a=g(t).$implicit,c=p(2);return h(c.EliminarPago(a))}),o(40,"Eliminar"),n()()()}if(s&2){let t=e.$implicit,i=p(2);l(2),T(t==null?null:t.FechaPago),l(3),T(i.getNombreCompletoTalleristaEnPago(t)),l(2),y("Carnet: ",(t==null?null:t.Carnet)||"-"),l(2),Q("bg-success",i.esActivo(t))("bg-secondary",!i.esActivo(t)),l(),y(" ",i.esActivo(t)?"VIGENTE":"VENCIDO"," "),l(3),T(i.getNombreCompletoDocenteEnPago(t)),l(2),y("Esp.: ",i.especialidadLabel(t==null?null:t.Especialidad)||"-"),l(2),T((t==null?null:t.MontoPagado)??"-"),l(2),Q("bg-info",(i.saldoDias(t)??-999)>=0)("bg-danger",(i.saldoDias(t)??-999)<0),l(),y(" ",i.saldoDias(t)===null?"-":i.saldoDias(t)," "),l(5),T((t==null?null:t.Turno)||"-"),l(2),T((t==null?null:t.Horario)||"-"),l(3),T((t==null?null:t.DetallePago)||"-"),l(2),T((t==null?null:t.Observacion)||""),l(2),d("ngIf",i.archivoUrl(t==null?null:t.ComprobantePago)),l(),d("ngIf",!i.archivoUrl(t==null?null:t.ComprobantePago))}}function Me(s,e){s&1&&(r(0,"tr")(1,"td",40),o(2,"Sin pagos"),n()())}function ke(s,e){if(s&1&&(r(0,"option",45),o(1),n()),s&2){let t=e.$implicit;d("value",t),l(),y("",t," por p\xE1gina")}}function Fe(s,e){if(s&1){let t=E();r(0,"div",41)(1,"ngb-pagination",42),_("pageChange",function(a){g(t);let c=p(2);return h(c.onPageChangePagos(a))}),n(),r(2,"select",43),it("ngModelChange",function(a){g(t);let c=p(2);return et(c.pageSizePagos,a)||(c.pageSizePagos=a),h(a)}),_("change",function(){g(t);let a=p(2);return h(a.onPageSizeChangePagos())}),C(3,ke,2,2,"option",44),n()()}if(s&2){let t=p(2);l(),d("page",t.paginPagos)("collectionSize",t.collectionSizePagos)("pageSize",t.pageSizePagos)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0),l(),tt("ngModel",t.pageSizePagos),l(),d("ngForOf",t.pageSizeOptionsPagos)}}function Ne(s,e){if(s&1&&(r(0,"div",23)(1,"table",24)(2,"thead")(3,"tr")(4,"th"),o(5,"Fecha Pago"),n(),r(6,"th"),o(7,"Tallerista"),n(),r(8,"th",25),o(9,"Estado"),n(),r(10,"th"),o(11,"Docente"),n(),r(12,"th",26),o(13,"Monto"),n(),r(14,"th",25),o(15,"Saldo"),n(),r(16,"th"),o(17,"Turno / Horario"),n(),r(18,"th"),o(19,"Detalle"),n(),r(20,"th"),o(21,"Comprobante"),n(),r(22,"th",26),o(23,"Acciones"),n()()(),r(24,"tbody"),C(25,we,41,22,"tr",27)(26,Me,3,0,"tr",28),n()(),C(27,Fe,4,9,"div",29),n()),s&2){let t=p();l(25),d("ngForOf",t.pagosPaginadosTabla),l(),d("ngIf",t.collectionSizePagos===0),l(),d("ngIf",t.collectionSizePagos>0)}}function Ve(s,e){if(s&1&&x(0,"img",83),s&2){let t=e.ngIf;d("src",t,N)}}function Ae(s,e){if(s&1){let t=E();r(0,"div",84)(1,"div")(2,"div",30),o(3,"Esperando foto del celular..."),n(),r(4,"div",85),o(5),n()(),r(6,"button",86),_("click",function(){g(t);let a=p(2);return h(a.cancelarEsperaCapturaFoto())}),o(7,"Cancelar"),n()()}if(s&2){let t=p(2);l(5),y("Estado: ",t.capturaStatusFoto||"PENDING",". Puedes seguir llenando el formulario.")}}function Be(s,e){if(s&1&&(r(0,"div",87)(1,"div",88),x(2,"div",89),n(),r(3,"div",90),o(4),n()()),s&2){let t=p(2);l(2),J("width",t.uploadProgressFoto,"%"),l(2),y("",t.uploadProgressFoto,"%")}}function De(s,e){s&1&&(r(0,"div",94),x(1,"span",95),o(2," Buscando... "),n())}function qe(s,e){if(s&1){let t=E();r(0,"div",96),_("click",function(){let a=g(t).$implicit,c=p(3);return h(c.seleccionarEstudianteParaTallerista(a))}),r(1,"div",97),x(2,"span",98),r(3,"small",14),o(4,"CI: "),x(5,"span",98),n()()()}if(s&2){let t=e.$implicit,i=p(3);l(2),d("innerHTML",i.resaltarNombreEnBuscadorEstudianteTallerista(t),H),l(3),d("innerHTML",i.resaltarCIEnBuscadorEstudianteTallerista(t.CI),H)}}function Le(s,e){if(s&1){let t=E();r(0,"div",94)(1,"div",99)(2,"button",61),_("click",function(a){return g(t),p(3).estudiantesPrevPageTallerista(),h(a.stopPropagation())}),o(3," Anterior "),n(),r(4,"span",31),o(5),n(),r(6,"button",61),_("click",function(a){return g(t),p(3).estudiantesNextPageTallerista(),h(a.stopPropagation())}),o(7," Siguiente "),n()()()}if(s&2){let t=p(3);l(2),d("disabled",t.estudiantesPageTallerista<=1),l(3),W("P\xE1gina ",t.estudiantesPageTallerista," de ",t.estudiantesTotalPagesTallerista),l(),d("disabled",t.estudiantesPageTallerista>=t.estudiantesTotalPagesTallerista)}}function ze(s,e){if(s&1&&(r(0,"div",91),C(1,De,3,0,"div",92)(2,qe,6,2,"div",93)(3,Le,8,4,"div",92),n()),s&2){let t=p(2);l(),d("ngIf",t.isBuscandoEstudianteTallerista),l(),d("ngForOf",t.estudiantesBuscadosTalleristaPaginados),l(),d("ngIf",!t.isBuscandoEstudianteTallerista&&((t.estudiantesBuscadosTallerista==null?null:t.estudiantesBuscadosTallerista.length)||0)>t.estudiantesPageSizeTallerista)}}function Re(s,e){if(s&1&&(r(0,"div",22),o(1," Autocompletado desde: "),r(2,"strong"),o(3),n()()),s&2){let t=p(2);l(3),jt("",t.estudianteSeleccionadoParaTallerista==null?null:t.estudianteSeleccionadoParaTallerista.Ap_Paterno," ",t.estudianteSeleccionadoParaTallerista==null?null:t.estudianteSeleccionadoParaTallerista.Ap_Materno," ",t.estudianteSeleccionadoParaTallerista==null?null:t.estudianteSeleccionadoParaTallerista.Nombre)}}function Oe(s,e){if(s&1){let t=E();r(0,"div",46)(1,"h5",47),o(2,"Registro de Tallerista"),n(),r(3,"button",48),_("click",function(){g(t);let a=p();return h(a.CerrarModalNuevoTallerista())}),n()(),r(4,"div",49)(5,"form",50)(6,"div",51)(7,"label",52),o(8,"Foto"),n(),r(9,"div",53),_("dragover",function(a){g(t);let c=p();return h(c.onFotoDragOver(a))})("dragleave",function(a){g(t);let c=p();return h(c.onFotoDragLeave(a))})("drop",function(a){g(t);let c=p();return h(c.onFotoDrop(a))}),r(10,"div",54)(11,"div")(12,"div",30),o(13,"Arrastra una foto o selecciona un archivo"),n(),r(14,"div",55),o(15,"1 archivo"),n()(),r(16,"div",56)(17,"input",57,3),_("change",function(a){g(t);let c=p();return h(c.onFotoFileSelected(a))}),n(),r(19,"button",58),_("click",function(){g(t);let a=Z(18),c=p();return h(c.abrirSelectorFoto(a))}),o(20,"Elegir"),n(),C(21,Ve,1,1,"img",59),n()(),r(22,"div",60)(23,"button",61),_("click",function(){g(t);let a=p();return h(a.abrirVinculacionCelular())}),o(24," Vincular celular (QR) "),n(),r(25,"span",62),o(26),n(),r(27,"button",63),_("click",function(){g(t);let a=p();return h(a.iniciarCapturaFotoTalleristaPorCelular())}),o(28," Tomar foto con celular "),n()(),C(29,Ae,8,1,"div",64)(30,Be,5,3,"div",65),n()(),r(31,"div",66)(32,"div",19)(33,"input",67),_("focus",function(){g(t);let a=p();return h(a.mostrarListaEstudiantesTallerista=!0)})("keyup.enter",function(){g(t);let a=p();return h(a.buscarEstudiantesParaTallerista())}),n(),r(34,"label"),o(35,"Buscar estudiante (CI / Apellidos / Nombre) para autocompletar"),n()(),C(36,ze,4,3,"div",68)(37,Re,4,3,"div",21),n(),r(38,"div",69)(39,"div",19),x(40,"input",70),r(41,"label"),o(42,"Apellido paterno"),n(),r(43,"div",71),o(44,"Apellido paterno requerido."),n()()(),r(45,"div",69)(46,"div",19),x(47,"input",72),r(48,"label"),o(49,"Apellido materno"),n(),r(50,"div",71),o(51,"Apellido materno requerido."),n()()(),r(52,"div",69)(53,"div",19),x(54,"input",73),r(55,"label"),o(56,"Nombres"),n(),r(57,"div",71),o(58,"Nombres requerido."),n()()(),r(59,"div",16)(60,"div",19),x(61,"input",74),r(62,"label"),o(63,"Carnet"),n(),r(64,"div",71),o(65,"Carnet requerido."),n()()(),r(66,"div",16)(67,"div",19),x(68,"input",75),r(69,"label"),o(70,"Celular"),n(),r(71,"div",71),o(72,"Celular requerido."),n()()(),r(73,"div",16)(74,"div",19),x(75,"input",76),r(76,"label"),o(77,"Nombre del padre"),n()()(),r(78,"div",16)(79,"div",19),x(80,"input",77),r(81,"label"),o(82,"Celular del padre"),n()()(),r(83,"div",16)(84,"div",19),x(85,"input",78),r(86,"label"),o(87,"Nombre de la madre"),n()()(),r(88,"div",16)(89,"div",19),x(90,"input",79),r(91,"label"),o(92,"Celular de la madre"),n()()()()(),r(93,"div",80)(94,"button",81),_("click",function(){g(t);let a=p();return h(a.CerrarModalNuevoTallerista())}),o(95,"Cancelar"),n(),r(96,"button",82),_("click",function(){g(t);let a=p();return h(a.GuardarNuevoTallerista())}),o(97,"Guardar"),n()()}if(s&2){let t,i=p();l(5),d("formGroup",i.frmNuevoTallerista),l(4),Q("dragging",i.isDraggingFoto),l(10),d("disabled",i.isUploadingFoto),l(2),d("ngIf",i.archivoUrl((t=i.frmNuevoTallerista.get("Foto"))==null?null:t.value)),l(2),d("disabled",i.isUploadingFoto),l(2),d("ngClass",at(31,ee,i.pairingStatus==="LINKED",!i.pairingStatus||i.pairingStatus==="PENDING",i.pairingStatus==="EXPIRED"||i.pairingStatus==="REVOKED")),l(),y(" ",i.pairingStatus==="LINKED"?"VINCULADO":i.pairingStatus||"NO VINCULADO"," "),l(),d("disabled",i.isUploadingFoto||i.isEsperandoCapturaFoto),l(2),d("ngIf",i.isEsperandoCapturaFoto&&i.capturaTokenFoto),l(),d("ngIf",i.isUploadingFoto),l(3),d("formControl",i.estudianteInputTallerista),l(3),d("ngIf",i.mostrarListaEstudiantesTallerista&&(i.estudianteInputTallerista.value||"").toString().trim()!==""&&i.busquedaEstudiantesTalleristaEjecutada),l(),d("ngIf",i.estudianteSeleccionadoParaTallerista),l(3),w(M("form-control text-uppercase ",i._tools.obtenerValidationClass(i.frmNuevoTallerista,"Ap_Paterno"))),l(7),w(M("form-control text-uppercase ",i._tools.obtenerValidationClass(i.frmNuevoTallerista,"Ap_Materno"))),l(7),w(M("form-control text-uppercase ",i._tools.obtenerValidationClass(i.frmNuevoTallerista,"Nombre"))),l(7),w(M("form-control text-uppercase ",i._tools.obtenerValidationClass(i.frmNuevoTallerista,"Carnet"))),l(7),w(M("form-control text-uppercase ",i._tools.obtenerValidationClass(i.frmNuevoTallerista,"Celular"))),l(26),d("disabled",i.isSavingTallerista),l(2),d("disabled",i.isSavingTallerista)}}function je(s,e){s&1&&(r(0,"div",94),x(1,"span",95),o(2," Buscando... "),n())}function Ue(s,e){if(s&1){let t=E();r(0,"div",96),_("click",function(){let a=g(t).$implicit,c=p(3);return h(c.seleccionarTallerista(a))}),r(1,"div",97),x(2,"span",98),r(3,"small",14),o(4," Carnet: "),x(5,"span",98),n()(),r(6,"div",31),o(7,"Cel: "),x(8,"span",98),n()()}if(s&2){let t=e.$implicit,i=p(3);l(2),d("innerHTML",i.resaltarNombreEnBuscadorTallerista(t),H),l(3),d("innerHTML",i.resaltarCarnetEnBuscadorTallerista(t==null?null:t.Carnet),H),l(3),d("innerHTML",i.resaltarCelularEnBuscadorTallerista(t==null?null:t.Celular),H)}}function Ge(s,e){if(s&1){let t=E();r(0,"div",94)(1,"div",99)(2,"button",61),_("click",function(a){return g(t),p(3).talleristasPrevPageBusqueda(),h(a.stopPropagation())}),o(3," Anterior "),n(),r(4,"span",31),o(5),n(),r(6,"button",61),_("click",function(a){return g(t),p(3).talleristasNextPageBusqueda(),h(a.stopPropagation())}),o(7," Siguiente "),n()()()}if(s&2){let t=p(3);l(2),d("disabled",t.paginTalleristasBusqueda<=1),l(3),W("P\xE1gina ",t.paginTalleristasBusqueda," de ",t.talleristasTotalPagesBusqueda),l(),d("disabled",t.paginTalleristasBusqueda>=t.talleristasTotalPagesBusqueda)}}function $e(s,e){if(s&1){let t=E();r(0,"div",117)(1,"div",96),_("click",function(){g(t);let a=p(2);return h(a.abrirRegistroTalleristaDesdeBuscador())}),r(2,"div",118)(3,"div")(4,"div",30),o(5,"\xBFNO ENCONTR\xD3 AL TALLERISTA?, REGISTRE SU INFORMACI\xD3N."),n(),r(6,"div",31),o(7,"Click para registrar y continuar con el pago."),n()(),r(8,"span",119),o(9,"REGISTRAR"),n()()(),C(10,je,3,0,"div",92)(11,Ue,9,3,"div",93)(12,Ge,8,4,"div",92),n()}if(s&2){let t=p(2);l(10),d("ngIf",t.isBuscandoTallerista),l(),d("ngForOf",t.talleristasBuscadosPaginados),l(),d("ngIf",!t.isBuscandoTallerista&&((t.talleristasBuscados==null?null:t.talleristasBuscados.length)||0)>t.pageSizeTalleristasBusqueda)}}function He(s,e){if(s&1&&(r(0,"div",51)(1,"div",120)(2,"div",30),o(3,"Tallerista seleccionado:"),n(),r(4,"div"),o(5),r(6,"span",14),o(7),n()()()()),s&2){let t=p(2);l(5),y(" ",((t.talleristaSeleccionado==null?null:t.talleristaSeleccionado.Ap_Paterno)||"")+" "+((t.talleristaSeleccionado==null?null:t.talleristaSeleccionado.Ap_Materno)||"")+" "+((t.talleristaSeleccionado==null?null:t.talleristaSeleccionado.Nombre)||"")," "),l(2),y("(Carnet: ",t.talleristaSeleccionado==null?null:t.talleristaSeleccionado.Carnet,")")}}function Qe(s,e){if(s&1&&(r(0,"option",106),o(1),n()),s&2){let t=e.$implicit;d("ngValue",t.id),l(),W(" ",(t.Apellidos||"")+" "+(t.Nombres||"")," (",t.Carnet,") ")}}function We(s,e){s&1&&(r(0,"div",55),o(1,"Si eres docente, se asigna autom\xE1ticamente."),n())}function Ke(s,e){if(s&1&&(r(0,"option",106),o(1),n()),s&2){let t=e.$implicit;d("ngValue",t.value),l(),T(t.label)}}function Xe(s,e){if(s&1&&(r(0,"a",121),o(1," Ver "),n()),s&2){let t=e.ngIf;d("href",t,N)}}function Ye(s,e){if(s&1){let t=E();r(0,"div",84)(1,"div")(2,"div",30),o(3,"Esperando comprobante del celular..."),n(),r(4,"div",85),o(5),n()(),r(6,"button",86),_("click",function(){g(t);let a=p(2);return h(a.cancelarEsperaCapturaComprobante())}),o(7,"Cancelar"),n()()}if(s&2){let t=p(2);l(5),y("Estado: ",t.capturaStatus||"PENDING_PAGOS",". Puedes seguir llenando el formulario.")}}function Ze(s,e){if(s&1&&(r(0,"div",87)(1,"div",88),x(2,"div",89),n(),r(3,"div",90),o(4),n()()),s&2){let t=p(2);l(2),J("width",t.uploadProgressComprobante,"%"),l(2),y("",t.uploadProgressComprobante,"%")}}function Je(s,e){if(s&1){let t=E();r(0,"div",46)(1,"h5",47),o(2,"Registro de Pago"),n(),r(3,"button",48),_("click",function(){g(t);let a=p();return h(a.CerrarModalPago())}),n()(),r(4,"div",49)(5,"form",50)(6,"div",100)(7,"input",67),_("focus",function(){g(t);let a=p();return h(a.mostrarListaTalleristas=!0)})("keyup.enter",function(){g(t);let a=p();return h(a.buscarTalleristas())}),n(),r(8,"label"),o(9,"Buscar tallerista (Carnet / Celular / Apellidos / Nombre)"),n(),C(10,$e,13,3,"div",101),n(),C(11,He,8,2,"div",102),r(12,"div",16)(13,"div",19),x(14,"input",103),r(15,"label"),o(16,"Fecha de pago"),n(),r(17,"div",71),o(18,"Fecha de pago requerida."),n()()(),r(19,"div",16)(20,"div",19),x(21,"input",104),r(22,"label"),o(23,"Hasta cu\xE1ndo pasa clases"),n(),r(24,"div",71),o(25,"Fecha hasta requerida."),n()()(),r(26,"div",16)(27,"label",52),o(28,"Docente"),n(),r(29,"select",105)(30,"option",106),o(31,"-- Seleccione --"),n(),C(32,Qe,2,3,"option",107),n(),r(33,"div",71),o(34,"Docente requerido."),n(),C(35,We,2,0,"div",108),n(),r(36,"div",16)(37,"div",19)(38,"select",109)(39,"option",106),o(40,"-- Seleccione --"),n(),C(41,Ke,2,2,"option",107),n(),r(42,"label"),o(43,"Especialidad"),n(),r(44,"div",71),o(45,"Especialidad requerida."),n()()(),r(46,"div",16)(47,"div",19),x(48,"input",110),r(49,"label"),o(50,"Turno"),n()()(),r(51,"div",16)(52,"div",19),x(53,"input",111),r(54,"label"),o(55,"Horario"),n()()(),r(56,"div",16)(57,"div",19),x(58,"input",112),r(59,"label"),o(60,"Monto pagado"),n()()(),r(61,"div",51)(62,"div",19),x(63,"textarea",113),r(64,"label"),o(65,"Detalle del pago"),n()()(),r(66,"div",51)(67,"label",52),o(68,"Comprobante (opcional)"),n(),r(69,"div",114)(70,"div",54)(71,"div")(72,"div",30),o(73,"Subir o capturar desde el celular"),n(),r(74,"div",55),o(75,"Imagen (jpg/png/webp)"),n()(),r(76,"div",56)(77,"input",57,4),_("change",function(a){g(t);let c=p();return h(c.onComprobanteFileSelected(a))}),n(),r(79,"button",58),_("click",function(){g(t);let a=Z(78);return h(a.click())}),o(80,"Elegir"),n(),C(81,Xe,2,1,"a",115),n()(),r(82,"div",60)(83,"button",61),_("click",function(){g(t);let a=p();return h(a.abrirVinculacionCelular())}),o(84," Vincular celular (QR) "),n(),r(85,"span",62),o(86),n(),r(87,"button",63),_("click",function(){g(t);let a=p();return h(a.iniciarCapturaComprobantePorCelular())}),o(88," Tomar foto con celular "),n()(),C(89,Ye,8,1,"div",64)(90,Ze,5,3,"div",65),n()(),r(91,"div",51)(92,"div",19),x(93,"textarea",116),r(94,"label"),o(95,"Observaci\xF3n"),n()()()()(),r(96,"div",80)(97,"button",81),_("click",function(){g(t);let a=p();return h(a.CerrarModalPago())}),o(98,"Cancelar"),n(),r(99,"button",82),_("click",function(){g(t);let a=p();return h(a.GuardarPago())}),o(100,"Guardar"),n()()}if(s&2){let t,i=p();l(5),d("formGroup",i.frmPago),l(2),d("formControl",i.talleristaInput),l(3),d("ngIf",i.mostrarListaTalleristas&&(i.talleristaInput.value||"").toString().trim()!==""&&i.busquedaTalleristaEjecutada),l(),d("ngIf",i.talleristaSeleccionado),l(3),w(M("form-control ",i.ValidacionxElemento("FechaPago"))),l(7),w(M("form-control ",i.ValidacionxElemento("FechaHasta"))),l(8),w(M("form-select ",i.ValidacionxElemento("planteldocentes_id"))),l(),d("ngValue",null),l(2),d("ngForOf",i.docentes),l(3),d("ngIf",i.esDocente),l(3),w(M("form-select ",i.ValidacionxElemento("Especialidad"))),l(),d("ngValue",""),l(2),d("ngForOf",i.optionsEspecialidad),l(38),d("disabled",i.isUploadingComprobante),l(2),d("ngIf",i.archivoUrl((t=i.frmPago.get("ComprobantePago"))==null?null:t.value)),l(2),d("disabled",i.isUploadingComprobante),l(2),d("ngClass",at(31,ee,i.pairingStatus==="LINKED",!i.pairingStatus||i.pairingStatus==="PENDING",i.pairingStatus==="EXPIRED"||i.pairingStatus==="REVOKED")),l(),y(" ",i.pairingStatus==="LINKED"?"VINCULADO":i.pairingStatus||"NO VINCULADO"," "),l(),d("disabled",i.isUploadingComprobante||i.isEsperandoCapturaComprobante),l(2),d("ngIf",i.isEsperandoCapturaComprobante&&i.capturaToken),l(),d("ngIf",i.isUploadingComprobante),l(7),d("disabled",i.isSaving),l(2),d("disabled",i.isSaving)}}function ti(s,e){if(s&1&&(r(0,"div",127),x(1,"img",128),n()),s&2){let t=p(2);l(),d("src",t.pairingQrDataUrl,N)}}function ei(s,e){if(s&1&&(r(0,"div",125)(1,"a",39),o(2,"Abrir link en el celular"),n()()),s&2){let t=p(2);l(),d("href",t.pairingUrl,N)}}function ii(s,e){if(s&1){let t=E();r(0,"div",46)(1,"h4",47),o(2,"Vincular celular"),n(),r(3,"button",122),_("click",function(){let a=g(t).$implicit;return h(a.dismiss())}),n()(),r(4,"div",49)(5,"div",123),o(6,"Escanea este QR una sola vez desde el celular."),n(),C(7,ti,2,1,"div",124),r(8,"div",125)(9,"div",31),o(10,"Estado"),n(),r(11,"div",30),o(12),n()(),C(13,ei,3,1,"div",126),n()}if(s&2){let t=p();l(7),d("ngIf",t.pairingQrDataUrl),l(5),T(t.pairingStatus||"..."),l(),d("ngIf",t.pairingUrl)}}var X=class X{constructor(e,t,i,a,c,u,m,v,b,f){this._talleristas=e;this._est=t;this._pagos=i;this._docentes=a;this._auth=c;this._tools=u;this._capture=m;this._pairing=v;this._controles=b;this.router=f;this.ruta=k.ruta;this.talleristas=[];this.docentes=[];this.talleristaInput=new S("");this.mostrarListaTalleristas=!1;this.isBuscandoTallerista=!1;this.busquedaTalleristaEjecutada=!1;this.talleristasBuscados=[];this.paginTalleristasBusqueda=1;this.pageSizeTalleristasBusqueda=10;this.pageSizeOptionsTalleristasBusqueda=[5,10,20,50];this.talleristaSeleccionado=null;this.pagos=[];this.pagosFiltrados=[];this.isLoadingTalleristas=!1;this.isLoadingPagos=!1;this.isSaving=!1;this.pagoSearchInput=new S("");this.isBuscandoPagos=!1;this.busquedaPagosEjecutada=!1;this.optionsEspecialidad=[];this.paginPagos=1;this.pageSizePagos=10;this.pageSizeOptionsPagos=[5,10,20,50];this.editId=null;this.isSavingTallerista=!1;this.estudianteInputTallerista=new S("");this.mostrarListaEstudiantesTallerista=!1;this.isBuscandoEstudianteTallerista=!1;this.busquedaEstudiantesTalleristaEjecutada=!1;this.estudiantesBuscadosTallerista=[];this.estudianteSeleccionadoParaTallerista=null;this.estudiantesPageTallerista=1;this.estudiantesPageSizeTallerista=8;this.isDraggingFoto=!1;this.isUploadingFoto=!1;this.uploadProgressFoto=0;this.fotoAnteriorPath=null;this.fotoTempPath=null;this.capturaTokenFoto=null;this.capturaStatusFoto=null;this.isEsperandoCapturaFoto=!1;this.capturaFotoIntervalId=null;this.esDocente=!1;this.docenteIdPerfil=null;this.pairingToken=null;this.pairingStatus=null;this.pairingUrl=null;this.pairingQrDataUrl=null;this.pairingIntervalId=null;this.capturaToken=null;this.capturaStatus=null;this.isEsperandoCapturaComprobante=!1;this.capturaIntervalId=null;this.isUploadingComprobante=!1;this.uploadProgressComprobante=0;this.comprobanteAnteriorPath=null;this.comprobanteTempPath=null;this.frmPago=this._pagos.createFormGrouppagostalleres(),this.frmNuevoTallerista=this._talleristas.createFormGrouptalleristas()}ngOnInit(){this.cargarPerfil(),this.cargarDocentes(),this.cargarTalleristas(),this.cargarOptionsEspecialidad(),this.cargarPagosGlobal(),this.cargarVinculacionDesdeStorage(),this.estudianteInputTallerista.valueChanges.subscribe(e=>{(e??"").toString()===""&&this.limpiarBusquedaEstudianteTallerista()}),this.talleristaInput.valueChanges.subscribe(e=>{(e??"").toString()===""&&this.limpiarBusquedaTallerista()}),this.pagoSearchInput.valueChanges.subscribe(e=>{(e??"").toString()===""&&this.resetBusquedaPagos()}),this.frmPago.get("FechaPago")?.valueChanges.subscribe(e=>{if(this.editId)return;let t=this.sumarUnMes((e??"").toString());t&&this.frmPago.patchValue({FechaHasta:t},{emitEvent:!1})})}ngOnDestroy(){this.isEsperandoCapturaComprobante&&this.cancelarEsperaCapturaComprobante(!0),this.isEsperandoCapturaFoto&&this.cancelarEsperaCapturaFoto(!0),this.detenerPollingCaptura(),this.detenerPollingCapturaFoto(),this.detenerPollingVinculacion()}archivoUrl(e){let t=(e??"").toString().trim();return t?t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?`${this.ruta}${t}`:`${this.ruta}/${t}`:null}ValidacionxElemento(e){return this._tools.obtenerValidationClass(this.frmPago,e)}normalizarParaBusqueda(e){return(e??"").toString().trim().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Z0-9]+/g," ").replace(/\s+/g," ").trim()}tokenizarPreservandoDuplicados(e){let t=this.normalizarParaBusqueda(e);return t?t.split(" ").map(i=>i.trim()).filter(Boolean):[]}esTokenNumerico(e){return/^[0-9]+$/.test(e)}contarOcurrencias(e,t){if(!e||!t)return 0;let i=0,a=0;for(;;){let c=e.indexOf(t,a);if(c===-1)break;i+=1,a=c+t.length}return i}getNombreCompletoTallerista(e){let t=(e?.Ap_Paterno??"").toString().trim(),i=(e?.Ap_Materno??"").toString().trim(),a=(e?.Nombre??"").toString().trim();return`${t} ${i} ${a}`.replace(/\s+/g," ").trim()}scoreTalleristaBusqueda(e,t){let i=this.normalizarParaBusqueda(t);if(!i)return 0;let a=this.normalizarParaBusqueda(this.getNombreCompletoTallerista(e)),c=this.normalizarParaBusqueda(e?.Carnet),u=this.normalizarParaBusqueda(e?.Celular),m=0;c&&i===c&&(m+=2e4),c&&i.length>=3&&c.startsWith(i)&&(m+=12e3),u&&i.length>=3&&u.includes(i)&&(m+=7e3),a&&i===a&&(m+=15e3),a&&a.startsWith(i)&&(m+=9e3);let v=this.tokenizarPreservandoDuplicados(i);for(let b of v)b&&(this.esTokenNumerico(b)?(m+=this.contarOcurrencias(c,b)*1200,m+=this.contarOcurrencias(u,b)*600):m+=this.contarOcurrencias(a,b)*700);return m}filtrarTalleristasPreciso(e,t){let i=(t??"").toString().trim();if(!i)return[];let a=this.tokenizarPreservandoDuplicados(i);if(a.length===0)return[];let c=new Map;for(let u of a)c.set(u,(c.get(u)??0)+1);return(e||[]).filter(u=>{let m=this.normalizarParaBusqueda(this.getNombreCompletoTallerista(u)),v=this.normalizarParaBusqueda(u?.Carnet),b=this.normalizarParaBusqueda(u?.Celular);for(let[f,P]of c.entries())if(f){if(this.esTokenNumerico(f)){let V=this.contarOcurrencias(v,f)>=P,A=this.contarOcurrencias(b,f)>=P;if(!V&&!A)return!1}else if(this.contarOcurrencias(m,f)<P)return!1}return!0})}buscarTalleristas(){let e=(this.talleristaInput.value??"").toString().trim();if(this.busquedaTalleristaEjecutada=!0,this.paginTalleristasBusqueda=1,this.mostrarListaTalleristas=!0,!e){this.talleristasBuscados=[];return}this.isBuscandoTallerista=!0;let t=this.filtrarTalleristasPreciso(this.talleristas||[],e);this.talleristasBuscados=(t||[]).slice().sort((i,a)=>{let c=this.scoreTalleristaBusqueda(a,e),u=this.scoreTalleristaBusqueda(i,e);return c!==u?c-u:Number(a?.id??0)-Number(i?.id??0)}),this.isBuscandoTallerista=!1}seleccionarTallerista(e){if(!e)return;let t=Number(e?.id??0);this.talleristaSeleccionado=e,this.frmPago.patchValue({talleristas_id:t}),this.talleristaInput.setValue(this.getNombreCompletoTallerista(e),{emitEvent:!1}),this.mostrarListaTalleristas=!1,this.talleristasBuscados=[],this.busquedaTalleristaEjecutada=!1,this.paginTalleristasBusqueda=1}limpiarBusquedaTallerista(){this.mostrarListaTalleristas=!1,this.isBuscandoTallerista=!1,this.busquedaTalleristaEjecutada=!1,this.talleristasBuscados=[],this.paginTalleristasBusqueda=1}get noEncontroTallerista(){let e=(this.talleristaInput.value??"").toString().trim();return this.busquedaTalleristaEjecutada&&!this.isBuscandoTallerista&&!!e&&(this.talleristasBuscados?.length??0)===0}get talleristasTotalPagesBusqueda(){let e=this.talleristasBuscados?.length??0,t=Math.ceil(e/this.pageSizeTalleristasBusqueda);return Math.max(1,t||1)}get collectionSizeTalleristasBusqueda(){return this.talleristasBuscados?.length??0}get talleristasBuscadosPaginados(){let e=this.talleristasBuscados||[],i=(Math.min(Math.max(1,this.paginTalleristasBusqueda),Math.max(1,Math.ceil(e.length/this.pageSizeTalleristasBusqueda)||1))-1)*this.pageSizeTalleristasBusqueda;return e.slice(i,i+this.pageSizeTalleristasBusqueda)}onPageChangeTalleristasBusqueda(e){this.paginTalleristasBusqueda=e}onPageSizeChangeTalleristasBusqueda(){this.paginTalleristasBusqueda=1}talleristasPrevPageBusqueda(){this.paginTalleristasBusqueda=Math.max(1,this.paginTalleristasBusqueda-1)}talleristasNextPageBusqueda(){this.paginTalleristasBusqueda=Math.min(this.talleristasTotalPagesBusqueda,this.paginTalleristasBusqueda+1)}escapeHtml(e){return(e??"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}highlight(e,t){let i=this.escapeHtml(e),a=(t??"").toString().trim();if(!a)return i;let c=this.normalizarParaBusqueda(a);if(!c)return i;let u=this.tokenizarPreservandoDuplicados(c).map(v=>(v??"").toString().trim()).filter(Boolean).sort((v,b)=>b.length-v.length);if(u.length===0)return i;let m=i;for(let v of u){if(!v||v.length<2)continue;let b=new RegExp(this.escapeRegExp(v),"gi");m=m.replace(b,f=>`<mark>${f}</mark>`)}return m}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}resaltarNombreEnBuscadorTallerista(e){let t=(this.talleristaInput.value??"").toString(),i=this.getNombreCompletoTallerista(e);return this.highlight(i,t)}resaltarCarnetEnBuscadorTallerista(e){let t=(this.talleristaInput.value??"").toString();return this.highlight(e??"",t)}resaltarCelularEnBuscadorTallerista(e){let t=(this.talleristaInput.value??"").toString();return this.highlight(e??"",t)}get estudiantesBuscadosTalleristaPaginados(){let e=this.estudiantesPageTallerista,t=this.estudiantesPageSizeTallerista,i=(e-1)*t;return(this.estudiantesBuscadosTallerista||[]).slice(i,i+t)}get estudiantesTotalPagesTallerista(){let e=this.estudiantesBuscadosTallerista?.length??0,t=Math.ceil(e/this.estudiantesPageSizeTallerista);return Math.max(1,t||1)}estudiantesPrevPageTallerista(){this.estudiantesPageTallerista=Math.max(1,this.estudiantesPageTallerista-1)}estudiantesNextPageTallerista(){this.estudiantesPageTallerista=Math.min(this.estudiantesTotalPagesTallerista,this.estudiantesPageTallerista+1)}limpiarBusquedaEstudianteTallerista(){this.mostrarListaEstudiantesTallerista=!1,this.isBuscandoEstudianteTallerista=!1,this.busquedaEstudiantesTalleristaEjecutada=!1,this.estudiantesBuscadosTallerista=[],this.estudiantesPageTallerista=1}getNombreCompletoEstudiante(e){let t=(e?.Ap_Paterno??"").toString().trim(),i=(e?.Ap_Materno??"").toString().trim(),a=(e?.Nombre??"").toString().trim();return`${t} ${i} ${a}`.replace(/\s+/g," ").trim()}getBackendSearchTermEstudiantes(e){let t=(e??"").toString().trim();if(!t)return"";let i=this.tokenizarPreservandoDuplicados(t).map(u=>(u??"").toString().trim()).filter(Boolean),a=i.filter(u=>this.esTokenNumerico(u)).sort((u,m)=>m.length-u.length);if(a.length>0)return a[0];let c=i.filter(u=>!this.esTokenNumerico(u)).sort((u,m)=>m.length-u.length);return c.length>0?c[0]:t}scoreEstudianteBusqueda(e,t){let i=this.normalizarParaBusqueda(t),a=this.normalizarParaBusqueda(this.getNombreCompletoEstudiante(e)),c=this.normalizarParaBusqueda(e?.CI),u=this.tokenizarPreservandoDuplicados(i),m=0;for(let v of u)v&&(this.esTokenNumerico(v)?m+=this.contarOcurrencias(c,v)*1200:m+=this.contarOcurrencias(a,v)*700);return m}filtrarEstudiantesPreciso(e,t){let i=this.normalizarParaBusqueda(t);if(!i)return e||[];let a=this.tokenizarPreservandoDuplicados(i),c=new Map;for(let u of a)c.set(u,(c.get(u)??0)+1);return(e||[]).filter(u=>{let m=this.normalizarParaBusqueda(this.getNombreCompletoEstudiante(u)),v=this.normalizarParaBusqueda(u?.CI);for(let[b,f]of c.entries())if(b){if(this.esTokenNumerico(b)){if(this.contarOcurrencias(v,b)<f)return!1}else if(this.contarOcurrencias(m,b)<f)return!1}return!0})}buscarEstudiantesParaTallerista(){let e=(this.estudianteInputTallerista.value??"").toString().trim();if(!e){this.estudiantesBuscadosTallerista=[];return}this.busquedaEstudiantesTalleristaEjecutada=!0,this.estudiantesPageTallerista=1,this.mostrarListaEstudiantesTallerista=!0,this.isBuscandoEstudianteTallerista=!0;let i={page:1,per_page:200,search:this.getBackendSearchTermEstudiantes(e)||e,search_mode:"any",relevance:1,sort_by:"id",sort_dir:"desc"};this._est.Obtenerestudiantesifas(i).subscribe({next:a=>{let c=Array.isArray(a?.data)?a.data:[],m=(this.filtrarEstudiantesPreciso(c,e)||[]).slice().sort((v,b)=>{let f=this.scoreEstudianteBusqueda(b,e),P=this.scoreEstudianteBusqueda(v,e);return f!==P?f-P:Number(b?.id??0)-Number(v?.id??0)});this.estudiantesBuscadosTallerista=m,this.isBuscandoEstudianteTallerista=!1,this.mostrarListaEstudiantesTallerista=!0},error:a=>{console.error("Error al buscar estudiantes",a),this.estudiantesBuscadosTallerista=[],this.isBuscandoEstudianteTallerista=!1,this.mostrarListaEstudiantesTallerista=!0}})}seleccionarEstudianteParaTallerista(e){e&&(this.estudianteSeleccionadoParaTallerista=e,this.frmNuevoTallerista.patchValue({Ap_Paterno:e?.Ap_Paterno??"",Ap_Materno:e?.Ap_Materno??"",Nombre:e?.Nombre??"",Carnet:e?.CI??"",Celular:e?.Celular??"",Nombre_Padre:e?.Nombre_Padre??"",Celular_Padre:e?.NumCelP??"",Nombre_Madre:e?.Nombre_Madre??"",Celular_Madre:e?.NumCelM??""}),this.estudianteInputTallerista.setValue(this.getNombreCompletoEstudiante(e),{emitEvent:!1}),this.mostrarListaEstudiantesTallerista=!1,this.estudiantesBuscadosTallerista=[],this.busquedaEstudiantesTalleristaEjecutada=!1,this.estudiantesPageTallerista=1)}resaltarNombreEnBuscadorEstudianteTallerista(e){let t=(this.estudianteInputTallerista.value??"").toString();return this.highlight(this.getNombreCompletoEstudiante(e),t)}resaltarCIEnBuscadorEstudianteTallerista(e){let t=(this.estudianteInputTallerista.value??"").toString();return this.highlight((e??"").toString(),t)}abrirRegistroTalleristaDesdeBuscador(){this.AbrirModalNuevoTallerista()}AbrirModalNuevoTallerista(){this.isSavingTallerista=!1,this.frmNuevoTallerista.reset(this._talleristas.createFormGrouptalleristas().value),this.estudianteSeleccionadoParaTallerista=null,this.estudianteInputTallerista.setValue("",{emitEvent:!0}),this.limpiarBusquedaEstudianteTallerista(),this.fotoAnteriorPath=null,this.fotoTempPath=null,this.isDraggingFoto=!1,this.isUploadingFoto=!1,this.uploadProgressFoto=0,this.cancelarEsperaCapturaFoto(!0);let e=(this.talleristaInput.value??"").toString().trim();if(e){let t=e.split(" ").filter(Boolean);t.length>=1&&this.frmNuevoTallerista.patchValue({Ap_Paterno:t[0]}),t.length>=2&&this.frmNuevoTallerista.patchValue({Ap_Materno:t[1]}),t.length>=3&&this.frmNuevoTallerista.patchValue({Nombre:t.slice(2).join(" ")})}this.modalNuevoTalleristaRef=this._tools.openModal(this.modalNuevoTalleristaTpl,"lg"),this.modalNuevoTalleristaRef.result.finally(()=>{this.cancelarEsperaCapturaFoto(!0),this.limpiarFotoTemporalSiCorresponde(),this.limpiarBusquedaEstudianteTallerista()})}CerrarModalNuevoTallerista(){this.cancelarEsperaCapturaFoto(!0),this.limpiarFotoTemporalSiCorresponde(),this.limpiarBusquedaEstudianteTallerista(),this.modalNuevoTalleristaRef?.close()}GuardarNuevoTallerista(){if(this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere que termine de subirse la foto");return}if(Object.values(this.frmNuevoTallerista.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()}),this.frmNuevoTallerista.invalid){this._tools.MostrarMensaje("warning","Complete los campos requeridos");return}this.isSavingTallerista=!0,this._tools.MostrarMensajeLoading();let e=D({},this.frmNuevoTallerista.value);e.id=0,this._talleristas.Agregartalleristas(e).subscribe({next:t=>{this.isSavingTallerista=!1;let i=t?.data??null;this._tools.MostrarMensajeSuccess(),this.CerrarModalNuevoTallerista(),i?.id?(this.fotoAnteriorPath=(i?.Foto??"").toString()||null,this.fotoTempPath=null,this.talleristas=[i,...(this.talleristas||[]).filter(a=>Number(a?.id)!==Number(i.id))],this.seleccionarTallerista(i)):this.cargarTalleristas()},error:()=>{this.isSavingTallerista=!1,this._tools.MostrarMensajeError()}})}abrirSelectorFoto(e){e.click()}onFotoDragOver(e){e.preventDefault(),this.isDraggingFoto=!0}onFotoDragLeave(e){e.preventDefault(),this.isDraggingFoto=!1}onFotoDrop(e){e.preventDefault(),this.isDraggingFoto=!1;let t=e.dataTransfer?.files;t&&this.handleFotoFiles(t)}onFotoFileSelected(e){let t=e.target,i=t.files;i&&this.handleFotoFiles(i),t.value=""}handleFotoFiles(e){let t=e.item(0);t&&(e.length>1&&this._tools.MostrarMensaje("warning","Solo se permite 1 archivo"),this.subirFoto(t))}subirFoto(e){this.isUploadingFoto=!0,this.uploadProgressFoto=0;let t=this.fotoTempPath;this._tools.SubirArchivo(e,"Foto").subscribe({next:i=>{if(i.type===B.UploadProgress&&i.total){this.uploadProgressFoto=Math.round(i.loaded/i.total*100);return}if(i.type===B.Response){let c=i.body?.filePath;c&&(this.frmNuevoTallerista.patchValue({Foto:c}),this.fotoTempPath=c,t&&t!==c&&t!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(t)),this.isUploadingFoto=!1}},error:i=>{console.error("Error subiendo foto",i),this.isUploadingFoto=!1,this.uploadProgressFoto=0,this._tools.MostrarMensajeError()}})}limpiarFotoTemporalSiCorresponde(){this.fotoTempPath&&this.fotoTempPath!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(this.fotoTempPath),this.fotoTempPath=null,this.fotoAnteriorPath=null,this.isDraggingFoto=!1,this.isUploadingFoto=!1,this.uploadProgressFoto=0}iniciarCapturaFotoTalleristaPorCelular(){return q(this,null,function*(){if(this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere a que termine la subida actual");return}if(!this.pairingToken||this.pairingStatus!=="LINKED"){this._tools.MostrarMensaje("info","Primero vincule el celular (QR)"),yield this.abrirVinculacionCelular();return}this._tools.MostrarMensajeLoading(),this._pairing.solicitarCaptura(this.pairingToken,null,"Foto").subscribe({next:e=>{let t=e?.data?.token;if(!t){this._tools.MostrarMensajeError();return}this.capturaTokenFoto=t,this.capturaStatusFoto=e?.data?.status??"PENDING",this.isEsperandoCapturaFoto=!0,this.iniciarPollingCapturaFoto(),this._tools.MostrarMensajeSuccess()},error:e=>{console.log("ERROR solicitando captura foto",e),this._tools.MostrarMensajeError()}})})}iniciarPollingCapturaFoto(){this.detenerPollingCapturaFoto(),this.capturaTokenFoto&&(this.capturaFotoIntervalId=setInterval(()=>{this.capturaTokenFoto&&this._capture.estadoSesion(this.capturaTokenFoto).subscribe({next:e=>{let t=e?.data?.status,i=e?.data?.file_path;if(this.capturaStatusFoto=t??this.capturaStatusFoto,t==="UPLOADED"&&i){let a=this.fotoTempPath;this.frmNuevoTallerista.patchValue({Foto:i}),this.fotoTempPath=i,a&&a!==i&&a!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(a),this.isUploadingFoto=!1,this.uploadProgressFoto=0,this.isEsperandoCapturaFoto=!1,this.detenerPollingCapturaFoto(),this._tools.MostrarMensaje("success","Foto recibida desde el celular")}},error:()=>{}})},2e3))}detenerPollingCapturaFoto(){this.capturaFotoIntervalId&&(clearInterval(this.capturaFotoIntervalId),this.capturaFotoIntervalId=null)}cancelarEsperaCapturaFoto(e=!1){let t=this.capturaStatusFoto;this.detenerPollingCapturaFoto(),this.capturaStatusFoto=null,this.capturaTokenFoto=null,this.isEsperandoCapturaFoto=!1,this.pairingToken&&t!=="UPLOADED"&&this._pairing.cancelarCaptura(this.pairingToken).subscribe({next:()=>{e||this._tools.MostrarMensaje("info","Espera cancelada")},error:()=>{}})}cargarVinculacionDesdeStorage(){let e=localStorage.getItem("lcch_capture_pairing_token");e&&(this.pairingToken=e,this.refrescarEstadoVinculacion(!1))}refrescarEstadoVinculacion(e){this.pairingToken&&this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:t=>{let i=t?.data?.status??this.pairingStatus;if(this.pairingStatus=i,i==="REVOKED"||i==="EXPIRED"){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null;return}e&&this._tools.MostrarMensaje("success","Vinculaci\xF3n actualizada")},error:t=>{t?.status===404&&(localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null)}})}abrirVinculacionCelular(){return q(this,null,function*(){if(this.isUploadingComprobante||this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere a que termine la subida actual");return}this._tools.MostrarMensajeLoading();let e=()=>new Promise((t,i)=>{let a=()=>{this._pairing.crearVinculacion().subscribe({next:c=>{let u=c?.data?.token;if(!u)return i(new Error("No token"));this.pairingToken=u,this.pairingStatus=c?.data?.status??null,localStorage.setItem("lcch_capture_pairing_token",u),t(u)},error:c=>i(c)})};if(this.pairingToken){this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:c=>{let u=c?.data?.status??null;if(this.pairingStatus=u,u==="EXPIRED"||u==="REVOKED"){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null,a();return}t(this.pairingToken)},error:c=>{if(c?.status===404){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null,a();return}i(c)}});return}a()});try{let t=yield e(),i=this.router.serializeUrl(this.router.createUrlTree(["/captura-celular",t])),a=window.location.hostname,u=(a==="localhost"||a==="127.0.0.1")&&k.frontendPublicBaseUrl?k.frontendPublicBaseUrl:document.baseURI;this.pairingUrl=new URL(i,u).toString();try{this.pairingQrDataUrl=yield te.toDataURL(this.pairingUrl,{width:240,margin:1})}catch{this.pairingQrDataUrl=null}this.modalVincularCelularRef=this._tools.openModal(this.modalVincularCelular,"md"),this.modalVincularCelularRef.result.finally(()=>{this.detenerPollingVinculacion()}),this.iniciarPollingVinculacion(),this._tools.MostrarMensajeSuccess()}catch(t){console.log("ERROR creando vinculaci\xF3n",t),this._tools.MostrarMensajeError()}})}iniciarPollingVinculacion(){this.detenerPollingVinculacion(),this.pairingToken&&(this.pairingIntervalId=setInterval(()=>{this.pairingToken&&this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:e=>{let t=e?.data?.status;this.pairingStatus=t??this.pairingStatus,t==="LINKED"&&this.detenerPollingVinculacion()},error:()=>{}})},2e3))}detenerPollingVinculacion(){this.pairingIntervalId&&(clearInterval(this.pairingIntervalId),this.pairingIntervalId=null)}iniciarCapturaComprobantePorCelular(){return q(this,null,function*(){if(this.isUploadingComprobante){this._tools.MostrarMensaje("warning","Espere a que termine la subida actual");return}if(!this.pairingToken||this.pairingStatus!=="LINKED"){this._tools.MostrarMensaje("info","Primero vincule el celular (QR)"),yield this.abrirVinculacionCelular();return}this._tools.MostrarMensajeLoading(),this._pairing.solicitarCaptura(this.pairingToken,null,"pagosAnualesUnicos").subscribe({next:e=>{let t=e?.data?.token;if(!t){this._tools.MostrarMensajeError();return}this.capturaToken=t,this.capturaStatus=e?.data?.status??"PENDING_PAGOS",this.isEsperandoCapturaComprobante=!0,this.iniciarPollingCaptura(),this._tools.MostrarMensajeSuccess()},error:e=>{console.log("ERROR solicitando captura",e),this._tools.MostrarMensajeError()}})})}iniciarPollingCaptura(){this.detenerPollingCaptura(),this.capturaToken&&(this.capturaIntervalId=setInterval(()=>{this.capturaToken&&this._capture.estadoSesion(this.capturaToken).subscribe({next:e=>{let t=e?.data?.status,i=e?.data?.file_path;if(this.capturaStatus=t??this.capturaStatus,t==="UPLOADED"&&i){let a=this.comprobanteTempPath;this.frmPago.patchValue({ComprobantePago:i}),this.comprobanteTempPath=i,a&&a!==i&&a!==this.comprobanteAnteriorPath&&this._tools.EliminarArchivo(a),this.isUploadingComprobante=!1,this.uploadProgressComprobante=0,this.isEsperandoCapturaComprobante=!1,this.detenerPollingCaptura(),this._tools.MostrarMensaje("success","Comprobante recibido desde el celular")}},error:()=>{}})},2e3))}detenerPollingCaptura(){this.capturaIntervalId&&(clearInterval(this.capturaIntervalId),this.capturaIntervalId=null)}cancelarEsperaCapturaComprobante(e=!1){let t=this.capturaStatus;this.detenerPollingCaptura(),this.capturaStatus=null,this.capturaToken=null,this.isEsperandoCapturaComprobante=!1,this.pairingToken&&t!=="UPLOADED"&&this._pairing.cancelarCaptura(this.pairingToken).subscribe({next:()=>{e||this._tools.MostrarMensaje("info","Espera cancelada")},error:()=>{}})}onComprobanteFileSelected(e){let t=e.target,a=t.files?.item(0);a&&this.subirComprobante(a),t.value=""}subirComprobante(e){this.isUploadingComprobante=!0,this.uploadProgressComprobante=0,this._tools.SubirArchivo(e,"pagosAnualesUnicos").subscribe({next:t=>{if(t.type===B.UploadProgress&&t.total){this.uploadProgressComprobante=Math.round(t.loaded/t.total*100);return}if(t.type===B.Response){let a=t.body?.filePath;if(a){let c=this.comprobanteTempPath;this.frmPago.patchValue({ComprobantePago:a}),this.comprobanteTempPath=a,c&&c!==a&&c!==this.comprobanteAnteriorPath&&this._tools.EliminarArchivo(c)}this.isUploadingComprobante=!1}},error:t=>{console.error("Error subiendo comprobante",t),this.isUploadingComprobante=!1,this.uploadProgressComprobante=0,this._tools.MostrarMensajeError()}})}limpiarComprobanteTemporalSiCorresponde(){this.comprobanteTempPath&&this.comprobanteTempPath!==this.comprobanteAnteriorPath&&this._tools.EliminarArchivo(this.comprobanteTempPath),this.comprobanteTempPath=null,this.comprobanteAnteriorPath=null,this.isUploadingComprobante=!1,this.uploadProgressComprobante=0}cargarPerfil(){this._auth.pedirPerfil().subscribe({next:e=>{let t=e?.usuario??e?.data?.usuario??e??{},i=(t?.Cargo??"").toString().toUpperCase().trim();this.esDocente=i==="DOCENTE";let a=Number(t?.id??0);this.docenteIdPerfil=Number.isFinite(a)&&a>0?a:null},error:()=>{this.esDocente=!1,this.docenteIdPerfil=null}})}hoyISO(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${a}`}sumarUnMes(e){let t=(e??"").trim();if(!t)return null;let i=new Date(t+"T00:00:00");if(Number.isNaN(i.getTime()))return null;let a=i.getDate();i.setMonth(i.getMonth()+1),i.getDate()!==a&&i.setDate(0);let c=i.getFullYear(),u=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");return`${c}-${u}-${m}`}esActivo(e){let t=(e?.FechaHasta??"").toString();return t?t>=this.hoyISO():!1}saldoDias(e){let t=(e?.FechaHasta??"").toString().trim();if(!t)return null;let i=new Date(t+"T00:00:00");if(Number.isNaN(i.getTime()))return null;let a=new Date(this.hoyISO()+"T00:00:00"),c=i.getTime()-a.getTime();return Math.floor(c/864e5)}getNombreCompletoTalleristaEnPago(e){let t=(e?.Ap_Paterno??"").toString().trim(),i=(e?.Ap_Materno??"").toString().trim(),a=(e?.Nombre??"").toString().trim();return`${t} ${i} ${a}`.replace(/\s+/g," ").trim()}getNombreCompletoDocenteEnPago(e){let t=(e?.DocenteApellidos??"").toString().trim(),i=(e?.DocenteNombres??"").toString().trim();return`${t} ${i}`.replace(/\s+/g," ").trim()}especialidadLabel(e){let t=(e??"").toString();return t?((this.optionsEspecialidad||[]).find(a=>(a?.value??"").toString()===t)?.label??t).toString():""}cargarOptionsEspecialidad(){let e=["ESPECIALIDAD"];this._controles.ObtenerOptionsSelectPorCategorias(e).subscribe({next:t=>{this.optionsEspecialidad=t?.ESPECIALIDAD||[]},error:()=>{this.optionsEspecialidad=[]}})}cargarTalleristas(){this.isLoadingTalleristas=!0,this._talleristas.Obtenertalleristas().subscribe({next:e=>{this.talleristas=Array.isArray(e?.data)?e.data:[],this.isLoadingTalleristas=!1},error:()=>{this.talleristas=[],this.isLoadingTalleristas=!1,this._tools.MostrarMensajeError()}})}cargarDocentes(){this._docentes.Obtenerplanteldocentes().subscribe({next:e=>{this.docentes=Array.isArray(e?.data)?e.data:[]},error:()=>{this.docentes=[]}})}cargarPagosGlobal(){this.isLoadingPagos=!0,this._pagos.Obtenerpagostalleres().subscribe({next:e=>{this.pagos=Array.isArray(e?.data)?e.data:[],this.pagosFiltrados=this.pagos.slice(),this.paginPagos=1,this.isLoadingPagos=!1},error:()=>{this.pagos=[],this.pagosFiltrados=[],this.paginPagos=1,this.isLoadingPagos=!1,this._tools.MostrarMensajeError()}})}buscarPagos(){let e=(this.pagoSearchInput.value??"").toString().trim();if(this.busquedaPagosEjecutada=!0,this.paginPagos=1,!e){this.pagosFiltrados=this.pagos.slice();return}this.isBuscandoPagos=!0;let t=this.normalizarParaBusqueda(e),i=this.tokenizarPreservandoDuplicados(t),a=new Map;for(let m of i)a.set(m,(a.get(m)??0)+1);let u=(this.pagos||[]).filter(m=>{let v=this.normalizarParaBusqueda(this.getNombreCompletoTalleristaEnPago(m)),b=this.normalizarParaBusqueda(m?.Carnet),f=this.normalizarParaBusqueda(this.getNombreCompletoDocenteEnPago(m)),P=this.normalizarParaBusqueda(this.especialidadLabel(m?.Especialidad)),V=this.normalizarParaBusqueda(m?.Turno),A=this.normalizarParaBusqueda(m?.Horario),nt=this.normalizarParaBusqueda(m?.DetallePago),re=this.normalizarParaBusqueda(m?.Observacion),ne=this.normalizarParaBusqueda(m?.MontoPagado);for(let[Lt,oe]of a.entries()){if(!Lt)continue;if(![v,b,f,P,V,A,nt,re,ne].some(se=>this.contarOcurrencias(se,Lt)>=oe))return!1}return!0}).slice().sort((m,v)=>{let b=this.scorePagoBusqueda(m,e),f=this.scorePagoBusqueda(v,e);return f!==b?f-b:Number(v?.id??0)-Number(m?.id??0)});this.pagosFiltrados=u,this.isBuscandoPagos=!1}scorePagoBusqueda(e,t){let i=this.normalizarParaBusqueda(t);if(!i)return 0;let a=this.normalizarParaBusqueda(this.getNombreCompletoTalleristaEnPago(e)),c=this.normalizarParaBusqueda(e?.Carnet),u=this.normalizarParaBusqueda(this.getNombreCompletoDocenteEnPago(e)),m=this.normalizarParaBusqueda(this.especialidadLabel(e?.Especialidad)),v=0;c&&i===c&&(v+=2e4),a&&i===a&&(v+=15e3),a&&a.startsWith(i)&&(v+=9e3),u&&u.includes(i)&&(v+=6e3),m&&m.includes(i)&&(v+=5e3);let b=this.tokenizarPreservandoDuplicados(i);for(let f of b)f&&(v+=this.contarOcurrencias(a,f)*700,v+=this.contarOcurrencias(c,f)*900,v+=this.contarOcurrencias(u,f)*400,v+=this.contarOcurrencias(m,f)*300);return v}resetBusquedaPagos(){this.busquedaPagosEjecutada=!1,this.isBuscandoPagos=!1,this.paginPagos=1,this.pagosFiltrados=this.pagos.slice()}get collectionSizePagos(){return this.pagosFiltrados?.length??0}get pagosPaginadosTabla(){let e=this.pagosFiltrados||[],i=(Math.min(Math.max(1,this.paginPagos),Math.max(1,Math.ceil(e.length/this.pageSizePagos)||1))-1)*this.pageSizePagos;return e.slice(i,i+this.pageSizePagos)}onPageChangePagos(e){this.paginPagos=e}onPageSizeChangePagos(){this.paginPagos=1}AbrirModalPagoNuevo(){this.editId=null,this.frmPago.reset(this._pagos.createFormGrouppagostalleres().value),this.comprobanteAnteriorPath=null,this.comprobanteTempPath=null,this.cancelarEsperaCapturaComprobante(!0),this.frmPago.patchValue({talleristas_id:null,FechaPago:this.hoyISO(),FechaHasta:this.sumarUnMes(this.hoyISO())??this.hoyISO()}),this.talleristaSeleccionado=null,this.talleristaInput.setValue("",{emitEvent:!0}),this.limpiarBusquedaTallerista(),this.esDocente&&this.docenteIdPerfil?(this.frmPago.patchValue({planteldocentes_id:this.docenteIdPerfil}),this.frmPago.get("planteldocentes_id")?.disable({emitEvent:!1})):this.frmPago.get("planteldocentes_id")?.enable({emitEvent:!1}),this.modalPagoRef=this._tools.openModal(this.modalPagoTpl,"lg")}AbrirModalPagoEditar(e){this.editId=Number(e?.id??0)||null,this.frmPago.reset(this._pagos.createFormGrouppagostalleres().value),this.frmPago.patchValue(D({},e));let t=Number(e?.talleristas_id??e?.Talleristas_id??0);t?(this.talleristaSeleccionado=this.talleristas.find(i=>Number(i?.id)===t)??null,this.talleristaInput.setValue(this.talleristaSeleccionado?this.getNombreCompletoTallerista(this.talleristaSeleccionado):"",{emitEvent:!1})):(this.talleristaSeleccionado=null,this.talleristaInput.setValue("",{emitEvent:!1})),this.limpiarBusquedaTallerista(),this.comprobanteAnteriorPath=(e?.ComprobantePago??"").toString()||null,this.comprobanteTempPath=null,this.cancelarEsperaCapturaComprobante(!0),this.esDocente&&this.docenteIdPerfil?(this.frmPago.patchValue({planteldocentes_id:this.docenteIdPerfil}),this.frmPago.get("planteldocentes_id")?.disable({emitEvent:!1})):this.frmPago.get("planteldocentes_id")?.enable({emitEvent:!1}),this.modalPagoRef=this._tools.openModal(this.modalPagoTpl,"lg")}CerrarModalPago(){this.frmPago.get("planteldocentes_id")?.enable({emitEvent:!1}),this.cancelarEsperaCapturaComprobante(!0),this.limpiarComprobanteTemporalSiCorresponde(),this.modalPagoRef?.close()}GuardarPago(){if(this.isUploadingComprobante){this._tools.MostrarMensaje("warning","Espere que termine de subirse el comprobante");return}if(!Number(this.frmPago.get("talleristas_id")?.value??0)){this._tools.MostrarMensaje("warning","Seleccione un tallerista");return}if(Object.values(this.frmPago.controls).forEach(c=>{c.markAsTouched(),c.markAsDirty()}),this.frmPago.invalid){this._tools.MostrarMensaje("warning","Complete los campos requeridos");return}let t=D({},this.frmPago.getRawValue()),i=this.editId;this.isSaving=!0,this._tools.MostrarMensajeLoading(),(i?this._pagos.Modificarpagostalleres(t,i):this._pagos.Agregarpagostalleres(t)).subscribe({next:()=>{this.isSaving=!1,this._tools.MostrarMensajeSuccess(),this.CerrarModalPago(),this.cargarPagosGlobal()},error:()=>{this.isSaving=!1,this._tools.MostrarMensajeError()}})}EliminarPago(e){let t=Number(e?.id??0);t&&confirm("\xBFEliminar el pago seleccionado?")&&(this._tools.MostrarMensajeLoading(),this._pagos.Eliminarpagostalleres(t).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.cargarPagosGlobal()},error:()=>this._tools.MostrarMensajeError()}))}};X.\u0275fac=function(t){return new(t||X)(I(K),I(kt),I(Vt),I(Zt),I(Wt),I(Mt),I(Ft),I(Nt),I(Kt),I(ht))},X.\u0275cmp=ct({type:X,selectors:[["app-pagostalleres"]],viewQuery:function(t,i){if(t&1&&(L(be,7),L(xe,7),L(Ce,7)),t&2){let a;z(a=R())&&(i.modalNuevoTalleristaTpl=a.first),z(a=R())&&(i.modalPagoTpl=a.first),z(a=R())&&(i.modalVincularCelular=a.first)}},standalone:!1,decls:16,vars:4,consts:[["modalNuevoTallerista",""],["modalPago",""],["modalVincularCelular",""],["fileFoto",""],["fileComp",""],[1,"container-fluid"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],[1,"btn","mouse-dir","primary",3,"click"],["class","alert alert-info",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","row mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"alert","alert-info"],[1,"text-muted"],[1,"row","mb-3"],[1,"col-12","col-md-6"],["title","PRESIONAR TECLA ENTER PARA REALIZAR BUSQUEDA",1,"input-group"],[1,"input-group-text"],[1,"form-floating"],["type","text","placeholder","Buscar","autocomplete","off",1,"form-control",3,"keyup.enter","formControl"],["class","small text-muted mt-1",4,"ngIf"],[1,"small","text-muted","mt-1"],[1,"table-responsive"],[1,"table","table-sm","table-hover","align-middle"],[1,"text-center"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],[1,"fw-semibold"],[1,"small","text-muted"],[1,"badge"],[2,"max-width","260px"],[1,"text-truncate"],[1,"small","text-muted","text-truncate"],["target","_blank","rel","noopener",3,"href",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],["target","_blank","rel","noopener",3,"href"],["colspan","10",1,"text-muted"],[1,"d-flex","align-items-center","justify-content-between"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-3",3,"formGroup"],[1,"col-12"],[1,"form-label"],[1,"dropzone",3,"dragover","dragleave","drop"],[1,"d-flex","align-items-center","justify-content-between",2,"gap","12px"],[1,"text-muted","small"],[1,"d-flex","align-items-center",2,"gap","10px"],["type","file","accept","image/*",1,"d-none",3,"change"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["class","rounded","style","width: 48px; height: 48px; object-fit: cover;",3,"src",4,"ngIf"],[1,"d-flex","flex-wrap","align-items-center","mt-2",2,"gap","8px"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"badge","align-self-center",3,"ngClass"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],["class","alert alert-info py-2 mt-2 d-flex justify-content-between align-items-center",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"col-12","position-relative",2,"z-index","1052"],["type","text","placeholder"," ","autocomplete","off",1,"form-control",3,"focus","keyup.enter","formControl"],["class","list-group position-absolute w-100 lista-buscador","style","z-index: 1100;",4,"ngIf"],[1,"col-12","col-md-4"],["type","text","formControlName","Ap_Paterno","placeholder","Apellido paterno"],[1,"invalid-feedback"],["type","text","formControlName","Ap_Materno","placeholder","Apellido materno"],["type","text","formControlName","Nombre","placeholder","Nombres"],["type","text","formControlName","Carnet","placeholder","Carnet"],["type","text","formControlName","Celular","placeholder","Celular"],["type","text","formControlName","Nombre_Padre","placeholder","Nombre del padre",1,"form-control","text-uppercase"],["type","text","formControlName","Celular_Padre","placeholder","Celular del padre",1,"form-control","text-uppercase"],["type","text","formControlName","Nombre_Madre","placeholder","Nombre de la madre",1,"form-control","text-uppercase"],["type","text","formControlName","Celular_Madre","placeholder","Celular de la madre",1,"form-control","text-uppercase"],[1,"modal-footer"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"btn","mouse-dir","primary",3,"click","disabled"],[1,"rounded",2,"width","48px","height","48px","object-fit","cover",3,"src"],[1,"alert","alert-info","py-2","mt-2","d-flex","justify-content-between","align-items-center"],[1,"small"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"mt-2"],[1,"progress",2,"height","8px"],["role","progressbar",1,"progress-bar"],[1,"text-muted","small","mt-1"],[1,"list-group","position-absolute","w-100","lista-buscador",2,"z-index","1100"],["class","list-group-item",4,"ngIf"],["class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"list-group-item","list-group-item-action",3,"click"],[1,"d-flex","w-100","justify-content-between"],[3,"innerHTML"],[1,"d-flex","justify-content-between","align-items-center",2,"gap","8px"],[1,"form-floating","mb-3","col-12","position-relative","tallerista-buscador",2,"z-index","1052"],["class","list-group position-absolute w-100","style","z-index: 1000;",4,"ngIf"],["class","col-12",4,"ngIf"],["type","date","formControlName","FechaPago","placeholder","Fecha de pago"],["type","date","formControlName","FechaHasta","placeholder","Hasta cu\xE1ndo pasa clases"],["formControlName","planteldocentes_id"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-muted small",4,"ngIf"],["formControlName","Especialidad"],["type","text","formControlName","Turno","placeholder","Turno",1,"form-control","text-uppercase"],["type","text","formControlName","Horario","placeholder","Horario",1,"form-control","text-uppercase"],["type","number","step","0.01","formControlName","MontoPagado","placeholder","Monto pagado",1,"form-control"],["formControlName","DetallePago","placeholder","Detalle del pago",1,"form-control",2,"height","80px"],[1,"border","rounded","p-2"],["class","btn btn-outline-primary","target","_blank","rel","noopener",3,"href",4,"ngIf"],["formControlName","Observacion","placeholder","Observaci\xF3n",1,"form-control",2,"height","110px"],[1,"list-group","position-absolute","w-100",2,"z-index","1000"],[1,"d-flex","w-100","justify-content-between","align-items-center",2,"gap","10px"],[1,"badge","bg-primary"],[1,"alert","alert-secondary","py-2","mb-0"],["target","_blank","rel","noopener",1,"btn","btn-outline-primary",3,"href"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"mb-2","text-muted"],["class","d-flex justify-content-center",4,"ngIf"],[1,"mt-3"],["class","mt-3",4,"ngIf"],[1,"d-flex","justify-content-center"],["alt","QR",2,"max-width","260px","width","100%",3,"src"]],template:function(t,i){if(t&1){let a=E();r(0,"div",5)(1,"div",6)(2,"h4",7),o(3,"Pagos de Talleres"),n(),r(4,"button",8),_("click",function(){return g(a),h(i.AbrirModalPagoNuevo())}),o(5,"Registrar pago"),n()(),C(6,Se,2,0,"div",9)(7,Te,2,0,"div",10)(8,Ee,10,2,"div",11)(9,Ne,28,3,"div",12),n(),C(10,Oe,98,35,"ng-template",null,0,O)(12,Je,101,35,"ng-template",null,1,O)(14,ii,14,3,"ng-template",null,2,O)}t&2&&(l(6),d("ngIf",i.isLoadingTalleristas),l(),d("ngIf",i.isLoadingPagos),l(),d("ngIf",!i.isLoadingPagos),l(),d("ngIf",!i.isLoadingPagos))},dependencies:[dt,pt,mt,Ct,yt,It,_t,$t,Et,ft,vt,xt,St,Tt,Pt,wt],styles:[".badge[_ngcontent-%COMP%]{padding:6px 10px}.lista-buscador[_ngcontent-%COMP%]{max-height:320px;overflow:auto;z-index:1100}.dropzone[_ngcontent-%COMP%]{border:2px dashed #cbd5e1;border-radius:12px;padding:14px;background:#f8fafc;cursor:pointer;transition:.12s ease-in-out}.dropzone.dragging[_ngcontent-%COMP%]{border-color:#0d6efd;background:#eef6ff}.foto-empty[_ngcontent-%COMP%]{width:140px;height:140px;border-radius:12px;background:#e9ecef;display:flex;align-items:center;justify-content:center;color:#6c757d}"]});var At=X;var ie=zt(Yt());var ai=["modalgestiontalleristas"],ri=["modalVincularCelular"],ni=(s,e,t)=>({"bg-success":s,"bg-secondary":e,"bg-danger":t});function oi(s,e){s&1&&(r(0,"div",14),o(1,"Cargando..."),n())}function si(s,e){if(s&1&&x(0,"img",27),s&2){let t=e.ngIf;d("src",t,N)}}function li(s,e){s&1&&x(0,"div",28)}function ci(s,e){if(s&1){let t=E();r(0,"tr")(1,"td",21),C(2,si,1,1,"img",22)(3,li,1,0,"div",23),n(),r(4,"td")(5,"div",24),o(6),n(),r(7,"div",14),o(8),n()(),r(9,"td"),o(10),n(),r(11,"td"),o(12),n(),r(13,"td")(14,"div",24),o(15),n(),r(16,"div",14),o(17),n()(),r(18,"td")(19,"div",24),o(20),n(),r(21,"div",14),o(22),n()(),r(23,"td",17)(24,"button",25),_("click",function(){let a=g(t).$implicit,c=p(2);return h(c.AbrirModalEditar(a))}),o(25,"Editar"),n(),r(26,"button",26),_("click",function(){let a=g(t).$implicit,c=p(2);return h(c.Eliminar(a))}),o(27,"Eliminar"),n()()()}if(s&2){let t=e.$implicit,i=p(2);l(2),d("ngIf",i.fotoUrl(t==null?null:t.Foto)),l(),d("ngIf",!i.fotoUrl(t==null?null:t.Foto)),l(3),T(((t==null?null:t.Ap_Paterno)||"")+" "+((t==null?null:t.Ap_Materno)||"")),l(2),T(t==null?null:t.Nombre),l(2),T(t==null?null:t.Carnet),l(2),T(t==null?null:t.Celular),l(3),T(t==null?null:t.Nombre_Padre),l(2),T(t==null?null:t.Celular_Padre),l(3),T(t==null?null:t.Nombre_Madre),l(2),T(t==null?null:t.Celular_Madre)}}function ui(s,e){s&1&&(r(0,"tr")(1,"td",29),o(2,"Sin registros"),n()())}function di(s,e){if(s&1&&(r(0,"option",34),o(1),n()),s&2){let t=e.$implicit;d("value",t),l(),y("",t," por p\xE1gina")}}function pi(s,e){if(s&1){let t=E();r(0,"div",30)(1,"ngb-pagination",31),_("pageChange",function(a){g(t);let c=p(2);return h(c.onPageChangeTalleristas(a))}),n(),r(2,"select",32),it("ngModelChange",function(a){g(t);let c=p(2);return et(c.pageSizeTalleristas,a)||(c.pageSizeTalleristas=a),h(a)}),_("change",function(){g(t);let a=p(2);return h(a.onPageSizeChangeTalleristas())}),C(3,di,2,2,"option",33),n()()}if(s&2){let t=p(2);l(),d("page",t.paginTalleristas)("collectionSize",t.collectionSizeTalleristas)("pageSize",t.pageSizeTalleristas)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0),l(),tt("ngModel",t.pageSizeTalleristas),l(),d("ngForOf",t.pageSizeOptionsTalleristas)}}function mi(s,e){if(s&1&&(r(0,"div",15)(1,"table",16)(2,"thead")(3,"tr")(4,"th"),o(5,"Foto"),n(),r(6,"th"),o(7,"Apellidos y Nombres"),n(),r(8,"th"),o(9,"Carnet"),n(),r(10,"th"),o(11,"Celular"),n(),r(12,"th"),o(13,"Padre"),n(),r(14,"th"),o(15,"Madre"),n(),r(16,"th",17),o(17,"Acciones"),n()()(),r(18,"tbody"),C(19,ci,28,10,"tr",18)(20,ui,3,0,"tr",19),n()(),C(21,pi,4,9,"div",20),n()),s&2){let t=p();l(19),d("ngForOf",t.talleristasPaginadosTabla),l(),d("ngIf",t.talleristasFiltrados.length===0),l(),d("ngIf",t.collectionSizeTalleristas>0)}}function gi(s,e){if(s&1&&(r(0,"span",76),o(1," CI: "),r(2,"span",24),o(3),n()()),s&2){let t=p(3);l(3),T(t.autoSeleccionado==null||t.autoSeleccionado.row==null?null:t.autoSeleccionado.row.CI)}}function hi(s,e){if(s&1&&(r(0,"span",76),o(1," Carnet: "),r(2,"span",24),o(3),n()()),s&2){let t=p(3);l(3),T(t.autoSeleccionado==null||t.autoSeleccionado.row==null?null:t.autoSeleccionado.row.Carnet)}}function _i(s,e){if(s&1&&(r(0,"div",74),o(1," Fuente: "),r(2,"span",24),o(3),n(),C(4,gi,4,1,"span",75)(5,hi,4,1,"span",75),n()),s&2){let t=p(2);l(3),T(t.autoSeleccionado==null?null:t.autoSeleccionado.fuente),l(),d("ngIf",(t.autoSeleccionado==null?null:t.autoSeleccionado.fuente)==="IFAS"),l(),d("ngIf",(t.autoSeleccionado==null?null:t.autoSeleccionado.fuente)==="TALLERISTA")}}function fi(s,e){s&1&&(r(0,"div",50),o(1,"Buscando..."),n())}function vi(s,e){if(s&1&&(r(0,"span"),o(1),n()),s&2){let t=p().$implicit;l(),y(" ",((t==null||t.row==null?null:t.row.Ap_Paterno)||"")+" "+((t==null||t.row==null?null:t.row.Ap_Materno)||"")+" "+((t==null||t.row==null?null:t.row.Nombre)||"")," ")}}function bi(s,e){if(s&1&&(r(0,"span"),o(1),n()),s&2){let t=p().$implicit;l(),y(" ",((t==null||t.row==null?null:t.row.Ap_Paterno)||"")+" "+((t==null||t.row==null?null:t.row.Ap_Materno)||"")+" "+((t==null||t.row==null?null:t.row.Nombre)||"")," ")}}function xi(s,e){if(s&1&&(r(0,"span"),o(1),n()),s&2){let t=p().$implicit;l(),T(t==null||t.row==null?null:t.row.CI)}}function Ci(s,e){if(s&1&&(r(0,"span"),o(1),n()),s&2){let t=p().$implicit;l(),T(t==null||t.row==null?null:t.row.Carnet)}}function Si(s,e){if(s&1){let t=E();r(0,"tr")(1,"td")(2,"span",85),o(3),n()(),r(4,"td"),C(5,vi,2,1,"span",19)(6,bi,2,1,"span",19),n(),r(7,"td"),C(8,xi,2,1,"span",19)(9,Ci,2,1,"span",19),n(),r(10,"td",17)(11,"button",86),_("click",function(){let a=g(t).$implicit,c=p(4);return h(c.seleccionarAuto(a))}),o(12,"Seleccionar"),n()()()}if(s&2){let t=e.$implicit;l(2),d("ngClass",(t==null?null:t.fuente)==="IFAS"?"bg-primary":"bg-success"),l(),T(t==null?null:t.fuente),l(2),d("ngIf",(t==null?null:t.fuente)==="IFAS"),l(),d("ngIf",(t==null?null:t.fuente)==="TALLERISTA"),l(2),d("ngIf",(t==null?null:t.fuente)==="IFAS"),l(),d("ngIf",(t==null?null:t.fuente)==="TALLERISTA")}}function Ti(s,e){s&1&&(r(0,"tr")(1,"td",87),o(2,"Sin coincidencias"),n()())}function Pi(s,e){if(s&1){let t=E();r(0,"div",30)(1,"button",88),_("click",function(){g(t);let a=p(4);return h(a.autoPrevPage())}),o(2,"Anterior"),n(),r(3,"div",89),o(4),n(),r(5,"button",88),_("click",function(){g(t);let a=p(4);return h(a.autoNextPage())}),o(6,"Siguiente"),n()()}if(s&2){let t=p(4);l(),d("disabled",t.autoPage<=1),l(3),W("P\xE1gina ",t.autoPage," / ",t.autoTotalPages),l(),d("disabled",t.autoPage>=t.autoTotalPages)}}function Ei(s,e){if(s&1&&(r(0,"div",80)(1,"table",81)(2,"thead")(3,"tr")(4,"th",82),o(5,"Fuente"),n(),r(6,"th"),o(7,"Registro"),n(),r(8,"th",83),o(9,"CI/Carnet"),n(),r(10,"th",84),o(11,"Acci\xF3n"),n()()(),r(12,"tbody"),C(13,Si,13,6,"tr",18)(14,Ti,3,0,"tr",19),n()(),C(15,Pi,7,4,"div",20),n()),s&2){let t=p(3);l(13),d("ngForOf",t.autoPaginados),l(),d("ngIf",t.autoPaginados.length===0),l(),d("ngIf",((t.autoResultados==null?null:t.autoResultados.length)||0)>t.autoPageSize)}}function yi(s,e){if(s&1&&(r(0,"div",77)(1,"div",30)(2,"div",24),o(3,"Resultados"),n(),C(4,fi,2,0,"div",78),n(),C(5,Ei,16,3,"div",79),n()),s&2){let t=p(2);l(4),d("ngIf",t.isBuscandoAuto),l(),d("ngIf",!t.isBuscandoAuto)}}function Ii(s,e){if(s&1&&x(0,"img",27),s&2){let t=e.ngIf;d("src",t,N)}}function wi(s,e){if(s&1){let t=E();r(0,"div",90)(1,"div")(2,"div",24),o(3,"Esperando foto del celular..."),n(),r(4,"div",91),o(5),n()(),r(6,"button",92),_("click",function(){g(t);let a=p(2);return h(a.cancelarEsperaCaptura())}),o(7,"Cancelar"),n()()}if(s&2){let t=p(2);l(5),y("Estado: ",t.capturaStatus||"PENDING",". Puedes seguir llenando el formulario.")}}function Mi(s,e){if(s&1&&(r(0,"div",93)(1,"div",94),x(2,"div",95),n(),r(3,"div",96),o(4),n()()),s&2){let t=p(2);l(2),J("width",t.uploadProgressFoto,"%"),l(2),y("",t.uploadProgressFoto,"%")}}function ki(s,e){if(s&1){let t=E();r(0,"div",35)(1,"h5",36),o(2,"Registro de Tallerista"),n(),r(3,"button",37),_("click",function(){g(t);let a=p();return h(a.CerrarModal())}),n()(),r(4,"div",38)(5,"form",39)(6,"div",40)(7,"label",41),o(8,"Autocompletar (Talleristas / Estudiantes IFAS)"),n(),r(9,"div",42),x(10,"input",43),r(11,"button",44),_("click",function(){g(t);let a=p();return h(a.buscarAutocompletar())}),o(12,"Buscar"),n(),r(13,"button",45),_("click",function(){g(t);let a=p();return h(a.limpiarAuto())}),o(14,"Limpiar"),n()(),C(15,_i,6,3,"div",46)(16,yi,6,2,"div",47),n(),r(17,"div",40)(18,"label",41),o(19,"Foto"),n(),r(20,"div",48),_("dragover",function(a){g(t);let c=p();return h(c.onFotoDragOver(a))})("dragleave",function(a){g(t);let c=p();return h(c.onFotoDragLeave(a))})("drop",function(a){g(t);let c=p();return h(c.onFotoDrop(a))}),r(21,"div",49)(22,"div")(23,"div",24),o(24,"Arrastra una foto o selecciona un archivo"),n(),r(25,"div",50),o(26,"1 archivo"),n()(),r(27,"div",51)(28,"input",52,2),_("change",function(a){g(t);let c=p();return h(c.onFotoFileSelected(a))}),n(),r(30,"button",44),_("click",function(){g(t);let a=Z(29),c=p();return h(c.abrirSelectorFoto(a))}),o(31,"Elegir"),n(),C(32,Ii,1,1,"img",22),n()(),r(33,"div",53)(34,"button",54),_("click",function(){g(t);let a=p();return h(a.abrirVinculacionCelular())}),o(35," Vincular celular (QR) "),n(),r(36,"span",55),o(37),n(),r(38,"button",56),_("click",function(){g(t);let a=p();return h(a.iniciarCapturaFotoPorCelular())}),o(39," Tomar foto con celular "),n()(),C(40,wi,8,1,"div",57)(41,Mi,5,3,"div",58),n()(),r(42,"div",59)(43,"div",60),x(44,"input",61),r(45,"label"),o(46,"Apellido paterno"),n(),r(47,"div",62),o(48,"Apellido paterno requerido."),n()()(),r(49,"div",59)(50,"div",60),x(51,"input",63),r(52,"label"),o(53,"Apellido materno"),n(),r(54,"div",62),o(55,"Apellido materno requerido."),n()()(),r(56,"div",59)(57,"div",60),x(58,"input",64),r(59,"label"),o(60,"Nombres"),n(),r(61,"div",62),o(62,"Nombres requerido."),n()()(),r(63,"div",59)(64,"div",60),x(65,"input",65),r(66,"label"),o(67,"Carnet"),n(),r(68,"div",62),o(69,"Carnet requerido."),n()()(),r(70,"div",59)(71,"div",60),x(72,"input",66),r(73,"label"),o(74,"Celular"),n(),r(75,"div",62),o(76,"Celular requerido."),n()()(),r(77,"div",8)(78,"div",60),x(79,"input",67),r(80,"label"),o(81,"Nombre del padre"),n()()(),r(82,"div",8)(83,"div",60),x(84,"input",68),r(85,"label"),o(86,"Celular del padre"),n()()(),r(87,"div",8)(88,"div",60),x(89,"input",69),r(90,"label"),o(91,"Nombre de la madre"),n()()(),r(92,"div",8)(93,"div",60),x(94,"input",70),r(95,"label"),o(96,"Celular de la madre"),n()()()()(),r(97,"div",71)(98,"button",72),_("click",function(){g(t);let a=p();return h(a.CerrarModal())}),o(99,"Cancelar"),n(),r(100,"button",73),_("click",function(){g(t);let a=p();return h(a.Guardar())}),o(101,"Guardar"),n()()}if(s&2){let t,i=p();l(5),d("formGroup",i.frm),l(5),d("formControl",i.autoInput),l(),d("disabled",i.isBuscandoAuto),l(4),d("ngIf",i.autoSeleccionado),l(),d("ngIf",i.mostrarListaAuto),l(4),Q("dragging",i.isDraggingFoto),l(10),d("disabled",i.isUploadingFoto),l(2),d("ngIf",i.fotoUrl((t=i.frm.get("Foto"))==null?null:t.value)),l(2),d("disabled",i.isUploadingFoto),l(2),d("ngClass",at(31,ni,i.pairingStatus==="LINKED",!i.pairingStatus||i.pairingStatus==="PENDING",i.pairingStatus==="EXPIRED"||i.pairingStatus==="REVOKED")),l(),y(" ",i.pairingStatus==="LINKED"?"VINCULADO":i.pairingStatus||"NO VINCULADO"," "),l(),d("disabled",i.isUploadingFoto||i.isEsperandoCapturaFoto),l(2),d("ngIf",i.isEsperandoCapturaFoto&&i.capturaToken),l(),d("ngIf",i.isUploadingFoto),l(3),w(M("form-control text-uppercase ",i.ValidacionxElemento("Ap_Paterno"))),l(7),w(M("form-control text-uppercase ",i.ValidacionxElemento("Ap_Materno"))),l(7),w(M("form-control text-uppercase ",i.ValidacionxElemento("Nombre"))),l(7),w(M("form-control text-uppercase ",i.ValidacionxElemento("Carnet"))),l(7),w(M("form-control text-uppercase ",i.ValidacionxElemento("Celular"))),l(28),d("disabled",i.isUploadingFoto)}}function Fi(s,e){if(s&1&&(r(0,"div",102),x(1,"img",103),n()),s&2){let t=p(2);l(),d("src",t.pairingQrDataUrl,N)}}function Ni(s,e){if(s&1&&(r(0,"div",100)(1,"a",104),o(2,"Abrir link en el celular"),n()()),s&2){let t=p(2);l(),d("href",t.pairingUrl,N)}}function Vi(s,e){if(s&1){let t=E();r(0,"div",35)(1,"h4",36),o(2,"Vincular celular"),n(),r(3,"button",97),_("click",function(){let a=g(t).$implicit;return h(a.dismiss())}),n()(),r(4,"div",38)(5,"div",98),o(6,"Escanea este QR una sola vez desde el celular."),n(),C(7,Fi,2,1,"div",99),r(8,"div",100)(9,"div",89),o(10,"Estado"),n(),r(11,"div",24),o(12),n()(),C(13,Ni,3,1,"div",101),n()}if(s&2){let t=p();l(7),d("ngIf",t.pairingQrDataUrl),l(5),T(t.pairingStatus||"..."),l(),d("ngIf",t.pairingUrl)}}var Y=class Y{constructor(e,t,i,a,c,u){this._svc=e;this._tools=t;this._capture=i;this._pairing=a;this._est=c;this.router=u;this.ruta=k.ruta;this.talleristas=[];this.isLoading=!0;this.filterTxt="";this.paginTalleristas=1;this.pageSizeTalleristas=10;this.pageSizeOptionsTalleristas=[5,10,20,50];this.autoInput=new S("");this.mostrarListaAuto=!1;this.autoResultados=[];this.isBuscandoAuto=!1;this.autoSeleccionado=null;this.autoPage=1;this.autoPageSize=10;this.pairingToken=null;this.pairingStatus=null;this.pairingUrl=null;this.pairingQrDataUrl=null;this.pairingIntervalId=null;this.capturaToken=null;this.capturaStatus=null;this.isEsperandoCapturaFoto=!1;this.capturaIntervalId=null;this.isDraggingFoto=!1;this.isUploadingFoto=!1;this.uploadProgressFoto=0;this.fotoAnteriorPath=null;this.fotoTempPath=null;this.tools=t,this.frm=this._svc.createFormGrouptalleristas(),this.frmAnterior=this._svc.createFormGrouptalleristas()}ngOnInit(){this.CargarTalleristas(),this.cargarVinculacionDesdeStorage(),this.setupBuscadorAuto()}onFilterTxtChange(){this.paginTalleristas=1}onPageChangeTalleristas(e){this.paginTalleristas=e}onPageSizeChangeTalleristas(){this.paginTalleristas=1}get collectionSizeTalleristas(){return this.talleristasFiltrados?.length??0}get talleristasPaginadosTabla(){let e=this.talleristasFiltrados||[],i=(Math.min(Math.max(1,this.paginTalleristas),Math.max(1,Math.ceil(e.length/this.pageSizeTalleristas)||1))-1)*this.pageSizeTalleristas;return e.slice(i,i+this.pageSizeTalleristas)}ngOnDestroy(){this.isEsperandoCapturaFoto&&this.cancelarEsperaCaptura(!0),this.detenerPollingCaptura(),this.detenerPollingVinculacion()}cargarVinculacionDesdeStorage(){let e=localStorage.getItem("lcch_capture_pairing_token");e&&(this.pairingToken=e,this.refrescarEstadoVinculacion(!1))}refrescarEstadoVinculacion(e){this.pairingToken&&this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:t=>{let i=t?.data?.status??this.pairingStatus;if(this.pairingStatus=i,i==="REVOKED"||i==="EXPIRED"){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null;return}e&&this._tools.MostrarMensaje("success","Vinculaci\xF3n actualizada")},error:t=>{t?.status===404&&(localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null)}})}abrirVinculacionCelular(){return q(this,null,function*(){if(this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere a que termine la subida actual");return}this._tools.MostrarMensajeLoading();let e=()=>new Promise((t,i)=>{let a=()=>{this._pairing.crearVinculacion().subscribe({next:c=>{let u=c?.data?.token;if(!u)return i(new Error("No token"));this.pairingToken=u,this.pairingStatus=c?.data?.status??null,localStorage.setItem("lcch_capture_pairing_token",u),t(u)},error:c=>i(c)})};if(this.pairingToken){this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:c=>{let u=c?.data?.status??null;if(this.pairingStatus=u,u==="EXPIRED"||u==="REVOKED"){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null,a();return}t(this.pairingToken)},error:c=>{if(c?.status===404){localStorage.removeItem("lcch_capture_pairing_token"),this.pairingToken=null,this.pairingStatus=null,a();return}i(c)}});return}a()});try{let t=yield e(),i=this.router.serializeUrl(this.router.createUrlTree(["/captura-celular",t])),a=window.location.hostname,u=(a==="localhost"||a==="127.0.0.1")&&k.frontendPublicBaseUrl?k.frontendPublicBaseUrl:document.baseURI;this.pairingUrl=new URL(i,u).toString();try{this.pairingQrDataUrl=yield ie.toDataURL(this.pairingUrl,{width:240,margin:1})}catch{this.pairingQrDataUrl=null}this.modalVincularCelularRef=this._tools.openModal(this.modalVincularCelular,"md"),this.modalVincularCelularRef.result.finally(()=>{this.detenerPollingVinculacion()}),this.iniciarPollingVinculacion(),this._tools.MostrarMensajeSuccess()}catch(t){console.log("ERROR creando vinculaci\xF3n",t),this._tools.MostrarMensajeError()}})}iniciarPollingVinculacion(){this.detenerPollingVinculacion(),this.pairingToken&&(this.pairingIntervalId=setInterval(()=>{this.pairingToken&&this._pairing.estadoVinculacion(this.pairingToken).subscribe({next:e=>{let t=e?.data?.status;this.pairingStatus=t??this.pairingStatus,t==="LINKED"&&this.detenerPollingVinculacion()},error:()=>{}})},2e3))}detenerPollingVinculacion(){this.pairingIntervalId&&(clearInterval(this.pairingIntervalId),this.pairingIntervalId=null)}iniciarCapturaFotoPorCelular(){return q(this,null,function*(){if(this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere a que termine la subida actual");return}if(!this.pairingToken||this.pairingStatus!=="LINKED"){this._tools.MostrarMensaje("info","Primero vincule el celular (QR)"),yield this.abrirVinculacionCelular();return}this._tools.MostrarMensajeLoading(),this._pairing.solicitarCaptura(this.pairingToken,null,"Foto").subscribe({next:e=>{let t=e?.data?.token;if(!t){this._tools.MostrarMensajeError();return}this.capturaToken=t,this.capturaStatus=e?.data?.status??"PENDING",this.isEsperandoCapturaFoto=!0,this.iniciarPollingCaptura(),this._tools.MostrarMensajeSuccess()},error:e=>{console.log("ERROR solicitando captura",e),this._tools.MostrarMensajeError()}})})}iniciarPollingCaptura(){this.detenerPollingCaptura(),this.capturaToken&&(this.capturaIntervalId=setInterval(()=>{this.capturaToken&&this._capture.estadoSesion(this.capturaToken).subscribe({next:e=>{let t=e?.data?.status,i=e?.data?.file_path;if(this.capturaStatus=t??this.capturaStatus,t==="UPLOADED"&&i){let a=this.fotoTempPath;this.frm.patchValue({Foto:i}),this.fotoTempPath=i,a&&a!==i&&a!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(a),this.isUploadingFoto=!1,this.uploadProgressFoto=0,this.isEsperandoCapturaFoto=!1,this.detenerPollingCaptura(),this._tools.MostrarMensaje("success","Foto recibida desde el celular")}},error:()=>{}})},2e3))}detenerPollingCaptura(){this.capturaIntervalId&&(clearInterval(this.capturaIntervalId),this.capturaIntervalId=null)}cancelarEsperaCaptura(e=!1){let t=this.capturaStatus;this.detenerPollingCaptura(),this.capturaStatus=null,this.capturaToken=null,this.isEsperandoCapturaFoto=!1,this.pairingToken&&t!=="UPLOADED"&&this._pairing.cancelarCaptura(this.pairingToken).subscribe({next:()=>{e||this._tools.MostrarMensaje("info","Espera cancelada")},error:()=>{}})}setupBuscadorAuto(){this.autoInput.valueChanges.subscribe(e=>{(e??"").toString()===""&&(this.autoResultados=[],this.mostrarListaAuto=!1,this.autoPage=1,this.autoSeleccionado=null)})}get autoTotalPages(){let e=this.autoResultados?.length??0,t=Math.ceil(e/this.autoPageSize);return Math.max(1,t||1)}get autoPaginados(){let e=this.autoResultados||[],i=(Math.min(Math.max(1,this.autoPage),this.autoTotalPages)-1)*this.autoPageSize;return e.slice(i,i+this.autoPageSize)}autoPrevPage(){this.autoPage=Math.max(1,this.autoPage-1)}autoNextPage(){this.autoPage=Math.min(this.autoTotalPages,this.autoPage+1)}limpiarAuto(){this.autoSeleccionado=null,this.autoInput.setValue("",{emitEvent:!0}),this.autoResultados=[],this.mostrarListaAuto=!1,this.autoPage=1}getNombreCompletoEstudiante(e){let t=(e?.Ap_Paterno??"").toString().trim(),i=(e?.Ap_Materno??"").toString().trim(),a=(e?.Nombre??"").toString().trim();return`${t} ${i} ${a}`.replace(/\s+/g," ").trim()}normalizarParaBusqueda(e){return(e??"").toString().toLowerCase().trim()}tokenizarPreservandoDuplicados(e){return e.split(/\s+/g).map(t=>t.trim()).filter(t=>t.length>0)}esTokenNumerico(e){return/^\d+$/.test(e)}contarOcurrencias(e,t){if(!t)return 0;let i=0,a=0;for(;;){let c=e.indexOf(t,a);if(c===-1)break;i+=1,a=c+t.length}return i}scoreEstudianteBusqueda(e,t){let i=(t??"").toString().trim().toLowerCase();if(!i)return 0;let a=this.normalizarParaBusqueda(this.getNombreCompletoEstudiante(e)),c=this.normalizarParaBusqueda(e?.CI),u=0;c&&i===c&&(u+=2e4),c&&i.length>=3&&c.startsWith(i)&&(u+=12e3),a&&i===a&&(u+=15e3),a&&a.startsWith(i)&&(u+=9e3);let m=this.tokenizarPreservandoDuplicados(i).map(f=>this.normalizarParaBusqueda(f));if(m.length===0)return u;for(let f of m)if(f)if(this.esTokenNumerico(f)){let P=this.contarOcurrencias(c,f);u+=P*1200}else{let P=this.contarOcurrencias(a,f);u+=P*700}let v=new Map;for(let f of m)v.set(f,(v.get(f)??0)+1);let b=!0;for(let[f,P]of v.entries())if(f){if(this.esTokenNumerico(f)){if(this.contarOcurrencias(c,f)<P){b=!1;break}}else if(this.contarOcurrencias(a,f)<P){b=!1;break}}return b&&(u+=5e3),u}filtrarEstudiantesPreciso(e,t){let i=(t??"").toString().trim();if(!i)return[];let a=this.tokenizarPreservandoDuplicados(i).map(u=>this.normalizarParaBusqueda(u));if(a.length===0)return[];let c=new Map;for(let u of a)c.set(u,(c.get(u)??0)+1);return(e||[]).filter(u=>{let m=this.normalizarParaBusqueda(this.getNombreCompletoEstudiante(u)),v=this.normalizarParaBusqueda(u?.CI);for(let[b,f]of c.entries())if(b){if(this.esTokenNumerico(b)){if(this.contarOcurrencias(v,b)<f)return!1}else if(this.contarOcurrencias(m,b)<f)return!1}return!0})}getBackendSearchTermEstudiantes(e){let t=(e??"").toString().trim();if(!t)return"";let i=this.tokenizarPreservandoDuplicados(t).map(u=>(u??"").toString().trim()).filter(Boolean),a=i.filter(u=>this.esTokenNumerico(u)).sort((u,m)=>m.length-u.length);if(a.length>0)return a[0];let c=i.filter(u=>!this.esTokenNumerico(u)).sort((u,m)=>m.length-u.length);return c.length>0?c[0]:t}getNombreCompletoTallerista(e){let t=(e?.Ap_Paterno??"").toString().trim(),i=(e?.Ap_Materno??"").toString().trim(),a=(e?.Nombre??"").toString().trim();return`${t} ${i} ${a}`.replace(/\s+/g," ").trim()}scoreTalleristaBusqueda(e,t){let i=(t??"").toString().trim().toLowerCase();if(!i)return 0;let a=this.normalizarParaBusqueda(this.getNombreCompletoTallerista(e)),c=this.normalizarParaBusqueda(e?.Carnet),u=this.normalizarParaBusqueda(e?.Celular),m=0;c&&i===c&&(m+=2e4),c&&i.length>=3&&c.startsWith(i)&&(m+=12e3),u&&i.length>=3&&u.includes(i)&&(m+=8e3),a&&i===a&&(m+=15e3),a&&a.startsWith(i)&&(m+=9e3);let v=this.tokenizarPreservandoDuplicados(i).map(b=>this.normalizarParaBusqueda(b));for(let b of v)b&&(this.esTokenNumerico(b)?(m+=this.contarOcurrencias(c,b)*1200,m+=this.contarOcurrencias(u,b)*700):m+=this.contarOcurrencias(a,b)*700);return m}filtrarTalleristasPreciso(e,t){let i=(t??"").toString().trim();if(!i)return[];let a=this.tokenizarPreservandoDuplicados(i).map(u=>this.normalizarParaBusqueda(u));if(a.length===0)return[];let c=new Map;for(let u of a)c.set(u,(c.get(u)??0)+1);return(e||[]).filter(u=>{let m=this.normalizarParaBusqueda(this.getNombreCompletoTallerista(u)),v=this.normalizarParaBusqueda(u?.Carnet),b=this.normalizarParaBusqueda(u?.Celular);for(let[f,P]of c.entries())if(f){if(this.esTokenNumerico(f)){let V=this.contarOcurrencias(v,f)>=P,A=this.contarOcurrencias(b,f)>=P;if(!V&&!A)return!1}else if(this.contarOcurrencias(m,f)<P)return!1}return!0})}buscarAutocompletar(){let e=(this.autoInput.value??"").toString().trim();if(!e){this.autoResultados=[],this.mostrarListaAuto=!1;return}this.autoPage=1,this.mostrarListaAuto=!0,this.isBuscandoAuto=!0;let t=this.talleristas||[],a=(this.filtrarTalleristasPreciso(t,e)||[]).slice().sort((m,v)=>{let b=this.scoreTalleristaBusqueda(v,e),f=this.scoreTalleristaBusqueda(m,e);return b!==f?b-f:Number(v?.id??0)-Number(m?.id??0)}),u={page:1,per_page:200,search:this.getBackendSearchTermEstudiantes(e)||e,search_mode:"any",relevance:1,sort_by:"id",sort_dir:"desc"};this._est.Obtenerestudiantesifas(u).pipe(Ot(m=>(console.error("Error al buscar estudiantes IFAS",m),Rt({data:[]})))).subscribe({next:m=>{let v=m?.data||[],f=(this.filtrarEstudiantesPreciso(v,e)||[]).slice().sort((P,V)=>{let A=this.scoreEstudianteBusqueda(V,e),nt=this.scoreEstudianteBusqueda(P,e);return A!==nt?A-nt:Number(V?.id??0)-Number(P?.id??0)});this.autoResultados=[...(a||[]).map(P=>({fuente:"TALLERISTA",row:P})),...(f||[]).map(P=>({fuente:"IFAS",row:P}))],this.mostrarListaAuto=!0,this.isBuscandoAuto=!1},error:()=>{this.autoResultados=(a||[]).map(m=>({fuente:"TALLERISTA",row:m})),this.mostrarListaAuto=!0,this.isBuscandoAuto=!1}})}seleccionarAuto(e){if(e?.row){if(this.autoSeleccionado=e,this.limpiarFotoTemporalSiCorresponde(),this.cancelarEsperaCaptura(!0),e.fuente==="TALLERISTA"){let t=e.row;this.frm.reset(this._svc.createFormGrouptalleristas().value),this.frm.patchValue({id:t?.id??0,Foto:t?.Foto??"",Ap_Paterno:t?.Ap_Paterno??"",Ap_Materno:t?.Ap_Materno??"",Nombre:t?.Nombre??"",Carnet:t?.Carnet??"",Celular:t?.Celular??"",Nombre_Padre:t?.Nombre_Padre??"",Celular_Padre:t?.Celular_Padre??"",Nombre_Madre:t?.Nombre_Madre??"",Celular_Madre:t?.Celular_Madre??""}),this.frmAnterior.reset(this.frm.value),this.fotoAnteriorPath=(t?.Foto??"").toString()||null,this.fotoTempPath=null,this._tools.MostrarMensaje("info","Autocompletado desde TALLERISTAS (modo edici\xF3n)")}else{let t=e.row;this.frm.patchValue({Ap_Paterno:(t?.Ap_Paterno??"").toString(),Ap_Materno:(t?.Ap_Materno??"").toString(),Nombre:(t?.Nombre??"").toString(),Carnet:(t?.CI??"").toString(),Celular:(t?.Celular??"").toString(),Nombre_Padre:(t?.Nombre_Padre??"").toString(),Celular_Padre:(t?.NumCelP??"").toString(),Nombre_Madre:(t?.Nombre_Madre??"").toString(),Celular_Madre:(t?.NumCelM??"").toString()});let i=(this.frm.get("Foto")?.value??"").toString().trim(),a=(t?.Foto??"").toString().trim();!this.fotoTempPath&&!i&&a&&this.frm.patchValue({Foto:a}),this._tools.MostrarMensaje("info","Autocompletado desde ESTUDIANTES IFAS")}this.autoInput.setValue(e.fuente==="TALLERISTA"?this.getNombreCompletoTallerista(e.row):this.getNombreCompletoEstudiante(e.row),{emitEvent:!1}),this.mostrarListaAuto=!1,this.autoResultados=[],this.autoPage=1}}get talleristasFiltrados(){let e=(this.filterTxt??"").toString().trim().toLowerCase();return e?this.talleristas.filter(t=>{let i=(t?.Ap_Paterno??"").toString().toLowerCase(),a=(t?.Ap_Materno??"").toString().toLowerCase(),c=(t?.Nombre??"").toString().toLowerCase(),u=(t?.Carnet??"").toString().toLowerCase(),m=(t?.Celular??"").toString().toLowerCase();return`${i} ${a} ${c} ${u} ${m}`.includes(e)}):this.talleristas}fotoUrl(e){let t=(e??"").toString().trim();return t?t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?`${this.ruta}${t}`:`${this.ruta}/${t}`:null}ValidacionxElemento(e){return this._tools.obtenerValidationClass(this.frm,e)}ValidacionTodoElemento(){Object.values(this.frm.controls).forEach(e=>{e.markAsTouched(),e.markAsDirty()})}CargarTalleristas(){this.isLoading=!0,this._svc.Obtenertalleristas().subscribe({next:e=>{this.talleristas=Array.isArray(e?.data)?e.data:[],this.paginTalleristas=1,this.isLoading=!1},error:()=>{this.talleristas=[],this.paginTalleristas=1,this.isLoading=!1,this._tools.MostrarMensajeError()}})}AbrirModalNuevo(){this.frm.reset(this._svc.createFormGrouptalleristas().value),this.frmAnterior.reset(this._svc.createFormGrouptalleristas().value),this.fotoAnteriorPath=null,this.fotoTempPath=null,this.limpiarAuto(),this.cancelarEsperaCaptura(!0),this.modalGestionRef=this._tools.openModal(this.modalgestiontalleristas,"lg")}AbrirModalEditar(e){let t=D({},e);this.frm.reset(this._svc.createFormGrouptalleristas().value),this.frm.patchValue(t),this.frmAnterior.reset(this.frm.value),this.fotoAnteriorPath=(e?.Foto??"").toString()||null,this.fotoTempPath=null,this.autoSeleccionado={fuente:"TALLERISTA",row:e},this.autoInput.setValue(this.getNombreCompletoTallerista(e),{emitEvent:!1}),this.mostrarListaAuto=!1,this.autoResultados=[],this.autoPage=1,this.cancelarEsperaCaptura(!0),this.modalGestionRef=this._tools.openModal(this.modalgestiontalleristas,"lg")}CerrarModal(){this.cancelarEsperaCaptura(!0),this.limpiarFotoTemporalSiCorresponde(),this.modalGestionRef?.close()}Guardar(){if(this.isUploadingFoto){this._tools.MostrarMensaje("warning","Espere que termine de subirse la foto");return}if(this.ValidacionTodoElemento(),this.frm.invalid){this._tools.MostrarMensaje("warning","Complete los campos requeridos");return}let e=Number(this.frm.get("id")?.value??0),t=D({},this.frm.value);this._tools.MostrarMensajeLoading(),(e>0?this._svc.Modificartalleristas(t,e):this._svc.Agregartalleristas(t)).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.CerrarModal(),this.CargarTalleristas()},error:()=>{this._tools.MostrarMensajeError()}})}Eliminar(e){let t=Number(e?.id??0);t&&confirm("\xBFEliminar el tallerista seleccionado?")&&(this._tools.MostrarMensajeLoading(),this._svc.Eliminartalleristas(t).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.CargarTalleristas()},error:()=>this._tools.MostrarMensajeError()}))}abrirSelectorFoto(e){e.click()}onFotoDragOver(e){e.preventDefault(),this.isDraggingFoto=!0}onFotoDragLeave(e){e.preventDefault(),this.isDraggingFoto=!1}onFotoDrop(e){e.preventDefault(),this.isDraggingFoto=!1;let t=e.dataTransfer?.files;t&&this.handleFotoFiles(t)}onFotoFileSelected(e){let t=e.target,i=t.files;i&&this.handleFotoFiles(i),t.value=""}handleFotoFiles(e){let t=e.item(0);t&&(e.length>1&&this._tools.MostrarMensaje("warning","Solo se permite 1 archivo"),this.subirFoto(t))}subirFoto(e){this.isUploadingFoto=!0,this.uploadProgressFoto=0,this._tools.SubirArchivo(e,"Foto").subscribe({next:t=>{if(t.type===B.UploadProgress&&t.total){this.uploadProgressFoto=Math.round(t.loaded/t.total*100);return}if(t.type===B.Response){let a=t.body?.filePath;if(a){let c=this.fotoTempPath;this.frm.patchValue({Foto:a}),this.fotoTempPath=a,c&&c!==a&&c!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(c)}this.isUploadingFoto=!1}},error:t=>{console.error("Error subiendo foto",t),this.isUploadingFoto=!1,this.uploadProgressFoto=0,this._tools.MostrarMensajeError()}})}limpiarFotoTemporalSiCorresponde(){this.fotoTempPath&&this.fotoTempPath!==this.fotoAnteriorPath&&this._tools.EliminarArchivo(this.fotoTempPath),this.fotoTempPath=null,this.fotoAnteriorPath=null,this.isDraggingFoto=!1,this.isUploadingFoto=!1,this.uploadProgressFoto=0}};Y.\u0275fac=function(t){return new(t||Y)(I(K),I(Mt),I(Ft),I(Nt),I(kt),I(ht))},Y.\u0275cmp=ct({type:Y,selectors:[["app-talleristas"]],viewQuery:function(t,i){if(t&1&&(L(ai,7),L(ri,7)),t&2){let a;z(a=R())&&(i.modalgestiontalleristas=a.first),z(a=R())&&(i.modalVincularCelular=a.first)}},standalone:!1,decls:18,vars:4,consts:[["modalgestiontalleristas",""],["modalVincularCelular",""],["fileFoto",""],[1,"container-fluid"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],[1,"btn","mouse-dir","primary",3,"click"],[1,"row","g-2","mb-3"],[1,"col-12","col-md-6"],["placeholder","Buscar por apellidos, nombres, carnet o celular",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-6","text-end"],[1,"btn","btn-outline-secondary",3,"click","disabled"],["class","text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-muted"],[1,"table-responsive"],[1,"table","table-sm","table-hover","align-middle"],[1,"text-end"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex align-items-center justify-content-between",4,"ngIf"],[2,"width","64px"],["class","rounded","style","width: 48px; height: 48px; object-fit: cover;",3,"src",4,"ngIf"],["class","foto-empty",4,"ngIf"],[1,"fw-semibold"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"rounded",2,"width","48px","height","48px","object-fit","cover",3,"src"],[1,"foto-empty"],["colspan","7",1,"text-muted"],[1,"d-flex","align-items-center","justify-content-between"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-3",3,"formGroup"],[1,"col-12"],[1,"form-label"],[1,"input-group"],["placeholder","Buscar por CI o apellidos/nombres",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","small text-muted mt-1",4,"ngIf"],["class","border rounded p-2 mt-2",4,"ngIf"],[1,"dropzone",3,"dragover","dragleave","drop"],[1,"d-flex","align-items-center","justify-content-between",2,"gap","12px"],[1,"text-muted","small"],[1,"d-flex","align-items-center",2,"gap","10px"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"d-flex","flex-wrap","align-items-center","mt-2",2,"gap","8px"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"badge","align-self-center",3,"ngClass"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],["class","alert alert-info py-2 mt-2 d-flex justify-content-between align-items-center",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"col-12","col-md-4"],[1,"form-floating"],["type","text","formControlName","Ap_Paterno","placeholder","Apellido paterno"],[1,"invalid-feedback"],["type","text","formControlName","Ap_Materno","placeholder","Apellido materno"],["type","text","formControlName","Nombre","placeholder","Nombres"],["type","text","formControlName","Carnet","placeholder","Carnet"],["type","text","formControlName","Celular","placeholder","Celular"],["type","text","formControlName","Nombre_Padre","placeholder","Nombre del padre",1,"form-control","text-uppercase"],["type","text","formControlName","Celular_Padre","placeholder","Celular del padre",1,"form-control","text-uppercase"],["type","text","formControlName","Nombre_Madre","placeholder","Nombre de la madre",1,"form-control","text-uppercase"],["type","text","formControlName","Celular_Madre","placeholder","Celular de la madre",1,"form-control","text-uppercase"],[1,"modal-footer"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","mouse-dir","primary",3,"click","disabled"],[1,"small","text-muted","mt-1"],["class","ms-2",4,"ngIf"],[1,"ms-2"],[1,"border","rounded","p-2","mt-2"],["class","text-muted small",4,"ngIf"],["class","table-responsive mt-2",4,"ngIf"],[1,"table-responsive","mt-2"],[1,"table","table-sm","table-hover","align-middle","mb-2"],[2,"width","120px"],[2,"width","140px"],[1,"text-end",2,"width","110px"],[1,"badge",3,"ngClass"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["colspan","4",1,"text-muted"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"small","text-muted"],[1,"alert","alert-info","py-2","mt-2","d-flex","justify-content-between","align-items-center"],[1,"small"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"mt-2"],[1,"progress",2,"height","8px"],["role","progressbar",1,"progress-bar"],[1,"text-muted","small","mt-1"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"mb-2","text-muted"],["class","d-flex justify-content-center",4,"ngIf"],[1,"mt-3"],["class","mt-3",4,"ngIf"],[1,"d-flex","justify-content-center"],["alt","QR",2,"max-width","260px","width","100%",3,"src"],["target","_blank","rel","noopener",3,"href"]],template:function(t,i){if(t&1){let a=E();r(0,"div",3)(1,"div",4)(2,"h4",5),o(3,"Talleristas"),n(),r(4,"button",6),_("click",function(){return g(a),h(i.AbrirModalNuevo())}),o(5,"Nuevo"),n()(),r(6,"div",7)(7,"div",8)(8,"input",9),it("ngModelChange",function(u){return g(a),et(i.filterTxt,u)||(i.filterTxt=u),h(u)}),_("ngModelChange",function(){return g(a),h(i.onFilterTxtChange())}),n()(),r(9,"div",10)(10,"button",11),_("click",function(){return g(a),h(i.CargarTalleristas())}),o(11,"Refrescar"),n()()(),C(12,oi,2,0,"div",12)(13,mi,22,3,"div",13),n(),C(14,ki,102,35,"ng-template",null,0,O)(16,Vi,14,3,"ng-template",null,1,O)}t&2&&(l(8),tt("ngModel",i.filterTxt),l(2),d("disabled",i.isLoading),l(2),d("ngIf",i.isLoading),l(),d("ngIf",!i.isLoading))},dependencies:[dt,pt,mt,Ct,yt,It,_t,Et,ft,vt,xt,St,Tt,Pt,wt],styles:[".dropzone[_ngcontent-%COMP%]{border:1px dashed #c9ced6;border-radius:10px;padding:12px;background:#fafbfc}.dropzone.dragging[_ngcontent-%COMP%]{border-color:#6c63ff;background:#f2f1ff}.foto-empty[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:6px;background:#e9ecef}"]});var Bt=Y;var Ai=[{path:"talleristas",component:Bt},{path:"pagostalleres",component:At}],G=class G{};G.\u0275fac=function(t){return new(t||G)},G.\u0275mod=ut({type:G}),G.\u0275inj=st({imports:[qt.forChild(Ai),qt]});var Dt=G;var $=class ${};$.\u0275fac=function(t){return new(t||$)},$.\u0275mod=ut({type:$}),$.\u0275inj=st({imports:[Ut,Xt,Ht,Qt,Dt]});var ae=$;export{ae as SubsistemaseparadoModule};
