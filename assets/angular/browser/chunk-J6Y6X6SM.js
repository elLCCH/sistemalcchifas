import{a as ve,b as be}from"./chunk-2BXAM6ZK.js";import{a as he}from"./chunk-QLP4KPPV.js";import{a as Se}from"./chunk-BEB7REIC.js";import{b as ge}from"./chunk-VUPGJX5W.js";import{b as fe}from"./chunk-6PECI7IV.js";import{a as xe}from"./chunk-MOE5DPUY.js";import"./chunk-A4J24TIR.js";import{a as T}from"./chunk-KFXCIGMC.js";import{e as _e}from"./chunk-JJJK5VRP.js";import{c as re,f as oe,h as se,i as h,l as le,m as ce,p as de,q as me,r as pe,w as ue}from"./chunk-EANZ5AHF.js";import{$a as G,Da as c,Ea as a,Fa as i,Ga as v,J as Y,K as I,Ka as w,La as F,M as z,Na as b,P as p,Pb as te,Q as u,Qa as _,Qb as ie,Sa as d,Wa as J,Xa as Z,Ya as W,Zb as ne,ab as X,bb as ee,bc as D,ca as k,dc as j,ea as s,eb as r,fb as f,fc as ae,gb as x,ib as A,jb as L,la as S,na as q,oa as M,sa as g,uc as $,va as K,zb as O}from"./chunk-N4IAAO5D.js";import{a as U,g as Q}from"./chunk-ATDPNAVO.js";var C=class C{constructor(t){this.http=t;this.ruta=T.ruta}ObtenerPagoslcch(t){let e=new D;return t?.infoestudiantesifas_id&&(e=e.set("infoestudiantesifas_id",String(t.infoestudiantesifas_id))),t?.gestion&&(e=e.set("gestion",String(t.gestion))),t?.mes&&(e=e.set("mes",String(t.mes))),this.http.get(this.ruta+"api/pagoslcch",{params:e})}ObtenerPagoslcchPorInfo(t){return this.http.get(this.ruta+"api/pagoslcch/by-info/"+t)}ObtenerDeudaPorInfo(t,e){let n=new D;return e&&(n=n.set("gestion",String(e))),this.http.get(this.ruta+"api/pagoslcch/deuda/by-info/"+t,{params:n})}ObtenerGestionesAsignaciones(){return this.http.get(this.ruta+"api/pagoslcch/gestiones-asignaciones")}ObtenerDeudores(t){let e=new D;return e=e.set("gestion",String(t.gestion??"")),t.gestion_pago&&(e=e.set("gestion_pago",String(t.gestion_pago))),t.search&&(e=e.set("search",String(t.search))),t.page&&(e=e.set("page",String(t.page))),t.per_page&&(e=e.set("per_page",String(t.per_page))),this.http.get(this.ruta+"api/pagoslcch/deudores",{params:e})}AgregarPagoslcch(t){return this.http.post(this.ruta+"api/pagoslcch",t)}ModificarPagoslcch(t,e){return this.http.put(this.ruta+"api/pagoslcch/"+e,t)}SeleccionarPagoslcch(t){return this.http.get(this.ruta+"api/pagoslcch/"+t)}EliminarPagoslcch(t){return this.http.delete(this.ruta+"api/pagoslcch/"+t)}createFormGroupPagoslcch(){return new se({id:new h(0),infoestudiantesifas_id:new h(null),nrodocumento:new h(""),mes:new h(1),gestion:new h(String(new Date().getFullYear())),monto:new h(""),acuenta:new h(""),saldo:new h(""),dolarboliviano:new h(""),mediopago:new h(""),fechapago:new h(""),horapago:new h(""),estadopago:new h("PAGADO"),observacion:new h(""),file:new h("")})}};C.\u0275fac=function(e){return new(e||C)(z(ae))},C.\u0275prov=Y({token:C,factory:C.\u0275fac,providedIn:"root"});var R=C;var Pe=["modalPago"];function ye(o,t){if(o&1&&(a(0,"option",40),r(1),i()),o&2){let e=t.$implicit;c("value",e),s(),f(e)}}function Ie(o,t){if(o&1){let e=b();a(0,"div",41)(1,"button",42),_("click",function(){p(e);let l=d(2);return u(l.deudoresPrev())}),r(2,"Anterior"),i(),a(3,"small",43),r(4),i(),a(5,"button",42),_("click",function(){p(e);let l=d(2);return u(l.deudoresNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d(2);s(),c("disabled",!e.deudoresTienePrev()||e.isLoadingDeudores),s(3),A(" P\xE1gina ",e.deudoresMeta.current_page," / ",e.deudoresMeta.last_page," (",e.deudoresMeta.total," resultados) "),s(),c("disabled",!e.deudoresTieneNext()||e.isLoadingDeudores)}}function Me(o,t){o&1&&(a(0,"th"),r(1,"Instituci\xF3n"),i())}function we(o,t){if(o&1&&(a(0,"td"),r(1),i()),o&2){let e=d().$implicit;s(),f(e.NombreInstitucion||"-")}}function Fe(o,t){if(o&1){let e=b();a(0,"tr")(1,"td"),r(2),i(),a(3,"td"),r(4),i(),a(5,"td"),r(6),i(),a(7,"td"),r(8),i(),g(9,we,2,1,"td",37),a(10,"td"),r(11),i(),a(12,"td"),r(13),i(),a(14,"td")(15,"button",44),_("click",function(){let l=p(e).$implicit,m=d(2);return u(m.seleccionarInscripcion(l))}),r(16," Cobrar "),i()()()}if(o&2){let e=t.$implicit,n=d(2);s(2),x("#",e.id),s(2),A("",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre),s(2),f(e.CI||"-"),s(2),f(e.Matricula||"-"),s(),c("ngIf",n.esSuperAdmin),s(2),f(e.Anio||"SIN ASIGNAR"),s(2),f(n.mesLabels(e.meses_deuda))}}function Ae(o,t){if(o&1&&(a(0,"tr")(1,"td",45),r(2,"Sin registros"),i()()),o&2){let e=d(2);s(),K("colspan",e.esSuperAdmin?8:7)}}function Oe(o,t){if(o&1){let e=b();a(0,"div",8)(1,"div",28)(2,"span",29),r(3,"Estudiantes con deuda (paginado)"),i(),a(4,"div",30)(5,"label",31),r(6,"Gesti\xF3n"),i(),a(7,"select",32),_("change",function(){p(e);let l=d();return u(l.cargarDeudores(1))}),g(8,ye,2,2,"option",33),i()()(),a(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"span",13),v(14,"i",14),i(),a(15,"div",15)(16,"input",34),_("input",function(l){p(e);let m=d();return u(m.filterDeudores=l.target.value)})("keyup.enter",function(){p(e);let l=d();return u(l.cargarDeudores(1))}),i(),a(17,"label"),r(18,"Buscar (nombre/CI/matr\xEDcula)"),i()(),a(19,"button",17),_("click",function(){p(e);let l=d();return u(l.cargarDeudores(1))}),r(20," Buscar "),i()(),g(21,Ie,7,5,"div",18),i(),a(22,"div",24)(23,"label",25),r(24,"Total deudores"),i(),v(25,"input",26),i()()(),a(26,"div",35)(27,"table",36)(28,"thead")(29,"tr")(30,"th"),r(31,"Inscripci\xF3n"),i(),a(32,"th"),r(33,"Estudiante"),i(),a(34,"th"),r(35,"CI"),i(),a(36,"th"),r(37,"Matr\xEDcula"),i(),g(38,Me,2,0,"th",37),a(39,"th"),r(40,"Gesti\xF3n (asignaci\xF3n)"),i(),a(41,"th"),r(42,"Meses adeudados"),i(),a(43,"th",38),r(44,"Acciones"),i()()(),a(45,"tbody"),g(46,Fe,17,9,"tr",39)(47,Ae,3,1,"tr",37),i()()()()}if(o&2){let e=d();s(7),c("formControl",e.gestionDeudores),s(),c("ngForOf",e.gestionesAsignaciones),s(8),c("value",e.filterDeudores),s(3),c("disabled",e.isLoadingDeudores),s(2),c("ngIf",e.deudoresMeta),s(4),c("value",(e.deudoresMeta==null?null:e.deudoresMeta.total)||0),s(13),c("ngIf",e.esSuperAdmin),s(8),c("ngForOf",e.deudores),s(),c("ngIf",e.deudores.length===0)}}function De(o,t){if(o&1){let e=b();a(0,"div",41)(1,"button",42),_("click",function(){p(e);let l=d();return u(l.resPrev())}),r(2,"Anterior"),i(),a(3,"small",43),r(4),i(),a(5,"button",42),_("click",function(){p(e);let l=d();return u(l.resNext())}),r(6,"Siguiente"),i()()}if(o&2){let e=d();s(),c("disabled",!e.resTienePrev()||e.isLoadingResultados),s(3),A(" P\xE1gina ",e.resMeta.current_page," / ",e.resMeta.last_page," (",e.resMeta.total," resultados) "),s(),c("disabled",!e.resTieneNext()||e.isLoadingResultados)}}function Te(o,t){if(o&1){let e=b();a(0,"button",42),_("click",function(){let l=p(e).$implicit,m=d();return u(m.seleccionarInscripcion(l))}),r(1),a(2,"span",43),r(3),i()()}if(o&2){let e=t.$implicit,n=d();ee("active",n.infoCtrl.value===e.id),c("disabled",n.isLoadingResultados),s(),L(" ",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre,"",n.esSuperAdmin?" | "+e.NombreInstitucion:""," | ",e.Anio," "),s(2),x("(#",e.id,")")}}function Re(o,t){o&1&&(a(0,"small",43),r(1,"Busca y selecciona una inscripci\xF3n para registrar pagos."),i())}function Ne(o,t){if(o&1&&(a(0,"span",43),r(1),i()),o&2){let e=d(2);s(),L(" (",e.infoSeleccionada.Ap_Paterno," ",e.infoSeleccionada.Ap_Materno," ",e.infoSeleccionada.Nombre,"",e.esSuperAdmin?" | "+e.infoSeleccionada.NombreInstitucion:""," | ",e.infoSeleccionada.Anio,") ")}}function Ve(o,t){if(o&1){let e=b();a(0,"div",46)(1,"small",47),r(2," Inscripci\xF3n seleccionada: "),a(3,"b"),r(4),i(),g(5,Ne,2,5,"span",22),i(),a(6,"button",48),_("click",function(){p(e);let l=d();return u(l.limpiarSeleccion())}),r(7,"Quitar selecci\xF3n"),i()()}if(o&2){let e=d();s(4),x("#",e.infoCtrl.value),s(),c("ngIf",e.infoSeleccionada)}}function ke(o,t){if(o&1&&(a(0,"span",54),r(1),i()),o&2){let e=t.$implicit,n=d(3);s(),f(n.mesLabel(e))}}function Ge(o,t){if(o&1&&(w(0),g(1,ke,2,1,"span",53),F()),o&2){let e=d(2);s(),c("ngForOf",e.mesesPagadosGestion)}}function Le(o,t){o&1&&(a(0,"span",43),r(1,"-"),i())}function je(o,t){o&1&&(a(0,"span",43),r(1,"Calculando..."),i())}function $e(o,t){if(o&1&&(a(0,"span",56),r(1),i()),o&2){let e=t.$implicit,n=d(4);s(),f(n.mesLabel(e))}}function Be(o,t){if(o&1&&(w(0),g(1,$e,2,1,"span",55),F()),o&2){let e=d(3);s(),c("ngForOf",e.deudaMeses)}}function He(o,t){o&1&&(a(0,"span",43),r(1,"Sin deuda detectada"),i())}function Ue(o,t){if(o&1&&(w(0),g(1,Be,2,1,"ng-container",52)(2,He,2,0,"ng-template",null,2,O),F()),o&2){let e=G(3),n=d(2);s(),c("ngIf",n.deudaMeses.length>0)("ngIfElse",e)}}function Qe(o,t){if(o&1&&(a(0,"small",43),r(1),i()),o&2){let e=d(2);s(),x(" Referencia: un compa\xF1ero lleg\xF3 hasta ",e.mesLabel(e.deudaMaxMesCompaneros),". ")}}function Ye(o,t){if(o&1){let e=b();a(0,"div",8)(1,"div",28)(2,"span"),r(3,"Registro de pagos"),i(),a(4,"button",49),_("click",function(){p(e);let l=d();return u(l.abrirModalNuevoPago())}),r(5,"Registrar pago"),i()(),a(6,"div",9)(7,"div",46)(8,"small",43),r(9,"Gesti\xF3n:"),i(),a(10,"span",50),r(11),i(),a(12,"small",51),r(13,"Meses pagados (PAGADO):"),i(),g(14,Ge,2,1,"ng-container",52)(15,Le,2,0,"ng-template",null,1,O),a(17,"small",51),r(18,"Meses adeudados (seg\xFAn compa\xF1eros):"),i(),g(19,je,2,0,"span",22)(20,Ue,4,2,"ng-container",37),i(),g(21,Qe,2,1,"small",22),i()()}if(o&2){let e,n=G(16),l=d();s(11),f(((e=l.frmPago.get("gestion"))==null?null:e.value)||"-"),s(3),c("ngIf",l.mesesPagadosGestion.length>0)("ngIfElse",n),s(5),c("ngIf",l.isLoadingDeuda),s(),c("ngIf",!l.isLoadingDeuda),s(),c("ngIf",l.deudaMaxMesCompaneros)}}function ze(o,t){if(o&1&&(a(0,"option",40),r(1),i()),o&2){let e=t.$implicit;c("value",e.value),s(),f(e.label)}}function qe(o,t){if(o&1&&(a(0,"option",80),r(1),i()),o&2){let e=t.$implicit;c("value",e.value)("disabled",e.disabled),s(),f(e.label)}}function Ke(o,t){if(o&1&&(a(0,"div",81)(1,"a",82),r(2,"Ver comprobante"),i()()),o&2){let e,n=d(2);s(),c("href",n.ruta+((e=n.frmPago.get("file"))==null?null:e.value),k)}}function Je(o,t){if(o&1&&(a(0,"div",81)(1,"div",83)(2,"div",84),r(3),i()()()),o&2){let e=d(2);s(2),X("width",e.uploadProgress,"%"),s(),x("",e.uploadProgress,"%")}}function Ze(o,t){if(o&1){let e=b();a(0,"div",57)(1,"h5",58),r(2),i(),a(3,"button",59),_("click",function(){let l=p(e).$implicit;return u(l.dismiss("close"))}),i()(),a(4,"div",60)(5,"div",61)(6,"small",43),r(7,"Inscripci\xF3n:"),i(),a(8,"span",62),r(9),i()(),a(10,"div",63)(11,"div",64)(12,"label",25),r(13,"Nro. documento"),i(),v(14,"input",65),i(),a(15,"div",64)(16,"label",25),r(17,"Mes"),i(),a(18,"select",66),g(19,ze,2,2,"option",33),i()(),a(20,"div",64)(21,"label",25),r(22,"Gesti\xF3n"),i(),v(23,"input",67),i(),a(24,"div",64)(25,"label",25),r(26,"Monto"),i(),v(27,"input",65),i(),a(28,"div",64)(29,"label",25),r(30,"A cuenta"),i(),v(31,"input",65),i(),a(32,"div",64)(33,"label",25),r(34,"Saldo"),i(),v(35,"input",65),i(),a(36,"div",64)(37,"label",25),r(38,"$ / Bs"),i(),v(39,"input",68),i(),a(40,"div",64)(41,"label",25),r(42,"Medio de pago"),i(),v(43,"input",69),i(),a(44,"div",64)(45,"label",25),r(46,"Estado pago"),i(),a(47,"select",66),g(48,qe,2,3,"option",70),i()(),a(49,"div",64)(50,"label",25),r(51,"Fecha de pago"),i(),v(52,"input",71),i(),a(53,"div",64)(54,"label",25),r(55,"Hora"),i(),v(56,"input",72),i(),a(57,"div",64)(58,"label",25),r(59,"Comprobante"),i(),a(60,"input",73),_("change",function(l){p(e);let m=d();return u(m.onFileSelected(l))}),i(),g(61,Ke,3,1,"div",74)(62,Je,4,3,"div",74),i(),a(63,"div",75)(64,"label",25),r(65,"Observaci\xF3n"),i(),v(66,"quill-editor",76),i()()(),a(67,"div",77)(68,"button",78),_("click",function(){p(e);let l=d();return u(l.guardar())}),r(69,"Guardar"),i(),a(70,"button",79),_("click",function(){let l=p(e).$implicit;return u(l.dismiss("cancel"))}),r(71,"Cancelar"),i()()}if(o&2){let e,n=d();s(2),f(n.editId?"Editar pago":"Registrar pago"),s(7),x("#",n.infoCtrl.value),s(5),c("formControl",n.frmPago.get("nrodocumento")),s(4),c("formControl",n.frmPago.get("mes")),s(),c("ngForOf",n.meses),s(4),c("formControl",n.frmPago.get("gestion")),s(4),c("formControl",n.frmPago.get("monto")),s(4),c("formControl",n.frmPago.get("acuenta")),s(4),c("formControl",n.frmPago.get("saldo")),s(4),c("formControl",n.frmPago.get("dolarboliviano")),s(4),c("formControl",n.frmPago.get("mediopago")),s(4),c("formControl",n.frmPago.get("estadopago")),s(),c("ngForOf",n.estadoPagoOptions),s(4),c("formControl",n.frmPago.get("fechapago")),s(4),c("formControl",n.frmPago.get("horapago")),s(5),c("ngIf",(e=n.frmPago.get("file"))==null?null:e.value),s(),c("ngIf",n.uploadProgress!==null),s(4),c("formControl",n.frmPago.get("observacion"))("modules",n.modulesQuillEdicion),s(2),c("disabled",n.uploading)}}function We(o,t){if(o&1&&(a(0,"a",82),r(1,"Ver"),i()),o&2){let e=d().$implicit,n=d(2);c("href",n.ruta+e.file,k)}}function Xe(o,t){o&1&&(a(0,"span"),r(1,"-"),i())}function et(o,t){if(o&1){let e=b();a(0,"tr")(1,"td"),r(2),i(),a(3,"td"),r(4),i(),a(5,"td"),r(6),i(),a(7,"td"),r(8),i(),a(9,"td"),r(10),i(),a(11,"td"),r(12),i(),a(13,"td"),g(14,We,2,1,"a",87)(15,Xe,2,0,"span",37),i(),a(16,"td")(17,"div",88)(18,"button",89),_("click",function(){let l=p(e).$implicit,m=d(2);return u(m.iniciarEditar(l))}),r(19,"Editar"),i(),a(20,"button",90),_("click",function(){let l=p(e).$implicit,m=d(2);return u(m.eliminar(l))}),r(21,"Eliminar"),i()()()()}if(o&2){let e=t.$implicit,n=d(2);s(2),f(e.gestion),s(2),f(n.mesLabel(e.mes)),s(2),f(e.monto),s(2),f(e.fechapago),s(2),f(e.horapago),s(2),f(e.estadopago),s(2),c("ngIf",e.file),s(),c("ngIf",!e.file)}}function tt(o,t){o&1&&(a(0,"tr")(1,"td",91),r(2,"Sin registros"),i()())}function it(o,t){if(o&1&&(a(0,"div",85)(1,"div",86),r(2,"Pagos registrados"),i(),a(3,"div",35)(4,"table",36)(5,"thead")(6,"tr")(7,"th"),r(8,"Gesti\xF3n"),i(),a(9,"th"),r(10,"Mes"),i(),a(11,"th"),r(12,"Monto"),i(),a(13,"th"),r(14,"Fecha"),i(),a(15,"th"),r(16,"Hora"),i(),a(17,"th"),r(18,"Estado"),i(),a(19,"th"),r(20,"Comprobante"),i(),a(21,"th",38),r(22,"Acciones"),i()()(),a(23,"tbody"),g(24,et,22,8,"tr",39)(25,tt,3,0,"tr",37),i()()()()),o&2){let e=d();s(24),c("ngForOf",e.pagos),s(),c("ngIf",e.pagos.length===0)}}var y=class y{constructor(t,e,n,l,m,H){this._info=t;this._pagos=e;this._tools=n;this._controles=l;this._auth=m;this._modal=H;this.ruta=T.ruta;this.modulesQuillEdicion={toolbar:[["bold","italic","underline","strike"],[{align:[]}],[{size:["small",!1,"large"]}],[{color:[]},{background:[]}],[{font:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","video"],["clean"]]};this.modulesQuillShow={toolbar:!1};this.infoCtrl=new h(null);this.filterInscripcion="";this.resultados=[];this.resMeta=null;this.resPage=1;this.resPerPage=10;this.isLoadingResultados=!1;this.infoSeleccionada=null;this.pagos=[];this.frmPago=this._pagos.createFormGroupPagoslcch();this.editId=null;this.modalRef=null;this.meses=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}];this.estadoPagoOptions=[];this.isLoadingDeuda=!1;this.deudaMeses=[];this.deudaMaxMesCompaneros=null;this.mesesPagadosGestion=[];this.deudaKey=null;this.gestionesAsignaciones=[];this.gestionDeudores=new h(String(new Date().getFullYear()));this.verDeudores=!1;this.filterDeudores="";this.deudores=[];this.deudoresMeta=null;this.deudoresPage=1;this.deudoresPerPage=10;this.isLoadingDeudores=!1;this.uploading=!1;this.uploadProgress=null;this.tempFilePath=null;this.originalFilePath=null;this.esSuperAdmin=!1}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>this.esSuperAdmin=t),this.cargarEstadoPagoOptions(),this.cargarGestionesAsignaciones(),this.infoCtrl.valueChanges.subscribe(t=>{let e=Number(t||0);e>0?(this.resetFormForInfo(e),this.cargarPagos(e),this.cargarDeudaActual()):(this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.infoSeleccionada=null,this.resetFormForInfo(null))}),this.frmPago.get("gestion")?.valueChanges.subscribe(()=>{this.recalcularMesesPagadosGestion(),this.cargarDeudaActual()})}cargarGestionesAsignaciones(){this._pagos.ObtenerGestionesAsignaciones().subscribe({next:t=>{let e=Array.isArray(t?.data)?t.data:[];this.gestionesAsignaciones=e},error:()=>{this.gestionesAsignaciones=["SIN ASIGNAR"]}})}toggleVerDeudores(){this.verDeudores=!this.verDeudores,this.verDeudores&&this.cargarDeudores(1)}cargarDeudores(t=1){if(this.isLoadingDeudores)return;let e=String(this.gestionDeudores.value??"").trim()||String(new Date().getFullYear()),n=(this.filterDeudores??"").trim();this.isLoadingDeudores=!0,this._pagos.ObtenerDeudores({gestion:e,page:t,per_page:this.deudoresPerPage,search:n||void 0}).subscribe({next:l=>{this.deudores=Array.isArray(l?.data)?l.data:[],this.deudoresMeta=l?.meta??null,this.deudoresPage=this.deudoresMeta?.current_page??t},error:l=>{console.log("ERROR CARGANDO DEUDORES",l),this.deudores=[],this.deudoresMeta=null,this.deudoresPage=1},complete:()=>{this.isLoadingDeudores=!1}})}deudoresTienePrev(){return(this.deudoresMeta?.current_page??1)>1}deudoresTieneNext(){let t=this.deudoresMeta?.current_page??1,e=this.deudoresMeta?.last_page??1;return t<e}deudoresPrev(){this.deudoresTienePrev()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)-1)}deudoresNext(){this.deudoresTieneNext()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)+1)}mesLabels(t){return(Array.isArray(t)?t:[]).map(n=>this.mesLabel(n)).filter(n=>!!n).join(", ")}cargarEstadoPagoOptions(){this._controles.ObtenerOptionsSelectPorCategoria("ESTADO PAGO").subscribe({next:t=>this.estadoPagoOptions=t||[],error:()=>this.estadoPagoOptions=[]})}buscarInscripciones(t=1){if(this.isLoadingResultados)return;let e=(this.filterInscripcion??"").trim();if(!e||e.length<2){this.resultados=[],this.resMeta=null,this.resPage=1;return}this.isLoadingResultados=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.resPerPage,search:e,sort_by:"Ap_Paterno",sort_dir:"asc"}).subscribe({next:n=>{this.resultados=Array.isArray(n?.data)?n.data:[],this.resMeta=n?.meta??null,this.resPage=this.resMeta?.current_page??t},error:n=>{console.log("ERROR BUSCANDO INSCRIPCIONES",n),this.resultados=[],this.resMeta=null,this.resPage=1},complete:()=>{this.isLoadingResultados=!1}})}resTienePrev(){return(this.resMeta?.current_page??1)>1}resTieneNext(){let t=this.resMeta?.current_page??1,e=this.resMeta?.last_page??1;return t<e}resPrev(){this.resTienePrev()&&this.buscarInscripciones((this.resMeta?.current_page??1)-1)}resNext(){this.resTieneNext()&&this.buscarInscripciones((this.resMeta?.current_page??1)+1)}seleccionarInscripcion(t){let e=Number(t?.id??0);e&&(this.infoSeleccionada=t,this.infoCtrl.setValue(e))}limpiarSeleccion(){this.infoCtrl.setValue(null),this.infoSeleccionada=null,this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.resetFormForInfo(null)}cargarPagos(t){this._pagos.ObtenerPagoslcchPorInfo(t).subscribe({next:e=>{this.pagos=Array.isArray(e?.data)?e.data:[],this.recalcularMesesPagadosGestion()},error:e=>{console.log("ERROR CARGANDO PAGOS LCCH",e),this.pagos=[],this.mesesPagadosGestion=[]}})}recalcularMesesPagadosGestion(){let t=String(this.frmPago.get("gestion")?.value??"").trim();if(!t){this.mesesPagadosGestion=[];return}let e=(this.pagos??[]).filter(n=>String(n?.gestion??"").trim()===t).filter(n=>String(n?.estadopago??"").trim().toUpperCase()==="PAGADO").map(n=>Number(n?.mes??0)).filter(n=>Number.isFinite(n)&&n>=1&&n<=12);this.mesesPagadosGestion=Array.from(new Set(e)).sort((n,l)=>n-l)}cargarDeudaActual(){let t=Number(this.infoCtrl.value??0);if(!t)return;let e=String(this.frmPago.get("gestion")?.value??"").trim()||String(new Date().getFullYear()),n=`${t}|${e}`;this.deudaKey!==n&&(this.deudaKey=n,this.isLoadingDeuda=!0,this._pagos.ObtenerDeudaPorInfo(t,e).subscribe({next:l=>{let m=l?.data;this.deudaMeses=Array.isArray(m?.meses_deuda)?m.meses_deuda:[],this.deudaMaxMesCompaneros=Number.isFinite(Number(m?.max_mes_companeros))?Number(m?.max_mes_companeros):null},error:l=>{console.log("ERROR CARGANDO DEUDA",l),this.deudaMeses=[],this.deudaMaxMesCompaneros=null},complete:()=>{this.isLoadingDeuda=!1}}))}resetFormForInfo(t){this.cancelarEdicion(),this.frmPago.reset({id:0,infoestudiantesifas_id:t,nrodocumento:"",mes:1,gestion:String(new Date().getFullYear()),monto:"",acuenta:"",saldo:"",dolarboliviano:"",mediopago:"",fechapago:"",horapago:"",estadopago:"PAGADO",observacion:"",file:""}),this.deudaKey=null}limpiarFormulario(){let t=this.infoCtrl.value??null;this.cancelarEdicion(),this.resetFormForInfo(t?Number(t):null)}abrirModalNuevoPago(){let t=Number(this.infoCtrl.value??0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}this.cancelarEdicion(),this.resetFormForInfo(t),this.abrirModalPago()}abrirModalPago(){this.modalRef=this._modal.open(this.modalPagoTpl,{size:"lg",centered:!0,backdrop:"static",scrollable:!0}),this.modalRef.result.catch(()=>{}).finally(()=>{this.modalRef=null,this.limpiarFormulario()})}cerrarModalPago(){this.modalRef?.close()}iniciarEditar(t){this.cancelarEdicion(),this.editId=t?.id??null,this.originalFilePath=t?.file??null,this.frmPago.reset({id:t?.id??0,infoestudiantesifas_id:t?.infoestudiantesifas_id??this.infoCtrl.value,nrodocumento:t?.nrodocumento??"",mes:t?.mes??1,gestion:t?.gestion??String(new Date().getFullYear()),monto:t?.monto??"",acuenta:t?.acuenta??"",saldo:t?.saldo??"",dolarboliviano:t?.dolarboliviano??"",mediopago:t?.mediopago??"",fechapago:t?.fechapago??"",horapago:t?.horapago??"",estadopago:t?.estadopago??"PAGADO",observacion:t?.observacion??"",file:t?.file??""}),this.abrirModalPago()}cancelarEdicion(){this.tempFilePath&&this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null,this.originalFilePath=null,this.uploading=!1,this.uploadProgress=null,this.editId=null}onFileSelected(t){let e=t.target;if(!e?.files||e.files.length===0)return;let n=e.files[0];this.tempFilePath&&(this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null),this.uploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(n,"pagoslcchcomprobantes").subscribe({next:l=>{if(l.type===j.UploadProgress){let m=l.total??0;m>0&&(this.uploadProgress=Math.round(l.loaded/m*100))}if(l.type===j.Response){let m=l.body?.filePath;m&&(this.frmPago.patchValue({file:m}),this.tempFilePath=m),this.uploading=!1,this.uploadProgress=100}},error:l=>{console.log("ERROR SUBIENDO COMPROBANTE",l),this.uploading=!1,this.uploadProgress=null,this._tools.MostrarMensaje("error","Error al subir comprobante")}})}guardar(){let t=Number(this.infoCtrl.value||0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}if(this.uploading){this._tools.MostrarMensaje("warning","Espere a que termine la subida");return}let e=U({},this.frmPago.value);e.infoestudiantesifas_id=t;let n=l=>{if(l===""||l===null||l===void 0)return null;let m=Number(l);return Number.isFinite(m)?Math.trunc(m):null};if(e.nrodocumento=n(e.nrodocumento),e.monto=n(e.monto),e.acuenta=n(e.acuenta),e.saldo=n(e.saldo),!this.editId){delete e.id,this._pagos.AgregarPagoslcch(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago registrado"),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual(),this.cerrarModalPago()},error:l=>{console.log("ERROR CREANDO PAGO",l),this._tools.MostrarMensaje("error","Error al guardar")}});return}this._pagos.ModificarPagoslcch(e,this.editId).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago actualizado"),this.tempFilePath&&this.originalFilePath&&this.tempFilePath!==this.originalFilePath&&this._tools.EliminarArchivo(this.originalFilePath),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual(),this.cerrarModalPago()},error:l=>{console.log("ERROR ACTUALIZANDO PAGO",l),this._tools.MostrarMensaje("error","Error al actualizar")}})}eliminar(t){return Q(this,null,function*(){if(!(yield this._tools.mostrarMensajeConfirm("Eliminar","\xBFEliminar este pago?","warning","Eliminar")))return;let n=Number(this.infoCtrl.value||0);this._pagos.EliminarPagoslcch(t.id).subscribe({next:()=>{t?.file&&this._tools.EliminarArchivo(t.file),this._tools.MostrarMensaje("success","Eliminado"),this.cargarPagos(n),this.cargarDeudaActual()},error:l=>{console.log("ERROR ELIMINANDO PAGO",l),this._tools.MostrarMensaje("error","Error al eliminar")}})})}mesLabel(t){let e=this.meses.find(n=>n.value===Number(t));return e?e.label:String(t??"")}};y.\u0275fac=function(e){return new(e||y)(S(Se),S(R),S(fe),S(he),S(ge),S(_e))},y.\u0275cmp=q({type:y,selectors:[["app-sistemapagoslcch"]],viewQuery:function(e,n){if(e&1&&J(Pe,7),e&2){let l;Z(l=W())&&(n.modalPagoTpl=l.first)}},standalone:!1,decls:34,vars:11,consts:[["modalPago",""],["sinPagados",""],["sinDeuda",""],[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],["type","button",1,"btn","btn-outline-primary",3,"click"],["class","card mb-3",4,"ngIf"],[1,"card","mb-3"],[1,"card-body"],[1,"row","align-items-end","g-2"],[1,"col-lg-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],[1,"form-floating","flex-grow-1"],["type","text","placeholder","Buscar inscripci\xF3n",1,"form-control",3,"input","keyup.enter","value"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","mt-2 d-flex align-items-center gap-2",4,"ngIf"],[1,"mt-2","d-flex","flex-wrap","gap-2"],["class","btn btn-outline-secondary btn-sm","type","button",3,"active","disabled","click",4,"ngFor","ngForOf"],[1,"mt-2"],["class","text-muted",4,"ngIf"],["class","d-flex flex-wrap align-items-center gap-2",4,"ngIf"],[1,"col-lg-4"],[1,"form-label"],["readonly","",1,"form-control",3,"value"],["class","card",4,"ngIf"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-danger"],[1,"d-flex","align-items-center","gap-2"],[1,"form-label","m-0"],[1,"form-select","form-select-sm",2,"width","180px",3,"change","formControl"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Buscar deudores",1,"form-control",3,"input","keyup.enter","value"],[1,"table-responsive"],[1,"table","table-sm","table-striped","align-middle","mb-0"],[4,"ngIf"],[2,"width","160px"],[4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","d-flex","align-items-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"text-muted"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"text-center","py-3"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"text-success"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-sm","btn-success",3,"click"],[1,"badge","bg-secondary"],[1,"text-muted","ms-2"],[4,"ngIf","ngIfElse"],["class","badge bg-success",4,"ngFor","ngForOf"],[1,"badge","bg-success"],["class","badge bg-danger",4,"ngFor","ngForOf"],[1,"badge","bg-danger"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-2"],[1,"badge","bg-primary"],[1,"row","g-2"],[1,"col-md-4"],["type","number","placeholder","0",1,"form-control",3,"formControl"],[1,"form-select",3,"formControl"],["placeholder","2025",1,"form-control",3,"formControl"],["placeholder","6.96",1,"form-control",3,"formControl"],["placeholder","Efectivo / QR / Transferencia",1,"form-control",3,"formControl"],[3,"value","disabled",4,"ngFor","ngForOf"],["type","date",1,"form-control",3,"formControl"],["type","time",1,"form-control",3,"formControl"],["type","file",1,"form-control",3,"change"],["class","mt-1",4,"ngIf"],[1,"col-12"],["placeholder","",1,"quill-container-wrapper",3,"formControl","modules"],[1,"modal-footer"],["type","button",1,"btn","btn-success",3,"click","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[3,"value","disabled"],[1,"mt-1"],["target","_blank","rel","noopener noreferrer",3,"href"],[1,"progress"],["role","progressbar",1,"progress-bar"],[1,"card"],[1,"card-header"],["target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["colspan","8",1,"text-center","py-3"]],template:function(e,n){if(e&1){let l=b();a(0,"div",3)(1,"div",4)(2,"h4",5),r(3,"Sistema de Pagos (Mensualidades)"),i(),a(4,"button",6),_("click",function(){return p(l),u(n.toggleVerDeudores())}),r(5),i()(),g(6,Oe,48,9,"div",7),a(7,"div",8)(8,"div",9)(9,"div",10)(10,"div",11)(11,"div",12)(12,"span",13),v(13,"i",14),i(),a(14,"div",15)(15,"input",16),_("input",function(H){return p(l),u(n.filterInscripcion=H.target.value)})("keyup.enter",function(){return p(l),u(n.buscarInscripciones(1))}),i(),a(16,"label"),r(17,"Buscar inscripci\xF3n (m\xEDn. 2 caracteres)"),i()(),a(18,"button",17),_("click",function(){return p(l),u(n.buscarInscripciones(1))}),r(19," Buscar "),i()(),g(20,De,7,5,"div",18),a(21,"div",19),g(22,Te,4,9,"button",20),i(),a(23,"div",21),g(24,Re,2,0,"small",22)(25,Ve,8,2,"div",23),i()(),a(26,"div",24)(27,"label",25),r(28,"Total registros"),i(),v(29,"input",26),i()()()(),g(30,Ye,22,6,"div",7)(31,Ze,72,20,"ng-template",null,0,O)(33,it,26,2,"div",27),i()}e&2&&(s(5),x(" ",n.verDeudores?"Ocultar deudores":"Ver estudiantes con deuda"," "),s(),c("ngIf",n.verDeudores),s(9),c("value",n.filterInscripcion),s(3),c("disabled",n.isLoadingResultados),s(2),c("ngIf",n.resMeta),s(2),c("ngForOf",n.resultados),s(2),c("ngIf",!n.infoCtrl.value),s(),c("ngIf",n.infoCtrl.value),s(4),c("value",n.pagos.length),s(),c("ngIf",n.infoCtrl.value),s(3),c("ngIf",n.infoCtrl.value))},dependencies:[te,ie,me,pe,re,le,de,oe,ce,ve],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var N=y;var nt=[{path:"sistemapagoslcch",component:N}],E=class E{};E.\u0275fac=function(e){return new(e||E)},E.\u0275mod=M({type:E}),E.\u0275inj=I({imports:[$.forChild(nt),$]});var V=E;var P=class P{};P.\u0275fac=function(e){return new(e||P)},P.\u0275mod=M({type:P}),P.\u0275inj=I({imports:[ne,xe,ue,be,V]});var Ce=P;export{Ce as SistemapagoslcchModule};
