import{a as I}from"./chunk-OQPWVW4O.js";import{Ha as m,Ia as r,Ja as n,Sb as _,Ua as x,Wa as d,Zb as b,dc as M,eb as h,ia as i,ib as s,ic as y,jb as g,kb as C,pa as u,ra as f,wa as v}from"./chunk-TNNFIFGQ.js";function E(o,a){if(o&1&&(r(0,"div",7)(1,"div",8)(2,"div",9),s(3),n()(),r(4,"div",10),s(5,"Subiendo\u2026"),n()()),o&2){let t=d();i(2),h("width",t.progress,"%"),i(),C("",t.progress,"%")}}function F(o,a){if(o&1&&(r(0,"div",11),s(1),n()),o&2){let t=d();i(),g(t.message)}}function k(o,a){if(o&1&&(r(0,"div",12),s(1),n()),o&2){let t=d();i(),g(t.error)}}var l=class l{constructor(a,t){this.route=a;this.http=t;this.ruta=I.ruta;this.token=null;this.uploading=!1;this.progress=0;this.message=null;this.error=null;this.token=this.route.snapshot.paramMap.get("token")}onFileSelected(a){let t=a.target,p=t.files?.item(0);if(t.value="",!p||!this.token)return;this.uploading=!0,this.progress=0,this.message=null,this.error=null;let c=new FormData;c.append("file",p),this.http.post(this.ruta+"api/capture-sessions/"+this.token+"/upload",c,{reportProgress:!0,observe:"events"}).subscribe({next:e=>{if(e?.type===1&&e.total){this.progress=Math.round(e.loaded/e.total*100);return}e?.type===4&&(this.uploading=!1,this.message="Foto enviada. Ya puedes cerrar esta pantalla.")},error:e=>{this.uploading=!1,this.progress=0,this.error=e?.error?.error??"No se pudo subir la foto"}})}};l.\u0275fac=function(t){return new(t||l)(u(y),u(M))},l.\u0275cmp=f({type:l,selectors:[["app-captura-foto"]],decls:10,vars:3,consts:[[1,"page"],[1,"muted"],[1,"box"],["type","file","accept","image/*","capture","environment",3,"change"],["class","mt",4,"ngIf"],["class","ok mt",4,"ngIf"],["class","err mt",4,"ngIf"],[1,"mt"],[1,"progress"],[1,"progress-bar"],[1,"muted","mt2"],[1,"ok","mt"],[1,"err","mt"]],template:function(t,p){t&1&&(r(0,"div",0)(1,"h3"),s(2,"Captura de foto"),n(),r(3,"p",1),s(4," Toca el bot\xF3n para abrir la c\xE1mara del celular y enviar la foto. "),n(),r(5,"div",2)(6,"input",3),x("change",function(e){return p.onFileSelected(e)}),n(),v(7,E,6,3,"div",4)(8,F,2,1,"div",5)(9,k,2,1,"div",6),n()()),t&2&&(i(7),m("ngIf",p.uploading),i(),m("ngIf",p.message),i(),m("ngIf",p.error))},dependencies:[b,_],styles:[".page[_ngcontent-%COMP%]{max-width:520px;margin:24px auto;padding:0 16px}.muted[_ngcontent-%COMP%]{color:#666}.box[_ngcontent-%COMP%]{border:1px solid #e5e5e5;border-radius:12px;padding:16px}.mt[_ngcontent-%COMP%]{margin-top:12px}.mt2[_ngcontent-%COMP%]{margin-top:8px}.progress[_ngcontent-%COMP%]{height:10px;background:#f1f1f1;border-radius:999px;overflow:hidden}.progress-bar[_ngcontent-%COMP%]{height:10px;background:#0d6efd;color:transparent}.ok[_ngcontent-%COMP%]{color:#0a7f2e}.err[_ngcontent-%COMP%]{color:#b00020}"]});var P=l;export{P as CapturaFotoComponent};
