import{a as bt}from"./chunk-WANVCWDU.js";import{a as Ge}from"./chunk-J5Y3SAOU.js";import{a as xt}from"./chunk-O24TPCPO.js";import{a as he}from"./chunk-76LOQ7RP.js";import{a as vt}from"./chunk-CLO6LTW7.js";import"./chunk-724O7RRN.js";import{a as ke}from"./chunk-2GD4CMSK.js";import"./chunk-WJU65V47.js";import{a as _t}from"./chunk-DNUF2RNX.js";import{a as ft}from"./chunk-BPBF5BY4.js";import{b as ht}from"./chunk-P3GASOP5.js";import{b as ge}from"./chunk-LRDGIBFV.js";import"./chunk-44ZKMDH4.js";import"./chunk-NCIXDP2C.js";import{b as _e}from"./chunk-KCTZUZJH.js";import{k as Xe}from"./chunk-PWQJWZZZ.js";import{b as fe}from"./chunk-OX7OA6PN.js";import{g as gt}from"./chunk-EGRYB44C.js";import"./chunk-5VY7FQQV.js";import{b as Ne,c as K,f as z,g as ue,h as ct,i as dt,j as N,k as H,l as pe,m as Ve,n as mt,p as Re,q as Fe,r as Q,s as q,t as X,u as ut,v as pt}from"./chunk-ROSYCBC4.js";import{a as Le}from"./chunk-JISGPZ2J.js";import{Aa as ye,Bb as J,Cb as ee,Da as Oe,Db as te,Dc as de,Ea as c,Fc as U,Gb as Ie,Gc as W,Hb as Ae,Ib as j,Lb as s,Ma as O,Mb as x,Nb as y,Nc as rt,Ob as ne,Oc as st,Ra as $,Sa as De,Tb as w,Ub as M,Uc as me,Vb as T,Wa as h,Wc as qe,Yc as lt,Z as et,Zb as A,_ as Pe,ab as Z,ba as tt,dc as ot,ga as p,gc as at,ha as _,hc as B,ia as it,ib as d,jb as o,kb as a,lb as v,p as G,pb as He,qb as Qe,sb as S,ua as nt,vb as g,xb as m}from"./chunk-SPNCLBHB.js";import{a as ie,b as re,c as Je,m as V}from"./chunk-GG76335P.js";function Mt(l,t){if(l&1){let e=S();o(0,"div",35)(1,"button",36),g("click",function(){p(e);let n=m();return _(n.infoPrev())}),s(2,"Prev"),a(),o(3,"button",36),g("click",function(){p(e);let n=m();return _(n.infoNext())}),s(4,"Next"),a()()}if(l&2){let e=m();c(),d("disabled",!e.infoTienePrev()||e.isLoadingInfo),c(2),d("disabled",!e.infoTieneNext()||e.isLoadingInfo)}}function Tt(l,t){if(l&1){let e=S();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let r=m();return _(r.onEvalEnabledChange(0,n))}),a(),o(2,"span",21),s(3,"1"),a()()}if(l&2){let e=m();c(),d("ngModel",e.evalEnabled[0])}}function Pt(l,t){if(l&1){let e=S();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let r=m();return _(r.onEvalEnabledChange(1,n))}),a(),o(2,"span",21),s(3,"2"),a()()}if(l&2){let e=m();c(),d("ngModel",e.evalEnabled[1])}}function Ot(l,t){if(l&1){let e=S();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let r=m();return _(r.onEvalEnabledChange(2,n))}),a(),o(2,"span",21),s(3,"3"),a()()}if(l&2){let e=m();c(),d("ngModel",e.evalEnabled[2])}}function Dt(l,t){if(l&1){let e=S();o(0,"label",37)(1,"input",20),g("ngModelChange",function(n){p(e);let r=m();return _(r.onEvalEnabledChange(3,n))}),a(),o(2,"span",21),s(3,"4"),a()()}if(l&2){let e=m();c(),d("ngModel",e.evalEnabled[3])}}function At(l,t){if(l&1&&(o(0,"span"),s(1),a()),l&2){let e=m(2);c(),ne("\xB7 P\xE1gina ",e.infoMeta.current_page," / ",e.infoMeta.last_page)}}function Lt(l,t){if(l&1&&(o(0,"span"),s(1),a()),l&2){let e=m().$implicit;c(),y("\xB7 ",e.NombreInstitucion)}}function Nt(l,t){if(l&1){let e=S();o(0,"button",46),g("click",function(){let n=p(e).$implicit,r=m(2);return _(r.seleccionarInfo(n))}),o(1,"div",47),s(2),a(),o(3,"div",48),s(4),h(5,Lt,2,1,"span",43),a()()}if(l&2){let e=t.$implicit,i=m(2);j("active",(i.selectedInfo==null?null:i.selectedInfo.id)===e.id),c(2),x(i.infoLabel(e)),c(2),y(" ID Inscripci\xF3n: ",e.id," "),c(),d("ngIf",i.esSuperAdmin&&e.NombreInstitucion)}}function Vt(l,t){if(l&1&&(o(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41)(4,"div",42),s(5),h(6,At,2,2,"span",43),a(),o(7,"div",44),h(8,Nt,6,5,"button",45),a()()()()()),l&2){let e=m();c(5),y(" Resultados: ",(e.infoMeta==null?null:e.infoMeta.total)??e.infoItems.length," "),c(),d("ngIf",e.infoMeta),c(2),d("ngForOf",e.infoItems)("ngForTrackBy",e.trackByRowIndex)}}function Rt(l,t){l&1&&(o(0,"div",49)(1,"div",50),s(2," Primero busca una "),o(3,"strong"),s(4,"inscripci\xF3n"),a(),s(5," y selecci\xF3nala para cargar sus materias. "),a(),o(6,"div",51),s(7," Columnas calculadas: "),o(8,"strong"),s(9,"Prom Teo"),a(),s(10,", "),o(11,"strong"),s(12,"Prom Prac"),a(),s(13," y "),o(14,"strong"),s(15,"Prom"),a(),s(16," (solo lectura). "),a()())}function Ft(l,t){l&1&&(o(0,"span"),s(1,"Cargando calificaciones\u2026"),a())}function kt(l,t){l&1&&(o(0,"span"),s(1,"Guardando cambios\u2026"),a())}function Gt(l,t){if(l&1&&(o(0,"div",52)(1,"div",51),h(2,Ft,2,0,"span",43)(3,kt,2,0,"span",43),a()()),l&2){let e=m();c(2),d("ngIf",e.isLoadingCalificaciones),c(),d("ngIf",e.isSaving)}}function jt(l,t){if(l&1&&(o(0,"div",53)(1,"div",51),s(2),a()()),l&2){let e=m();c(2),x(e.saveError)}}function Bt(l,t){if(l&1&&(o(0,"span"),s(1),a()),l&2){let e=m(2);c(),y("/ ",e.califMeta.last_page)}}function $t(l,t){if(l&1){let e=S();o(0,"div",56)(1,"button",36),g("click",function(){p(e);let n=m(2);return _(n.califPrev())}),s(2,"Prev"),a(),o(3,"button",36),g("click",function(){p(e);let n=m(2);return _(n.califNext())}),s(4,"Next"),a()()}if(l&2){let e=m(2);c(),d("disabled",!e.califTienePrev()||e.isLoadingCalificaciones),c(2),d("disabled",!e.califTieneNext()||e.isLoadingCalificaciones)}}function Ut(l,t){if(l&1){let e=S();o(0,"div",2)(1,"div",54),s(2," Inscripci\xF3n seleccionada: "),o(3,"strong"),s(4),a(),s(5," \xB7 P\xE1gina materias: "),o(6,"strong"),s(7),a(),h(8,Bt,2,1,"span",43),a(),o(9,"div",5)(10,"div",51),s(11,"Cambios pendientes: "),o(12,"strong"),s(13),a()(),h(14,$t,5,2,"div",55),o(15,"button",12),g("click",function(){p(e);let n=m();return _(n.cargarCalificaciones(n.califPage))}),s(16," Recargar "),a()()()}if(l&2){let e=m();c(4),x(e.selectedInfo.id),c(3),x((e.califMeta==null?null:e.califMeta.current_page)??e.califPage),c(),d("ngIf",e.califMeta),c(5),x(e.dirtyIds.size),c(),d("ngIf",e.califMeta),c(),d("disabled",e.isLoadingCalificaciones)}}function Wt(l,t){if(l&1&&(o(0,"span",4),s(1),a()),l&2){let e=t.ngIf;c(),y("(",e,")")}}function Kt(l,t){if(l&1&&(o(0,"th",62),s(1),h(2,Wt,2,1,"span",63),a()),l&2){let e=t.$implicit,i=m(2);Ae("width",e.widthPx,"px"),d("ngClass",i.headerThClass(e.key)),c(),y(" ",e.label," "),c(),d("ngIf",i.maxForColumn(e))}}function zt(l,t){if(l&1&&(o(0,"tr",68)(1,"td",59)(2,"div",47),s(3),a()()()),l&2){let e=m().$implicit,i=m(2);c(),Z("colspan",i.tableColspan()),c(2),x(i.groupKey(e))}}function Ht(l,t){if(l&1){let e=S();He(0),o(1,"input",71),g("ngModelChange",function(n){p(e);let r=m().$implicit,u=m().index,f=m(2);return _(f.onCellValueInput(u,r.key,n))})("focus",function(){p(e);let n=m().index,r=m().index,u=m(2);return _(u.onCellFocus(r,n))})("keydown",function(n){p(e);let r=m().index,u=m().index,f=m(2);return _(f.onKeyDown(n,u,r))})("paste",function(n){p(e);let r=m().index,u=m().index,f=m(2);return _(f.onPaste(n,u,r))}),a(),Qe()}if(l&2){let e=m(),i=e.$implicit,n=e.index,r=m(),u=r.$implicit,f=r.index,b=m(2);c(),j("readonly-cell",i.readonly),d("readOnly",!!i.readonly||!b.isColumnEditable(i.key))("ngModel",u[i.key]),Z("data-cell",f+"-"+n)("min",0)("max",b.maxForColumn(i))}}function Qt(l,t){if(l&1){let e=S();o(0,"input",72),g("focus",function(){p(e);let n=m().index,r=m().index,u=m(2);return _(u.onCellFocus(r,n))})("keydown",function(n){p(e);let r=m().index,u=m().index,f=m(2);return _(f.onKeyDown(n,u,r))})("paste",function(n){p(e);let r=m().index,u=m().index,f=m(2);return _(f.onPaste(n,u,r))}),a()}if(l&2){let e=m(),i=e.$implicit,n=e.index,r=m(),u=r.$implicit,f=r.index,b=m(2);d("readOnly",!0)("value",b.sumForColumn(u,i.key)??""),Z("data-cell",f+"-"+n)}}function qt(l,t){if(l&1&&(o(0,"td",69),h(1,Ht,2,7,"ng-container",70)(2,Qt,1,3,"ng-template",null,0,B),a()),l&2){let e=t.$implicit,i=t.index,n=Ie(3),r=m().$implicit,u=m(2);d("ngClass",u.cellTdClass(r,i,e.key)),c(),d("ngIf",e.kind!=="sum")("ngIfElse",n)}}function Xt(l,t){if(l&1){let e=S();He(0),h(1,zt,4,2,"tr",64),o(2,"tr")(3,"td",59)(4,"div",65)(5,"div")(6,"div",47),s(7),a(),o(8,"div",66),s(9),a()(),o(10,"button",24),g("click",function(){let n=p(e).$implicit,r=m(2);return _(r.openPhoto(n))}),s(11,"Foto"),a()()(),h(12,qt,4,3,"td",67),a(),Qe()}if(l&2){let e=t.$implicit,i=t.index,n=m(2);c(),d("ngIf",n.isGroupStart(i)),c(),j("table-active",i===n.activeRowIndex),c(5),x(e.estudiante),c(2),x(e.materia),c(3),d("ngForOf",n.columns)("ngForTrackBy",n.trackByColIndex)}}function Yt(l,t){if(l&1&&(o(0,"div",57)(1,"table",58)(2,"thead")(3,"tr")(4,"th",59),s(5,"Estudiante"),a(),h(6,Kt,3,5,"th",60),a()(),o(7,"tbody"),h(8,Xt,13,7,"ng-container",61),a()()()),l&2){let e=m();c(6),d("ngForOf",e.columns)("ngForTrackBy",e.trackByColIndex),c(2),d("ngForOf",e.rows)("ngForTrackBy",e.trackByRowIndex)}}function Zt(l,t){if(l&1){let e=S();o(0,"div",73)(1,"div",74)(2,"div",75)(3,"div",76)(4,"h5",77),s(5),a(),o(6,"button",78),g("click",function(){p(e);let n=m();return _(n.closePhoto())}),a()(),o(7,"div",79),v(8,"img",80),o(9,"div",81),s(10),a()()()()()}if(l&2){let e=m();c(5),y("Foto - ",e.photoRow==null?null:e.photoRow.estudiante),c(3),d("src",e.photoUrlFor(e.photoRow),ye),c(2),x(e.photoRow==null?null:e.photoRow.materia)}}function Jt(l,t){if(l&1){let e=S();o(0,"div",82),g("click",function(){p(e);let n=m();return _(n.closePhoto())}),a()}}var xe=class xe{constructor(t,e,i,n){this.hostEl=t;this._calif=e;this._info=i;this._auth=n;this.esSuperAdmin=!1;this.PASSING_SCORE=61;this.maxTeorico=30;this.maxPractico=70;this.avgEvalCount=4;this.evalEnabled=[!0,!0,!0,!0];this.showSumColumns=!1;this.filterInfo="";this.infoItems=[];this.infoMeta=null;this.infoPage=1;this.infoPerPage=10;this.isLoadingInfo=!1;this.selectedInfo=null;this.isLoadingCalificaciones=!1;this.califMeta=null;this.califPage=1;this.califPerPage=200;this.isSaving=!1;this.saveError=null;this.originalById=new Map;this.dirtyIds=new Set;this.HISTORY_LIMIT=80;this.undoStack=[];this.redoStack=[];this.isRestoring=!1;this.viewMode="intercalado";this.rows=[];this.activeRowIndex=0;this.activeColIndex=0;this.photoModalOpen=!1;this.photoRow=null;this.trackByRowIndex=(t,e)=>e.id;this.trackByColIndex=(t,e)=>e.key}get visibleEvalCount(){return this.avgEvalCount}get columns(){return this.buildColumns(this.viewMode,this.visibleEvalCount)}tableColspan(){return 1+this.columns.length}groupKey(t){let e=(t.Anio??"SIN A\xD1O").toString().trim()||"SIN A\xD1O",i=(t.LvlCurso??"SIN CURSO").toString().trim()||"SIN CURSO";return`${e} | ${i}`}isGroupStart(t){if(t<=0)return!0;let e=this.rows[t-1],i=this.rows[t];return!e||!i?!0:this.groupKey(e)!==this.groupKey(i)}buildColumns(t,e){let i=[],r=e;if(t==="intercalado")for(let u=1;u<=r;u++)i.push({key:`Teorico${u}`,label:`Teo${u}`,type:"number",kind:"input",widthPx:95}),i.push({key:`Practico${u}`,label:`Prac${u}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${u}`,label:`Sum${u}`,type:"number",kind:"sum",readonly:!0,widthPx:90});else{for(let u=1;u<=r;u++)i.push({key:`Teorico${u}`,label:`Teo${u}`,type:"number",kind:"input",widthPx:95});for(let u=1;u<=r;u++)i.push({key:`Practico${u}`,label:`Prac${u}`,type:"number",kind:"input",widthPx:95}),this.showSumColumns&&i.push({key:`Sum${u}`,label:`Sum${u}`,type:"number",kind:"sum",readonly:!0,widthPx:90})}return[...i,{key:"PromTeorico",label:"Prom Teo",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"PromPractico",label:"Prom Prac",type:"number",kind:"input",readonly:!0,widthPx:110},{key:"Promedio",label:"Prom",type:"number",kind:"input",readonly:!0,widthPx:90},{key:"PruebaRecuperacion",label:"Recup",type:"number",kind:"input",widthPx:95}]}ngOnInit(){this._auth.revisarSiEsSuperAdmin().subscribe(t=>{this.esSuperAdmin=t})}buscarInfo(t=1){if(this.isLoadingInfo)return;let e=(this.filterInfo??"").trim();if(!e||e.length<2){this.infoItems=[],this.infoMeta=null,this.infoPage=1;return}this.isLoadingInfo=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.infoPerPage,search:e,sort_by:"FechInsc",sort_dir:"desc"}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.infoItems=n.map(r=>({id:Number(r?.id),FechInsc:r?.FechInsc??null,Curso_Solicitado:r?.Curso_Solicitado??null,Paralelo_Solicitado:r?.Paralelo_Solicitado??null,Categoria:r?.Categoria??null,Turno:r?.Turno??null,Anio:r?.Anio??null,Ap_Paterno:r?.Ap_Paterno??null,Ap_Materno:r?.Ap_Materno??null,Nombre:r?.Nombre??null,NombreInstitucion:r?.NombreInstitucion??null})).filter(r=>Number.isFinite(r.id)),this.infoMeta=i?.meta??null,this.infoPage=this.infoMeta?.current_page??t},error:i=>{console.error("Error al buscar inscripciones:",i),this.infoItems=[],this.infoMeta=null},complete:()=>{this.isLoadingInfo=!1}})}infoTienePrev(){return(this.infoMeta?.current_page??1)>1}infoTieneNext(){let t=this.infoMeta?.current_page??1,e=this.infoMeta?.last_page??1;return t<e}infoPrev(){this.infoTienePrev()&&this.buscarInfo((this.infoMeta?.current_page??1)-1)}infoNext(){this.infoTieneNext()&&this.buscarInfo((this.infoMeta?.current_page??1)+1)}infoLabel(t){let e=(t.Ap_Paterno??"").toString().trim(),i=(t.Ap_Materno??"").toString().trim(),n=(t.Nombre??"").toString().trim(),r=`${e} ${i} ${n}`.replace(/\s+/g," ").trim()||`Inscripci\xF3n #${t.id}`,u=(t.Anio??"").toString().trim(),f=(t.Curso_Solicitado??"").toString().trim(),b=(t.Paralelo_Solicitado??"").toString().trim(),C=[r];return u&&C.push(`A\xF1o: ${u}`),f&&C.push(`Curso: ${f}${b?" - "+b:""}`),C.join(" \xB7 ")}seleccionarInfo(t){this.selectedInfo=t,this.resetGridForNewInfo(),this.cargarCalificaciones(1)}limpiarInfo(){this.selectedInfo=null,this.resetGridForNewInfo()}resetGridForNewInfo(){this.rows=[],this.originalById.clear(),this.dirtyIds.clear(),this.undoStack=[],this.redoStack=[],this.saveError=null,this.califMeta=null,this.califPage=1}califTienePrev(){return(this.califMeta?.current_page??1)>1}califTieneNext(){let t=this.califMeta?.current_page??1,e=this.califMeta?.last_page??1;return t<e}califPrev(){this.califTienePrev()&&this.cargarCalificaciones((this.califMeta?.current_page??1)-1)}califNext(){this.califTieneNext()&&this.cargarCalificaciones((this.califMeta?.current_page??1)+1)}cargarCalificaciones(t=1){if(!this.selectedInfo||this.isLoadingCalificaciones)return;this.isLoadingCalificaciones=!0,this.saveError=null;let e=this.selectedInfo.id;this._calif.ObtenerCalificacionesPorInfoPaginado(e,{page:t,per_page:this.califPerPage}).subscribe({next:i=>{let n=Array.isArray(i?.data)?i.data:[];this.califMeta=i?.meta??null,this.califPage=this.califMeta?.current_page??t;let r=Number(n?.[0]?.CantidadEvaluaciones);Number.isFinite(r)&&(this.avgEvalCount=this.clampInt(r,1,4));let u=this.infoLabel(this.selectedInfo);this.rows=n.map(f=>{let b=(f?.NombreMateria??"").toString().trim(),C=(f?.SiglaMateria??"").toString().trim(),E=(f?.MateriaParalelo??"").toString().trim(),I=[C,b].filter(Boolean).join(" ")+(E?` (${E})`:"");return{id:Number(f?.id),infoestudiantesifas_id:Number(f?.infoestudiantesifas_id??e),materias_id:Number(f?.materias_id),estudiante:u,materia:I||`Materia #${f?.materias_id}`,fotoUrl:null,Anio:f?.Anio??null,LvlCurso:f?.LvlCurso??null,Teorico1:f?.Teorico1??null,Teorico2:f?.Teorico2??null,Teorico3:f?.Teorico3??null,Teorico4:f?.Teorico4??null,Practico1:f?.Practico1??null,Practico2:f?.Practico2??null,Practico3:f?.Practico3??null,Practico4:f?.Practico4??null,PromTeorico:f?.PromTeorico??null,PromPractico:f?.PromPractico??null,Promedio:f?.Promedio??null,PruebaRecuperacion:f?.PruebaRecuperacion??null}}).filter(f=>Number.isFinite(f.id)&&Number.isFinite(f.materias_id));for(let f of this.rows){for(let b of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(f,b);this.recalcInPlace(f)}this.captureBaseline()},error:i=>{console.error("Error al cargar calificaciones:",i),this.rows=[],this.califMeta=null,this.saveError="No se pudieron cargar las calificaciones."},complete:()=>{this.isLoadingCalificaciones=!1}})}captureBaseline(){this.originalById.clear(),this.dirtyIds.clear();for(let t of this.rows)this.originalById.set(t.id,{Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion})}recomputeDirtyForRow(t){let e=this.originalById.get(t.id);if(!e)return;["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"].some(r=>t[r]!==e[r])?this.dirtyIds.add(t.id):this.dirtyIds.delete(t.id)}guardarCambios(){if(!this.selectedInfo||this.isSaving||(this.saveError=null,Array.from(this.dirtyIds.values()).length===0))return;let e=this.rows.filter(i=>this.dirtyIds.has(i.id)).map(i=>({id:i.id,Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion}));this.isSaving=!0,this._calif.GuardarCalificacionesBulk({infoestudiantesifas_id:this.selectedInfo.id,avg_eval_count:this.avgEvalCount,items:e}).subscribe({next:()=>{for(let i of this.rows)this.dirtyIds.has(i.id)&&this.originalById.set(i.id,{Teorico1:i.Teorico1,Teorico2:i.Teorico2,Teorico3:i.Teorico3,Teorico4:i.Teorico4,Practico1:i.Practico1,Practico2:i.Practico2,Practico3:i.Practico3,Practico4:i.Practico4,PruebaRecuperacion:i.PruebaRecuperacion});this.dirtyIds.clear()},error:i=>{console.error("Error al guardar cambios:",i),this.saveError="No se pudieron guardar los cambios."},complete:()=>{this.isSaving=!1}})}onGlobalKeyDown(t){let e=t.target;if(!e||!this.hostEl.nativeElement.contains(e)||!(t.ctrlKey||t.metaKey))return;let n=t.key.toLowerCase();if(n==="z"&&!t.shiftKey){this.canUndo()&&(t.preventDefault(),this.undo());return}(n==="y"||n==="z"&&t.shiftKey)&&this.canRedo()&&(t.preventDefault(),this.redo())}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){let t=this.undoStack.pop();t&&(this.redoStack.push(this.snapshotState()),this.restoreState(t))}redo(){let t=this.redoStack.pop();t&&(this.undoStack.push(this.snapshotState()),this.restoreState(t))}beginUserChange(){this.isRestoring||(this.undoStack.push(this.snapshotState()),this.undoStack.length>this.HISTORY_LIMIT&&this.undoStack.shift(),this.redoStack=[])}copyAllToClipboard(){return V(this,null,function*(){let t=this.buildTsvExport();if(navigator.clipboard?.writeText){yield navigator.clipboard.writeText(t);return}let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)})}onShowSumColumnsChange(t){this.beginUserChange(),this.showSumColumns=!!t}onMaxTeoricoInput(t){this.beginUserChange(),this.maxTeorico=t,this.onLimitsChange()}onMaxPracticoInput(t){this.beginUserChange(),this.maxPractico=t,this.onLimitsChange()}onLimitsChange(){this.maxTeorico=this.clampInt(this.maxTeorico,1,100),this.maxPractico=this.clampInt(this.maxPractico,1,100);for(let t of this.rows){for(let e of["Teorico1","Teorico2","Teorico3","Teorico4","Practico1","Practico2","Practico3","Practico4","PruebaRecuperacion"])this.sanitizeCellValue(t,e);this.recalcInPlace(t)}}onAvgEvalCountInput(t){this.beginUserChange(),this.avgEvalCount=t,this.onAvgEvalCountChange()}onAvgEvalCountChange(){this.avgEvalCount=this.clampInt(this.avgEvalCount,1,4);for(let t of this.rows)this.recalcInPlace(t)}setAllEvaluations(t){this.beginUserChange(),this.evalEnabled=[t,t,t,t]}onEvalEnabledChange(t,e){t<0||t>3||(this.beginUserChange(),this.evalEnabled[t]=!!e)}setViewMode(t){this.viewMode!==t&&(this.beginUserChange(),this.viewMode=t)}onCellFocus(t,e){this.activeRowIndex=t,this.activeColIndex=e}maxForKey(t){return this.isTeoricoKey(t)?this.maxTeorico:this.isPracticoKey(t)?this.maxPractico:t==="PruebaRecuperacion"?100:null}maxForColumn(t){if(t.kind!=="input")return null;let e=t.key;return this.isReadonlyKey(e)?null:this.maxForKey(e)}isColumnEditable(t){return this.isSumKey(t)?!1:this.isCellEditable(t)}isSumColumn(t){return this.isSumKey(t)}sumForColumn(t,e){let i=this.evalIndexFromColumnKey(e);return i===null?null:this.evalSum(t,i)}openPhoto(t){this.photoRow=t,this.photoModalOpen=!0}closePhoto(){this.photoModalOpen=!1,this.photoRow=null}photoUrlFor(t){return t?.fotoUrl??"assets/images/client6.png"}isCellEditable(t){if(this.isReadonlyKey(t))return!1;let e=this.evalIndexFromKey(t);return e!==null?!!this.evalEnabled[e-1]:!0}evalSum(t,e){let i=t[`Teorico${e}`],n=t[`Practico${e}`];return typeof i=="number"&&typeof n=="number"?i+n:null}isSumKey(t){return typeof t=="string"&&t.startsWith("Sum")}evalIndexFromColumnKey(t){if(this.isSumKey(t)){let e=Number(t.replace("Sum",""));return e>=1&&e<=4?e:null}return this.evalIndexFromKey(t)}cellTdClass(t,e,i){return{"eval-end":this.isEvaluationSeparator(i),"section-start":this.isSectionStart(i),"cell-danger":this.isDangerCell(t,i)}}headerThClass(t){return{"eval-end":this.isEvaluationSeparator(t),"section-start":this.isSectionStart(t)}}onCellValueInput(t,e,i){if(!this.isCellEditable(e)||this.isReadonlyKey(e))return;this.beginUserChange();let n=this.rows[t];n[e]=this.parseNullableInt(String(i??"").trim()),this.sanitizeCellValue(n,e),this.recalcInPlace(n),this.recomputeDirtyForRow(this.rows[t])}onPaste(t,e,i){let n=t.clipboardData?.getData("text/plain");n&&(t.preventDefault(),this.beginUserChange(),this.applyPaste(n,e,i))}onKeyDown(t,e,i){if(t.key!=="ArrowUp"&&t.key!=="ArrowDown"&&t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return;t.preventDefault();let n=this.keyToDelta(t.key),r=this.clamp(e+n.dr,0,this.rows.length-1),u=this.clamp(i+n.dc,0,this.columns.length-1);this.focusCell(r,u)}focusCell(t,e){this.activeRowIndex=t,this.activeColIndex=e,queueMicrotask(()=>{let i=document.querySelector(`[data-cell="${t}-${e}"]`);i?.focus(),i?.select()})}pasteHere(t){this.applyPaste(t,this.activeRowIndex,this.activeColIndex)}applyPaste(t,e,i){let n=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`),r=this.trimEmptyTrailingLines(n);for(let u=0;u<r.length;u++){let f=e+u;if(f>=this.rows.length)break;let b=r[u].split("	");for(let C=0;C<b.length;C++){let E=i+C;if(E>=this.columns.length)break;let I=this.columns[E];if(I.readonly||I.kind==="sum"||this.isSumKey(I.key))continue;let P=b[C].trim(),D=I.key;if(!this.isCellEditable(D))continue;let F=this.parseNullableInt(P);this.rows[f][D]=F,this.sanitizeCellValue(this.rows[f],D)}this.recalcInPlace(this.rows[f]),this.recomputeDirtyForRow(this.rows[f])}}recalcInPlace(t){let e=this.findZeroCascadeIndex(t),i=t,n=!!i.__cascadeActive,r=i.__cascadeLockFrom??null;if(e!==null){n||(i.__cascadeBackup={1:{teo:t.Teorico1,prac:t.Practico1},2:{teo:t.Teorico2,prac:t.Practico2},3:{teo:t.Teorico3,prac:t.Practico3},4:{teo:t.Teorico4,prac:t.Practico4}}),i.__cascadeActive=!0,i.__cascadeLockFrom=e;for(let E=e;E<=4;E++)t[`Teorico${E}`]=0,t[`Practico${E}`]=0}else if(n){let E=i.__cascadeBackup,I=r??1;if(E)for(let P=I+1;P<=4;P++){let D=E[P];if(!D)continue;let F=t[`Teorico${P}`],k=t[`Practico${P}`];typeof F=="number"&&typeof k=="number"&&F===0&&k===0&&(t[`Teorico${P}`]=D.teo,t[`Practico${P}`]=D.prac)}i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null}let u=e!==null,f=this.getAvgEvalIndices(),b=f.map(E=>t[`Teorico${E}`]),C=f.map(E=>t[`Practico${E}`]);if(t.PromTeorico=u?0:this.avg(b),t.PromPractico=u?0:this.avg(C),t.PromTeorico===null&&t.PromPractico===null)t.Promedio=null;else{let E=(t.PromTeorico??0)+(t.PromPractico??0);t.Promedio=Math.max(0,Math.min(100,Math.round(E)))}}avg(t){let e=t.filter(n=>typeof n=="number"&&Number.isFinite(n));if(e.length===0)return null;let i=e.reduce((n,r)=>n+r,0);return Math.round(i/e.length)}parseNullableInt(t){if(!t)return null;let e=t.replace(",","."),i=Number(e);return Number.isFinite(i)?Math.trunc(i):null}sanitizeCellValue(t,e){if(this.isReadonlyKey(e))return;let i=t[e];if(i==null||!Number.isFinite(i)){t[e]=null;return}let n=Math.trunc(i),r=this.maxForKey(e);r!==null&&(n=Math.min(n,r)),n=Math.max(n,0),t[e]=n}clampInt(t,e,i){let n=Number(t);return Number.isFinite(n)?Math.trunc(this.clamp(n,e,i)):e}getAvgEvalIndices(){let t=[];for(let e=1;e<=this.avgEvalCount;e++)t.push(e);return t}findZeroCascadeIndex(t){for(let e=1;e<=4;e=e+1){let i=t[`Teorico${e}`],n=t[`Practico${e}`];if(typeof i=="number"&&typeof n=="number"&&i===0&&n===0)return e}return null}buildTsvExport(){let t=[{key:"Teorico1",label:"Teo1"},{key:"Practico1",label:"Prac1"},{key:"Teorico2",label:"Teo2"},{key:"Practico2",label:"Prac2"},{key:"Teorico3",label:"Teo3"},{key:"Practico3",label:"Prac3"},{key:"Teorico4",label:"Teo4"},{key:"Practico4",label:"Prac4"},{key:"PromTeorico",label:"Prom Teo"},{key:"PromPractico",label:"Prom Prac"},{key:"Promedio",label:"Prom"},{key:"PruebaRecuperacion",label:"Recup"}],e=["Estudiante","Materia",...t.map(n=>n.label)].join("	"),i=this.rows.map(n=>{let r=t.map(u=>{let f=n[u.key];return f==null?"":String(f)});return[n.estudiante,n.materia,...r].join("	")});return[e,...i].join(`
`)}snapshotState(){return{maxTeorico:this.maxTeorico,maxPractico:this.maxPractico,avgEvalCount:this.avgEvalCount,viewMode:this.viewMode,evalEnabled:[...this.evalEnabled],showSumColumns:this.showSumColumns,rows:this.rows.map(t=>({id:t.id,Teorico1:t.Teorico1,Teorico2:t.Teorico2,Teorico3:t.Teorico3,Teorico4:t.Teorico4,Practico1:t.Practico1,Practico2:t.Practico2,Practico3:t.Practico3,Practico4:t.Practico4,PruebaRecuperacion:t.PruebaRecuperacion}))}}restoreState(t){this.isRestoring=!0;try{this.maxTeorico=t.maxTeorico,this.maxPractico=t.maxPractico,this.avgEvalCount=t.avgEvalCount,this.viewMode=t.viewMode,this.evalEnabled=[...t.evalEnabled],this.showSumColumns=!!t.showSumColumns;let e=new Map(t.rows.map(i=>[i.id,i]));for(let i of this.rows){let n=e.get(i.id);n&&(i.Teorico1=n.Teorico1,i.Teorico2=n.Teorico2,i.Teorico3=n.Teorico3,i.Teorico4=n.Teorico4,i.Practico1=n.Practico1,i.Practico2=n.Practico2,i.Practico3=n.Practico3,i.Practico4=n.Practico4,i.PruebaRecuperacion=n.PruebaRecuperacion,i.__cascadeActive=!1,i.__cascadeLockFrom=null,i.__cascadeBackup=null,this.recalcInPlace(i),this.recomputeDirtyForRow(i))}}finally{this.isRestoring=!1}}isTeoricoKey(t){return t==="Teorico1"||t==="Teorico2"||t==="Teorico3"||t==="Teorico4"}isPracticoKey(t){return t==="Practico1"||t==="Practico2"||t==="Practico3"||t==="Practico4"}isReadonlyKey(t){return t==="PromTeorico"||t==="PromPractico"||t==="Promedio"}isEvaluationSeparator(t){if(this.viewMode==="intercalado"){let e=i=>this.showSumColumns?`Sum${i}`:`Practico${i}`;return this.visibleEvalCount>=1&&t===e(1)||this.visibleEvalCount>=2&&t===e(2)||this.visibleEvalCount>=3&&t===e(3)||this.visibleEvalCount>=4&&t===e(4)}return t===`Teorico${this.visibleEvalCount}`||t===`Practico${this.visibleEvalCount}`||this.showSumColumns&&t===`Sum${this.visibleEvalCount}`}isSectionStart(t){return t==="PromTeorico"}isDangerCell(t,e){let i=this.evalIndexFromColumnKey(e);if(i!==null){let n=t[`Teorico${i}`],r=t[`Practico${i}`];return typeof n=="number"&&typeof r=="number"?n+r<this.PASSING_SCORE:!1}return e==="PromTeorico"?t.PromTeorico===null?!1:t.PromTeorico*100<this.PASSING_SCORE*this.maxTeorico:e==="PromPractico"?t.PromPractico===null?!1:t.PromPractico*100<this.PASSING_SCORE*this.maxPractico:e==="Promedio"?t.Promedio!==null&&t.Promedio<this.PASSING_SCORE:e==="PruebaRecuperacion"?t.PruebaRecuperacion!==null&&t.PruebaRecuperacion<this.PASSING_SCORE:!1}evalIndexFromKey(t){switch(t){case"Teorico1":case"Practico1":return 1;case"Teorico2":case"Practico2":return 2;case"Teorico3":case"Practico3":return 3;case"Teorico4":case"Practico4":return 4;default:return null}}trimEmptyTrailingLines(t){let e=[...t];for(;e.length>0&&e[e.length-1].trim()==="";)e.pop();return e}keyToDelta(t){switch(t){case"ArrowUp":return{dr:-1,dc:0};case"ArrowDown":return{dr:1,dc:0};case"ArrowLeft":return{dr:0,dc:-1};case"ArrowRight":return{dr:0,dc:1};default:return{dr:0,dc:0}}}clamp(t,e,i){return Math.max(e,Math.min(i,t))}makeRow(t,e,i,n,r,u,f,b,C,E,I,P,D,F,k){return{id:t,infoestudiantesifas_id:e,materias_id:i,estudiante:n,materia:r,fotoUrl:u,Teorico1:f,Teorico2:b,Teorico3:C,Teorico4:E,Practico1:I,Practico2:P,Practico3:D,Practico4:F,PromTeorico:null,PromPractico:null,Promedio:null,PruebaRecuperacion:k}}};xe.\u0275fac=function(e){return new(e||xe)(O(nt),O(bt),O(ke),O(_e))},xe.\u0275cmp=$({type:xe,selectors:[["app-calificacionessolo"]],hostBindings:function(e,i){e&1&&g("keydown",function(r){return i.onGlobalKeyDown(r)},Oe)},standalone:!1,decls:73,vars:34,consts:[["sumCell",""],[1,"container-fluid","py-2"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-2"],[1,"mb-0"],[1,"text-body-secondary"],[1,"d-flex","align-items-center","gap-2"],[1,"d-flex","align-items-center","gap-2","flex-wrap"],[1,"input-group","input-group-sm",2,"width","380px"],[1,"input-group-text"],["placeholder","Apellido o nombre (min 2 letras)",1,"form-control",3,"ngModelChange","keydown.enter","ngModel"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n inscripci\xF3n",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],["role","group","aria-label","Modo de visualizaci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn",3,"click"],[1,"d-flex","align-items-center","gap-1","small"],["type","number","min","1","max","100",1,"form-control","form-control-sm",2,"width","78px",3,"ngModelChange","ngModel"],[1,"form-select","form-select-sm",2,"width","110px",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"form-check","small","mb-0"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"form-check-label"],[1,"d-flex","align-items-center","gap-2","small"],["class","form-check form-check-inline mb-0",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],["class","row g-2 mb-2",4,"ngIf"],["class","alert alert-info py-2 mb-2",4,"ngIf"],["class","alert alert-warning py-2 mb-2",4,"ngIf"],["class","alert alert-danger py-2 mb-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2",4,"ngIf"],["class","table-responsive cali-grid-wrap",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","role","dialog","aria-modal","true",4,"ngIf"],["class","modal-backdrop fade show",3,"click",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n inscripci\xF3n",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"form-check","form-check-inline","mb-0"],[1,"row","g-2","mb-2"],[1,"col-12"],[1,"card"],[1,"card-body","py-2"],[1,"small","text-body-secondary","mb-2"],[4,"ngIf"],[1,"list-group","list-group-flush"],["type","button","class","list-group-item list-group-item-action py-2",3,"active","click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"list-group-item","list-group-item-action","py-2",3,"click"],[1,"fw-semibold"],[1,"small","opacity-75"],[1,"alert","alert-info","py-2","mb-2"],[1,"small","mb-1"],[1,"small"],[1,"alert","alert-warning","py-2","mb-2"],[1,"alert","alert-danger","py-2","mb-2"],[1,"small","text-body-secondary"],["class","btn-group btn-group-sm","role","group","aria-label","Paginaci\xF3n calificaciones",4,"ngIf"],["role","group","aria-label","Paginaci\xF3n calificaciones",1,"btn-group","btn-group-sm"],[1,"table-responsive","cali-grid-wrap"],[1,"table","table-sm","table-bordered","align-middle","cali-grid"],[1,"sticky-col","col-meta"],["class","text-center",3,"width","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center",3,"ngClass"],["class","text-body-secondary",4,"ngIf"],["class","table-secondary",4,"ngIf"],[1,"d-flex","align-items-start","justify-content-between","gap-2"],[1,"text-body-secondary","small"],["class","p-1",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-secondary"],[1,"p-1",3,"ngClass"],[4,"ngIf","ngIfElse"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center",3,"ngModelChange","focus","keydown","paste","readOnly","ngModel"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center","readonly-cell",3,"focus","keydown","paste","readOnly","value"],["tabindex","-1","role","dialog","aria-modal","true",1,"modal","fade","show","d-block"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"modal-body","text-center"],["alt","Foto del estudiante",1,"img-fluid","rounded",3,"src"],[1,"text-body-secondary","small","mt-2"],[1,"modal-backdrop","fade","show",3,"click"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"h5",3),s(4,"Editor de calificaciones (BD) tipo Excel"),a(),o(5,"small",4),s(6," Edita directo en celdas. Puedes copiar desde Excel y pegar (Ctrl+V) dentro de una celda; soporta pegar bloques (tab + saltos de l\xEDnea). "),a()(),o(7,"div",5)(8,"div",6)(9,"div",7)(10,"span",8),s(11,"Buscar inscripci\xF3n"),a(),o(12,"input",9),g("ngModelChange",function(r){return i.filterInfo=r})("keydown.enter",function(){return i.buscarInfo(1)}),a(),o(13,"button",10),g("click",function(){return i.buscarInfo(1)}),s(14," Buscar "),a()(),h(15,Mt,5,2,"div",11),o(16,"button",12),g("click",function(){return i.limpiarInfo()}),s(17," Limpiar "),a()(),o(18,"div",13)(19,"button",14),g("click",function(){return i.setViewMode("intercalado")}),s(20," Intercalado (Eval1..4) "),a(),o(21,"button",14),g("click",function(){return i.setViewMode("agrupado")}),s(22," Agrupado (Teo/Prac) "),a()(),o(23,"div",6)(24,"div",15)(25,"span",4),s(26,"L\xEDmite Teo"),a(),o(27,"input",16),g("ngModelChange",function(r){return i.onMaxTeoricoInput(r)}),a()(),o(28,"div",15)(29,"span",4),s(30,"L\xEDmite Prac"),a(),o(31,"input",16),g("ngModelChange",function(r){return i.onMaxPracticoInput(r)}),a()(),o(32,"div",6)(33,"div",15)(34,"span",4),s(35,"Promedio usa"),a(),o(36,"select",17),g("ngModelChange",function(r){return i.onAvgEvalCountInput(r)}),o(37,"option",18),s(38,"1 eval"),a(),o(39,"option",18),s(40,"2 eval"),a(),o(41,"option",18),s(42,"3 eval"),a(),o(43,"option",18),s(44,"4 eval"),a()()()()(),o(45,"div",6)(46,"label",19)(47,"input",20),g("ngModelChange",function(r){return i.onShowSumColumnsChange(r)}),a(),o(48,"span",21),s(49,"Mostrar sumas"),a()(),o(50,"div",22)(51,"span",4),s(52,"Evaluaciones"),a(),h(53,Tt,4,1,"label",23)(54,Pt,4,1,"label",23)(55,Ot,4,1,"label",23)(56,Dt,4,1,"label",23),a(),o(57,"button",24),g("click",function(){return i.setAllEvaluations(!0)}),s(58," Todas "),a()(),o(59,"button",12),g("click",function(){return i.focusCell(0,0)}),s(60," Ir a primera celda "),a(),o(61,"button",25),g("click",function(){return i.copyAllToClipboard()}),s(62," Copiar todo "),a(),o(63,"button",26),g("click",function(){return i.guardarCambios()}),s(64," Guardar cambios "),a()()(),h(65,Vt,9,4,"div",27)(66,Rt,17,0,"div",28)(67,Gt,4,2,"div",29)(68,jt,3,1,"div",30)(69,Ut,17,6,"div",31)(70,Yt,9,4,"div",32)(71,Zt,11,3,"div",33)(72,Jt,1,0,"div",34),a()),e&2&&(c(12),d("ngModel",i.filterInfo),c(),d("disabled",i.isLoadingInfo),c(2),d("ngIf",i.infoMeta),c(),d("disabled",!i.selectedInfo),c(3),j("btn-primary",i.viewMode==="intercalado")("btn-outline-primary",i.viewMode!=="intercalado"),c(2),j("btn-primary",i.viewMode==="agrupado")("btn-outline-primary",i.viewMode!=="agrupado"),c(6),d("ngModel",i.maxTeorico),c(4),d("ngModel",i.maxPractico),c(5),d("ngModel",i.avgEvalCount),c(),d("ngValue",1),c(2),d("ngValue",2),c(2),d("ngValue",3),c(2),d("ngValue",4),c(4),d("ngModel",i.showSumColumns),c(6),d("ngIf",i.visibleEvalCount>=1),c(),d("ngIf",i.visibleEvalCount>=2),c(),d("ngIf",i.visibleEvalCount>=3),c(),d("ngIf",i.visibleEvalCount>=4),c(3),d("disabled",i.rows.length===0),c(4),d("disabled",!i.selectedInfo||i.dirtyIds.size===0||i.isSaving),c(2),d("ngIf",i.infoItems.length>0),c(),d("ngIf",!i.selectedInfo),c(),d("ngIf",i.selectedInfo&&(i.isLoadingCalificaciones||i.isSaving)),c(),d("ngIf",i.saveError),c(),d("ngIf",i.selectedInfo),c(),d("ngIf",i.selectedInfo),c(),d("ngIf",i.photoModalOpen),c(),d("ngIf",i.photoModalOpen))},dependencies:[de,U,W,q,X,K,Ve,Ne,Q,z,pt,ut,H],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.cali-grid-wrap[_ngcontent-%COMP%]{max-height:calc(100vh - 220px)}.cali-grid[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:3;background:var(--bs-body-bg)}.col-meta[_ngcontent-%COMP%]{min-width:240px;background:inherit}.sticky-col[_ngcontent-%COMP%]{position:sticky;left:0;z-index:2;background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th.col-meta[_ngcontent-%COMP%]{background:var(--bs-body-bg)}.cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr.table-active[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--bs-table-active-bg)}.cali-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.readonly-cell[_ngcontent-%COMP%]{background:#0000000a}.cali-grid[_ngcontent-%COMP%]   td.eval-end[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.eval-end[_ngcontent-%COMP%]{border-right-width:3px;border-right-style:solid;border-right-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.section-start[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   th.section-start[_ngcontent-%COMP%]{border-left-width:3px;border-left-style:solid;border-left-color:color-mix(in srgb,var(--bs-body-color) 55%,var(--bs-border-color))}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%]{color:var(--bs-danger);font-weight:600}.cali-grid[_ngcontent-%COMP%]   td.cell-danger[_ngcontent-%COMP%]   input.form-control.readonly-cell[_ngcontent-%COMP%]{color:var(--bs-danger)}.cali-grid[_ngcontent-%COMP%]   input.form-control[_ngcontent-%COMP%], .cali-grid[_ngcontent-%COMP%]   select.form-select[_ngcontent-%COMP%]{border-radius:0}']});var je=xe;var ei=["modalgestioncontroles"];function ti(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function ii(l,t){l&1&&(o(0,"div",29),s(1," Cargando controles... "),a())}function ni(l,t){if(l&1&&(o(0,"div",49),s(1),a()),l&2){let e=m().$implicit,i=m(3).$implicit,n=m(3);c(),ne(" ",n.labelEdadesCategoria(i),": ",e.Edades||"-"," ")}}function oi(l,t){if(l&1&&(o(0,"span",49),s(1),a()),l&2){let e=m().$implicit,i=m(6);c(),y("Instituci\xF3n: ",i.getNombreInstitucion(e)||(e.instituciones_id??"GLOBAL"))}}function ai(l,t){l&1&&(o(0,"span",49),s(1,"|"),a())}function ri(l,t){if(l&1){let e=S();o(0,"div",44)(1,"div",45)(2,"div",46),s(3),a(),h(4,ni,2,2,"div",47)(5,oi,2,1,"span",47)(6,ai,2,0,"span",47),o(7,"div",48)(8,"span",49),s(9,"Estado:"),a(),o(10,"button",50),g("click",function(n){let r=p(e).$implicit,u=m(6);return _(u.toggleEstadoFila(r,n))}),s(11),a(),o(12,"span",49),s(13,"|"),a(),o(14,"span",49),s(15,"Visibilidad:"),a(),o(16,"button",51),g("click",function(n){let r=p(e).$implicit,u=m(6);return _(u.toggleVisibilidadFila(r,n))}),s(17),a()()(),o(18,"div",52)(19,"button",53),g("click",function(){let n=p(e).$implicit,r=m(6);return _(r.Seleccionarcontroles(n.id))}),s(20,"Editar"),a(),o(21,"button",54),g("click",function(){let n=p(e).$implicit,r=m(6);return _(r.Eliminarcontroles(n.id))}),s(22,"Eliminar"),a()()()}if(l&2){let e=t.$implicit,i=m(3).$implicit,n=m(3);c(3),x(e.ParaI),c(),d("ngIf",n.showEdadesCategoria(i)),c(),d("ngIf",n.esSuperlcchs),c(),d("ngIf",n.esSuperlcchs),c(4),d("ngClass",e.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(e.id)),c(),y(" ",e.Estado," "),c(5),d("ngClass",e.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(e.id)),c(),y(" ",e.Visibilidad," ")}}function si(l,t){if(l&1&&(o(0,"div",42),h(1,ri,23,10,"div",43),a()),l&2){let e=m().ngIf;c(),d("ngForOf",e)}}function li(l,t){l&1&&(o(0,"div",55),s(1,"Sin datos"),a())}function ci(l,t){if(l&1){let e=S();o(0,"div",34)(1,"div",35)(2,"div",36)(3,"h4",37),s(4),a()(),o(5,"div",38),s(6),a(),o(7,"button",39),g("click",function(){p(e);let n=m().$implicit,r=m(3);return _(r.abrirNuevoPorCategoria(n))}),s(8," Nuevo "),a()(),o(9,"div",40),h(10,si,2,1,"div",41)(11,li,2,0,"ng-template",null,1,B),a()()}if(l&2){let e=t.ngIf,i=Ie(12),n=m().$implicit;c(4),y("",n," "),c(2),y(" ",e.length," item(s) "),c(4),d("ngIf",e.length>0)("ngIfElse",i)}}function di(l,t){if(l&1&&(o(0,"div",32),h(1,ci,13,4,"div",33),a()),l&2){let e=t.$implicit,i=m(3);c(),d("ngIf",i.getControlesPorCategoria(e))}}function mi(l,t){if(l&1&&(o(0,"div",30),h(1,di,2,1,"div",31),a()),l&2){let e=m(2);c(),d("ngForOf",e.categoriasParaMostrar)}}function ui(l,t){if(l&1&&(o(0,"div",26),h(1,ii,2,0,"div",27)(2,mi,2,1,"div",28),a()),l&2){let e=m();c(),d("ngIf",e.isLoadingcontroles),c(),d("ngIf",!e.isLoadingcontroles)}}function pi(l,t){l&1&&(o(0,"th",67),s(1,"NombreInstitucion"),a())}function _i(l,t){if(l&1&&(o(0,"tr")(1,"td",59)(2,"div",68)(3,"span",69),s(4,"Cargando..."),a()()()()),l&2){let e=m(2);c(),Z("colspan",e.esSuperlcchs?9:8)}}function gi(l,t){if(l&1&&(o(0,"tr")(1,"td",59),s(2,"No hay datos disponibles"),a()()),l&2){let e=m(2);c(),Z("colspan",e.esSuperlcchs?9:8)}}function fi(l,t){if(l&1&&(o(0,"td"),s(1),a()),l&2){let e=m().$implicit,i=m(2);c(),x(i.getNombreInstitucion(e))}}function hi(l,t){if(l&1&&v(0,"img",76),l&2){let e=m(3);d("src",e._tools.rutabtniconsanimaciones+"pencil.svg",ye)}}function xi(l,t){if(l&1&&v(0,"ng-lottie",77),l&2){let e=m(3);d("options",e._tools.optionsEditar)}}function vi(l,t){if(l&1&&v(0,"img",76),l&2){let e=m(3);d("src",e._tools.rutabtniconsanimaciones+"delete.svg",ye)}}function bi(l,t){if(l&1&&v(0,"ng-lottie",77),l&2){let e=m(3);d("options",e._tools.optionsEliminar)}}function Ci(l,t){if(l&1){let e=S();o(0,"tr",70),g("contextmenu",function(n){let r=p(e).$implicit,u=m(2);return _(u.abrirMenucontroles(n,r))}),o(1,"td",59),s(2),a(),o(3,"td"),s(4),a(),h(5,fi,2,1,"td",62),o(6,"td"),s(7),a(),o(8,"td"),s(9),a(),o(10,"td"),s(11),a(),o(12,"td")(13,"button",50),g("click",function(n){let r=p(e).$implicit,u=m(2);return _(u.toggleEstadoFila(r,n))}),s(14),a()(),o(15,"td")(16,"button",51),g("click",function(n){let r=p(e).$implicit,u=m(2);return _(u.toggleVisibilidadFila(r,n))}),s(17),a()(),o(18,"td",71)(19,"button",72),g("click",function(){let n=p(e).$implicit,r=m(2);return _(r.Seleccionarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,r=m(2);return _(r._tools.hoverBotonMap["edicioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,r=m(2);return _(r._tools.hoverBotonMap["edicioncontroles-"+n.id]=!1)}),h(20,hi,1,1,"img",73)(21,xi,1,1,"ng-lottie",74),a(),o(22,"button",75),g("click",function(){let n=p(e).$implicit,r=m(2);return _(r.Eliminarcontroles(n.id))})("mouseenter",function(){let n=p(e).$implicit,r=m(2);return _(r._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!0)})("mouseleave",function(){let n=p(e).$implicit,r=m(2);return _(r._tools.hoverBotonMap["eliminacioncontroles-"+n.id]=!1)}),h(23,vi,1,1,"img",73)(24,bi,1,1,"ng-lottie",74),a()()()}if(l&2){let e=t.index,i=t.$implicit,n=m(2);c(2),x((n.paginacontroles-1)*n.pageSizecontroles+(e+1)),c(2),x(i.instituciones_id??"GLOBAL"),c(),d("ngIf",n.esSuperlcchs),c(2),x(i.Categoria),c(2),x(i.ParaI),c(2),x(i.Edades),c(2),d("ngClass",i.Estado==="ACTIVO"?"btn-outline-success":"btn-outline-secondary")("disabled",n.isTogglingEstado(i.id)),c(),y(" ",i.Estado," "),c(2),d("ngClass",i.Visibilidad==="VISIBLE"?"btn-outline-primary":"btn-outline-secondary")("disabled",n.isTogglingVisibilidad(i.id)),c(),y(" ",i.Visibilidad," "),c(3),d("ngIf",!n._tools.hoverBotonMap["edicioncontroles-"+i.id]),c(),d("ngIf",n._tools.hoverBotonMap["edicioncontroles-"+i.id]),c(2),d("ngIf",!n._tools.hoverBotonMap["eliminacioncontroles-"+i.id]),c(),d("ngIf",n._tools.hoverBotonMap["eliminacioncontroles-"+i.id])}}function Si(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),y("",e," por p\xE1gina")}}function Ei(l,t){if(l&1){let e=S();o(0,"div",26)(1,"div",56)(2,"table",57)(3,"thead",58)(4,"tr")(5,"th",59),s(6,"#"),a(),o(7,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("instituciones_id",n))}),s(8,"Instituci\xF3n"),a(),h(9,pi,2,0,"th",61),o(10,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("Categoria",n))}),s(11,"Categoria"),a(),o(12,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("ParaI",n))}),s(13,"ParaI"),a(),o(14,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("Edades",n))}),s(15,"Edades"),a(),o(16,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("Estado",n))}),s(17,"Estado"),a(),o(18,"th",60),g("click",function(n){p(e);let r=m();return _(r.sortBycontroles("Visibilidad",n))}),s(19,"Visibilidad"),a(),o(20,"th",59),s(21,"ACCIONES"),a()()(),o(22,"tbody"),h(23,_i,5,1,"tr",62)(24,gi,3,1,"tr",62)(25,Ci,25,16,"tr",63),ot(26,"slice"),a()()(),o(27,"div",64)(28,"ngb-pagination",65),T("pageChange",function(n){p(e);let r=m();return M(r.paginacontroles,n)||(r.paginacontroles=n),_(n)}),a(),o(29,"select",66),T("ngModelChange",function(n){p(e);let r=m();return M(r.pageSizecontroles,n)||(r.pageSizecontroles=n),_(n)}),g("change",function(){p(e);let n=m();return _(n.onPageSizeChangecontroles())}),h(30,Si,2,2,"option",23),a()()()}if(l&2){let e=m();c(9),d("ngIf",e.esSuperlcchs),c(14),d("ngIf",e.isLoadingcontroles),c(),d("ngIf",!e.isLoadingcontroles&&(!e.controles||e.controles.length===0)),c(),d("ngForOf",at(26,13,e.controlesFiltrados,(e.paginacontroles-1)*e.pageSizecontroles,e.paginacontroles*e.pageSizecontroles)),c(3),w("page",e.paginacontroles),d("collectionSize",e.controlesFiltrados.length)("pageSize",e.pageSizecontroles)("maxSize",5)("rotate",!0)("ellipses",!1)("boundaryLinks",!0),c(),w("ngModel",e.pageSizecontroles),c(),d("ngForOf",e.pageSizeOptionscontroles)}}function yi(l,t){if(l&1&&(o(0,"option",97),s(1),a()),l&2){let e=t.$implicit;d("ngValue",e.id),c(),x(e.Nombre)}}function Ii(l,t){if(l&1&&(o(0,"div",84)(1,"select",96)(2,"option",97),s(3,"GLOBAL"),a(),h(4,yi,2,2,"option",98),a(),o(5,"label"),s(6,"Instituci\xF3n"),a()()),l&2){let e=m(2);c(2),d("ngValue",""),c(2),d("ngForOf",e.institucionesInfo)}}function wi(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Mi(l,t){if(l&1&&(o(0,"div",84),v(1,"input",99),o(2,"label"),s(3),a()()),l&2){let e=m(2);c(3),x(e.labelNivelCurso)}}function Ti(l,t){if(l&1&&(o(0,"div",84),v(1,"input",100),o(2,"label"),s(3),a()()),l&2){let e=m(2);c(3),x(e.labelEdades)}}function Pi(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Oi(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Di(l,t){if(l&1){let e=S();o(0,"button",103),g("click",function(){p(e);let n=m(3);return _(n.AutoCompletarLastcontroles())}),o(1,"span",104),v(2,"ng-lottie",105),a(),o(3,"span"),s(4,"AUTO COMPLETAR "),a(),v(5,"span",10),a()}if(l&2){let e=m(3);c(2),d("options",e._tools.optionsautocompletar)}}function Ai(l,t){if(l&1&&(o(0,"div",101),h(1,Di,6,1,"button",102),a()),l&2){let e=m(2);c(),d("ngIf",!e.AnimacionCargabtnModalcontroles)}}function Li(l,t){if(l&1){let e=S();o(0,"button",106),g("click",function(){p(e);let n=m().$implicit,r=m();return n.dismiss(),_(r.resetcontroles())}),o(1,"span",104),v(2,"ng-lottie",105),a(),o(3,"span"),s(4,"CANCELAR"),a(),v(5,"span",10),a()}if(l&2){let e=m(2);c(2),d("options",e._tools.optionscancelar)}}function Ni(l,t){if(l&1){let e=S();o(0,"button",107),g("click",function(){p(e);let n=m(2);return _(n.AgregarModificarcontroles())}),v(1,"span",108),a()}l&2&&d("disabled",!0)}function Vi(l,t){if(l&1){let e=S();o(0,"button",109),g("click",function(){p(e);let n=m(2);return _(n.AgregarModificarcontroles())}),o(1,"span",104),v(2,"ng-lottie",105),a(),o(3,"span"),s(4),a(),v(5,"span",10),a()}if(l&2){let e,i,n=m(2);c(2),d("options",(e=n.newcontroles.get("id"))!=null&&e.value?n._tools.optionsEditar:n._tools.optionsAdicionar),c(2),x((i=n.newcontroles.get("id"))!=null&&i.value?"MODIFICAR":"REGISTRAR")}}function Ri(l,t){if(l&1){let e=S();o(0,"div",78)(1,"h4",79),s(2),a(),o(3,"button",80),g("click",function(){let n=p(e).$implicit,r=m();return n.dismiss(),_(r.resetcontroles())}),a()(),o(4,"div",81)(5,"form",82),h(6,Ii,7,2,"div",83),o(7,"div",84)(8,"select",85)(9,"option",22),s(10,"SELECCIONE"),a(),h(11,wi,2,2,"option",23),a(),o(12,"label"),s(13,"Categoria"),a()(),o(14,"div",84),v(15,"input",86),o(16,"label"),s(17),a()(),h(18,Mi,4,1,"div",83)(19,Ti,4,1,"div",83),o(20,"div",84)(21,"select",87),h(22,Pi,2,2,"option",23),a(),o(23,"label"),s(24,"Estado"),a()(),o(25,"div",84)(26,"select",88),h(27,Oi,2,2,"option",23),a(),o(28,"label"),s(29,"Visibilidad"),a()()()(),o(30,"div",89),h(31,Ai,2,1,"div",90),o(32,"div",91),h(33,Li,6,1,"button",92),a(),o(34,"div",93),h(35,Ni,2,1,"button",94)(36,Vi,6,2,"button",95),a()()}if(l&2){let e,i=m();c(2),y("",(e=i.newcontroles.get("id"))!=null&&e.value?"Modificar":"Registrar"," control"),c(3),d("formGroup",i.newcontroles),c(),d("ngIf",i.esSuperlcchs),c(5),d("ngForOf",i.categoriasOptionsForm),c(6),x(i.labelParaI),c(),d("ngIf",i.showNivelCurso),c(),d("ngIf",i.showEdades),c(3),d("ngForOf",i.estadoOptions),c(5),d("ngForOf",i.visibilidadOptions),c(4),d("ngIf",!i.newcontroles.get("id").value),c(2),d("ngIf",!i.AnimacionCargabtnModalcontroles),c(2),d("ngIf",i.AnimacionCargabtnModalcontroles),c(),d("ngIf",!i.AnimacionCargabtnModalcontroles)}}var ve=class ve{constructor(t,e,i,n){this._cont=t;this._tools=e;this._auth=i;this._inst=n;this.esSuperlcchs=!1;this.esAdministrativo=!1;this.institucionesIdSesion=null;this.institucionesInfo=[];this.institucionesById=new Map;this.estadoOptions=["ACTIVO","INACTIVO"];this.visibilidadOptions=["VISIBLE","OCULTO"];this.categoriasGlobales=["CARGOS SUPERADMINISTRATIVOS","PERMISO","ESTADO","VISIBILIDAD","SEXO","CARACTER\xCDSTICAS DE INSTITUCI\xD3N","EDICI\xD3N DE INSCRIPCIONES","EDICI\xD3N DE CALIFICACIONES","PREDETERMINADO","TIPOS SUPERADMINISTRATIVOS","TIPOS PLANTEL ADMINISTRATIVOS","TIPOS DOCENTES","ESTADO DE HABILITACI\xD3N","TIPOS MATERIAS","MODOS MATERIAS","RELACI\xD3N DOCENTE ESTUDIANTES","PROGRAMA","MODALIDAD","TIPO DE ESTUDIANTE"];this.categoriasPorInstitucion=["CARGOS ADMINISTRATIVOS","CARGOS DOCENTES","NIVEL DE CARRERA","ESPECIALIDAD","ESPECIALIDAD SECUNDARIA","LVLCURSO","NIVEL EN COLEGIO","GRADO DE COLEGIO","TIPO COLEGIO","TIPO REGISTRO DE MATERIA","ESTADO PAGO","EXPEDIDO","TURNO","VERIFICACI\xD3N INSCRIPCIONES"];this.togglingEstadoIds=new Set;this.togglingVisibilidadIds=new Set;this.viewMode="interactive";this.categoriaFiltro="";this.menuStatecontroles$=this._tools.state$;this.controles=[];this.paginacontroles=1;this.isLoadingcontroles=!0;this.AnimacionCargabtnModalcontroles=!1;this.filtertxtcontroles="";this.collectionSizecontroles=0;this.pageSizecontroles=10;this.pageSizeOptionscontroles=[5,10,20,50];this.sortColumnscontroles=[]}get categoriasOptions(){return this.esSuperlcchs?[...this.categoriasGlobales,...this.categoriasPorInstitucion]:[...this.categoriasPorInstitucion]}get categoriasOptionsForm(){return this.categoriasOptions}ngOnInit(){this.newcontroles=this._cont.createFormGroupcontroles(),this.newcontrolesAnteriorAccion=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this.cargarSesionYPermisos()}cargarSesionYPermisos(){this._auth.pedirPerfil().subscribe({next:t=>{let e=(t?.tipo??"").toString().toLowerCase();this.esSuperlcchs=e==="superlcchs",this.esAdministrativo=e==="planteladministrativos";let i=Number(t?.usuario?.instituciones_id??0);this.institucionesIdSesion=Number.isFinite(i)&&i>0?i:null,this.applyCategoriaRules(),this.esSuperlcchs&&this._inst.Obtenerinstituciones().subscribe({next:n=>{this.institucionesInfo=n?.data||[],this.institucionesById=new Map((this.institucionesInfo||[]).map(r=>[String(r?.id??""),r]))},error:()=>{this.institucionesInfo=[],this.institucionesById=new Map}}),this.Cargarcontroles()},error:()=>{this.esSuperlcchs=!1,this.esAdministrativo=!1,this.institucionesIdSesion=null,this.applyCategoriaRules(),this.Cargarcontroles()}})}upperTrim(t){return(t??"").toString().trim().toUpperCase()}isCategoriaGlobal(t){return this.categoriasGlobales.includes(t)}puedeEditarFila(t){if(this.esSuperlcchs)return!0;let e=Number(this.institucionesIdSesion??0),i=Number(t?.instituciones_id??0);return e>0&&i===e}getNombreInstitucion(t){let e=(t?.NombreInstitucion??t?.nombre_institucion??t?.institucion_nombre??"").toString().trim();if(e)return e;let i=String(t?.instituciones_id??""),n=this.institucionesById.get(i);return(n?.Nombre??n?.nombre??"").toString().trim()}get categoriaActual(){return this.upperTrim(this.newcontroles?.get("Categoria")?.value)}get categoriaFiltroActual(){return this.upperTrim(this.categoriaFiltro)}get categoriasParaMostrar(){let t=this.categoriaFiltroActual;return t?this.categoriasOptions.filter(e=>this.upperTrim(e)===t):this.categoriasOptions}get showEdades(){return this.categoriaActual==="LVLCURSO"||this.categoriaActual==="TURNO"}categoriaUsaNivelCurso(t){let e=this.upperTrim(t);return e==="TIPOS DOCENTES"||e==="MODOS MATERIAS"||e==="RELACI\xD3N DOCENTE ESTUDIANTES"}get showNivelCurso(){let t=this.categoriaActual,e=(this.newcontroles?.get("NivelCurso")?.value??"").toString().trim();return this.categoriaUsaNivelCurso(t)||e.length>0}get labelNivelCurso(){switch(this.categoriaActual){case"TIPOS DOCENTES":case"MODOS MATERIAS":case"RELACI\xD3N DOCENTE ESTUDIANTES":return"Detalle";default:return"NivelCurso"}}get labelEdades(){return this.categoriaActual==="TURNO"?"Horas":"Edades"}get labelParaI(){switch(this.categoriaActual){case"LVLCURSO":return"Nivel/Curso";case"TURNO":return"Turno";case"EXPEDIDO":return"Sigla";default:return"Valor"}}applyCategoriaRules(){let t=this.categoriaActual;t&&this.newcontroles.get("Categoria")?.value!==t&&this.newcontroles.get("Categoria")?.setValue(t,{emitEvent:!1});let e=this.upperTrim(this.newcontroles.get("Estado")?.value);this.estadoOptions.includes(e)||this.newcontroles.get("Estado")?.setValue("ACTIVO",{emitEvent:!1});let i=this.upperTrim(this.newcontroles.get("Visibilidad")?.value);this.visibilidadOptions.includes(i)||this.newcontroles.get("Visibilidad")?.setValue("VISIBLE",{emitEvent:!1});let n=this.newcontroles.get("instituciones_id");n&&(this.esSuperlcchs?t&&this.isCategoriaGlobal(t)?(n.setValue("",{emitEvent:!1}),n.disable({emitEvent:!1})):n.enable({emitEvent:!1}):(this.institucionesIdSesion&&n.setValue(this.institucionesIdSesion,{emitEvent:!1}),n.disable({emitEvent:!1}))),this.showEdades||this.newcontroles.get("Edades")?.setValue("",{emitEvent:!1}),this.showNivelCurso||this.newcontroles.get("NivelCurso")?.setValue("",{emitEvent:!1})}buildPayloadFromForm(){let t=this.newcontroles.getRawValue(),e=ie({},t);return delete e.created_at,delete e.updated_at,this.showEdades||(e.Edades=""),this.showNivelCurso||(e.NivelCurso=""),e}setViewMode(t){this.viewMode=t,this.paginacontroles=1}onCategoriaFiltroChange(){this.paginacontroles=1}get controlesFiltrados(){let t=this.categoriaFiltroActual,e=this.upperTrim(this.filtertxtcontroles);return(this.controles||[]).filter(i=>{if(t&&this.upperTrim(i?.Categoria)!==t)return!1;if(!e)return!0;let n=[i?.instituciones_id,i?.Categoria,i?.ParaI,i?.Edades,i?.Estado,i?.Visibilidad].map(r=>(r??"").toString()).join(" ");return this.upperTrim(n).includes(e)})}getControlesPorCategoria(t){let e=this.upperTrim(t);return this.controlesFiltrados.filter(i=>this.upperTrim(i?.Categoria)===e)}labelEdadesCategoria(t){return this.upperTrim(t)==="TURNO"?"Horas":"Edades"}showEdadesCategoria(t){let e=this.upperTrim(t);return e==="LVLCURSO"||e==="TURNO"}abrirNuevoPorCategoria(t){this.resetcontroles();let e=this.upperTrim(t);e&&(this.newcontroles.get("Categoria")?.setValue(e),this.applyCategoriaRules()),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl")}isTogglingEstado(t){return this.togglingEstadoIds.has(Number(t))}isTogglingVisibilidad(t){return this.togglingVisibilidadIds.has(Number(t))}toggleEstadoFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingEstadoIds.has(i))return;let n=this.upperTrim(t?.Estado),r=n==="ACTIVO"?"INACTIVO":"ACTIVO";this.togglingEstadoIds.add(i),t.Estado=r,this._cont.Modificarcontroles({id:i,Estado:r},i).subscribe({next:u=>{t.Estado=this.upperTrim(u?.data?.Estado??r)},error:u=>{console.error("Error toggling Estado",u),t.Estado=n},complete:()=>{this.togglingEstadoIds.delete(i)}})}toggleVisibilidadFila(t,e){if(e?.stopPropagation(),!this.puedeEditarFila(t)){this._tools.MostrarMensaje("warning","No autorizado");return}let i=Number(t?.id);if(!Number.isFinite(i)||i<=0||this.togglingVisibilidadIds.has(i))return;let n=this.upperTrim(t?.Visibilidad),r=n==="VISIBLE"?"OCULTO":"VISIBLE";this.togglingVisibilidadIds.add(i),t.Visibilidad=r,this._cont.Modificarcontroles({id:i,Visibilidad:r},i).subscribe({next:u=>{t.Visibilidad=this.upperTrim(u?.data?.Visibilidad??r)},error:u=>{console.error("Error toggling Visibilidad",u),t.Visibilidad=n},complete:()=>{this.togglingVisibilidadIds.delete(i)}})}setupCategoriaWatcher(){this.categoriaSub&&(this.categoriaSub.unsubscribe(),this.categoriaSub=void 0),this.categoriaSub=this.newcontroles.get("Categoria")?.valueChanges.subscribe(()=>{this.applyCategoriaRules()}),this.applyCategoriaRules()}closeMenu(){this._tools.close()}abrirMenucontroles(t,e){t.preventDefault(),t.stopPropagation();let i=[{label:"\u270F Editar",action:()=>this.Seleccionarcontroles(e.id)},{label:"\u{1F5D1}\uFE0F Eliminar",action:()=>this.Eliminarcontroles(e.id)}];this._tools.open(t.clientX,t.clientY,i)}Cargarcontroles(){this.isLoadingcontroles=!0,this._cont.Obtenercontroles().subscribe({next:t=>{let e=t.data||[];if(!this.esSuperlcchs&&this.institucionesIdSesion){let i=Number(this.institucionesIdSesion);this.controles=e.filter(n=>Number(n?.instituciones_id??0)===i)}else this.esSuperlcchs?this.controles=e:this.controles=[];this.collectionSizecontroles=this.controles.length,this.isLoadingcontroles=!1},error:t=>{console.error("Error al cargar controles",t),this.controles=[],this.collectionSizecontroles=0,this.isLoadingcontroles=!1}})}AgregarModificarcontroles(){if(this.newcontroles.invalid){this.ValidacionTodoElementocontroles(),this._tools.MostrarMensajeFrmIncompleto(),this.AnimacionCargabtnModalcontroles=!1;return}this.AnimarCargaTablacontroles(),this.AnimacionCargabtnModalcontroles=!0,this._tools.MostrarMensajeLoading(),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue());let t=this.newcontroles.controls.id.value,e=this.buildPayloadFromForm();t?this._cont.Modificarcontroles(e,e.id).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL MODIFICAR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()}):this._cont.Agregarcontroles(e).subscribe(i=>{this.Cargarcontroles(),this.resetcontroles(),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL A\xD1ADIR controles",i),this.AnimacionCargabtnModalcontroles=!1,this._tools.MostrarMensajeError()})}Seleccionarcontroles(t){if(this._tools.MostrarMensajeLoading(),!t)return;let e=this.controles.find(i=>i.id===t);if(e){if(!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._cont.Seleccionarcontroles(t).subscribe(i=>{Object.keys(this.newcontroles.controls).forEach(n=>{this.newcontroles.controls[n].setValue(i.data[n])}),this.newcontrolesAnteriorAccion.patchValue(this.newcontroles.getRawValue()),this.applyCategoriaRules(),this.modalGestioncontrolesRef=this._tools.openModal(this.modalgestioncontroles,"xl"),this._tools.MostrarMensajeSuccess()},i=>{console.log("ERROR AL SELECCIONAR controles",i),this._tools.MostrarMensajeError()})}}Eliminarcontroles(t){let e=this.controles.find(i=>i.id===t);if(e&&!this.puedeEditarFila(e)){this._tools.MostrarMensaje("warning","No autorizado");return}this._tools.mostrarMensajeConfirm("\xBFSEGURO QUE DESEA ELIMINAR?","SE ELIMINARA EL DATO Y NO SE PODR\xC1 RECUPERAR EL DATO","warning","SI, ESTOY SEGURO","NO").then(i=>{i&&(this._tools.MostrarMensajeLoading(),this._cont.Eliminarcontroles(t).subscribe(n=>{this.Cargarcontroles(),this._tools.MostrarMensajeSuccess()},n=>{console.log("ERROR AL ELIMINAR controles",n),this._tools.MostrarMensajeError()}))})}resetcontroles(){this.newcontroles=this._cont.createFormGroupcontroles(),this.setupCategoriaWatcher(),this._tools.closeModal(this.modalGestioncontrolesRef)}AutoCompletarLastcontroles(){this.newcontroles.patchValue(this.newcontrolesAnteriorAccion.getRawValue()),this.newcontroles.patchValue({id:0})}AnimarCargaTablacontroles(){this.controles=[],this.isLoadingcontroles=!0}ValidacioncontrolesxElemento(t){return this._tools.obtenerValidationClass(this.newcontroles,t)}ValidacionTodoElementocontroles(){Object.values(this.newcontroles.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()})}onPageSizeChangecontroles(){this.paginacontroles=1}sortBycontroles(t,e){this.sortColumnscontroles=this._tools.handleSort(t,e,this.sortColumnscontroles),this.controles=this._tools.applyMultiSort(this.controles,this.sortColumnscontroles)}isSortedcontroles(t){return this._tools.isSorted(this.sortColumnscontroles,t)}getSortDircontroles(t){return this._tools.getSortDirection(this.sortColumnscontroles,t)}};ve.\u0275fac=function(e){return new(e||ve)(O(ft),O(fe),O(_e),O(_t))},ve.\u0275cmp=$({type:ve,selectors:[["app-controles"]],viewQuery:function(e,i){if(e&1&&J(ei,7),e&2){let n;ee(n=te())&&(i.modalgestioncontroles=n.first)}},hostBindings:function(e,i){e&1&&g("click",function(){return i.closeMenu()},Oe)},standalone:!1,decls:41,vars:11,consts:[["modalgestioncontroles",""],["emptyCat",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"button","col-sm-3","d-flex","justify-content-start"],[1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"],["width","30px","height","30px",3,"options"],[1,"dir-part"],[1,"col-sm-3","ms-auto","d-flex","justify-content-end"],[1,"input-group"],[1,"input-group-text"],[1,"form-floating"],["type","text","placeholder","Buscar","title","Filtrar/Buscar",1,"form-control",3,"input","ngModelChange","ngModel"],[1,"row","mt-3","align-items-end",2,"row-gap","10px"],[1,"col-sm-4"],["role","group","aria-label","Modo",1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"col-sm-5"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[3,"value"],[1,"mt-4"],["class","alert alert-secondary","style","margin-bottom: 0;",4,"ngIf"],["class","row","style","row-gap: 14px;",4,"ngIf"],[1,"alert","alert-secondary",2,"margin-bottom","0"],[1,"row",2,"row-gap","14px"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12"],["class","card",4,"ngIf"],[1,"card"],[1,"card-header","d-flex","align-items-center","justify-content-between","col-sm-12",2,"gap","10px"],[1,"col-sm-8"],[1,"fw-bold","text-center","text-danger"],[1,"small","text-secondary","col-sm-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"card-body",2,"padding","0"],["class","list-group list-group-flush",4,"ngIf","ngIfElse"],[1,"list-group","list-group-flush"],["class","list-group-item d-flex align-items-center justify-content-between flex-row","style","gap: 12px;",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","align-items-center","justify-content-between","flex-row",2,"gap","12px"],[1,"d-flex","align-items-center","flex-wrap","justify-content-between",2,"gap","12px","min-width","0","width","100%"],[1,"fw-semibold","text-truncate",2,"max-width","180px"],["class","small text-secondary",4,"ngIf"],[1,"d-flex","align-items-center","ms-auto",2,"gap","8px"],[1,"small","text-secondary"],["type","button","title","Cambiar Estado",1,"btn","btn-sm",3,"click","ngClass","disabled"],["type","button","title","Cambiar Visibilidad",1,"btn","btn-sm",3,"click","ngClass","disabled"],[1,"d-flex",2,"gap","8px","flex-shrink","0"],["title","Editar",1,"btn","btn-outline-warning","btn-sm",3,"click"],["title","Eliminar",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"p-3","text-center","text-secondary"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,""],[1,"text-center"],[2,"user-select","none",3,"click"],["style","user-select:none;",4,"ngIf"],[4,"ngIf"],["style","cursor: pointer;",3,"contextmenu",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-3"],["previousLabel","Anterior","nextLabel","Siguiente",3,"pageChange","page","collectionSize","pageSize","maxSize","rotate","ellipses","boundaryLinks"],[1,"form-select",2,"width","auto",3,"ngModelChange","change","ngModel"],[2,"user-select","none"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[2,"cursor","pointer",3,"contextmenu"],[1,"text-center","d-flex","justify-content-center","align-items-center",2,"gap","5px"],["title","Modificar informaci\xF3n",1,"btn","btn-outline-warning","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src",4,"ngIf"],["width","30px","height","35px",3,"options",4,"ngIf"],["title","Eliminar informaci\xF3n",1,"btn","btn-outline-danger","btn-sm","d-flex","justify-content-center","align-items-center","p-0",2,"width","40px","height","40px","overflow","hidden",3,"click","mouseenter","mouseleave"],["width","20",3,"src"],["width","30px","height","35px",3,"options"],[1,"modal-header"],[1,"modal-title"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],["class","form-floating mb-3 col-sm-12",4,"ngIf"],[1,"form-floating","mb-3","col-sm-12"],["formControlName","Categoria",1,"form-select"],["type","text","placeholder","","formControlName","ParaI",1,"form-control",2,"text-transform","uppercase"],["formControlName","Estado",1,"form-select"],["formControlName","Visibilidad",1,"form-select"],[1,"modal-footer"],["class","button d-flex justify-content-start",4,"ngIf"],[1,"button","me-2"],["title","Cancelar y cerrar","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],[1,"button"],["class","btn mouse-dir success","title","Procesando informaci\xF3n",3,"disabled","click",4,"ngIf"],["class","btn mouse-dir primary d-flex align-items-center","style"," gap: 8px;","title","Accionar",3,"click",4,"ngIf"],["formControlName","instituciones_id",1,"form-select"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","text","placeholder","","formControlName","NivelCurso",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","","formControlName","Edades",1,"form-control",2,"text-transform","uppercase"],[1,"button","d-flex","justify-content-start"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n","class","btn mouse-dir secondary d-flex align-items-center","style"," gap: 8px;",3,"click",4,"ngIf"],["title","Se Autocompletar\xE1 la ultima informaci\xF3n",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],["title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],["title","Procesando informaci\xF3n",1,"btn","mouse-dir","success",3,"click","disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["title","Accionar",1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"]],template:function(e,i){if(e&1){let n=S();o(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),s(4,"Gesti\xF3n de controles"),a(),o(5,"p",6),s(6,"Administra los controles (selects/autocompletados) del sistema"),a()()()(),o(7,"div",3)(8,"div",7)(9,"button",8),g("click",function(){p(n);let u=Ie(40);return _(i.modalGestioncontrolesRef=i._tools.openModal(u,"xl"))}),v(10,"ng-lottie",9),o(11,"span"),s(12,"A\xF1adir control"),a(),v(13,"span",10),a()(),o(14,"div",11)(15,"div",12)(16,"span",13),v(17,"ng-lottie",9),a(),o(18,"div",14)(19,"input",15),g("input",function(){return p(n),_(i.paginacontroles=1)}),T("ngModelChange",function(u){return p(n),M(i.filtertxtcontroles,u)||(i.filtertxtcontroles=u),_(u)}),a(),o(20,"label"),s(21,"Buscar"),a()()()()(),o(22,"div",16)(23,"div",17)(24,"div",18)(25,"button",19),g("click",function(){return p(n),_(i.setViewMode("interactive"))}),s(26,"Modo interactivo"),a(),o(27,"button",19),g("click",function(){return p(n),_(i.setViewMode("table"))}),s(28,"Modo tabla"),a()()(),o(29,"div",20)(30,"div",14)(31,"select",21),T("ngModelChange",function(u){return p(n),M(i.categoriaFiltro,u)||(i.categoriaFiltro=u),_(u)}),g("change",function(){return p(n),_(i.onCategoriaFiltroChange())}),o(32,"option",22),s(33,"TODAS"),a(),h(34,ti,2,2,"option",23),a(),o(35,"label"),s(36,"Filtrar por categor\xEDa"),a()()()(),h(37,ui,3,2,"div",24)(38,Ei,31,17,"div",24)(39,Ri,37,13,"ng-template",null,0,B)}e&2&&(c(10),d("options",i._tools.optionsAdicionar),c(7),d("options",i._tools.optionslupa),c(2),w("ngModel",i.filtertxtcontroles),c(6),j("active",i.viewMode==="interactive"),c(2),j("active",i.viewMode==="table"),c(4),w("ngModel",i.categoriaFiltro),c(3),d("ngForOf",i.categoriasOptions),c(3),d("ngIf",i.viewMode==="interactive"),c(),d("ngIf",i.viewMode==="table"))},dependencies:[de,U,W,pe,q,X,K,Q,z,ue,H,Re,Fe,gt,ge,rt],encapsulation:2});var Be=ve;var se=class se{constructor(t){this.http=t;this.ruta=Le.ruta}ObtenerAsignacionesPorMaterias(t){let e=new me;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let r=String(n).trim();r&&(e=e.set(i,r))}),this.http.get(this.ruta+"api/estadisticas/asignaciones/materias",{params:e})}ObtenerEstudiantesAsignados(t){let e=new me;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let r=String(n).trim();r&&(e=e.set(i,r))}),this.http.get(this.ruta+"api/estadisticas/asignaciones/materias/estudiantes",{params:e})}ObtenerOpcionesResolucionNivel(t){let e=new me;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let r=String(n).trim();r&&(e=e.set(i,r))}),this.http.get(this.ruta+"api/estadisticas/docentes/opciones-resolucion",{params:e})}ObtenerConteoDocentesAsignados(t){let e=new me;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let r=String(n).trim();r&&(e=e.set(i,r))}),this.http.get(this.ruta+"api/estadisticas/docentes/asignados",{params:e})}ObtenerEstudiantesDocenteAsignados(t){let e=new me;return Object.entries(t??{}).forEach(([i,n])=>{if(n==null)return;let r=String(n).trim();r&&(e=e.set(i,r))}),this.http.get(this.ruta+"api/estadisticas/docentes/asignados/estudiantes",{params:e})}};se.\u0275fac=function(e){return new(e||se)(tt(lt))},se.\u0275prov=et({token:se,factory:se.\u0275fac,providedIn:"root"});var ae=se;var ki=["modalAutocompletarCarreraCuadro"],Gi=["modalListasPreliminaresCursos"],ji=["modalListasOficialesCursos"],Bi=["modalListasDocente"],$i=["modalSeleccionPlantillaExcel"],L=()=>({standalone:!0});function Ui(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e.id),c(),x(e.Anio)}}function Wi(l,t){if(l&1){let e=S();o(0,"div",55)(1,"div",23)(2,"label",27),s(3,"\xC1rea:"),a(),o(4,"input",56),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.AreaManual,n)||(r.AreaManual=n),_(n)}),a()(),o(5,"div",23)(6,"label",27),s(7,"Carrera:"),a(),o(8,"input",56),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.CarreraManual,n)||(r.CarreraManual=n),_(n)}),a()(),o(9,"div",23)(10,"label",27),s(11,"Resoluci\xF3n:"),a(),o(12,"input",56),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.ResolucionManual,n)||(r.ResolucionManual=n),_(n)}),a()(),o(13,"div",23)(14,"label",27),s(15,"Texto Nivel:"),a(),o(16,"input",56),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.NivelManual,n)||(r.NivelManual=n),_(n)}),a()(),o(17,"div",23)(18,"label",27),s(19,"Bicentenario:"),a(),o(20,"input",56),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.BicentenarioManual,n)||(r.BicentenarioManual=n),_(n)}),a()(),o(21,"div",57)(22,"div",38)(23,"input",58),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.ContadorManual,n)||(r.ContadorManual=n),_(n)}),a(),o(24,"label",59),s(25," \xBFCon contador de P\xE1gina? "),a()()()()}if(l&2){let e=m(2);c(4),d("ngModelOptions",A(12,L)),w("ngModel",e.AreaManual),c(4),d("ngModelOptions",A(13,L)),w("ngModel",e.CarreraManual),c(4),d("ngModelOptions",A(14,L)),w("ngModel",e.ResolucionManual),c(4),d("ngModelOptions",A(15,L)),w("ngModel",e.NivelManual),c(4),d("ngModelOptions",A(16,L)),w("ngModel",e.BicentenarioManual),c(3),d("ngModelOptions",A(17,L)),w("ngModel",e.ContadorManual)}}function Ki(l,t){l&1&&(o(0,"span"),s(1,"GENERAR CUADRO DE INSCRIPCIONES (CURSO SOLICITADO)"),a())}function zi(l,t){l&1&&(o(0,"span"),s(1,"Generando..."),a())}function Hi(l,t){if(l&1){let e=S();o(0,"div",16)(1,"div",17)(2,"span",18),v(3,"i",19),a(),o(4,"h2",20),s(5,"CUADRO DE INSCRIPCIONES DE ALUMNOS - GENERAL"),a()(),o(6,"div",21)(7,"p",13),s(8,"Ac\xE1 obtendremos la lista del Cuadro de Inscripciones de Alumnos Nuevos y Antiguos de la Instituci\xF3n."),a(),o(9,"form",22)(10,"div",23)(11,"label",24),s(12,"Por Favor introducir Numero de Paginaci\xF3n Inicial:"),a(),o(13,"input",25),T("ngModelChange",function(n){p(e);let r=m();return M(r.numeroPaginaCuadro,n)||(r.numeroPaginaCuadro=n),_(n)}),a()(),o(14,"div",26)(15,"label",27),s(16,"Seleccione Gesti\xF3n"),a(),o(17,"select",28),T("ngModelChange",function(n){p(e);let r=m();return M(r.gestion_id_seleccionado,n)||(r.gestion_id_seleccionado=n),_(n)}),o(18,"optgroup",29),h(19,Ui,2,2,"option",30),a()()(),o(20,"div",31)(21,"label",27),s(22,"Seleccione Nivel"),a(),o(23,"select",32),T("ngModelChange",function(n){p(e);let r=m();return M(r.NivelCuadro,n)||(r.NivelCuadro=n),_(n)}),o(24,"optgroup",33)(25,"option",34),s(26,"MIXTO (TODOS)"),a(),o(27,"option",35),s(28,"TECNICO SUPERIOR"),a(),o(29,"option",36),s(30,"CAPACITACI\xD3N"),a()()()(),o(31,"div",37)(32,"div",38)(33,"input",39),T("ngModelChange",function(n){p(e);let r=m();return M(r.showContenidoManual,n)||(r.showContenidoManual=n),_(n)}),a(),o(34,"label",40),s(35," Mostrar/Ocultar Contenido Manual "),a()()(),o(36,"div",41)(37,"div",38)(38,"input",42),T("ngModelChange",function(n){p(e);let r=m();return M(r.incluirSinAsignar,n)||(r.incluirSinAsignar=n),_(n)}),a(),o(39,"label",43),s(40," INCLUIR LOS SIN ASIGNACIONES "),a()()()(),h(41,Wi,26,18,"div",44),o(42,"div",45)(43,"div",46)(44,"button",47),g("click",function(){p(e);let n=m();return _(n.abrirModalListasDocente())}),v(45,"i",48),o(46,"span"),s(47,"LISTAS OFICIALES ESTUDIANTES x DOCENTE"),a()(),o(48,"button",47),g("click",function(){p(e);let n=m();return _(n.abrirModalListasOficialesCursos())}),v(49,"i",48),o(50,"span"),s(51,"LISTAS OFICIALES POR CURSO (ASIGNACIONES)"),a()(),o(52,"button",47),g("click",function(){p(e);let n=m();return _(n.abrirModalListasPreliminaresCursos())}),v(53,"i",48),o(54,"span"),s(55,"LISTAS PRELIMINARES POR CURSO SOLICITADO"),a()(),o(56,"button",49),g("click",function(){p(e);let n=m();return _(n.GenerarCuadroInscripciones2026())}),it(),o(57,"svg",50),v(58,"path",51)(59,"path",52),a(),h(60,Ki,2,0,"span",53)(61,zi,2,0,"span",53),a()()()()()}if(l&2){let e=m();c(13),d("ngModelOptions",A(18,L)),w("ngModel",e.numeroPaginaCuadro),c(4),d("ngModelOptions",A(19,L)),w("ngModel",e.gestion_id_seleccionado),c(2),d("ngForOf",e.anio),c(4),d("ngModelOptions",A(20,L)),w("ngModel",e.NivelCuadro),c(10),d("ngModelOptions",A(21,L)),w("ngModel",e.showContenidoManual),c(5),d("ngModelOptions",A(22,L)),w("ngModel",e.incluirSinAsignar),c(3),d("ngIf",e.showContenidoManual),c(3),d("disabled",e.isLoadingDocentesParaListas||e.isGenerandoListasDocente||e.generandoExcelDocente),c(4),d("disabled",e.isLoadingCursosParaListasOficiales||e.isGenerandoListasOficiales),c(4),d("disabled",e.isLoadingCursosParaListas||e.isGenerandoListasPreliminares),c(4),d("disabled",e.isGenerandoCuadro),c(4),d("ngIf",!e.isGenerandoCuadro),c(),d("ngIf",e.isGenerandoCuadro)}}function Qi(l,t){if(l&1){let e=S();o(0,"button",92),g("click",function(){let n=p(e).$implicit,r=m(3);return _(r.seleccionarDocente(n))}),s(1),a()}if(l&2){let e=t.$implicit,i=m(3);c(),y(" ",i.getNombreCompletoDocente(e)," ")}}function qi(l,t){l&1&&(o(0,"div",93),s(1,"Sin resultados"),a())}function Xi(l,t){if(l&1&&(o(0,"div",89),h(1,Qi,2,1,"button",90)(2,qi,2,0,"div",91),a()),l&2){let e=m(2);c(),d("ngForOf",e.docentesFiltrados),c(),d("ngIf",e.docentesFiltrados.length===0)}}function Yi(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e.label),c(),x(e.label)}}function Zi(l,t){if(l&1){let e=S();o(0,"select",72),T("ngModelChange",function(n){p(e);let r=m(3);return M(r.cursoSolicitadoSeleccionadoDocente,n)||(r.cursoSolicitadoSeleccionadoDocente=n),_(n)}),g("change",function(){p(e);let n=m(3);return _(n.onCursoDocenteChange())}),o(1,"option",96),s(2,"Todos"),a(),h(3,Yi,2,2,"option",30),a()}if(l&2){let e=m(3);w("ngModel",e.cursoSolicitadoSeleccionadoDocente),d("ngModelOptions",A(3,L)),c(3),d("ngForOf",e.cursoSolicitadoOptionsDocente)}}function Ji(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e.label),c(),x(e.label)}}function en(l,t){if(l&1){let e=S();o(0,"select",72),T("ngModelChange",function(n){p(e);let r=m(3);return M(r.cursoAsignadoSeleccionadoDocente,n)||(r.cursoAsignadoSeleccionadoDocente=n),_(n)}),g("change",function(){p(e);let n=m(3);return _(n.onCursoDocenteChange())}),o(1,"option",96),s(2,"Todos"),a(),h(3,Ji,2,2,"option",30),a()}if(l&2){let e=m(3);w("ngModel",e.cursoAsignadoSeleccionadoDocente),d("ngModelOptions",A(3,L)),c(3),d("ngForOf",e.cursoAsignadoOptionsDocente)}}function tn(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e.label),c(),x(e.label)}}function nn(l,t){if(l&1){let e=S();o(0,"select",72),T("ngModelChange",function(n){p(e);let r=m(3);return M(r.cursoMixtoSeleccionadoDocente,n)||(r.cursoMixtoSeleccionadoDocente=n),_(n)}),g("change",function(){p(e);let n=m(3);return _(n.onCursoDocenteChange())}),o(1,"option",96),s(2,"Todos"),a(),h(3,tn,2,2,"option",30),a()}if(l&2){let e=m(3);w("ngModel",e.cursoMixtoSeleccionadoDocente),d("ngModelOptions",A(3,L)),c(3),d("ngForOf",e.cursoMixtoOptionsDocente)}}function on(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function an(l,t){if(l&1){let e=S();o(0,"div",64)(1,"div",65)(2,"div",66)(3,"label",27),s(4,"Curso"),a(),h(5,Zi,4,4,"select",94)(6,en,4,4,"select",94)(7,nn,4,4,"select",94),o(8,"small",95),s(9,"Selecciona un curso para previsualizar y generar con seguridad."),a()()(),o(10,"div",65)(11,"div",66)(12,"label",27),s(13,"Instrumento"),a(),o(14,"select",72),T("ngModelChange",function(n){p(e);let r=m(2);return M(r.instrumentoSeleccionadoDocente,n)||(r.instrumentoSeleccionadoDocente=n),_(n)}),g("change",function(){p(e);let n=m(2);return _(n.onInstrumentoDocenteChange())}),o(15,"option",96),s(16,"Todos"),a(),h(17,on,2,2,"option",30),a(),o(18,"small",95),s(19,"Filtra por instrumento para listar mejor y rotular el Excel."),a()()()()}if(l&2){let e=m(2);c(5),d("ngIf",e.tipoListaDocente==="NO_OFICIAL"),c(),d("ngIf",e.tipoListaDocente==="OFICIAL"),c(),d("ngIf",e.tipoListaDocente==="MIXTO"),c(7),w("ngModel",e.instrumentoSeleccionadoDocente),d("ngModelOptions",A(6,L)),c(3),d("ngForOf",e.instrumentoOptionsDocente)}}function rn(l,t){l&1&&(o(0,"div",103)(1,"div",104),v(2,"div",105),o(3,"div"),s(4,"Cargando lista..."),a()()())}function sn(l,t){if(l&1&&(o(0,"tr")(1,"td"),s(2),a(),o(3,"td"),s(4),a(),o(5,"td"),s(6),a(),o(7,"td"),s(8),a()()),l&2){let e=t.$implicit,i=t.index,n=m(4);c(2),x(i+1),c(2),x((e==null?null:e.NombreCompleto)||(e==null?null:e.Nombre)||(e==null?null:e.Apellidos)||""),c(2),x((e==null?null:e.CI)||(e==null?null:e.Ci)||(e==null?null:e.ci)||""),c(2),x((e==null?null:e[n.instrumentoFieldKey])||(e==null?null:e.InstrumentoMusical)||(e==null?null:e.InstrumentoMusicalSecundario)||"")}}function ln(l,t){l&1&&(o(0,"tr")(1,"td",110),s(2,"Sin estudiantes para los filtros seleccionados"),a()())}function cn(l,t){if(l&1&&(o(0,"div",106)(1,"table",107)(2,"thead")(3,"tr")(4,"th",108),s(5,"#"),a(),o(6,"th"),s(7,"Estudiante"),a(),o(8,"th"),s(9,"CI"),a(),o(10,"th"),s(11,"Instrumento"),a()()(),o(12,"tbody"),h(13,sn,9,4,"tr",109)(14,ln,3,0,"tr",53),a()(),o(15,"small",95),s(16),a()()),l&2){let e=m(3);c(13),d("ngForOf",e.previewDocenteRows),c(),d("ngIf",e.previewDocenteRows.length===0),c(2),ne("Mostrando ",e.previewDocenteRows.length," de ",e.previewDocenteTotal,".")}}function dn(l,t){if(l&1&&(o(0,"div",64)(1,"div",97)(2,"div",98)(3,"div",99),s(4,"Vista previa"),a(),o(5,"div",100),s(6),a()(),h(7,rn,5,0,"div",101)(8,cn,17,4,"div",102),a()()),l&2){let e=m(2);c(6),y(" Total: ",e.previewDocenteTotal," "),c(),d("ngIf",e.isLoadingPreviewDocente),c(),d("ngIf",!e.isLoadingPreviewDocente)}}function mn(l,t){l&1&&(o(0,"span"),s(1,"PDF"),a())}function un(l,t){l&1&&(o(0,"span"),v(1,"span",111),s(2," GENERANDO... "),a())}function pn(l,t){l&1&&(o(0,"span"),s(1,"EXCEL"),a())}function _n(l,t){l&1&&(o(0,"span"),v(1,"span",111),s(2," GENERANDO... "),a())}function gn(l,t){if(l&1){let e=S();o(0,"div",9)(1,"h5",10),s(2,"LISTAS OFICIALES ESTUDIANTES x DOCENTE"),a(),o(3,"button",60),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",12)(5,"div",61)(6,"div",62),s(7),a(),o(8,"div",63),s(9),a()(),o(10,"div",64)(11,"div",65)(12,"div",66)(13,"label",27),s(14,"Docente"),a(),o(15,"div",67)(16,"input",68),T("ngModelChange",function(n){p(e);let r=m();return M(r.docenteTxt,n)||(r.docenteTxt=n),_(n)}),g("input",function(){p(e);let n=m();return _(n.filtrarDocentes())})("focus",function(){p(e);let n=m();return _(n.filtrarDocentes())})("blur",function(){p(e);let n=m();return _(n.onDocenteBlur())}),a(),o(17,"button",69),g("click",function(){p(e);let n=m();return _(n.limpiarDocenteSeleccionado())}),s(18,"Limpiar"),a()(),h(19,Xi,3,2,"div",70),a()(),o(20,"div",71)(21,"div",66)(22,"label",27),s(23,"Modo"),a(),o(24,"select",72),T("ngModelChange",function(n){p(e);let r=m();return M(r.modoDocente,n)||(r.modoDocente=n),_(n)}),g("change",function(){p(e);let n=m();return _(n.onModoDocenteChange())}),o(25,"option",73),s(26,"Especialidad"),a(),o(27,"option",74),s(28,"Instrumento complementario"),a(),o(29,"option",75),s(30,"Pr\xE1ctica de conjuntos"),a()()()(),o(31,"div",71)(32,"div",66)(33,"label",27),s(34,"Tipo de lista"),a(),o(35,"select",72),T("ngModelChange",function(n){p(e);let r=m();return M(r.tipoListaDocente,n)||(r.tipoListaDocente=n),_(n)}),g("change",function(){p(e);let n=m();return _(n.onTipoListaDocenteChange())}),o(36,"option",76),s(37,"NO OFICIAL (sin asignar)"),a(),o(38,"option",77),s(39,"OFICIAL (asignados)"),a(),o(40,"option",34),s(41,"MIXTO"),a()()()()(),h(42,an,20,7,"div",78)(43,dn,9,3,"div",78),a(),o(44,"div",79)(45,"div",80),v(46,"div"),o(47,"div",81)(48,"button",82),g("click",function(){p(e);let n=m();return _(n.refrescarPreviewDocente(!0))}),o(49,"span",83),v(50,"ng-lottie",84),a(),o(51,"span"),s(52,"ACTUALIZAR"),a(),v(53,"span",85),a(),o(54,"button",86),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),o(55,"span",83),v(56,"ng-lottie",84),a(),o(57,"span"),s(58,"CERRAR"),a(),v(59,"span",85),a(),o(60,"button",87),g("click",function(){p(e);let n=m();return _(n.generarPdfDocente())}),o(61,"span",83),v(62,"ng-lottie",84),a(),h(63,mn,2,0,"span",53)(64,un,3,0,"span",53),v(65,"span",85),a(),o(66,"button",88),g("click",function(){p(e);let n=m();return _(n.generarExcelDocente())}),o(67,"span",83),v(68,"ng-lottie",84),a(),h(69,pn,2,0,"span",53)(70,_n,3,0,"span",53),v(71,"span",85),a()()()()}if(l&2){let e=m();c(7),y("Gesti\xF3n: ",e.getGestionLabel()),c(2),y("Modo: ",e.tituloModoDocente),c(7),w("ngModel",e.docenteTxt),d("ngModelOptions",A(22,L)),c(3),d("ngIf",e.mostrarListaDocentes),c(5),w("ngModel",e.modoDocente),d("ngModelOptions",A(23,L)),c(11),w("ngModel",e.tipoListaDocente),d("ngModelOptions",A(24,L)),c(7),d("ngIf",e.docenteSeleccionado),c(),d("ngIf",e.docenteSeleccionado),c(5),d("disabled",!e.docenteSeleccionado||e.isLoadingPreviewDocente),c(2),d("options",e.optionsautocompletar),c(6),d("options",e.optionscancelar),c(4),d("disabled",!e.docenteSeleccionado||e.isGenerandoListasDocente),c(2),d("options",e.optionsarchive),c(),d("ngIf",!e.isGenerandoListasDocente),c(),d("ngIf",e.isGenerandoListasDocente),c(2),d("disabled",!e.docenteSeleccionado||e.generandoExcelDocente),c(2),d("options",e.optionsarchive),c(),d("ngIf",!e.generandoExcelDocente),c(),d("ngIf",e.generandoExcelDocente)}}function fn(l,t){if(l&1){let e=S();o(0,"button",118),g("click",function(){let n=p(e).$implicit,r=m(2).$implicit;return _(r.close(n))}),o(1,"span"),s(2),a(),o(3,"small",95),s(4),a()()}if(l&2){let e=t.$implicit;c(2),x((e==null?null:e.ParaI)||"Plantilla"),c(2),x(e==null?null:e.Categoria)}}function hn(l,t){if(l&1&&(o(0,"div",116),h(1,fn,5,2,"button",117),a()),l&2){let e=m(2);c(),d("ngForOf",e.plantillasExcelDisponibles)}}function xn(l,t){l&1&&(o(0,"div",95),s(1,"No hay plantillas disponibles."),a())}function vn(l,t){if(l&1){let e=S();o(0,"div",112)(1,"h5",10),s(2,"Seleccionar plantilla Excel"),a(),o(3,"button",113),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",12),h(5,hn,2,1,"div",114)(6,xn,2,0,"div",115),a()}if(l&2){let e=m();c(5),d("ngIf",e.plantillasExcelDisponibles&&e.plantillasExcelDisponibles.length),c(),d("ngIf",!e.plantillasExcelDisponibles||e.plantillasExcelDisponibles.length===0)}}function bn(l,t){l&1&&(o(0,"div",124),s(1,"Incluye SIN ASIGNAR"),a())}function Cn(l,t){l&1&&(o(0,"div",63),s(1,"Solo asignados"),a())}function Sn(l,t){l&1&&(o(0,"div",125)(1,"div",126),s(2,"Cargando cursos..."),a()())}function En(l,t){l&1&&(o(0,"div",127),s(1," No se encontraron cursos para el filtro actual. "),a())}function yn(l,t){if(l&1){let e=S();o(0,"tr",135),g("click",function(){let n=p(e).$implicit;return _(n.selected=!n.selected)}),o(1,"td")(2,"input",136),T("ngModelChange",function(n){let r=p(e).$implicit;return M(r.selected,n)||(r.selected=n),_(n)}),g("click",function(n){return p(e),_(n.stopPropagation())}),a()(),o(3,"td",137),s(4),a(),o(5,"td"),s(6),a(),o(7,"td",133),s(8),a()()}if(l&2){let e=t.$implicit;c(2),w("ngModel",e.selected),d("ngModelOptions",A(5,L)),c(2),x(e.curso),c(2),x(e.paraleloLabel),c(2),x(e.total)}}function In(l,t){if(l&1){let e=S();o(0,"div",128)(1,"table",129)(2,"thead",130)(3,"tr")(4,"th",131)(5,"input",132),g("change",function(n){p(e);let r=m(2);return _(r.toggleSeleccionarTodosCursosParaListas(n.target.checked))}),a()(),o(6,"th"),s(7,"Curso"),a(),o(8,"th"),s(9,"Paralelo"),a(),o(10,"th",133),s(11,"Total"),a()()(),o(12,"tbody"),h(13,yn,9,6,"tr",134),a()()()}if(l&2){let e=m(2);c(13),d("ngForOf",e.cursosParaListas)}}function wn(l,t){l&1&&(o(0,"span"),s(1,"GENERAR PDF"),a())}function Mn(l,t){l&1&&(o(0,"span"),v(1,"span",111),s(2," GENERANDO... "),a())}function Tn(l,t){if(l&1){let e=S();o(0,"div",9)(1,"h5",10),s(2,"LISTAS PRELIMINARES POR CURSO"),a(),o(3,"button",60),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",12)(5,"div",61)(6,"div",62),s(7),a(),h(8,bn,2,0,"div",119)(9,Cn,2,0,"div",120),a(),h(10,Sn,3,0,"div",121)(11,En,2,0,"div",122)(12,In,14,1,"div",123),a(),o(13,"div",14)(14,"div",80)(15,"div",95),s(16),a(),o(17,"div",81)(18,"button",86),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),o(19,"span",83),v(20,"ng-lottie",84),a(),o(21,"span"),s(22,"CANCELAR"),a(),v(23,"span",85),a(),o(24,"button",87),g("click",function(){p(e);let n=m();return _(n.generarListasPreliminaresSeleccionadas())}),o(25,"span",83),v(26,"ng-lottie",84),a(),h(27,wn,2,0,"span",53)(28,Mn,3,0,"span",53),v(29,"span",85),a()()()()}if(l&2){let e=m();c(7),y("Gesti\xF3n: ",e.getGestionLabel()),c(),d("ngIf",e.incluirSinAsignar),c(),d("ngIf",!e.incluirSinAsignar),c(),d("ngIf",e.isLoadingCursosParaListas),c(),d("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length===0),c(),d("ngIf",!e.isLoadingCursosParaListas&&e.cursosParaListas.length>0),c(4),y("Seleccionados: ",e.getCursosParaListasSeleccionadosCount()),c(4),d("options",e._tools.optionscancelar),c(4),d("disabled",e.isGenerandoListasPreliminares||e.getCursosParaListasSeleccionadosCount()===0),c(2),d("options",e._tools.optionsarchive),c(),d("ngIf",!e.isGenerandoListasPreliminares),c(),d("ngIf",e.isGenerandoListasPreliminares)}}function Pn(l,t){if(l&1&&(o(0,"div",63),s(1),a()),l&2){let e=m(2);c(),y("Resoluci\xF3n: ",e.resolucionSeleccionada)}}function On(l,t){if(l&1&&(o(0,"option",54),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Dn(l,t){l&1&&(o(0,"span"),s(1,"Cargar materias (de cursos seleccionados)"),a())}function An(l,t){l&1&&(o(0,"span"),s(1,"Cargando materias..."),a())}function Ln(l,t){if(l&1&&(o(0,"div",152),s(1),a()),l&2){let e=m(3);c(),y(" Materias seleccionadas: ",e.getMateriasParaListasOficialesSeleccionadas().length," ")}}function Nn(l,t){l&1&&(o(0,"div",153),s(1," Para imprimir por materia, primero seleccione cursos y luego cargue las materias. "),a())}function Vn(l,t){if(l&1){let e=S();o(0,"tr",135),g("click",function(){let n=p(e).$implicit;return _(n.selected=!n.selected)}),o(1,"td")(2,"input",136),T("ngModelChange",function(n){let r=p(e).$implicit;return M(r.selected,n)||(r.selected=n),_(n)}),g("click",function(n){return p(e),_(n.stopPropagation())}),a()(),o(3,"td",137),s(4),a(),o(5,"td",156),s(6),a()()}if(l&2){let e=t.$implicit;c(2),w("ngModel",e.selected),d("ngModelOptions",A(5,L)),c(2),x(e.nombre),c(),d("title",e.cursosLabel),c(),y(" En ",(e.cursosKeys==null?null:e.cursosKeys.length)||0," curso(s) ")}}function Rn(l,t){if(l&1){let e=S();o(0,"div",154)(1,"table",129)(2,"thead",130)(3,"tr")(4,"th",131)(5,"input",132),g("change",function(n){p(e);let r=m(3);return _(r.toggleSeleccionarTodasMateriasParaListasOficiales(n.target.checked))}),a()(),o(6,"th"),s(7,"Materia"),a(),o(8,"th",155),s(9,"Cursos"),a()()(),o(10,"tbody"),h(11,Vn,7,6,"tr",134),a()()()}if(l&2){let e=m(3);c(11),d("ngForOf",e.materiasParaListasOficiales)}}function Fn(l,t){if(l&1){let e=S();o(0,"div",125)(1,"div",147)(2,"button",148),g("click",function(){p(e);let n=m(2);return _(n.cargarMateriasOficiales())}),h(3,Dn,2,0,"span",53)(4,An,2,0,"span",53),a(),h(5,Ln,2,1,"div",149),a(),h(6,Nn,2,0,"div",150)(7,Rn,12,1,"div",151),a()}if(l&2){let e=m(2);c(2),d("disabled",e.isLoadingMateriasParaListasOficiales||e.isLoadingCursosParaListasOficiales||!e.resolucionSeleccionada),c(),d("ngIf",!e.isLoadingMateriasParaListasOficiales),c(),d("ngIf",e.isLoadingMateriasParaListasOficiales),c(),d("ngIf",e.materiasParaListasOficiales.length>0),c(),d("ngIf",e.materiasParaListasOficiales.length===0),c(),d("ngIf",e.materiasParaListasOficiales.length>0)}}function kn(l,t){l&1&&(o(0,"div",125)(1,"div",126),s(2,"Cargando cursos..."),a()())}function Gn(l,t){l&1&&(o(0,"div",127),s(1," No se encontraron cursos para el filtro actual. "),a())}function jn(l,t){l&1&&(o(0,"span"),s(1,"Excel"),a())}function Bn(l,t){l&1&&(o(0,"span"),s(1,"..."),a())}function $n(l,t){if(l&1){let e=S();o(0,"tr",135),g("click",function(){let n=p(e).$implicit;return _(n.selected=!n.selected)}),o(1,"td")(2,"input",136),T("ngModelChange",function(n){let r=p(e).$implicit;return M(r.selected,n)||(r.selected=n),_(n)}),g("click",function(n){return p(e),_(n.stopPropagation())}),a()(),o(3,"td",137),s(4),a(),o(5,"td"),s(6),a(),o(7,"td"),s(8),a(),o(9,"td",133),s(10),a(),o(11,"td",158)(12,"button",159),g("click",function(n){let r=p(e).$implicit;return m(3).descargarExcelListaOficialCurso(r),_(n.stopPropagation())}),h(13,jn,2,0,"span",53)(14,Bn,2,0,"span",53),a()()()}if(l&2){let e=t.$implicit,i=m(3);c(2),w("ngModel",e.selected),d("ngModelOptions",A(9,L)),c(2),x(e.curso),c(2),x(e.paraleloLabel),c(2),x(e.turnoLabel),c(2),x(e.total),c(2),d("disabled",i.isGenerandoExcelCurso(e)||i.isGenerandoListasOficiales||i.isLoadingCursosParaListasOficiales),c(),d("ngIf",!i.isGenerandoExcelCurso(e)),c(),d("ngIf",i.isGenerandoExcelCurso(e))}}function Un(l,t){if(l&1){let e=S();o(0,"div",128)(1,"table",129)(2,"thead",130)(3,"tr")(4,"th",131)(5,"input",132),g("change",function(n){p(e);let r=m(2);return _(r.toggleSeleccionarTodosCursosParaListasOficiales(n.target.checked))}),a()(),o(6,"th"),s(7,"Curso"),a(),o(8,"th"),s(9,"Paralelo"),a(),o(10,"th"),s(11,"Turno"),a(),o(12,"th",133),s(13,"Total"),a(),o(14,"th",157),s(15,"Excel"),a()()(),o(16,"tbody"),h(17,$n,15,10,"tr",134),a()()()}if(l&2){let e=m(2);c(17),d("ngForOf",e.cursosParaListasOficiales)}}function Wn(l,t){l&1&&(o(0,"span"),s(1,"GENERAR PDF"),a())}function Kn(l,t){l&1&&(o(0,"span"),v(1,"span",111),s(2," GENERANDO... "),a())}function zn(l,t){if(l&1){let e=S();o(0,"div",9)(1,"h5",10),s(2,"LISTAS OFICIALES POR CURSO (ASIGNACIONES)"),a(),o(3,"button",60),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",12)(5,"div",61)(6,"div",62),s(7),a(),h(8,Pn,2,1,"div",120),a(),o(9,"div",138)(10,"div",139)(11,"label",140),s(12,"Seleccione resoluci\xF3n"),a(),o(13,"select",141),T("ngModelChange",function(n){p(e);let r=m();return M(r.resolucionSeleccionada,n)||(r.resolucionSeleccionada=n),_(n)}),g("change",function(){p(e);let n=m();return _(n.cargarCursosOficiales())}),o(14,"option",96),s(15,"-- Seleccione --"),a(),h(16,On,2,2,"option",30),a()(),o(17,"div",139)(18,"label",140),s(19,"Tipo de lista"),a(),o(20,"div",142)(21,"div",38)(22,"input",143),T("ngModelChange",function(n){p(e);let r=m();return M(r.modoListasOficiales,n)||(r.modoListasOficiales=n),_(n)}),a(),o(23,"label",144),s(24,"General (todos)"),a()(),o(25,"div",38)(26,"input",145),T("ngModelChange",function(n){p(e);let r=m();return M(r.modoListasOficiales,n)||(r.modoListasOficiales=n),_(n)}),a(),o(27,"label",146),s(28,"Por materia"),a()()()()(),h(29,Fn,8,6,"div",121)(30,kn,3,0,"div",121)(31,Gn,2,0,"div",122)(32,Un,18,1,"div",123),a(),o(33,"div",14)(34,"div",80)(35,"div",95),s(36),a(),o(37,"div",81)(38,"button",86),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),o(39,"span",83),v(40,"ng-lottie",84),a(),o(41,"span"),s(42,"CANCELAR"),a(),v(43,"span",85),a(),o(44,"button",87),g("click",function(){p(e);let n=m();return _(n.generarListasOficialesSeleccionadas())}),o(45,"span",83),v(46,"ng-lottie",84),a(),h(47,Wn,2,0,"span",53)(48,Kn,3,0,"span",53),v(49,"span",85),a()()()()}if(l&2){let e=m();c(7),y("Gesti\xF3n: ",e.getGestionLabel()),c(),d("ngIf",e.resolucionSeleccionada),c(5),d("ngModelOptions",A(20,L)),w("ngModel",e.resolucionSeleccionada),d("disabled",e.isLoadingCursosParaListasOficiales),c(3),d("ngForOf",e.resolucionesDisponibles),c(6),d("ngModelOptions",A(21,L)),w("ngModel",e.modoListasOficiales),c(4),d("ngModelOptions",A(22,L)),w("ngModel",e.modoListasOficiales),c(3),d("ngIf",e.modoListasOficiales==="POR_MATERIA"),c(),d("ngIf",e.isLoadingCursosParaListasOficiales),c(),d("ngIf",!e.isLoadingCursosParaListasOficiales&&e.cursosParaListasOficiales.length===0),c(),d("ngIf",!e.isLoadingCursosParaListasOficiales&&e.cursosParaListasOficiales.length>0),c(4),y("Seleccionados: ",e.getCursosParaListasOficialesSeleccionadosCount()),c(4),d("options",e._tools.optionscancelar),c(4),d("disabled",e.isGenerandoListasOficiales||e.getCursosParaListasOficialesSeleccionadosCount()===0),c(2),d("options",e._tools.optionsarchive),c(),d("ngIf",!e.isGenerandoListasOficiales),c(),d("ngIf",e.isGenerandoListasOficiales)}}function Hn(l,t){if(l&1&&v(0,"option",54),l&2){let e=t.$implicit;d("value",e)}}function Qn(l,t){if(l&1){let e=S();o(0,"div",160)(1,"h5",10),s(2,"Completar Carrera (estudiantes sin asignar)"),a(),o(3,"button",161),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("close"))}),a()(),o(4,"div",12)(5,"div",162),s(6," Se detectaron "),o(7,"b"),s(8),a(),s(9," estudiante(s) sin "),o(10,"b"),s(11,"Carrera"),a(),s(12," (por falta de asignaciones). Selecciona una opci\xF3n sugerida o escribe manualmente para autocompletar y continuar. "),a(),o(13,"label",140),s(14,"Carrera para autocompletar"),a(),o(15,"input",163),T("ngModelChange",function(n){p(e);let r=m();return M(r.cuadroCarreraAutocompletarTxt,n)||(r.cuadroCarreraAutocompletarTxt=n),_(n)}),a(),o(16,"datalist",164),h(17,Hn,1,1,"option",30),a(),o(18,"small",95),s(19,"Las sugerencias se obtienen de la misma lista (los que s\xED tienen Carrera)."),a()(),o(20,"div",14)(21,"div",165)(22,"button",69),g("click",function(){let n=p(e).$implicit;return _(n.dismiss("cancel"))}),s(23,"Cancelar"),a(),o(24,"button",166),g("click",function(){let n=p(e).$implicit,r=m();return _(n.close(r.cuadroCarreraAutocompletarTxt))}),s(25," Continuar y generar "),a()()()}if(l&2){let e=m();c(8),x(e.cuadroMissingCarreraCount),c(7),d("ngModelOptions",A(5,L)),w("ngModel",e.cuadroCarreraAutocompletarTxt),c(2),d("ngForOf",e.cuadroCarreraSugerencias),c(7),d("disabled",!(e.cuadroCarreraAutocompletarTxt!=null&&e.cuadroCarreraAutocompletarTxt.trim()))}}var be=class be{constructor(t,e,i,n,r,u,f){this._repo=t;this._anios=e;this._infoest=i;this._tools=n;this._estadisticas=r;this._planteldoc=u;this._plantillasExcel=f;this.numeroPaginaCuadro=1;this.anio=[];this.gestion_id_seleccionado="";this.NivelCuadro="MIXTO";this.incluirSinAsignar=!0;this.isGenerandoCuadro=!1;this.cuadroCarreraSugerencias=[];this.cuadroCarreraAutocompletarTxt="";this.cuadroMissingCarreraCount=0;this.showContenidoManual=!1;this.AreaManual="";this.CarreraManual="";this.ResolucionManual="";this.NivelManual="";this.BicentenarioManual="";this.ContadorManual=!1;this.cursosParaListas=[];this.isLoadingCursosParaListas=!1;this.isGenerandoListasPreliminares=!1;this.resolucionesDisponibles=[];this.resolucionSeleccionada="";this.modoListasOficiales="GENERAL";this.cursosParaListasOficiales=[];this.isLoadingCursosParaListasOficiales=!1;this.isGenerandoListasOficiales=!1;this.materiasParaListasOficiales=[];this.isLoadingMateriasParaListasOficiales=!1;this.isLoadingDocentesParaListas=!1;this.docentesParaListas=[];this.docentesFiltrados=[];this.mostrarListaDocentes=!1;this.docenteTxt="";this.docenteSeleccionado=null;this.tipoListaDocente="OFICIAL";this.modoDocente="especialidad";this.docenteFieldKey="planteldocadmins_id";this.instrumentoFieldKey="InstrumentoMusical";this.tituloModoDocente="Especialidad";this.cursoSolicitadoOptionsDocente=[];this.cursoAsignadoOptionsDocente=[];this.cursoMixtoOptionsDocente=[];this.cursoSolicitadoSeleccionadoDocente="";this.cursoAsignadoSeleccionadoDocente="";this.cursoMixtoSeleccionadoDocente="";this.docenteCursos=[];this.cursoPreviewLabelDocente="";this.isGenerandoPdfDocenteCursos=!1;this.generandoExcelDocenteCursos={};this.instrumentoOptionsDocente=[];this.instrumentoSeleccionadoDocente="";this.isLoadingPreviewDocente=!1;this.previewDocenteRows=[];this.previewDocenteTotal=0;this.previewPageSizeDocente=100;this.docenteRowsCacheKey=null;this.docenteRowsCacheRows=[];this.isGenerandoListasDocente=!1;this.plantillasExcelDisponibles=[];this.generandoExcelDocente=!1;this.generandoExcelCursoKeys=new Set}ngOnInit(){this.cargarAnios()}cargarAnios(){this._anios.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anio=t?.anios||[];let e=t?.predeterminado??null,i=Number(this.gestion_id_seleccionado);(Number.isFinite(i)&&i>0?(this.anio||[]).some(r=>Number(r?.id)===i):!1)||(e?.id?this.gestion_id_seleccionado=e.id:this.anio?.length?this.gestion_id_seleccionado=this.anio[0]?.id??"":this.gestion_id_seleccionado="")},error:t=>{console.error("Error al cargar anios",t),this.anio=[]}})}getGestionLabel(){let t=Number(this.gestion_id_seleccionado),e=(this.anio||[]).find(n=>Number(n?.id)===t);return(e?.Anio??e?.anio??"").toString().trim()||(Number.isFinite(t)&&t>0?String(t):"")}getAnioIdSeleccionadoOrWarn(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0)return this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o"),null;let t=Number(this.gestion_id_seleccionado);return!Number.isFinite(t)||t<=0?(this._tools.MostrarMensaje("warning","Seleccione un a\xF1o v\xE1lido"),null):t}limpiarTxt(t){return(t??"").toString().replace(/\s+/g," ").trim()}getCarrerasSugeridasDesdeLista(t){let e=new Set;for(let i of t||[]){let n=this.limpiarTxt(i?.Carrera);n&&n.toUpperCase()!=="SIN ASIGNAR"&&e.add(n)}return Array.from(e.values()).sort((i,n)=>i.localeCompare(n))}pedirAutocompletarCarreraCuadro(){return V(this,null,function*(){this.modalAutocompletarCarreraCuadroRef=this._tools.openModal(this.modalAutocompletarCarreraCuadro,"lg");try{let t=yield this.modalAutocompletarCarreraCuadroRef.result,e=this.limpiarTxt(t);return e||null}catch{return null}})}GenerarCuadroInscripciones2026(){return V(this,null,function*(){if(this.gestion_id_seleccionado===""||this.gestion_id_seleccionado===null||this.gestion_id_seleccionado===void 0){this._tools.MostrarMensaje("warning","Seleccione una gesti\xF3n/a\xF1o");return}if(this.isGenerandoCuadro)return;this.isGenerandoCuadro=!0;let t=Number(this.numeroPaginaCuadro||1),e=Number(this.gestion_id_seleccionado),i=this.NivelCuadro||"MIXTO";try{let n=yield this._repo.ObtenerRespuestaCuadroInscripciones2026(e,i,this.incluirSinAsignar),r=Array.isArray(n?.data)?n.data:[],u=r.filter(f=>!this.limpiarTxt(f?.Carrera));if(this.cuadroMissingCarreraCount=u.length,u.length>0){this.cuadroCarreraSugerencias=this.getCarrerasSugeridasDesdeLista(r);let f=this.limpiarTxt(this.CarreraManual)||(this.cuadroCarreraSugerencias[0]??"");this.cuadroCarreraAutocompletarTxt=f;let b=yield this.pedirAutocompletarCarreraCuadro();if(!b){this._tools.MostrarMensaje("info","Generaci\xF3n cancelada (faltaba completar Carrera)");return}r.forEach(C=>{this.limpiarTxt(C?.Carrera)||(C.Carrera=b)}),this.CarreraManual=b}this._repo.GenerarCuadroInscripciones2026DesdeRespuesta(t,e,i,n)}catch(n){console.error(n),this._tools.MostrarMensaje("error","No se pudo generar el cuadro de inscripciones")}finally{this.isGenerandoCuadro=!1}})}abrirModalListasPreliminaresCursos(){let t=this.getAnioIdSeleccionadoOrWarn();t&&(this.cursosParaListas=[],this.isLoadingCursosParaListas=!0,this.modalListasPreliminaresCursosRef=this._tools.openModal(this.modalListasPreliminaresCursos,"lg"),this._infoest.ObtenerEstadisticasInscripciones({anio_id:t,include_sin_asignar:this.incluirSinAsignar?1:0}).subscribe({next:e=>{let i=Array.isArray(e?.por_curso_paralelo)?e.por_curso_paralelo:[];this.cursosParaListas=i.map(n=>{let r=(n?.curso??"").toString().trim(),u=(n?.paralelo??"").toString().trim(),f=(n?.paralelo_label??(u||"SIN DETERMINAR")).toString().trim(),b=Number(n?.total??0);return{curso:r,paralelo:u,paraleloLabel:f||"SIN DETERMINAR",total:Number.isFinite(b)?b:0,selected:!1}}).filter(n=>n.curso!=="").sort((n,r)=>{let u=n.curso.localeCompare(r.curso);return u!==0?u:(n.paraleloLabel||"").localeCompare(r.paraleloLabel||"")}),this.isLoadingCursosParaListas=!1},error:e=>{console.error(e),this.cursosParaListas=[],this.isLoadingCursosParaListas=!1,this._tools.MostrarMensaje("error","No se pudieron cargar los cursos")}}))}toggleSeleccionarTodosCursosParaListas(t){(this.cursosParaListas||[]).forEach(e=>e.selected=t)}getCursosParaListasSeleccionadosCount(){return(this.cursosParaListas||[]).filter(t=>!!t.selected).length}generarListasPreliminaresSeleccionadas(){return V(this,null,function*(){let t=this.getAnioIdSeleccionadoOrWarn();if(!t)return;let e=(this.cursosParaListas||[]).filter(i=>!!i.selected).map(i=>({curso:i.curso,paralelo:i.paralelo}));if(e.length===0){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}if(!this.isGenerandoListasPreliminares){this.isGenerandoListasPreliminares=!0;try{yield this._repo.GenerarListaPreliminarAlumnos2026(t,e,null,this.incluirSinAsignar);try{this.modalListasPreliminaresCursosRef?.close?.()}catch{}}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudieron generar las listas")}finally{this.isGenerandoListasPreliminares=!1}}})}abrirModalListasOficialesCursos(){return V(this,null,function*(){let t=this.getAnioIdSeleccionadoOrWarn();if(t){this.cursosParaListasOficiales=[],this.materiasParaListasOficiales=[],this.resolucionesDisponibles=[],this.isLoadingCursosParaListasOficiales=!0,this.isLoadingMateriasParaListasOficiales=!1,this.isGenerandoListasOficiales=!1,this.modoListasOficiales=this.modoListasOficiales||"GENERAL",this.modalListasOficialesCursosRef=this._tools.openModal(this.modalListasOficialesCursos,"lg");try{let e=yield G(this._estadisticas.ObtenerOpcionesResolucionNivel({anio_id:t})),n=(Array.isArray(e?.data)?e.data:[]).map(r=>(r?.Resolucion??"").toString().trim()).filter(r=>r!=="");this.resolucionesDisponibles=Array.from(new Set(n)).sort((r,u)=>r.localeCompare(u)),this.resolucionesDisponibles.includes(this.resolucionSeleccionada)||(this.resolucionSeleccionada=this.resolucionesDisponibles[0]??"")}catch(e){console.error(e),this.resolucionesDisponibles=[],this.resolucionSeleccionada="",this.isLoadingCursosParaListasOficiales=!1,this._tools.MostrarMensaje("error","No se pudieron cargar las resoluciones");return}yield this.cargarCursosOficiales()}})}cargarCursosOficiales(){return V(this,null,function*(){let t=this.getAnioIdSeleccionadoOrWarn();if(!t)return;let e=(this.resolucionSeleccionada??"").toString().trim();if(!e){this.cursosParaListasOficiales=[],this.materiasParaListasOficiales=[],this.isLoadingCursosParaListasOficiales=!1;return}this.isLoadingCursosParaListasOficiales=!0,this.cursosParaListasOficiales=[];try{let i=yield G(this._estadisticas.ObtenerAsignacionesPorMaterias({anio_id:t,resolucion:e,modo:"SIMPLIFICADO"})),n=Array.isArray(i?.data)?i.data:[];this.cursosParaListasOficiales=n.map(r=>{let u=(r?.LvlCurso??"").toString().trim(),f=(r?.Paralelo??"").toString().trim(),b=(r?.Turno??"").toString().trim(),C=Number(r?.Total_Gral??0);return{curso:u,paralelo:f,paraleloLabel:f||"SIN DETERMINAR",turno:b,turnoLabel:b||"SIN TURNO",total:Number.isFinite(C)?C:0,selected:!1,__rango:Number(r?.RangoLvlCurso??0)||0}}).filter(r=>r.curso!=="").sort((r,u)=>{let f=Number(r.__rango??0),b=Number(u.__rango??0);if(f!==b)return f-b;let C=r.curso.localeCompare(u.curso);if(C!==0)return C;let E=(r.paraleloLabel||"").localeCompare(u.paraleloLabel||"");return E!==0?E:(r.turnoLabel||"").localeCompare(u.turnoLabel||"")}).map(f=>{var b=f,{__rango:r}=b,u=Je(b,["__rango"]);return u}),this.materiasParaListasOficiales=[]}catch(i){console.error(i),this.cursosParaListasOficiales=[],this.materiasParaListasOficiales=[],this._tools.MostrarMensaje("error","No se pudieron cargar los cursos (asignaciones)")}finally{this.isLoadingCursosParaListasOficiales=!1}})}cargarMateriasOficiales(){return V(this,null,function*(){let t=this.getAnioIdSeleccionadoOrWarn();if(!t)return;let e=(this.resolucionSeleccionada??"").toString().trim();if(!e){this._tools.MostrarMensaje("warning","Seleccione una resoluci\xF3n");return}let i=(this.cursosParaListasOficiales||[]).filter(n=>!!n.selected);if(i.length===0){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}if(!this.isLoadingMateriasParaListasOficiales){this.isLoadingMateriasParaListasOficiales=!0,this.materiasParaListasOficiales=[];try{let n=new Map;for(let r of i){let u=`${(r.curso??"").toString().trim()}||${(r.paralelo??"").toString().trim()}||${(r.turno??"").toString().trim()}`,f=`${(r.curso??"").toString().trim()} ${(r.paraleloLabel??"").toString().trim()} - ${(r.turnoLabel??"").toString().trim()}`.replace(/\s+/g," ").trim(),b=yield G(this._estadisticas.ObtenerAsignacionesPorMaterias({anio_id:t,resolucion:e,lvl_curso:r.curso,modo:"NORMAL"})),E=(Array.isArray(b?.data)?b.data:[]).filter(I=>(I?.Paralelo??"").toString().trim()===(r.paralelo??"").toString().trim()).filter(I=>(I?.Turno??"").toString().trim()===(r.turno??"").toString().trim()).map(I=>{let P=(I?.NombreMateria??"").toString().trim(),D=Number(I?.Rango??0);return{nombre:P,rango:Number.isFinite(D)?D:0}}).filter(I=>I.nombre!=="");for(let I of E){let P=`${I.rango}||${I.nombre}`;n.has(P)||n.set(P,{key:P,nombre:I.nombre,rango:I.rango,selected:!0,cursosKeysSet:new Set,cursosLabelsSet:new Set});let D=n.get(P);D.cursosKeysSet.add(u),D.cursosLabelsSet.add(f)}}this.materiasParaListasOficiales=Array.from(n.values()).map(r=>{let u=Array.from(r.cursosLabelsSet.values());return u.sort((f,b)=>f.localeCompare(b)),{key:r.key,nombre:r.nombre,rango:r.rango,selected:r.selected,cursosKeys:Array.from(r.cursosKeysSet.values()),cursosLabel:u.join(" | ")}}).sort((r,u)=>r.rango!==u.rango?r.rango-u.rango:r.nombre.localeCompare(u.nombre)),this.materiasParaListasOficiales.length===0&&this._tools.MostrarMensaje("info","No se encontraron materias para los cursos seleccionados")}catch(n){console.error(n),this.materiasParaListasOficiales=[],this._tools.MostrarMensaje("error","No se pudieron cargar las materias")}finally{this.isLoadingMateriasParaListasOficiales=!1}}})}toggleSeleccionarTodasMateriasParaListasOficiales(t){(this.materiasParaListasOficiales||[]).forEach(e=>e.selected=t)}getMateriasParaListasOficialesSeleccionadas(){return(this.materiasParaListasOficiales||[]).filter(t=>!!t.selected).map(t=>({nombre:t.nombre,rango:t.rango}))}getMateriaSelectedKeysForCurso(t){let e=`${(t?.curso??"").toString().trim()}||${(t?.paralelo??"").toString().trim()}||${(t?.turno??"").toString().trim()}`;return(this.materiasParaListasOficiales||[]).filter(i=>!!i.selected).filter(i=>Array.isArray(i.cursosKeys)&&i.cursosKeys.includes(e)).map(i=>({nombre:i.nombre,rango:i.rango}))}toggleSeleccionarTodosCursosParaListasOficiales(t){(this.cursosParaListasOficiales||[]).forEach(e=>e.selected=t)}getCursosParaListasOficialesSeleccionadosCount(){return(this.cursosParaListasOficiales||[]).filter(t=>!!t.selected).length}generarListasOficialesSeleccionadas(){return V(this,null,function*(){let t=this.getAnioIdSeleccionadoOrWarn();if(!t)return;let e=(this.resolucionSeleccionada??"").toString().trim();if(!e){this._tools.MostrarMensaje("warning","Seleccione una resoluci\xF3n");return}let i=(this.cursosParaListasOficiales||[]).filter(r=>!!r.selected);if(i.length===0){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}if(this.isGenerandoListasOficiales)return;this.isGenerandoListasOficiales=!0;let n=this.getGestionLabel()||String(t);try{if(this.modoListasOficiales==="GENERAL")for(let r of i){let u=yield G(this._estadisticas.ObtenerEstudiantesAsignados({anio_id:t,resolucion:e,lvl_curso:r.curso,paralelo:r.paralelo,turno:r.turno,modo:"SIMPLIFICADO",limit:2e3})),f=Array.isArray(u?.data)?u.data:[];yield this._repo.GenerarListaOficialAsignaciones2026(f,{gestionTxt:n,resolucion:e,lvlCurso:r.curso,paralelo:r.paralelo,turno:r.turno,tipo:"GENERAL"})}else{if(this.getMateriasParaListasOficialesSeleccionadas().length===0){this._tools.MostrarMensaje("warning","Seleccione al menos una materia (o cargue materias)");return}for(let u of i){let f=this.getMateriaSelectedKeysForCurso(u);if(f.length===0)continue;let b=[];for(let C of f){let E=yield G(this._estadisticas.ObtenerEstudiantesAsignados({anio_id:t,resolucion:e,lvl_curso:u.curso,paralelo:u.paralelo,turno:u.turno,modo:"NORMAL",nombre_materia:C.nombre,rango:Number.isFinite(Number(C.rango))?Number(C.rango):void 0,limit:2e3})),I=Array.isArray(E?.data)?E.data:[];b.push({nombreMateria:C.nombre,estudiantes:I})}yield this._repo.GenerarListaOficialAsignacionesPorMaterias2026(b,{gestionTxt:n,resolucion:e,lvlCurso:u.curso,paralelo:u.paralelo,turno:u.turno})}}try{this.modalListasOficialesCursosRef?.close?.()}catch{}}catch(r){console.error(r),this._tools.MostrarMensaje("error","No se pudieron generar las listas oficiales")}finally{this.isGenerandoListasOficiales=!1}})}abrirModalListasDocente(){return V(this,null,function*(){if(this.getAnioIdSeleccionadoOrWarn()&&(this.docenteTxt=this.docenteSeleccionado?this.getNombreCompletoDocente(this.docenteSeleccionado):"",this.docentesFiltrados=[],this.mostrarListaDocentes=!1,this.isGenerandoListasDocente=!1,this.generandoExcelDocente=!1,this.isLoadingPreviewDocente=!1,this.setModoDocente(this.modoDocente||"especialidad"),this.reiniciarFiltrosCursoDocente(),this.previewDocenteRows=[],this.previewDocenteTotal=0,this.docenteCursos=[],this.cursoPreviewLabelDocente="",this.instrumentoOptionsDocente=[],this.instrumentoSeleccionadoDocente="",this.modalListasDocenteRef=this._tools.openModal(this.modalListasDocente,"lg",{scrollable:!0}),!(this.docentesParaListas.length>0))){this.isLoadingDocentesParaListas=!0;try{let e=yield G(this._planteldoc.Obtenerplanteldocentes()),i=Array.isArray(e?.data)?e.data:[];this.docentesParaListas=i.filter(n=>(n?.Visibilidad??"").toString().trim().toUpperCase()!=="OCULTO").sort((n,r)=>this.getNombreCompletoDocente(n).localeCompare(this.getNombreCompletoDocente(r)))}catch(e){console.error(e),this.docentesParaListas=[],this._tools.MostrarMensaje("error","No se pudieron cargar los docentes")}finally{this.isLoadingDocentesParaListas=!1}}})}setModoDocente(t){if(this.modoDocente=t,t==="complementario"){this.docenteFieldKey="planteldocadmins_idOtros",this.instrumentoFieldKey="InstrumentoMusicalSecundario",this.tituloModoDocente="Complementario";return}if(t==="practicaconjuntos"){this.docenteFieldKey="planteldocadmins_idPC",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModoDocente="Pr\xE1ctica de conjuntos";return}this.docenteFieldKey="planteldocadmins_id",this.instrumentoFieldKey="InstrumentoMusical",this.tituloModoDocente="Especialidad"}onDocenteBlur(){window.setTimeout(()=>{this.mostrarListaDocentes=!1},150)}normalizarTxt(t){return(t??"").toString().trim().toUpperCase()}getNombreCompletoDocente(t){let e=(t?.Nombres??"").toString().trim(),i=(t?.Apellidos??"").toString().trim();return`${e} ${i}`.replace(/\s+/g," ").trim()}filtrarDocentes(){let t=(this.docenteTxt??"").toString().trim().toLowerCase();if(!t){this.docentesFiltrados=[],this.mostrarListaDocentes=!1;return}this.docenteSeleccionado&&this.docenteTxt!==this.getNombreCompletoDocente(this.docenteSeleccionado)&&(this.docenteSeleccionado=null);let e=this.docentesParaListas||[];this.docentesFiltrados=e.filter(i=>this.getNombreCompletoDocente(i).toLowerCase().includes(t)).slice(0,25),this.mostrarListaDocentes=!0}seleccionarDocente(t){t&&(this.docenteSeleccionado=t,this.docenteTxt=this.getNombreCompletoDocente(t),this.mostrarListaDocentes=!1,this.docentesFiltrados=[],this.refrescarPreviewDocente(!0))}limpiarDocenteSeleccionado(){this.docenteSeleccionado=null,this.docenteTxt="",this.docentesFiltrados=[],this.reiniciarFiltrosCursoDocente(),this.previewDocenteRows=[],this.previewDocenteTotal=0,this.docenteCursos=[],this.cursoPreviewLabelDocente="",this.instrumentoOptionsDocente=[],this.instrumentoSeleccionadoDocente="",this.docenteRowsCacheKey=null,this.docenteRowsCacheRows=[]}onModoDocenteChange(){this.setModoDocente(this.modoDocente),this.reiniciarFiltrosCursoDocente(),this.previewDocenteRows=[],this.previewDocenteTotal=0,this.docenteCursos=[],this.cursoPreviewLabelDocente="",this.instrumentoOptionsDocente=[],this.instrumentoSeleccionadoDocente="",this.docenteRowsCacheKey=null,this.docenteRowsCacheRows=[],this.docenteSeleccionado?.id&&this.refrescarPreviewDocente(!0)}onTipoListaDocenteChange(){this.reiniciarFiltrosCursoDocente(),this.docenteCursos=[],this.cursoPreviewLabelDocente="",this.instrumentoOptionsDocente=[],this.instrumentoSeleccionadoDocente="",this.docenteSeleccionado?.id&&this.refrescarPreviewDocente(!1)}onCursoDocenteChange(){this.docenteSeleccionado?.id&&this.refrescarPreviewDocente(!1)}onInstrumentoDocenteChange(){this.docenteSeleccionado?.id&&this.refrescarPreviewDocente(!1)}getCursoFiltroTextoDocente(){return this.tipoListaDocente==="NO_OFICIAL"?(this.cursoSolicitadoSeleccionadoDocente||"").trim():this.tipoListaDocente==="OFICIAL"?(this.cursoAsignadoSeleccionadoDocente||"").trim():(this.cursoMixtoSeleccionadoDocente||"").trim()}getMateriaBasePorModoDocente(){return this.modoDocente==="complementario"?"INSTRUMENTO COMPLEMENTARIO":this.modoDocente==="practicaconjuntos"?"PRACTICA DE CONJUNTOS":"INSTRUMENTO DE ESPECIALIDAD I"}getMateriaLabelDocente(){let t=this.getMateriaBasePorModoDocente(),e=(this.instrumentoSeleccionadoDocente||"").toString().trim();return e?`${t} (${e})`:t}getCursoLabelRowDocente(t){return this.tipoListaDocente==="NO_OFICIAL"?this.cursoSolicitadoLabel(t):this.tipoListaDocente==="OFICIAL"?this.cursoAsignadoLabel(t):this.esCursoAsignadoSinAsignar(t)?this.cursoSolicitadoLabel(t):this.cursoAsignadoLabel(t)}buildCursosDocenteDesdeRows(t){let e=this.aplicarFiltroDocente(t),i=new Map;return e.forEach(n=>{let r=this.getCursoLabelRowDocente(n);r&&i.set(r,(i.get(r)??0)+1)}),Array.from(i.entries()).map(([n,r])=>({label:n,total:r,selected:!1})).sort((n,r)=>n.label.localeCompare(r.label))}toggleSeleccionarTodosCursosDocente(t){this.docenteCursos=(this.docenteCursos||[]).map(e=>re(ie({},e),{selected:!!t}))}getCursosDocenteSeleccionadosCount(){return(this.docenteCursos||[]).filter(t=>!!t.selected).length}seleccionarCursoPreviewDocente(t){this.cursoPreviewLabelDocente=(t??"").toString().trim(),this.docenteSeleccionado?.id&&this.refrescarPreviewDocente(!1)}isGenerandoExcelDocenteCurso(t){return!!this.generandoExcelDocenteCursos?.[t]}reiniciarFiltrosCursoDocente(){this.cursoSolicitadoSeleccionadoDocente="",this.cursoAsignadoSeleccionadoDocente="",this.cursoMixtoSeleccionadoDocente=""}esCursoAsignadoSinAsignar(t){let e=String(t?.CursoAsignado??"").trim().toUpperCase();return!e||e==="SIN ASIGNAR"}cursoSolicitadoLabel(t){return`${String(t?.Curso_Solicitado??"").trim()} ${String(t?.Paralelo_Solicitado??"").trim()}`.replace(/\s+/g," ").trim()}cursoAsignadoLabel(t){return`${String(t?.CursoAsignado??"").trim()} ${String(t?.ParaleloAsignado??"").trim()}`.replace(/\s+/g," ").trim()}recalcularCursosOptionsDesdeRows(t){let e=new Map,i=new Map;(t||[]).forEach(r=>{let u=String(r?.Curso_Solicitado??"").trim(),f=String(r?.Paralelo_Solicitado??"").trim(),b=`${u} ${f}`.replace(/\s+/g," ").trim();u&&e.set(b,{label:b,curso:u,paralelo:f});let C=String(r?.CursoAsignado??"").trim(),E=String(r?.ParaleloAsignado??"").trim(),I=`${C} ${E}`.replace(/\s+/g," ").trim();C&&C.toUpperCase()!=="SIN ASIGNAR"&&i.set(I,{label:I,curso:C,paralelo:E})}),this.cursoSolicitadoOptionsDocente=Array.from(e.values()).sort((r,u)=>r.label.localeCompare(u.label)),this.cursoAsignadoOptionsDocente=Array.from(i.values()).sort((r,u)=>r.label.localeCompare(u.label));let n=new Map;this.cursoSolicitadoOptionsDocente.forEach(r=>n.set(r.label,r)),this.cursoAsignadoOptionsDocente.forEach(r=>n.set(r.label,r)),this.cursoMixtoOptionsDocente=Array.from(n.values()).sort((r,u)=>r.label.localeCompare(u.label)),this.cursoSolicitadoSeleccionadoDocente&&!this.cursoSolicitadoOptionsDocente.some(r=>r.label===this.cursoSolicitadoSeleccionadoDocente)&&(this.cursoSolicitadoSeleccionadoDocente=""),this.cursoAsignadoSeleccionadoDocente&&!this.cursoAsignadoOptionsDocente.some(r=>r.label===this.cursoAsignadoSeleccionadoDocente)&&(this.cursoAsignadoSeleccionadoDocente=""),this.cursoMixtoSeleccionadoDocente&&!this.cursoMixtoOptionsDocente.some(r=>r.label===this.cursoMixtoSeleccionadoDocente)&&(this.cursoMixtoSeleccionadoDocente="")}aplicarFiltroDocente(t){let e=this.tipoListaDocente,i=(this.instrumentoSeleccionadoDocente||"").toString().trim(),n=f=>i?(f||[]).filter(b=>(b?.[this.instrumentoFieldKey]??"").toString().trim()===i):f;if(e==="NO_OFICIAL"){let f=(this.cursoSolicitadoSeleccionadoDocente??"").trim(),b=(t||[]).filter(C=>this.esCursoAsignadoSinAsignar(C)).filter(C=>!f||this.cursoSolicitadoLabel(C)===f);return n(b)}if(e==="OFICIAL"){let f=(this.cursoAsignadoSeleccionadoDocente??"").trim(),b=(t||[]).filter(C=>!this.esCursoAsignadoSinAsignar(C)).filter(C=>!f||this.cursoAsignadoLabel(C)===f);return n(b)}let r=(this.cursoMixtoSeleccionadoDocente??"").trim();if(!r)return n((t||[]).slice());let u=(t||[]).filter(f=>{let b=this.cursoAsignadoLabel(f),C=this.cursoSolicitadoLabel(f);return this.esCursoAsignadoSinAsignar(f)?C===r:b===r});return n(u)}cursosUnicosDesdeFilas(t,e){let i=new Set;return(t||[]).forEach(n=>{let r=`${String(n?.Curso_Solicitado??"").trim()} ${String(n?.Paralelo_Solicitado??"").trim()}`.replace(/\s+/g," ").trim(),u=`${String(n?.CursoAsignado??"").trim()} ${String(n?.ParaleloAsignado??"").trim()}`.replace(/\s+/g," ").trim(),f=u&&!u.toUpperCase().includes("SIN ASIGNAR");if(e==="solicitado"){r&&!r.toUpperCase().includes("SIN DETERMINAR")&&i.add(r);return}if(e==="asignado"){f&&i.add(u);return}f?i.add(u):r&&!r.toUpperCase().includes("SIN DETERMINAR")&&i.add(r)}),Array.from(i.values()).sort((n,r)=>n.localeCompare(r)).join(", ")}buildCacheKeyDocente(t,e){return`${t}||${e}||${this.docenteFieldKey}`}cargarFilasDocente(t=!1){return V(this,null,function*(){let e=this.getAnioIdSeleccionadoOrWarn();if(!e)return[];let i=Number(this.docenteSeleccionado?.id??0);if(!Number.isFinite(i)||i<=0)return[];let n=this.buildCacheKeyDocente(e,i);if(!t&&this.docenteRowsCacheKey===n&&Array.isArray(this.docenteRowsCacheRows)&&this.docenteRowsCacheRows.length)return this.docenteRowsCacheRows;let r={page:1,per_page:5e3,anio_id:e,search_mode:"any",relevance:0,include_sin_docente:0,include_sin_asignar:1,anio_scope:"default",[this.docenteFieldKey]:i},u=yield G(this._infoest.Obtenerinfoestudiantesifas(r)),f=Array.isArray(u?.data)?u.data:[];return this.docenteRowsCacheKey=n,this.docenteRowsCacheRows=f,f})}refrescarPreviewDocente(t=!1){return V(this,null,function*(){if(this.docenteSeleccionado?.id&&!this.isLoadingPreviewDocente){this.isLoadingPreviewDocente=!0;try{let e=yield this.cargarFilasDocente(t);this.recalcularCursosOptionsDesdeRows(e);let i=new Set((this.docenteCursos||[]).filter(b=>!!b.selected).map(b=>b.label));this.docenteCursos=this.buildCursosDocenteDesdeRows(e).map(b=>re(ie({},b),{selected:i.has(b.label)})),this.docenteCursos.length>0?this.cursoPreviewLabelDocente&&this.docenteCursos.some(C=>C.label===this.cursoPreviewLabelDocente)||(this.cursoPreviewLabelDocente=this.docenteCursos[0].label):this.cursoPreviewLabelDocente="";let n=(()=>{let b=this.instrumentoSeleccionadoDocente;this.instrumentoSeleccionadoDocente="";let C=this.aplicarFiltroDocente(e);return this.instrumentoSeleccionadoDocente=b,C})(),r=new Map;n.forEach(b=>{let C=(b?.[this.instrumentoFieldKey]??"").toString().trim();C&&r.set(C,!0)}),this.instrumentoOptionsDocente=Array.from(r.keys()).sort((b,C)=>b.localeCompare(C)),this.instrumentoSeleccionadoDocente&&!this.instrumentoOptionsDocente.includes(this.instrumentoSeleccionadoDocente)&&(this.instrumentoSeleccionadoDocente="");let u=this.aplicarFiltroDocente(e),f=this.cursoPreviewLabelDocente?u.filter(b=>this.getCursoLabelRowDocente(b)===this.cursoPreviewLabelDocente):u;this.previewDocenteTotal=f.length,this.previewDocenteRows=f.slice(0,Math.max(10,Number(this.previewPageSizeDocente||100)))}catch(e){console.error(e),this.previewDocenteRows=[],this.previewDocenteTotal=0,this.docenteCursos=[],this.cursoPreviewLabelDocente="",this.instrumentoOptionsDocente=[],this.instrumentoSeleccionadoDocente="",this._tools.MostrarMensaje("error","No se pudo cargar la vista previa")}finally{this.isLoadingPreviewDocente=!1}}})}generarPdfDocenteCursosSeleccionados(){return V(this,null,function*(){if(this.isGenerandoPdfDocenteCursos)return;let t=this.getAnioIdSeleccionadoOrWarn();if(!t)return;if(!this.docenteSeleccionado?.id){this._tools.MostrarMensaje("warning","Seleccione un docente");return}let e=(this.docenteCursos||[]).filter(i=>!!i.selected).map(i=>i.label);if(!e.length){this._tools.MostrarMensaje("warning","Seleccione al menos un curso");return}this.isGenerandoPdfDocenteCursos=!0;try{let i=yield this.cargarFilasDocente(!1),n=this.aplicarFiltroDocente(i),r=this.getGestionLabel(),u=this.getNombreCompletoDocente(this.docenteSeleccionado),f=this.tipoListaDocente==="MIXTO"?"mixto":this.tipoListaDocente==="OFICIAL"?"asignado":"solicitado";for(let b of e){let C=n.filter(I=>this.getCursoLabelRowDocente(I)===b);if(!C.length)continue;let E={reporteTipo:this.tipoListaDocente,tituloModo:this.tituloModoDocente,docente:u,anio_id:t,anio_txt:r,cursosHeaderTxt:b,fecha:new Date,modoCursos:f};yield this._repo.GenerarListaEstudiantesPorDocenteTablaActual(C,E)}}catch(i){console.error(i),this._tools.MostrarMensaje("error","No se pudo generar el PDF")}finally{this.isGenerandoPdfDocenteCursos=!1}})}generarExcelDocenteCurso(t){return V(this,null,function*(){let e=(t??"").toString().trim();if(!(!e||!this.getAnioIdSeleccionadoOrWarn())){if(!this.docenteSeleccionado?.id){this._tools.MostrarMensaje("warning","Seleccione un docente");return}if(!this.generandoExcelDocenteCursos[e]){this.generandoExcelDocenteCursos=re(ie({},this.generandoExcelDocenteCursos||{}),{[e]:!0});try{let n=yield this.cargarFilasDocente(!1),u=this.aplicarFiltroDocente(n).filter(R=>this.getCursoLabelRowDocente(R)===e),f=this.getCategoriaPlantillaExcelDocente(),b=yield this.pedirPlantillaExcel(f);if(!b?.id){this._tools.MostrarMensaje("warning","No se encontr\xF3 plantilla Excel para este modo.");return}let C=this.buildExcelRowsSimple(u),E=this.getNombreCompletoDocente(this.docenteSeleccionado),I=this.getGestionLabel(),P=R=>(R??"").toString().replace(/[^a-zA-Z0-9_\- ]/g,"").trim(),D=[P(E),P(this.tituloModoDocente),P(I),P(this.tipoListaDocente),P(e)].filter(R=>!!R).join(" ").trim(),k=(yield G(this._plantillasExcel.GenerarExcelDesdePlantilla(b.id,{rows:C,filename:D||"registro",docente:E,materia:this.getMateriaLabelDocente(),curso:e,gestion:I})))?.body;if(!k){this._tools.MostrarMensaje("error","No se recibi\xF3 el archivo Excel");return}let Y=`${D||"registro"}.xlsx`;this.descargarBlob(k,Y)}catch(n){console.error(n),this._tools.MostrarMensaje("error","Error al generar el Excel")}finally{this.generandoExcelDocenteCursos=re(ie({},this.generandoExcelDocenteCursos||{}),{[e]:!1})}}}})}generarPdfDocente(){return V(this,null,function*(){if(!this.docenteSeleccionado?.id)return;let t=this.getAnioIdSeleccionadoOrWarn();if(t&&!this.isGenerandoListasDocente){this.isGenerandoListasDocente=!0;try{let e=yield this.cargarFilasDocente(!1),i=this.aplicarFiltroDocente(e);if(!i.length){this._tools.MostrarMensaje("info","No hay filas para el reporte con los filtros actuales");return}let n=this.tipoListaDocente==="MIXTO"?"mixto":this.tipoListaDocente==="OFICIAL"?"asignado":"solicitado",r={reporteTipo:this.tipoListaDocente,tituloModo:this.getMateriaLabelDocente(),docente:this.getNombreCompletoDocente(this.docenteSeleccionado),anio_id:t,anio_txt:this.getGestionLabel(),instituciones_id:0,institucion:"(seg\xFAn perfil)",cursosHeaderTxt:this.getCursoFiltroTextoDocente()||this.cursosUnicosDesdeFilas(i,n),fecha:new Date};yield this._repo.GenerarListaEstudiantesPorDocenteTablaActual(i,r)}catch(e){console.error(e),this._tools.MostrarMensaje("error","No se pudo generar el reporte")}finally{this.isGenerandoListasDocente=!1}}})}normalizarSexo(t){let e=(t??"").toString().trim().toUpperCase();return e?e==="M"||e.startsWith("MAS")||e.includes("MASC")?"M":e==="F"||e.startsWith("FEM")||e.includes("FEM")?"F":"":""}buildExcelRowsSimple(t){return(t||[]).map(e=>{let i=`${(e?.Ap_Paterno??"").toString().trim()} ${(e?.Ap_Materno??"").toString().trim()} ${(e?.Nombre??"").toString().trim()}`.replace(/\s+/g," ").trim(),n=(e?.CI??"").toString().trim(),r=(e?.[this.instrumentoFieldKey]??e?.InstrumentoMusical??e?.Instrumento??"").toString().trim(),u=this.normalizarSexo(e?.Sexo);return[i,n,r,u==="M"?"X":"",u==="F"?"X":""]})}descargarBlob(t,e){let i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(i),0)}pedirPlantillaExcel(t){return V(this,null,function*(){let e=(t??"").toString().trim();if(!e)return null;let n=(yield G(this._plantillasExcel.ObtenerPlantillas(e,!1)))?.data||[];if(n.length===0)return null;if(n.length===1)return n[0];this.plantillasExcelDisponibles=n,this.modalSeleccionPlantillaExcelRef=this._tools.openModal(this.modalSeleccionPlantillaExcel,"lg",{scrollable:!0});try{return(yield this.modalSeleccionPlantillaExcelRef.result)??null}catch{return null}})}generarExcelDocente(){return V(this,null,function*(){if(!(!this.docenteSeleccionado?.id||!this.getAnioIdSeleccionadoOrWarn())&&!this.generandoExcelDocente){this.generandoExcelDocente=!0;try{let e=yield this.cargarFilasDocente(!1),i=this.aplicarFiltroDocente(e);if(!i.length){this._tools.MostrarMensaje("info","No hay filas para generar");return}let n=this.getCategoriaPlantillaExcelDocente(),r=yield this.pedirPlantillaExcel(n);if(!r?.id){this._tools.MostrarMensaje("warning","No se encontr\xF3 plantilla Excel para este modo.");return}let u=this.buildExcelRowsSimple(i),f=this.getNombreCompletoDocente(this.docenteSeleccionado),b=this.getGestionLabel(),C=this.getCursoFiltroTextoDocente()||this.cursosUnicosDesdeFilas(i,this.tipoListaDocente==="MIXTO"?"mixto":this.tipoListaDocente==="OFICIAL"?"asignado":"solicitado"),E=this.getMateriaLabelDocente(),I=R=>(R??"").toString().replace(/[^a-zA-Z0-9_\- ]/g,"").trim(),P=[I(f),I(E),I(b),I(C)].filter(R=>!!R).join(" ").trim(),D=yield G(this._plantillasExcel.GenerarExcelDesdePlantilla(Number(r.id),{rows:u,filename:P||"registro",docente:f,materia:E,curso:C,gestion:b})),F=D?.body??null;if(!F){this._tools.MostrarMensaje("error","No se pudo generar el Excel");return}let k=D?.headers?.get?.("content-disposition")||D?.headers?.get?.("Content-Disposition"),Y=(P||"registro")+".xlsx";if(k){let R=k.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),Ze=decodeURIComponent((R?.[1]||R?.[2]||"").trim());Ze&&(Y=Ze)}this.descargarBlob(F,Y),this._tools.MostrarMensaje("success",`Excel generado (${i.length} filas)`)}catch(e){console.error(e),this._tools.MostrarMensaje("error","Error al generar el Excel")}finally{this.generandoExcelDocente=!1}}})}getCategoriaPlantillaExcelDocente(){return this.modoDocente==="complementario"?"MODO INSTRUMENTO COMPLEMENTARIO":this.modoDocente==="practicaconjuntos"?"MODO PRACTICA DE CONJUNTOS":"MODO INSTRUMENTOS DE ESPECIALIDAD"}getCursoExcelKey(t){return`${(t?.curso??"").toString().trim()}||${(t?.paralelo??"").toString().trim()}||${(t?.turno??"").toString().trim()}`}isGenerandoExcelCurso(t){return this.generandoExcelCursoKeys.has(this.getCursoExcelKey(t))}descargarExcelListaOficialCurso(t){return V(this,null,function*(){let e=this.getAnioIdSeleccionadoOrWarn();if(!e)return;let i=(this.resolucionSeleccionada??"").toString().trim();if(!i){this._tools.MostrarMensaje("warning","Seleccione una resoluci\xF3n");return}let n=this.getCursoExcelKey(t);if(!this.generandoExcelCursoKeys.has(n)){this.generandoExcelCursoKeys.add(n);try{let r=yield G(this._estadisticas.ObtenerEstudiantesAsignados({anio_id:e,resolucion:i,lvl_curso:t.curso,paralelo:t.paralelo,turno:t.turno,modo:"SIMPLIFICADO",limit:5e3})),u=Array.isArray(r?.data)?r.data:[];if(!u.length){this._tools.MostrarMensaje("info","No hay estudiantes para generar");return}let f=yield this.pedirPlantillaExcel("MODO INSTRUMENTOS DE ESPECIALIDAD");if(!f?.id){this._tools.MostrarMensaje("warning","No se encontr\xF3 plantilla Excel para este modo.");return}let b=this.buildExcelRowsSimple(u),C=this.getGestionLabel(),E=Y=>(Y??"").toString().replace(/[^a-zA-Z0-9_\- ]/g,"").trim(),I=[E(t?.curso),E(t?.paraleloLabel),E(t?.turnoLabel),E(C)].filter(Y=>!!Y).join(" ").trim(),P=yield G(this._plantillasExcel.GenerarExcelDesdePlantilla(Number(f.id),{rows:b,filename:I||"lista_oficial",docente:"",materia:"",curso:`${(t?.curso??"").toString().trim()} ${(t?.paraleloLabel??"").toString().trim()}`.replace(/\s+/g," ").trim(),gestion:C})),D=P?.body??null;if(!D){this._tools.MostrarMensaje("error","No se pudo generar el Excel");return}let F=P?.headers?.get?.("content-disposition")||P?.headers?.get?.("Content-Disposition"),k=(I||"lista_oficial")+".xlsx";if(F){let Y=F.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),R=decodeURIComponent((Y?.[1]||Y?.[2]||"").trim());R&&(k=R)}this.descargarBlob(D,k),this._tools.MostrarMensaje("success",`Excel generado (${u.length} filas)`)}catch(r){console.error(r),this._tools.MostrarMensaje("error","Error al generar el Excel")}finally{this.generandoExcelCursoKeys.delete(n)}}})}};be.\u0275fac=function(e){return new(e||be)(O(xt),O(he),O(ke),O(fe),O(ae),O(vt),O(Ge))},be.\u0275cmp=$({type:be,selectors:[["app-documentosimportantes"]],viewQuery:function(e,i){if(e&1&&(J(ki,7),J(Gi,7),J(ji,7),J(Bi,7),J($i,7)),e&2){let n;ee(n=te())&&(i.modalAutocompletarCarreraCuadro=n.first),ee(n=te())&&(i.modalListasPreliminaresCursos=n.first),ee(n=te())&&(i.modalListasOficialesCursos=n.first),ee(n=te())&&(i.modalListasDocente=n.first),ee(n=te())&&(i.modalSeleccionPlantillaExcel=n.first)}},standalone:!1,decls:23,vars:1,consts:[["modalListasDocente",""],["modalSeleccionPlantillaExcel",""],["modalListasPreliminaresCursos",""],["modalListasOficialesCursos",""],["modalAutocompletarCarreraCuadro",""],["class","card shadow mb-4",4,"ngIf"],["id","modalGeneracionCuadroEstudiantes","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body"],[1,"mb-4"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"card","shadow","mb-4"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center"],[1,"me-2"],[1,"bi","bi-file-earmark-text"],[1,"mb-0","fw-bold","fs-4"],[1,"card-body"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-4"],[1,"form-label","fw-bold","fst-italic","text-warning"],["type","number","placeholder","NUMERO PAGINA",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-2"],[1,"form-label"],["name","Curso_id","id","Curso_idModal",1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Gestion"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3"],[1,"form-select","bg-danger","bg-opacity-25",3,"ngModelChange","ngModelOptions","ngModel"],["label","Seleccione Nivel"],["value","MIXTO"],["value","TECNICO SUPERIOR"],["value","CAPACITACI\xD3N"],[1,"col-md-3","d-flex","align-items-end"],[1,"form-check"],["type","checkbox","id","toggleContent",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","toggleContent",1,"form-check-label"],[1,"col-md-12"],["type","checkbox","id","chkSinAsignarCuadro",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","chkSinAsignarCuadro",1,"form-check-label","text-danger","fw-bold"],["class","row g-3",4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-outline-primary","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],[1,"bi","bi-list-check"],["type","button",1,"btn","btn-success","btn-lg","d-flex","align-items-center","gap-2",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","width","28","height","28","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-download"],["d","M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"],["d","M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"],[4,"ngIf"],[3,"value"],[1,"row","g-3"],["type","text",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],[1,"col-md-4","d-flex","align-items-center"],["type","checkbox","id","contadormanual",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","contadormanual",1,"form-check-label"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"d-flex","flex-wrap","gap-2","align-items-center"],[1,"badge","bg-secondary"],[1,"badge","bg-light","text-dark"],[1,"row"],[1,"col-12","col-md-6"],[1,"mb-2"],[1,"input-group"],["placeholder","Buscar docente...",1,"form-control",3,"ngModelChange","input","focus","blur","ngModel","ngModelOptions"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","list-group mt-2",4,"ngIf"],[1,"col-12","col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel","ngModelOptions"],["value","especialidad"],["value","complementario"],["value","practicaconjuntos"],["value","NO_OFICIAL"],["value","OFICIAL"],["class","row",4,"ngIf"],[1,"modal-footer",2,"display","flex","justify-content","space-between","align-items","center"],[1,"d-flex","w-100","justify-content-between","align-items-center","gap-2"],[1,"button","d-flex","gap-2"],["type","button","title","Actualizar",1,"btn","mouse-dir","secondary","d-flex","align-items-center","gap-2",3,"click","disabled"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],[1,"dir-part"],["type","button","title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center","gap-2",3,"click"],["type","button","title","Generar PDF",1,"btn","mouse-dir","primary","d-flex","align-items-center","gap-2",3,"click","disabled"],["type","button","title","Generar Excel",1,"btn","mouse-dir","success","d-flex","align-items-center","gap-2",3,"click","disabled"],[1,"list-group","mt-2"],["type","button","class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],["class","list-group-item",4,"ngIf"],["type","button",1,"list-group-item","list-group-item-action",3,"click"],[1,"list-group-item"],["class","form-select",3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],[1,"text-muted"],["value",""],[1,"col-12"],[1,"d-flex","align-items-center","justify-content-between"],[1,"fw-bold"],[1,"text-muted",2,"font-size","12px"],["class","mt-2",4,"ngIf"],["class","table-responsive mt-2",4,"ngIf"],[1,"mt-2"],[1,"d-flex","align-items-center"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"table-responsive","mt-2"],[1,"table","table-sm","table-striped"],[2,"width","36px"],[4,"ngFor","ngForOf"],["colspan","4",1,"text-muted"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"modal-header"],["type","button",1,"btn-close",3,"click"],["class","list-group",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"list-group"],["type","button","class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click"],["class","badge bg-danger",4,"ngIf"],["class","badge bg-light text-dark",4,"ngIf"],["class","mt-3",4,"ngIf"],["class","alert alert-warning mt-3",4,"ngIf"],["class","table-responsive mt-3","style","max-height: 55vh;",4,"ngIf"],[1,"badge","bg-danger"],[1,"mt-3"],[1,"text-center","py-4"],[1,"alert","alert-warning","mt-3"],[1,"table-responsive","mt-3",2,"max-height","55vh"],[1,"table","table-sm","table-hover","align-middle"],[1,"table-light",2,"position","sticky","top","0","z-index","1"],[2,"width","46px"],["type","checkbox",1,"form-check-input",3,"change"],[1,"text-end"],["style","cursor: pointer;",3,"click",4,"ngFor","ngForOf"],[2,"cursor","pointer",3,"click"],["type","checkbox",1,"form-check-input",3,"ngModelChange","click","ngModel","ngModelOptions"],[1,"fw-semibold"],[1,"row","g-3","mt-2"],[1,"col-md-6"],[1,"form-label","fw-semibold"],[1,"form-select",3,"ngModelChange","change","ngModelOptions","ngModel","disabled"],[1,"d-flex","gap-3","align-items-center",2,"min-height","38px"],["type","radio","name","modoListasOficiales","id","modoListasOficialesGeneral","value","GENERAL",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","modoListasOficialesGeneral",1,"form-check-label"],["type","radio","name","modoListasOficiales","id","modoListasOficialesMateria","value","POR_MATERIA",1,"form-check-input",3,"ngModelChange","ngModelOptions","ngModel"],["for","modoListasOficialesMateria",1,"form-check-label"],[1,"d-flex","gap-2","align-items-center","flex-wrap"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click","disabled"],["class","text-muted small",4,"ngIf"],["class","alert alert-info mt-2",4,"ngIf"],["class","table-responsive mt-2","style","max-height: 30vh;",4,"ngIf"],[1,"text-muted","small"],[1,"alert","alert-info","mt-2"],[1,"table-responsive","mt-2",2,"max-height","30vh"],[2,"width","160px"],[1,"text-muted","small",3,"title"],[1,"text-center",2,"width","110px"],[1,"text-center"],["type","button","title","Descargar Excel (solo este curso)",1,"btn","btn-outline-success","btn-sm",3,"click","disabled"],[1,"modal-header","bg-warning","text-dark"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"alert","alert-warning","mb-3"],["placeholder","Escribe o elige...","list","datalistCarrerasCuadro",1,"form-control",3,"ngModelChange","ngModelOptions","ngModel"],["id","datalistCarrerasCuadro"],[1,"d-flex","w-100","justify-content-end","gap-2"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,i){e&1&&(h(0,Hi,62,23,"div",5)(1,gn,72,25,"ng-template",null,0,B)(3,vn,7,2,"ng-template",null,1,B)(5,Tn,30,12,"ng-template",null,2,B)(7,zn,50,23,"ng-template",null,3,B)(9,Qn,26,6,"ng-template",null,4,B),o(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"h5",10),s(16,"FORMULARIO - CUADRO ESTUDIANTES"),a(),v(17,"button",11),a(),o(18,"div",12),v(19,"div",13),a(),o(20,"div",14)(21,"button",15),s(22,"Cancelar"),a()()()()()),e&2&&d("ngIf",!0)},dependencies:[U,W,pe,q,X,K,Ve,Ne,Q,mt,z,ue,H,dt,ge],encapsulation:2});var $e=be;function qn(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e.id),c(),x(e.Anio)}}function Xn(l,t){if(l&1&&(o(0,"option",25),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Yn(l,t){l&1&&v(0,"span",32)}function Zn(l,t){if(l&1){let e=S();o(0,"div",26)(1,"div",27)(2,"button",28),g("click",function(){p(e);let n=m();return _(n.cargarEstadisticas())}),h(3,Yn,1,0,"span",29),s(4," Recargar estad\xEDsticas "),a()(),o(5,"div",30)(6,"div",31),s(7,"Registros: "),o(8,"strong"),s(9),a()()()()}if(l&2){let e=m();c(2),d("disabled",e.isLoading),c(),d("ngIf",e.isLoading),c(6),x(e.totalFiltrado)}}function Jn(l,t){l&1&&(o(0,"th"),s(1,"Materia"),a())}function eo(l,t){l&1&&(o(0,"th"),s(1,"Materias (diferenciado)"),a())}function to(l,t){if(l&1&&(o(0,"tr")(1,"td",33)(2,"div",34)(3,"span",35),s(4,"Cargando..."),a()()()()),l&2){let e=m();c(),Z("colspan",e.modo==="NORMAL"?18:e.modo==="SIMPLE_DIFERENCIADO"?17:16)}}function io(l,t){if(l&1&&(o(0,"tr")(1,"td",36),s(2," No hay estad\xEDsticas para la gesti\xF3n seleccionada. "),a()()),l&2){let e=m();c(),Z("colspan",e.modo==="NORMAL"?18:e.modo==="SIMPLE_DIFERENCIADO"?17:16)}}function no(l,t){if(l&1&&(o(0,"td"),s(1),a()),l&2){let e=m().$implicit;c(),x(e.NombreMateria)}}function oo(l,t){if(l&1&&(o(0,"td"),s(1),a()),l&2){let e=m().$implicit;c(),x(e.Materias)}}function ao(l,t){if(l&1){let e=S();o(0,"tr")(1,"td",19),s(2),a(),o(3,"td",37),s(4),o(5,"div",38),s(6),a()(),o(7,"td"),s(8),a(),o(9,"td",19),s(10),o(11,"div",38),s(12),a()(),h(13,no,2,1,"td",20)(14,oo,2,1,"td",20),o(15,"td",21)(16,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"NUEVO","MASCULINO","Nuevos M"))}),s(17),a()(),o(18,"td",21)(19,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"NUEVO","FEMENINO","Nuevos F"))}),s(20),a()(),o(21,"td",21)(22,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"NUEVO","","Total nuevos"))}),s(23),a()(),o(24,"td",21)(25,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"ANTIGUO","MASCULINO","Antiguos M"))}),s(26),a()(),o(27,"td",21)(28,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"ANTIGUO","FEMENINO","Antiguos F"))}),s(29),a()(),o(30,"td",21)(31,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"ANTIGUO","","Total antiguos"))}),s(32),a()(),o(33,"td",21)(34,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"","MASCULINO","Total M"))}),s(35),a()(),o(36,"td",21)(37,"button",39),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"","FEMENINO","Total F"))}),s(38),a()(),o(39,"td",40)(40,"button",41),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalCantidad(n,"","","Total general"))}),s(41),a()()()}if(l&2){let e=t.$implicit,i=t.index,n=m();c(2),x(i+1),c(2),y("",e.Anio," "),c(2),x(e.Resolucion),c(2),x(e.LvlCurso),c(2),y("",e.Paralelo," "),c(2),x(e.Turno),c(),d("ngIf",n.modo==="NORMAL"),c(),d("ngIf",n.modo==="SIMPLE_DIFERENCIADO"),c(2),d("title","Ver estudiantes ("+e.Nuevos_M+")"),c(),x(e.Nuevos_M),c(2),d("title","Ver estudiantes ("+e.Nuevos_F+")"),c(),x(e.Nuevos_F),c(2),d("title","Ver estudiantes ("+e.Total_Nuevos+")"),c(),x(e.Total_Nuevos),c(2),d("title","Ver estudiantes ("+e.Antiguos_M+")"),c(),x(e.Antiguos_M),c(2),d("title","Ver estudiantes ("+e.Antiguos_F+")"),c(),x(e.Antiguos_F),c(2),d("title","Ver estudiantes ("+e.Total_Antiguos+")"),c(),x(e.Total_Antiguos),c(2),d("title","Ver estudiantes ("+e.Total_M+")"),c(),x(e.Total_M),c(2),d("title","Ver estudiantes ("+e.Total_F+")"),c(),x(e.Total_F),c(2),d("title","Ver estudiantes ("+e.Total_Gral+")"),c(),x(e.Total_Gral)}}function ro(l,t){l&1&&(o(0,"div",33)(1,"div",34)(2,"span",35),s(3,"Cargando..."),a()()())}function so(l,t){l&1&&(o(0,"div",54),s(1," No hay estudiantes para este criterio. "),a())}function lo(l,t){if(l&1&&(o(0,"tr")(1,"td",19),s(2),a(),o(3,"td"),s(4),a(),o(5,"td",37),s(6),a(),o(7,"td",19),s(8),a(),o(9,"td",19),s(10),a()()),l&2){let e=t.$implicit,i=t.index;c(2),x(i+1),c(2),x(e.Nombre),c(2),x(e.CI),c(2),x(e.Edad??"-"),c(2),x(e.Sexo)}}function co(l,t){if(l&1&&(o(0,"div",17)(1,"table",55)(2,"thead")(3,"tr")(4,"th",19),s(5,"#"),a(),o(6,"th"),s(7,"Nombre"),a(),o(8,"th"),s(9,"CI"),a(),o(10,"th",19),s(11,"Edad"),a(),o(12,"th",19),s(13,"Sexo"),a()()(),o(14,"tbody"),h(15,lo,11,5,"tr",22),a()()()),l&2){let e=m(2);c(15),d("ngForOf",e.modalEstudiantes)}}function mo(l,t){if(l&1){let e=S();o(0,"div",42),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),o(1,"div",43),g("click",function(n){return p(e),_(n.stopPropagation())}),o(2,"div",44)(3,"div",45)(4,"h5",46),s(5),a(),o(6,"button",47),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),a()(),o(7,"div",48),h(8,ro,4,0,"div",49)(9,so,2,0,"div",50)(10,co,16,1,"div",51),a(),o(11,"div",52)(12,"button",53),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),s(13,"Cerrar"),a()()()()()}if(l&2){let e=m();c(5),x(e.modalTitulo),c(3),d("ngIf",e.modalLoading),c(),d("ngIf",!e.modalLoading&&(!e.modalEstudiantes||e.modalEstudiantes.length===0)),c(),d("ngIf",!e.modalLoading&&e.modalEstudiantes&&e.modalEstudiantes.length>0)}}function uo(l,t){l&1&&v(0,"div",56)}var Ce=class Ce{constructor(t,e){this.aniosService=t;this.estadisticasService=e;this.ruta=Le.ruta;this.anios=[];this.anioIdSeleccionado="";this.modo="NORMAL";this.isLoading=!1;this.filtroNivel="";this.filtroTexto="";this.dataRaw=[];this.dataTabla=[];this.modalAbierto=!1;this.modalTitulo="";this.modalLoading=!1;this.modalEstudiantes=[]}cerrarModal(){this.modalAbierto=!1,this.modalTitulo="",this.modalEstudiantes=[],this.modalLoading=!1}abrirModalCantidad(t,e,i,n){let r=String(this.anioIdSeleccionado??"").trim();r&&(this.modalAbierto=!0,this.modalTitulo=`${n} \u2014 ${t.Resolucion} / ${t.LvlCurso} ${t.Paralelo} (${t.Turno})`,this.modalLoading=!0,this.modalEstudiantes=[],this.estadisticasService.ObtenerEstudiantesAsignados({anio_id:r,modo:this.modo==="SIMPLE_DIFERENCIADO"?"SIMPLE_DIFERENCIADO":this.modo==="SIMPLIFICADO"?"SIMPLIFICADO":"NORMAL",resolucion:String(t.Resolucion??""),lvl_curso:String(t.LvlCurso??""),paralelo:String(t.Paralelo??""),turno:String(t.Turno??""),nombre_materia:this.modo==="NORMAL"?String(t.NombreMateria??""):void 0,rango:this.modo==="NORMAL"&&t.Rango!==void 0?Number(t.Rango):void 0,materias:this.modo==="SIMPLE_DIFERENCIADO"?String(t.Materias??""):void 0,categoria:e,sexo:i,limit:2e3}).subscribe({next:u=>{this.modalEstudiantes=u?.data??[],this.modalLoading=!1},error:()=>{this.modalEstudiantes=[],this.modalLoading=!1}}))}ngOnInit(){this.cargarAnios()}cargarAnios(){this.aniosService.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anios=t?.anios??[];let e=t?.predeterminado;e?.id&&(this.anioIdSeleccionado=String(e.id),this.cargarEstadisticas())},error:()=>{this.anios=[]}})}onChangeGestion(){this.cargarEstadisticas()}setModo(t){this.modo=t,this.cargarEstadisticas()}cargarEstadisticas(){let t=String(this.anioIdSeleccionado??"").trim();if(!t){this.dataRaw=[],this.dataTabla=[];return}this.isLoading=!0,this.estadisticasService.ObtenerAsignacionesPorMaterias({anio_id:t,modo:this.modo}).subscribe({next:e=>{this.dataRaw=(e?.data??[]).map(i=>re(ie({},i),{RangoLvlCurso:Number(i?.RangoLvlCurso??0),Rango:i?.Rango===null||i?.Rango===void 0?void 0:Number(i?.Rango??0),Nuevos_M:Number(i?.Nuevos_M??0),Nuevos_F:Number(i?.Nuevos_F??0),Total_Nuevos:Number(i?.Total_Nuevos??0),Antiguos_M:Number(i?.Antiguos_M??0),Antiguos_F:Number(i?.Antiguos_F??0),Total_Antiguos:Number(i?.Total_Antiguos??0),Total_M:Number(i?.Total_M??0),Total_F:Number(i?.Total_F??0),Total_Gral:Number(i?.Total_Gral??0)})),this.dataTabla=[...this.dataRaw],this.isLoading=!1},error:()=>{this.dataRaw=[],this.dataTabla=[],this.isLoading=!1}})}get nivelesCursos(){let t=new Set;for(let e of this.dataTabla??[]){let i=String(e?.LvlCurso??"").trim();i&&t.add(i)}return Array.from(t).sort((e,i)=>e.localeCompare(i))}get dataFiltrada(){let t=String(this.filtroNivel??"").trim(),e=String(this.filtroTexto??"").trim().toUpperCase();return(this.dataTabla??[]).filter(i=>t&&String(i.LvlCurso??"").trim()!==t?!1:e?[i.Anio,i.Resolucion,i.LvlCurso,i.Paralelo,i.Turno,i.NombreMateria,i.Materias].map(r=>String(r??"").toUpperCase()).join(" ").includes(e):!0)}get totalFiltrado(){return this.dataFiltrada.length}};Ce.\u0275fac=function(e){return new(e||Ce)(O(he),O(ae))},Ce.\u0275cmp=$({type:Ce,selectors:[["app-estadisticas"]],standalone:!1,decls:76,vars:22,consts:[[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["role","group",1,"btn-group","w-100"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"form-select",3,"ngModelChange","ngModel"],["placeholder","Materia / resoluci\xF3n / nivel / paralelo",1,"form-control",3,"ngModelChange","ngModel"],["class","row mt-3",4,"ngIf"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center"],[4,"ngIf"],[1,"text-end"],[4,"ngFor","ngForOf"],["class","modal fade show d-block","tabindex","-1","role","dialog",3,"click",4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],[3,"value"],[1,"row","mt-3"],[1,"col-12","col-md-4"],[1,"btn","btn-outline-primary","w-100",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],[1,"col-12","col-md-8","text-md-end","mt-2","mt-md-0"],[1,"text-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-center","text-secondary","py-4"],[2,"white-space","nowrap"],[1,"small","text-muted"],["type","button",1,"btn","btn-link","text-black","p-0","text-end","w-100",3,"click","title"],[1,"text-end","fw-bold"],["type","button",1,"btn","btn-link","text-black","p-0","text-end","w-100","fw-bold",3,"click","title"],["tabindex","-1","role","dialog",1,"modal","fade","show","d-block",3,"click"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-scrollable",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","text-secondary text-center py-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-secondary","text-center","py-3"],[1,"table","table-sm","table-striped","align-middle"],[1,"modal-backdrop","fade","show"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"Estad\xEDsticas de asignaciones estudiantiles"),a(),o(5,"p",4),s(6,"Conteo oficial desde asignaciones (tabla calificaciones)"),a()()()(),o(7,"div",5)(8,"div",6)(9,"label",7),s(10,"Gesti\xF3n"),a(),o(11,"select",8),T("ngModelChange",function(r){return M(i.anioIdSeleccionado,r)||(i.anioIdSeleccionado=r),r}),g("change",function(){return i.onChangeGestion()}),o(12,"option",9),s(13,"Seleccione"),a(),h(14,qn,2,2,"option",10),a()(),o(15,"div",6)(16,"label",7),s(17,"Modo"),a(),o(18,"div",11)(19,"button",12),g("click",function(){return i.setModo("NORMAL")}),s(20," Normal "),a(),o(21,"button",12),g("click",function(){return i.setModo("SIMPLIFICADO")}),s(22," Simplificado "),a(),o(23,"button",12),g("click",function(){return i.setModo("SIMPLE_DIFERENCIADO")}),s(24," Simple diferenciado "),a()()(),o(25,"div",6)(26,"label",7),s(27,"Filtrar por nivel"),a(),o(28,"select",13),T("ngModelChange",function(r){return M(i.filtroNivel,r)||(i.filtroNivel=r),r}),o(29,"option",9),s(30,"Todos"),a(),h(31,Xn,2,2,"option",10),a()(),o(32,"div",6)(33,"label",7),s(34,"Buscar"),a(),o(35,"input",14),T("ngModelChange",function(r){return M(i.filtroTexto,r)||(i.filtroTexto=r),r}),a()()(),h(36,Zn,10,3,"div",15),o(37,"div",16)(38,"div",17)(39,"table",18)(40,"thead")(41,"tr")(42,"th",19),s(43,"#"),a(),o(44,"th"),s(45,"Gesti\xF3n"),a(),o(46,"th"),s(47,"Nivel"),a(),o(48,"th",19),s(49,"Paralelo"),a(),h(50,Jn,2,0,"th",20)(51,eo,2,0,"th",20),o(52,"th",21),s(53,"Nuevos M"),a(),o(54,"th",21),s(55,"Nuevos F"),a(),o(56,"th",21),s(57,"Total nuevos"),a(),o(58,"th",21),s(59,"Antiguos M"),a(),o(60,"th",21),s(61,"Antiguos F"),a(),o(62,"th",21),s(63,"Total antiguos"),a(),o(64,"th",21),s(65,"Total M"),a(),o(66,"th",21),s(67,"Total F"),a(),o(68,"th",21),s(69,"Total gral"),a()()(),o(70,"tbody"),h(71,to,5,1,"tr",20)(72,io,3,1,"tr",20)(73,ao,42,26,"tr",22),a()()()(),h(74,mo,14,4,"div",23)(75,uo,1,0,"div",24)),e&2&&(c(11),w("ngModel",i.anioIdSeleccionado),c(3),d("ngForOf",i.anios),c(5),j("active",i.modo==="NORMAL"),d("disabled",i.isLoading),c(2),j("active",i.modo==="SIMPLIFICADO"),d("disabled",i.isLoading),c(2),j("active",i.modo==="SIMPLE_DIFERENCIADO"),d("disabled",i.isLoading),c(5),w("ngModel",i.filtroNivel),c(3),d("ngForOf",i.nivelesCursos),c(4),w("ngModel",i.filtroTexto),c(),d("ngIf",i.anioIdSeleccionado),c(14),d("ngIf",i.modo==="NORMAL"),c(),d("ngIf",i.modo==="SIMPLE_DIFERENCIADO"),c(20),d("ngIf",i.isLoading),c(),d("ngIf",!i.isLoading&&(!i.dataFiltrada||i.dataFiltrada.length===0)),c(),d("ngForOf",i.dataFiltrada),c(),d("ngIf",i.modalAbierto),c(),d("ngIf",i.modalAbierto))},dependencies:[U,W,q,X,K,Q,z,H],encapsulation:2});var Ue=Ce;function po(l,t){if(l&1&&(o(0,"option",31),s(1),a()),l&2){let e=t.$implicit;d("value",e.id),c(),x(e.Anio)}}function _o(l,t){if(l&1&&(o(0,"option",31),s(1),a()),l&2){let e=t.$implicit;d("value",e.Resolucion),c(),ne("",e.Resolucion," \u2014 ",e.Nivel)}}function go(l,t){l&1&&v(0,"span",37)}function fo(l,t){if(l&1){let e=S();o(0,"div",32)(1,"div",11)(2,"button",33),g("click",function(){p(e);let n=m();return _(n.cargarDocentes())}),h(3,go,1,0,"span",34),s(4," Recargar "),a()(),o(5,"div",35)(6,"div",36),s(7,"Docentes: "),o(8,"strong"),s(9),a()()()()}if(l&2){let e=m();c(2),d("disabled",e.isLoading),c(),d("ngIf",e.isLoading),c(6),x(e.totalDocentes)}}function ho(l,t){l&1&&(o(0,"div",38),s(1,` Los \u201CNo tomados en cuenta\u201D = son aquellos estudiantes que tienen su docente puesto en su inscripci\xF3n; PERO NO SON TOMADOS EN CUENTA POR QUE NO TIENEN REGISTRADO ESA MATERIA.
`),a())}function xo(l,t){l&1&&(o(0,"tr")(1,"td",39)(2,"div",40)(3,"span",41),s(4,"Cargando..."),a()()()())}function vo(l,t){l&1&&(o(0,"tr")(1,"td",42),s(2,"No hay datos para el filtro."),a()())}function bo(l,t){if(l&1&&(o(0,"div",48),s(1),a()),l&2){let e=m().$implicit;c(),x(e.CelularTrabajo)}}function Co(l,t){if(l&1){let e=S();o(0,"tr")(1,"td",20),s(2),a(),o(3,"td")(4,"div",43),s(5),a(),h(6,bo,2,1,"div",44),a(),o(7,"td",45)(8,"button",46),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_id","OK","Especialidad"))}),s(9),a()(),o(10,"td",45)(11,"button",47),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_id","SIN_MODO","Especialidad"))}),s(12),a()(),o(13,"td",45)(14,"button",46),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_idPC","OK","Pr\xE1ctica de conjuntos"))}),s(15),a()(),o(16,"td",45)(17,"button",47),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_idPC","SIN_MODO","Pr\xE1ctica de conjuntos"))}),s(18),a()(),o(19,"td",45)(20,"button",46),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_idOtros","OK","Instrumento complementario"))}),s(21),a()(),o(22,"td",45)(23,"button",47),g("click",function(){let n=p(e).$implicit,r=m();return _(r.abrirModalDetalle(n,"planteldocadmins_idOtros","SIN_MODO","Instrumento complementario"))}),s(24),a()()()}if(l&2){let e=t.$implicit,i=t.index,n=m();c(2),x(i+1),c(3),x(n.getNombreCompletoDocente(e)),c(),d("ngIf",e==null?null:e.CelularTrabajo),c(2),d("disabled",((e==null?null:e.Especialidad_OK)??0)<=0),c(),y(" ",e.Especialidad_OK??0," "),c(2),d("disabled",((e==null?null:e.Especialidad_SinModo)??0)<=0),c(),y(" ",e.Especialidad_SinModo??0," "),c(2),d("disabled",((e==null?null:e.PracticaConjuntos_OK)??0)<=0),c(),y(" ",e.PracticaConjuntos_OK??0," "),c(2),d("disabled",((e==null?null:e.PracticaConjuntos_SinModo)??0)<=0),c(),y(" ",e.PracticaConjuntos_SinModo??0," "),c(2),d("disabled",((e==null?null:e.InstrumentoComplementario_OK)??0)<=0),c(),y(" ",e.InstrumentoComplementario_OK??0," "),c(2),d("disabled",((e==null?null:e.InstrumentoComplementario_SinModo)??0)<=0),c(),y(" ",e.InstrumentoComplementario_SinModo??0," ")}}function So(l,t){l&1&&(o(0,"div",61)(1,"div",40)(2,"span",41),s(3,"Cargando..."),a()()())}function Eo(l,t){l&1&&(o(0,"div",62),s(1," No hay estudiantes para este criterio. "),a())}function yo(l,t){l&1&&(o(0,"th"),s(1,"Instrumento (Especialidad)"),a())}function Io(l,t){l&1&&(o(0,"th"),s(1,"Instrumento (Complementario)"),a())}function wo(l,t){if(l&1&&(o(0,"td",64),s(1),a()),l&2){let e=m().$implicit;c(),x((e.InstrumentoMusical??"")||"-")}}function Mo(l,t){if(l&1&&(o(0,"td",64),s(1),a()),l&2){let e=m().$implicit;c(),x((e.InstrumentoMusicalSecundario??"")||"-")}}function To(l,t){if(l&1&&(o(0,"tr")(1,"td",20),s(2),a(),o(3,"td"),s(4),a(),o(5,"td",64),s(6),a(),o(7,"td",65),s(8),a(),o(9,"td",64),s(10),a(),o(11,"td",64),s(12),a(),o(13,"td",64),s(14),a(),o(15,"td",64),s(16),a(),h(17,wo,2,1,"td",66)(18,Mo,2,1,"td",66),a()),l&2){let e=t.$implicit,i=t.index,n=m(3);c(2),x(i+1),c(2),x(e.Nombre),c(2),x(e.CI),c(2),x(e.Edad??"-"),c(2),x((e.Sexo??"")||"-"),c(2),x((e.Curso??"")||"-"),c(2),x((e.Paralelo??"")||"-"),c(2),x((e.Turno??"")||"-"),c(),d("ngIf",n.modalCampo==="planteldocadmins_id"),c(),d("ngIf",n.modalCampo==="planteldocadmins_idOtros")}}function Po(l,t){if(l&1&&(o(0,"div",18)(1,"table",63)(2,"thead")(3,"tr")(4,"th",20),s(5,"#"),a(),o(6,"th"),s(7,"Nombre"),a(),o(8,"th"),s(9,"CI"),a(),o(10,"th",20),s(11,"Edad"),a(),o(12,"th"),s(13,"Sexo"),a(),o(14,"th"),s(15,"Curso"),a(),o(16,"th"),s(17,"Paralelo"),a(),o(18,"th"),s(19,"Turno"),a(),h(20,yo,2,0,"th",27)(21,Io,2,0,"th",27),a()(),o(22,"tbody"),h(23,To,19,10,"tr",28),a()()()),l&2){let e=m(2);c(20),d("ngIf",e.modalCampo==="planteldocadmins_id"),c(),d("ngIf",e.modalCampo==="planteldocadmins_idOtros"),c(2),d("ngForOf",e.modalEstudiantes)}}function Oo(l,t){if(l&1){let e=S();o(0,"div",49),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),o(1,"div",50),g("click",function(n){return p(e),_(n.stopPropagation())}),o(2,"div",51)(3,"div",52)(4,"h5",53),s(5),a(),o(6,"button",54),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),a()(),o(7,"div",55),h(8,So,4,0,"div",56)(9,Eo,2,0,"div",57)(10,Po,24,3,"div",58),a(),o(11,"div",59)(12,"button",60),g("click",function(){p(e);let n=m();return _(n.cerrarModal())}),s(13,"Cerrar"),a()()()()()}if(l&2){let e=m();c(5),x(e.modalTitulo),c(3),d("ngIf",e.modalLoading),c(),d("ngIf",!e.modalLoading&&(!e.modalEstudiantes||e.modalEstudiantes.length===0)),c(),d("ngIf",!e.modalLoading&&e.modalEstudiantes&&e.modalEstudiantes.length>0)}}function Do(l,t){l&1&&v(0,"div",67)}var Se=class Se{constructor(t,e){this.aniosService=t;this.estadisticasService=e;this.anios=[];this.anioIdSeleccionado="";this.opcionesResolucion=[];this.resolucionSeleccionada="";this.isLoading=!1;this.filtroDocente="";this.docentesRaw=[];this.modalAbierto=!1;this.modalTitulo="";this.modalCampo="";this.modalLoading=!1;this.modalEstudiantes=[]}ngOnInit(){this.cargarAnios()}cargarAnios(){this.aniosService.ObtenerAniosConPredeterminado().subscribe({next:t=>{this.anios=t?.anios??[];let e=t?.predeterminado;e?.id&&(this.anioIdSeleccionado=String(e.id),this.cargarOpcionesResolucion())},error:()=>{this.anios=[]}})}onChangeGestion(){this.resolucionSeleccionada="",this.opcionesResolucion=[],this.docentesRaw=[],this.cargarOpcionesResolucion()}onChangeResolucion(){this.cargarDocentes()}cargarOpcionesResolucion(){let t=String(this.anioIdSeleccionado??"").trim();if(!t){this.opcionesResolucion=[];return}this.estadisticasService.ObtenerOpcionesResolucionNivel({anio_id:t}).subscribe({next:e=>{this.opcionesResolucion=e?.data??[],!this.resolucionSeleccionada&&this.opcionesResolucion.length>0&&(this.resolucionSeleccionada=String(this.opcionesResolucion[0]?.Resolucion??"").trim(),this.resolucionSeleccionada&&this.cargarDocentes())},error:()=>{this.opcionesResolucion=[]}})}cargarDocentes(){let t=String(this.anioIdSeleccionado??"").trim(),e=String(this.resolucionSeleccionada??"").trim();if(!t||!e){this.docentesRaw=[];return}this.isLoading=!0,this.estadisticasService.ObtenerConteoDocentesAsignados({anio_id:t,resolucion:e}).subscribe({next:i=>{this.docentesRaw=i?.data??[],this.isLoading=!1},error:()=>{this.docentesRaw=[],this.isLoading=!1}})}get docentesFiltrados(){let t=String(this.filtroDocente??"").trim().toUpperCase();return t?(this.docentesRaw??[]).filter(e=>`${e?.Apellidos??""} ${e?.Nombres??""}`.toUpperCase().includes(t)):this.docentesRaw??[]}get totalDocentes(){return this.docentesFiltrados.length}getNombreCompletoDocente(t){return`${(t?.Apellidos??"").toString().trim()} ${(t?.Nombres??"").toString().trim()}`.trim()}abrirModalDetalle(t,e,i,n){let r=String(this.anioIdSeleccionado??"").trim(),u=String(this.resolucionSeleccionada??"").trim();!r||!u||(this.modalAbierto=!0,this.modalTitulo=`${n} \u2014 ${this.getNombreCompletoDocente(t)} (${i==="OK"?"Parte":"Sin modo"})`,this.modalCampo=e,this.modalLoading=!0,this.modalEstudiantes=[],this.estadisticasService.ObtenerEstudiantesDocenteAsignados({anio_id:r,resolucion:u,docente_id:t.id,campo:e,tipo:i,limit:5e3}).subscribe({next:f=>{this.modalEstudiantes=f?.data??[],this.modalLoading=!1},error:()=>{this.modalEstudiantes=[],this.modalLoading=!1}}))}cerrarModal(){this.modalAbierto=!1,this.modalTitulo="",this.modalCampo="",this.modalLoading=!1,this.modalEstudiantes=[]}};Se.\u0275fac=function(e){return new(e||Se)(O(he),O(ae))},Se.\u0275cmp=$({type:Se,selectors:[["app-estadisticasmezclainstrs"]],standalone:!1,decls:55,vars:13,consts:[[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","col-md-4"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[1,"col-12","col-md-5"],["placeholder","Apellidos o nombres",1,"form-control",3,"ngModelChange","ngModel"],["class","row mt-3",4,"ngIf"],["class","mt-3 alert alert-secondary",4,"ngIf"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center"],["title","Instrumento de Especialidad Oficial",1,"text-end"],["title","Estudiantes no tomados en cuenta en Especialidad",1,"text-end","text-danger"],["title","Instrumento de Pr\xE1ctica de conjuntos Oficial",1,"text-end"],["title","Estudiantes no tomados en cuenta en Pr\xE1ctica de conjuntos",1,"text-end","text-danger"],["title","Instrumento complementario Oficial",1,"text-end"],["title","Estudiantes no tomados en cuenta en Instrumento complementario",1,"text-end","text-danger"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","modal fade show d-block","tabindex","-1","role","dialog",3,"click",4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],[3,"value"],[1,"row","mt-3"],[1,"btn","btn-outline-primary","w-100",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status","aria-hidden","true",4,"ngIf"],[1,"col-12","col-md-8","text-md-end","mt-2","mt-md-0"],[1,"text-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"],[1,"mt-3","alert","alert-secondary"],["colspan","8",1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["colspan","8",1,"text-center","text-secondary","py-4"],[1,"fw-semibold"],["class","small text-muted",4,"ngIf"],[1,"text-end"],["type","button",1,"btn","btn-link","text-black","p-0","text-end","w-100",3,"click","disabled"],["type","button",1,"btn","btn-link","text-danger","p-0","text-end","w-100",3,"click","disabled"],[1,"small","text-muted"],["tabindex","-1","role","dialog",1,"modal","fade","show","d-block",3,"click"],["role","document",1,"modal-dialog","modal-xl","modal-dialog-scrollable",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","text-center py-4",4,"ngIf"],["class","text-secondary text-center py-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"text-center","py-4"],[1,"text-secondary","text-center","py-3"],[1,"table","table-sm","table-striped","align-middle"],[2,"white-space","nowrap"],[1,"text-center",2,"white-space","nowrap"],["style","white-space: nowrap;",4,"ngIf"],[1,"modal-backdrop","fade","show"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4,"Estudiantes por docente (asignados)"),a(),o(5,"p",4),s(6,"Vea estudisticas por docentes y estudiantes designados en los modos especiales de plan de estudios (MODO INSTRUMENTO DE ESPECIALIDAD, PRACTICA DE CONJUNTOS, INSTRUMENTO COMPLEMENTARIO)"),a()()()(),o(7,"div",5)(8,"div",6)(9,"label",7),s(10,"Gesti\xF3n"),a(),o(11,"select",8),T("ngModelChange",function(r){return M(i.anioIdSeleccionado,r)||(i.anioIdSeleccionado=r),r}),g("change",function(){return i.onChangeGestion()}),o(12,"option",9),s(13,"Seleccione"),a(),h(14,po,2,2,"option",10),a()(),o(15,"div",11)(16,"label",7),s(17,"Resoluci\xF3n (Nivel)"),a(),o(18,"select",12),T("ngModelChange",function(r){return M(i.resolucionSeleccionada,r)||(i.resolucionSeleccionada=r),r}),g("change",function(){return i.onChangeResolucion()}),o(19,"option",9),s(20,"Seleccione"),a(),h(21,_o,2,3,"option",10),a()(),o(22,"div",13)(23,"label",7),s(24,"Buscar docente"),a(),o(25,"input",14),T("ngModelChange",function(r){return M(i.filtroDocente,r)||(i.filtroDocente=r),r}),a()()(),h(26,fo,10,3,"div",15)(27,ho,2,0,"div",16),o(28,"div",17)(29,"div",18)(30,"table",19)(31,"thead")(32,"tr")(33,"th",20),s(34,"#"),a(),o(35,"th"),s(36,"Docente"),a(),o(37,"th",21),s(38,"Esp. OFICIAL"),a(),o(39,"th",22),s(40,"Esp. No tomados en cuenta"),a(),o(41,"th",23),s(42,"Pr\xE1c. OFICIAL"),a(),o(43,"th",24),s(44,"Pr\xE1c. No tomados en cuenta"),a(),o(45,"th",25),s(46,"Comp. OFICIAL"),a(),o(47,"th",26),s(48,"Comp. No tomados en cuenta"),a()()(),o(49,"tbody"),h(50,xo,5,0,"tr",27)(51,vo,3,0,"tr",27)(52,Co,25,15,"tr",28),a()()()(),h(53,Oo,14,4,"div",29)(54,Do,1,0,"div",30)),e&2&&(c(11),w("ngModel",i.anioIdSeleccionado),c(3),d("ngForOf",i.anios),c(4),w("ngModel",i.resolucionSeleccionada),d("disabled",!i.anioIdSeleccionado),c(3),d("ngForOf",i.opcionesResolucion),c(4),w("ngModel",i.filtroDocente),c(),d("ngIf",i.anioIdSeleccionado&&i.resolucionSeleccionada),c(),d("ngIf",i.anioIdSeleccionado&&i.resolucionSeleccionada),c(23),d("ngIf",i.isLoading),c(),d("ngIf",!i.isLoading&&(!i.docentesFiltrados||i.docentesFiltrados.length===0)),c(),d("ngForOf",i.docentesFiltrados),c(),d("ngIf",i.modalAbierto),c(),d("ngIf",i.modalAbierto))},dependencies:[U,W,q,X,K,Q,z,H],encapsulation:2});var We=Se;var Ao=["modalGestion"];function Lo(l,t){l&1&&(o(0,"div",31)(1,"div",32)(2,"h6",33),v(3,"i",34),s(4,"Campos de celda "),a(),o(5,"ol",35)(6,"li",36)(7,"span",37),s(8,"Celda principal:"),a(),s(9," Punto de inicio para datos de estudiantes."),a(),o(10,"li",36)(11,"span",37),s(12,"Docente:"),a(),s(13," Nombre y apellido del docente."),a(),o(14,"li",36)(15,"span",37),s(16,"Materia:"),a(),s(17," Nombre de la materia."),a(),o(18,"li",36)(19,"span",37),s(20,"Curso:"),a(),s(21," Nivel y paralelo (ej: PRIMERO SUPERIOR A)."),a(),o(22,"li",36)(23,"span",37),s(24,"A\xF1o gesti\xF3n:"),a(),s(25," A\xF1o al que pertenece."),a(),o(26,"li",36)(27,"span",38),s(28,"Carrera:"),a(),s(29," Nombre de la carrera."),a(),o(30,"li",36)(31,"span",38),s(32,"Nivel:"),a(),s(33," T\xE9cnico Superior, Capacitaci\xF3n, etc."),a(),o(34,"li",36)(35,"span",38),s(36,"Sigla materia:"),a(),s(37," Ej: INE-101."),a(),o(38,"li",36)(39,"span",38),s(40,"Turno:"),a(),s(41," MA\xD1ANA, TARDE, NOCHE."),a(),o(42,"li",36)(43,"span",38),s(44,"\xC1rea:"),a(),s(45," \xC1rea de la carrera."),a(),o(46,"li",36)(47,"span",38),s(48,"Instituci\xF3n:"),a(),s(49," Nombre de la instituci\xF3n."),a(),o(50,"li",36)(51,"span",38),s(52,"Resoluci\xF3n:"),a(),s(53," Resoluci\xF3n de la carrera."),a(),o(54,"li",36)(55,"span",38),s(56,"Horas totales:"),a(),s(57," Horas totales de la carrera."),a(),o(58,"li",36)(59,"span",38),s(60,"Menci\xF3n:"),a(),s(61," Menci\xF3n de la carrera."),a(),o(62,"li",36)(63,"span",38),s(64,"T\xEDtulo oficial:"),a(),s(65," T\xEDtulo que otorga la carrera."),a()(),o(66,"div",39),v(67,"i",40),o(68,"span",41),s(69,"Ej:"),a(),o(70,"span",42),s(71,"B10, C3, C4, C5, C6, C11, C12, C13, C14, C15, C16, C17, C18, C19, C20"),a()(),o(72,"div",43),v(73,"i",44),o(74,"span",45),s(75,"(C3)"),a(),s(76," = valor entre par\xE9ntesis en el Excel. Dejar vac\xEDo = no escribir en esa celda. "),a()()())}function No(l,t){if(l&1&&(o(0,"option",46),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Vo(l,t){l&1&&(o(0,"tr")(1,"td",47)(2,"div",48)(3,"span",49),s(4,"Cargando..."),a()()()())}function Ro(l,t){l&1&&(o(0,"tr")(1,"td",47),s(2,"No hay datos disponibles"),a()())}function Fo(l,t){if(l&1){let e=S();o(0,"tr")(1,"td",28),s(2),a(),o(3,"td"),s(4),a(),o(5,"td"),s(6),a(),o(7,"td"),s(8),a(),o(9,"td"),s(10),a(),o(11,"td"),s(12),a(),o(13,"td",50)(14,"button",51),g("click",function(){let n=p(e).$implicit,r=m();return _(r.editar(n))}),s(15,"Editar"),a(),o(16,"button",52),g("click",function(){let n=p(e).$implicit,r=m();return _(r.eliminar(n))}),s(17,"Eliminar"),a()()()}if(l&2){let e=t.$implicit,i=t.index;c(2),x(i+1),c(2),x(e.Categoria),c(2),x(e.ParaI),c(2),x(e.NivelCurso||"B10"),c(2),x(e.Estado),c(2),x(e.Visibilidad)}}function ko(l,t){if(l&1&&(o(0,"option",46),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Go(l,t){if(l&1&&(o(0,"div",94)(1,"div",95)(2,"div",96),s(3),a()()()),l&2){let e=m(2);c(2),Ae("width",e.uploadProgress,"%"),c(),y("",e.uploadProgress,"%")}}function jo(l,t){if(l&1&&(o(0,"div",97),s(1),a()),l&2){let e,i=m(2);c(),y(" ",(e=i.frm.get("Edades"))==null?null:e.value," ")}}function Bo(l,t){if(l&1&&(o(0,"option",46),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function $o(l,t){if(l&1&&(o(0,"option",46),s(1),a()),l&2){let e=t.$implicit;d("value",e),c(),x(e)}}function Uo(l,t){if(l&1){let e=S();o(0,"div",53)(1,"h4",54),s(2),a(),o(3,"button",55),g("click",function(){let n=p(e).$implicit,r=m();return _(r.cancelar(n))}),a()(),o(4,"div",56)(5,"form",57)(6,"div",58)(7,"select",59)(8,"option",19),s(9,"SELECCIONE"),a(),h(10,ko,2,2,"option",20),a(),o(11,"label"),s(12,"Modo"),a()(),o(13,"div",58),v(14,"input",60),o(15,"label"),s(16,"T\xEDtulo"),a()(),o(17,"div",61)(18,"div",62)(19,"div",17),v(20,"input",63),o(21,"label"),s(22,"1. Celda principal (ej: B10)"),a()()(),o(23,"div",62)(24,"div",17),v(25,"input",64),o(26,"label"),s(27,"2. Celda docente (ej: C3)"),a()()(),o(28,"div",62)(29,"div",17),v(30,"input",65),o(31,"label"),s(32,"3. Celda materia (ej: C4)"),a()()(),o(33,"div",62)(34,"div",17),v(35,"input",66),o(36,"label"),s(37,"4. Celda curso (ej: C5)"),a()()(),o(38,"div",62)(39,"div",17),v(40,"input",67),o(41,"label"),s(42,"5. Celda a\xF1o gesti\xF3n (ej: C6)"),a()()(),o(43,"div",62)(44,"div",17),v(45,"input",68),o(46,"label"),s(47,"6. Celda carrera (ej: C11)"),a()()(),o(48,"div",62)(49,"div",17),v(50,"input",69),o(51,"label"),s(52,"7. Celda nivel (ej: C12)"),a()()(),o(53,"div",62)(54,"div",17),v(55,"input",70),o(56,"label"),s(57,"8. Celda sigla materia (ej: C13)"),a()()(),o(58,"div",62)(59,"div",17),v(60,"input",71),o(61,"label"),s(62,"9. Celda turno (ej: C14)"),a()()(),o(63,"div",62)(64,"div",17),v(65,"input",72),o(66,"label"),s(67,"10. Celda \xE1rea (ej: C15)"),a()()(),o(68,"div",62)(69,"div",17),v(70,"input",73),o(71,"label"),s(72,"11. Celda instituci\xF3n (ej: C16)"),a()()(),o(73,"div",62)(74,"div",17),v(75,"input",74),o(76,"label"),s(77,"12. Celda resoluci\xF3n (ej: C17)"),a()()(),o(78,"div",62)(79,"div",17),v(80,"input",75),o(81,"label"),s(82,"13. Celda horas totales (ej: C18)"),a()()(),o(83,"div",62)(84,"div",17),v(85,"input",76),o(86,"label"),s(87,"14. Celda menci\xF3n (ej: C19)"),a()()(),o(88,"div",62)(89,"div",17),v(90,"input",77),o(91,"label"),s(92,"15. Celda t\xEDtulo oficial (ej: C20)"),a()()(),o(93,"div",78)(94,"div",79),s(95," Deje vac\xEDo para que no se escriba en esa celda. Escriba "),o(96,"span",41),s(97,"(C3)"),a(),s(98," con par\xE9ntesis para que el valor aparezca entre par\xE9ntesis en el Excel. "),a()()(),o(99,"div",80)(100,"label",81),s(101,"Archivo Excel"),a(),o(102,"input",82),g("change",function(n){p(e);let r=m();return _(r.onFileSelected(n))}),a(),h(103,Go,4,3,"div",83)(104,jo,2,1,"div",84),a(),o(105,"div",58)(106,"select",85),h(107,Bo,2,2,"option",20),a(),o(108,"label"),s(109,"Estado"),a()(),o(110,"div",58)(111,"select",86),h(112,$o,2,2,"option",20),a(),o(113,"label"),s(114,"Visibilidad"),a()()()(),o(115,"div",87)(116,"div",88)(117,"button",89),g("click",function(){let n=p(e).$implicit,r=m();return _(r.cancelar(n))}),o(118,"span",90),v(119,"ng-lottie",91),a(),o(120,"span"),s(121,"CANCELAR"),a(),v(122,"span",15),a()(),o(123,"div",92)(124,"button",93),g("click",function(){p(e);let n=m();return _(n.guardar())}),o(125,"span",90),v(126,"ng-lottie",91),a(),o(127,"span"),s(128),a(),v(129,"span",15),a()()()}if(l&2){let e,i,n,r,u=m();c(2),y("",(e=u.frm.get("id"))!=null&&e.value?"Modificar":"Registrar"," plantilla"),c(3),d("formGroup",u.frm),c(5),d("ngForOf",u.modos),c(93),d("ngIf",u.uploadProgress!==null),c(),d("ngIf",(i=u.frm.get("Edades"))==null?null:i.value),c(3),d("ngForOf",u.estadoOptions),c(5),d("ngForOf",u.visibilidadOptions),c(7),d("options",u._tools.optionscancelar),c(5),d("disabled",u.uploading),c(2),d("options",(n=u.frm.get("id"))!=null&&n.value?u._tools.optionsEditar:u._tools.optionsAdicionar),c(2),x((r=u.frm.get("id"))!=null&&r.value?"MODIFICAR":"REGISTRAR")}}var Ee=class Ee{constructor(t,e,i){this._tools=t;this._auth=e;this._svc=i;this.modos=["MODO INSTRUMENTOS DE ESPECIALIDAD","MODO PRACTICA DE CONJUNTOS","MODO INSTRUMENTO COMPLEMENTARIO","1 DOCENTE X MATERIA","MULTIPLES DOCENTES X MATERIA"];this.estadoOptions=["ACTIVO","INACTIVO"];this.visibilidadOptions=["VISIBLE","OCULTO"];this.ruta=window?.__env?.ruta??null;this.esSuperlcchs=!1;this.institucionesIdSesion=null;this.isLoading=!0;this.filtertxt="";this.modoFiltro="";this.infoVisible=!1;this.plantillas=[];this.frm=new ct({id:new N(0),Categoria:new N(""),ParaI:new N(""),NivelCurso:new N(""),CeldaPrincipal:new N(""),CeldaDocente:new N(""),CeldaMateria:new N(""),CeldaCurso:new N(""),CeldaGestion:new N(""),CeldaCarrera:new N(""),CeldaNivel:new N(""),CeldaSigla:new N(""),CeldaTurno:new N(""),CeldaArea:new N(""),CeldaInstitucion:new N(""),CeldaResolucion:new N(""),CeldaHorasTotales:new N(""),CeldaMencion:new N(""),CeldaTituloOficial:new N(""),Edades:new N(""),Estado:new N("ACTIVO"),Visibilidad:new N("VISIBLE")});this.uploading=!1;this.uploadProgress=null;this.tempFilePath=null;this.CELDA_FIELDS=["CeldaPrincipal","CeldaDocente","CeldaMateria","CeldaCurso","CeldaGestion","CeldaCarrera","CeldaNivel","CeldaSigla","CeldaTurno","CeldaArea","CeldaInstitucion","CeldaResolucion","CeldaHorasTotales","CeldaMencion","CeldaTituloOficial"]}ngOnInit(){this._auth.pedirPerfil().subscribe({next:t=>{let e=(t?.tipo??"").toString().toLowerCase();this.esSuperlcchs=e==="superlcchs"||e==="usuarioslcchs";let i=Number(t?.usuario?.instituciones_id??0);this.institucionesIdSesion=Number.isFinite(i)&&i>0?i:null,this.cargar()},error:()=>{this.esSuperlcchs=!1,this.institucionesIdSesion=null,this.cargar()}})}upperTrim(t){return(t??"").toString().trim().toUpperCase()}normalizarCelda(t){return this.upperTrim(t)}parseCeldas(t){let i=(t??"").toString().split(",").map(n=>n.trim().toUpperCase()).slice(0,this.CELDA_FIELDS.length);for(;i.length<this.CELDA_FIELDS.length;)i.push("");return i}serializarCeldasDesdeForm(){return this.CELDA_FIELDS.map(e=>this.normalizarCelda(this.frm.get(e)?.value)).join(", ")}get plantillasFiltradas(){let t=this.upperTrim(this.filtertxt),e=this.upperTrim(this.modoFiltro);return(this.plantillas||[]).filter(i=>{if(e&&this.upperTrim(i?.Categoria)!==e)return!1;if(!t)return!0;let n=[i?.Categoria,i?.ParaI,i?.NivelCurso,i?.Estado,i?.Visibilidad].map(r=>(r??"").toString()).join(" ");return this.upperTrim(n).includes(t)})}cargar(){this.isLoading=!0,this._svc.ObtenerPlantillas(void 0,!0).subscribe({next:t=>{this.plantillas=t?.data||[],this.isLoading=!1},error:()=>{this.plantillas=[],this.isLoading=!1}})}abrirNuevo(){this.resetForm(),this.modalGestionRef=this._tools.openModal(this.modalGestion,"xl")}editar(t){this.resetForm();let e=this.parseCeldas(t?.NivelCurso??""),i={id:t?.id,Categoria:t?.Categoria,ParaI:t?.ParaI,NivelCurso:t?.NivelCurso??"",Edades:t?.Edades,Estado:t?.Estado,Visibilidad:t?.Visibilidad};this.CELDA_FIELDS.forEach((n,r)=>i[n]=e[r]??""),this.frm.patchValue(i),this.modalGestionRef=this._tools.openModal(this.modalGestion,"xl")}onFileSelected(t){let i=t.target?.files?.[0];i&&(this.tempFilePath&&(this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null),this.uploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(i,"plantillasexcel").subscribe({next:n=>{if(n.type===qe.UploadProgress){let r=n.total??0;r>0&&(this.uploadProgress=Math.round(n.loaded/r*100))}if(n.type===qe.Response){let r=n.body?.filePath;r&&(this.frm.patchValue({Edades:r}),this.tempFilePath=r),this.uploading=!1,this.uploadProgress=100}},error:()=>{this.uploading=!1,this.uploadProgress=null,this._tools.MostrarMensaje("error","Error al subir plantilla")}}))}guardar(){if(this.uploading){this._tools.MostrarMensaje("info","Espere a que termine la subida");return}let t=this.serializarCeldasDesdeForm(),e={Categoria:this.frm.get("Categoria")?.value,ParaI:this.frm.get("ParaI")?.value,NivelCurso:t,Edades:this.frm.get("Edades")?.value,Estado:this.frm.get("Estado")?.value,Visibilidad:this.frm.get("Visibilidad")?.value};if(this.frm.patchValue({NivelCurso:t},{emitEvent:!1}),!e.Categoria||!e.ParaI||!e.Edades){this._tools.MostrarMensaje("warning","Complete Modo, T\xEDtulo y Archivo");return}let i=Number(this.frm.get("id")?.value??0);if(this._tools.MostrarMensajeLoading(),!i){this._svc.AgregarPlantilla(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Guardado"),this.tempFilePath=null,this._tools.closeModal(this.modalGestionRef),this.cargar()},error:()=>this._tools.MostrarMensaje("error","Error al guardar")});return}this._svc.ModificarPlantilla(i,e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Actualizado"),this.tempFilePath=null,this._tools.closeModal(this.modalGestionRef),this.cargar()},error:()=>this._tools.MostrarMensaje("error","Error al actualizar")})}eliminar(t){let e=Number(t?.id??0);e&&this._tools.mostrarMensajeConfirm("\xBFSEGURO QUE DESEA ELIMINAR?","Se eliminar\xE1 la plantilla y no se podr\xE1 recuperar.","warning","SI, ESTOY SEGURO","NO").then(i=>{i&&(this._tools.MostrarMensajeLoading(),this._svc.EliminarPlantilla(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Eliminado"),this.cargar()},error:()=>this._tools.MostrarMensaje("error","Error al eliminar")}))})}cancelar(t){if(t.dismiss(),this.tempFilePath){let e=(this.frm.get("Edades")?.value??"").toString();e&&e===this.tempFilePath&&this._tools.EliminarArchivo(this.tempFilePath)}this.resetForm()}resetForm(){let t={id:0,Categoria:"",ParaI:"",NivelCurso:"",Edades:"",Estado:"ACTIVO",Visibilidad:"VISIBLE"};this.CELDA_FIELDS.forEach(e=>t[e]=""),this.frm.reset(t),this.uploading=!1,this.uploadProgress=null,this.tempFilePath=null}};Ee.\u0275fac=function(e){return new(e||Ee)(O(fe),O(_e),O(Ge))},Ee.\u0275cmp=$({type:Ee,selectors:[["app-plantillasexcel"]],viewQuery:function(e,i){if(e&1&&J(Ao,7),e&2){let n;ee(n=te())&&(i.modalGestion=n.first)}},standalone:!1,decls:61,vars:11,consts:[["modalGestion",""],[1,"container","mt-4"],[1,"row"],[1,"col","text-center"],[1,"display-4","fw-bold","titulosGlobales"],[1,"lead","text-secondary","subtitulosGlobales"],[1,"row","justify-content-center","mb-3"],[1,"col-lg-10","text-end"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"bi",3,"ngClass"],["class","card shadow-sm border-0 mt-2 text-start","style","max-height: 370px; overflow-y: auto; font-size: 0.85rem;",4,"ngIf"],[1,"row","align-items-end",2,"row-gap","10px"],[1,"col-sm-3","d-flex","justify-content-start"],[1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click"],["width","30px","height","30px",3,"options"],[1,"dir-part"],[1,"col-sm-4"],[1,"form-floating"],[1,"form-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-5","ms-auto"],[1,"input-group"],[1,"input-group-text"],["type","text","placeholder","Buscar","title","Filtrar/Buscar",1,"form-control",3,"ngModelChange","ngModel"],[1,"mt-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm","align-middle"],[1,"text-center"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"card","shadow-sm","border-0","mt-2","text-start",2,"max-height","370px","overflow-y","auto","font-size","0.85rem"],[1,"card-body","py-2","px-3"],[1,"card-title","mb-2","text-primary"],[1,"bi","bi-info-circle-fill","me-1"],[1,"list-group","list-group-numbered","list-group-flush","mb-0",2,"font-size","0.82rem"],[1,"list-group-item","py-1","px-0"],[1,"fw-semibold","text-success"],[1,"fw-semibold","text-info"],[1,"mt-2","small"],[1,"bi","bi-lightbulb-fill","text-primary","me-1"],[1,"fw-semibold"],[1,"badge","bg-info","text-dark","ms-1"],[1,"mt-1","small"],[1,"bi","bi-exclamation-triangle-fill","text-warning","me-1"],[1,"badge","bg-light","text-dark"],[3,"value"],["colspan","7",1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-center",2,"white-space","nowrap"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button","title","cerrar",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],[1,"form-floating","mb-3","col-sm-12"],["formControlName","Categoria",1,"form-select"],["type","text","placeholder","","formControlName","ParaI",1,"form-control"],[1,"row","mb-3",2,"row-gap","10px"],[1,"col-sm-6","col-lg-4"],["type","text","placeholder","B10","formControlName","CeldaPrincipal",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C3","formControlName","CeldaDocente",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C4","formControlName","CeldaMateria",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C5","formControlName","CeldaCurso",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C6","formControlName","CeldaGestion",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C11","formControlName","CeldaCarrera",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C12","formControlName","CeldaNivel",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C13","formControlName","CeldaSigla",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C14","formControlName","CeldaTurno",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C15","formControlName","CeldaArea",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C16","formControlName","CeldaInstitucion",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C17","formControlName","CeldaResolucion",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C18","formControlName","CeldaHorasTotales",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C19","formControlName","CeldaMencion",1,"form-control",2,"text-transform","uppercase"],["type","text","placeholder","C20","formControlName","CeldaTituloOficial",1,"form-control",2,"text-transform","uppercase"],[1,"col-12"],[1,"small","text-secondary"],[1,"mb-3","col-sm-12"],[1,"form-label","fw-semibold"],["type","file","accept",".xlsx,.xlsm,.xltx",1,"form-control",3,"change"],["class","mt-2",4,"ngIf"],["class","small text-secondary mt-1",4,"ngIf"],["formControlName","Estado",1,"form-select"],["formControlName","Visibilidad",1,"form-select"],[1,"modal-footer"],[1,"button","me-2"],["title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","50px","height","50px",3,"options"],[1,"button"],[1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click","disabled"],[1,"mt-2"],[1,"progress",2,"height","10px"],["role","progressbar",1,"progress-bar"],[1,"small","text-secondary","mt-1"]],template:function(e,i){if(e&1){let n=S();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),s(4,"Plantillas Excel"),a(),o(5,"p",5),s(6,"Administra plantillas para generar Excel autom\xE1ticamente"),a()()()(),o(7,"div",6)(8,"div",7)(9,"button",8),g("click",function(){return p(n),_(i.infoVisible=!i.infoVisible)}),v(10,"i",9),s(11),a(),h(12,Lo,77,0,"div",10),a()(),o(13,"div",11)(14,"div",12)(15,"button",13),g("click",function(){return p(n),_(i.abrirNuevo())}),v(16,"ng-lottie",14),o(17,"span"),s(18,"A\xF1adir plantilla"),a(),v(19,"span",15),a()(),o(20,"div",16)(21,"div",17)(22,"select",18),T("ngModelChange",function(u){return p(n),M(i.modoFiltro,u)||(i.modoFiltro=u),_(u)}),o(23,"option",19),s(24,"TODOS LOS MODOS"),a(),h(25,No,2,2,"option",20),a(),o(26,"label"),s(27,"Filtrar por modo"),a()()(),o(28,"div",21)(29,"div",22)(30,"span",23),v(31,"ng-lottie",14),a(),o(32,"div",17)(33,"input",24),T("ngModelChange",function(u){return p(n),M(i.filtertxt,u)||(i.filtertxt=u),_(u)}),a(),o(34,"label"),s(35,"Buscar"),a()()()()(),o(36,"div",25)(37,"div",26)(38,"table",27)(39,"thead")(40,"tr")(41,"th",28),s(42,"#"),a(),o(43,"th"),s(44,"Modo"),a(),o(45,"th"),s(46,"T\xEDtulo"),a(),o(47,"th"),s(48,"Celda inicio"),a(),o(49,"th"),s(50,"Estado"),a(),o(51,"th"),s(52,"Visibilidad"),a(),o(53,"th",28),s(54,"ACCIONES"),a()()(),o(55,"tbody"),h(56,Vo,5,0,"tr",29)(57,Ro,3,0,"tr",29)(58,Fo,18,6,"tr",30),a()()()(),h(59,Uo,130,11,"ng-template",null,0,B)}e&2&&(c(10),d("ngClass",i.infoVisible?"bi-x-circle":"bi-info-circle-fill"),c(),y(" ",i.infoVisible?"Cerrar ayuda":"Ayuda: campos de celda"," "),c(),d("ngIf",i.infoVisible),c(4),d("options",i._tools.optionsAdicionar),c(6),w("ngModel",i.modoFiltro),c(3),d("ngForOf",i.modos),c(6),d("options",i._tools.optionslupa),c(2),w("ngModel",i.filtertxt),c(23),d("ngIf",i.isLoading),c(),d("ngIf",!i.isLoading&&i.plantillasFiltradas.length===0),c(),d("ngForOf",i.plantillasFiltradas))},dependencies:[de,U,W,pe,q,X,K,Q,z,ue,H,Re,Fe,ge],styles:['@charset "UTF-8";']});var Ke=Ee;var Wo=[{path:"calificacionessolo",component:je},{path:"controles",component:Be},{path:"plantillasexcel",component:Ke},{path:"documentosifasimportantes",component:$e},{path:"estadisticasasignaciones",component:Ue},{path:"estadisticasmezclainstrs",component:We}],le=class le{};le.\u0275fac=function(e){return new(e||le)},le.\u0275mod=De({type:le}),le.\u0275inj=Pe({imports:[Xe.forChild(Wo),Xe]});var ze=le;var ce=class ce{};ce.\u0275fac=function(e){return new(e||ce)},ce.\u0275mod=De({type:ce}),ce.\u0275inj=Pe({imports:[st,ht,ze]});var It=ce;export{It as AdministrativosModule};
