import{a as De}from"./chunk-GKBKEJCN.js";import{a as Re}from"./chunk-633ZKBKW.js";import{a as Oe}from"./chunk-SVDENQU6.js";import{b as Me}from"./chunk-ZODOWL6N.js";import{b as Ne}from"./chunk-ZPE3UOEJ.js";import{b as we}from"./chunk-IOMHTJQE.js";import{a as Ve,b as Fe}from"./chunk-R7WDWIDH.js";import{k as J}from"./chunk-O3DH7IF3.js";import{b as Te}from"./chunk-L3EZDEDO.js";import{e as Ae}from"./chunk-XJCOF3T3.js";import{c as ge,e as A,f as ue,g as _e,h as fe,j as x,l as he,m as xe,n as ve,o as be,p as Se,q as Ce,r as Ee,s as Pe,t as ye,y as Ie}from"./chunk-RY6BQWSI.js";import{a as j}from"./chunk-JISGPZ2J.js";import{Aa as R,Bb as q,Cb as Q,Db as z,Dc as le,Ea as r,Fc as de,Gb as G,Gc as ce,Hb as ae,Ib as oe,Lb as s,Ma as P,Mb as h,Nb as C,Ob as Y,Oc as me,Pb as V,Ra as ne,Rb as K,Sa as D,Uc as F,Wa as p,Wc as W,Yc as pe,Z as ee,_ as N,ab as H,ba as te,dc as re,ec as se,ga as u,ha as _,hc as w,ib as d,jb as i,kb as n,lb as m,pb as k,qb as L,ra as ie,sb as v,vb as f,xb as c}from"./chunk-K6WFP5KF.js";import{a as O,m as X}from"./chunk-GG76335P.js";var y=class y{constructor(t){this.http=t;this.ruta=j.ruta}ObtenerPagoslcch(t){let e=new F;return t?.infoestudiantesifas_id&&(e=e.set("infoestudiantesifas_id",String(t.infoestudiantesifas_id))),t?.gestion&&(e=e.set("gestion",String(t.gestion))),t?.mes&&(e=e.set("mes",String(t.mes))),this.http.get(this.ruta+"api/pagoslcch",{params:e})}ObtenerPagoslcchPorInfo(t){return this.http.get(this.ruta+"api/pagoslcch/by-info/"+t)}ObtenerDeudaPorInfo(t,e){let a=new F;return e&&(a=a.set("gestion",String(e))),this.http.get(this.ruta+"api/pagoslcch/deuda/by-info/"+t,{params:a})}ObtenerGestionesAsignaciones(){return this.http.get(this.ruta+"api/pagoslcch/gestiones-asignaciones")}ObtenerDeudores(t){let e=new F;return e=e.set("gestion",String(t.gestion??"")),t.gestion_pago&&(e=e.set("gestion_pago",String(t.gestion_pago))),t.search&&(e=e.set("search",String(t.search))),t.page&&(e=e.set("page",String(t.page))),t.per_page&&(e=e.set("per_page",String(t.per_page))),this.http.get(this.ruta+"api/pagoslcch/deudores",{params:e})}ObtenerPagadores(t){let e=new F;return e=e.set("gestion",String(t.gestion??"")),e=e.set("mes",String(t.mes??0)),t.gestion_pago&&(e=e.set("gestion_pago",String(t.gestion_pago))),t.search&&(e=e.set("search",String(t.search))),t.page&&(e=e.set("page",String(t.page))),t.per_page&&(e=e.set("per_page",String(t.per_page))),this.http.get(this.ruta+"api/pagoslcch/pagadores",{params:e})}AgregarPagoslcch(t){return this.http.post(this.ruta+"api/pagoslcch",t)}ModificarPagoslcch(t,e){return this.http.put(this.ruta+"api/pagoslcch/"+e,t)}SeleccionarPagoslcch(t){return this.http.get(this.ruta+"api/pagoslcch/"+t)}EliminarPagoslcch(t){return this.http.delete(this.ruta+"api/pagoslcch/"+t)}createFormGroupPagoslcch(){return new fe({id:new x(0),infoestudiantesifas_id:new x(null),nrodocumento:new x(""),mes:new x(1),gestion:new x(String(new Date().getFullYear())),monto:new x(""),acuenta:new x(""),saldo:new x(""),dolarboliviano:new x(""),mediopago:new x(""),fechapago:new x(""),horapago:new x(""),estadopago:new x("PAGADO"),observacion:new x(""),file:new x("")})}};y.\u0275fac=function(e){return new(e||y)(te(pe))},y.\u0275prov=ee({token:y,factory:y.\u0275fac,providedIn:"root"});var $=y;var Ge=["modalPago"],je=["modalPagadores"];function $e(o,t){if(o&1){let e=v();i(0,"button",11),f("click",function(){u(e);let l=c();return _(l.toggleVerDeudores())}),s(1),n()}if(o&2){let e=c();r(),C(" ",e.verDeudores?"Ocultar deudores":"Ver estudiantes con deuda"," ")}}function Ue(o,t){if(o&1&&m(0,"img",22),o&2){let e=c(2);d("src",e.fotoUrl(),R)}}function Be(o,t){o&1&&(i(0,"div",23),m(1,"i",24),n())}function He(o,t){if(o&1&&(i(0,"div",25),s(1),n()),o&2){let e=c(2);r(),h(e.sexoEstudiante)}}function qe(o,t){if(o&1&&(i(0,"span",26),s(1),n()),o&2){let e=c(2);r(),C("Inscripci\xF3n #",e.infoCtrl.value)}}function Qe(o,t){if(o&1&&(i(0,"span",27),s(1),n()),o&2){let e,a=c(2);r(),C("Gesti\xF3n ",(e=a.frmPago.get("gestion"))==null?null:e.value)}}function ze(o,t){if(o&1&&(i(0,"div",12)(1,"div",13)(2,"div",14),p(3,Ue,1,1,"img",15)(4,Be,2,0,"ng-template",null,2,w),n(),i(6,"div",16)(7,"div",17),s(8),n(),p(9,He,2,1,"div",18),i(10,"div",19),p(11,qe,2,1,"span",20)(12,Qe,2,1,"span",21),n()()()()),o&2){let e,a=G(5),l=c();r(3),d("ngIf",l.fotoUrl())("ngIfElse",a),r(5),h(l.nombreEstudiante||"Estudiante"),r(),d("ngIf",l.sexoEstudiante),r(2),d("ngIf",l.infoCtrl.value),r(),d("ngIf",(e=l.frmPago.get("gestion"))==null?null:e.value)}}function Ye(o,t){if(o&1&&(i(0,"option",54),s(1),n()),o&2){let e=t.$implicit;d("value",e),r(),h(e)}}function Ke(o,t){if(o&1&&m(0,"ng-lottie",55),o&2){let e=c(2);d("options",e._tools.optionsengranaje)}}function We(o,t){if(o&1){let e=v();i(0,"div",56)(1,"button",57),f("click",function(){u(e);let l=c(2);return _(l.deudoresPrev())}),s(2,"Anterior"),n(),i(3,"small",58),s(4),n(),i(5,"button",57),f("click",function(){u(e);let l=c(2);return _(l.deudoresNext())}),s(6,"Siguiente"),n()()}if(o&2){let e=c(2);r(),d("disabled",!e.deudoresTienePrev()||e.isLoadingDeudores),r(3),V(" P\xE1gina ",e.deudoresMeta.current_page," / ",e.deudoresMeta.last_page," (",e.deudoresMeta.total," resultados) "),r(),d("disabled",!e.deudoresTieneNext()||e.isLoadingDeudores)}}function Je(o,t){o&1&&(i(0,"th"),s(1,"Instituci\xF3n"),n())}function Ze(o,t){if(o&1&&(i(0,"tr")(1,"td",59)(2,"div",60),m(3,"ng-lottie",61),i(4,"span",58),s(5,"Cargando deudores..."),n()()()()),o&2){let e=c(2);r(),H("colspan",e.esSuperAdmin?8:7),r(2),d("options",e._tools.optionsengranaje)}}function Xe(o,t){if(o&1&&(i(0,"td"),s(1),n()),o&2){let e=c().$implicit;r(),h(e.NombreInstitucion||"-")}}function et(o,t){if(o&1){let e=v();i(0,"tr",62)(1,"td"),s(2),n(),i(3,"td"),s(4),n(),i(5,"td"),s(6),n(),i(7,"td"),s(8),n(),p(9,Xe,2,1,"td",51),i(10,"td"),s(11),n(),i(12,"td"),s(13),n(),i(14,"td")(15,"button",63),f("click",function(){let l=u(e).$implicit,g=c(2);return _(g.seleccionarInscripcion(l))}),s(16," Cobrar "),n()()()}if(o&2){let e=t.$implicit,a=c(2);d("hidden",a.isLoadingDeudores),r(2),C("#",e.id),r(2),V("",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre),r(2),h(e.CI||"-"),r(2),h(e.Matricula||"-"),r(),d("ngIf",a.esSuperAdmin),r(2),h(e.Anio||"SIN ASIGNAR"),r(2),h(a.mesLabels(e.meses_deuda))}}function tt(o,t){if(o&1&&(i(0,"tr")(1,"td",59),s(2,"Sin registros"),n()()),o&2){let e=c(2);r(),H("colspan",e.esSuperAdmin?8:7)}}function it(o,t){if(o&1){let e=v();i(0,"div",12)(1,"div",28)(2,"span",29),s(3,"Estudiantes con deudas"),n(),i(4,"div",30)(5,"label",31),s(6,"Gesti\xF3n"),n(),i(7,"select",32),f("change",function(){u(e);let l=c();return _(l.cargarDeudores(1))}),p(8,Ye,2,2,"option",33),n()()(),i(9,"div",34)(10,"div",35)(11,"div",36)(12,"div",37)(13,"span",38),m(14,"i",39),n(),i(15,"div",40)(16,"input",41),f("input",function(l){u(e);let g=c();return _(g.filterDeudores=l.target.value)})("keyup.enter",function(){u(e);let l=c();return _(l.cargarDeudores(1))}),n(),i(17,"label"),s(18,"Buscar (nombre/CI/matr\xEDcula)"),n()(),i(19,"button",42),f("click",function(){u(e);let l=c();return _(l.cargarDeudores(1))}),i(20,"span",43),p(21,Ke,1,1,"ng-lottie",44),i(22,"span"),s(23),n()()()(),p(24,We,7,5,"div",45),n(),i(25,"div",46)(26,"label",47),s(27,"Total deudores"),n(),m(28,"input",48),n()()(),i(29,"div",49)(30,"table",50)(31,"thead")(32,"tr")(33,"th"),s(34,"Inscripci\xF3n"),n(),i(35,"th"),s(36,"Estudiante"),n(),i(37,"th"),s(38,"CI"),n(),i(39,"th"),s(40,"Matr\xEDcula"),n(),p(41,Je,2,0,"th",51),i(42,"th"),s(43,"Gesti\xF3n (asignaci\xF3n)"),n(),i(44,"th"),s(45,"Meses adeudados"),n(),i(46,"th",52),s(47,"Acciones"),n()()(),i(48,"tbody"),p(49,Ze,6,2,"tr",51)(50,et,17,10,"tr",53)(51,tt,3,1,"tr",51),n()()()()}if(o&2){let e=c();r(7),d("formControl",e.gestionDeudores),r(),d("ngForOf",e.gestionesAsignaciones),r(8),d("value",e.filterDeudores),r(3),d("disabled",e.isLoadingDeudores),r(2),d("ngIf",e.isLoadingDeudores),r(2),h(e.isLoadingDeudores?"Buscando...":"Buscar"),r(),d("ngIf",e.deudoresMeta),r(4),d("value",(e.deudoresMeta==null?null:e.deudoresMeta.total)||0),r(13),d("ngIf",e.esSuperAdmin),r(8),d("ngIf",e.isLoadingDeudores),r(),d("ngForOf",e.deudores),r(),d("ngIf",e.deudores.length===0&&!e.isLoadingDeudores)}}function nt(o,t){if(o&1&&m(0,"ng-lottie",55),o&2){let e=c(2);d("options",e._tools.optionslupa)}}function at(o,t){if(o&1){let e=v();i(0,"div",56)(1,"button",57),f("click",function(){u(e);let l=c(2);return _(l.resPrev())}),s(2,"Anterior"),n(),i(3,"small",58),s(4),n(),i(5,"button",57),f("click",function(){u(e);let l=c(2);return _(l.resNext())}),s(6,"Siguiente"),n()()}if(o&2){let e=c(2);r(),d("disabled",!e.resTienePrev()||e.isLoadingResultados),r(3),V(" P\xE1gina ",e.resMeta.current_page," / ",e.resMeta.last_page," (",e.resMeta.total," resultados) "),r(),d("disabled",!e.resTieneNext()||e.isLoadingResultados)}}function ot(o,t){if(o&1&&(i(0,"div",71),m(1,"ng-lottie",72),i(2,"span"),s(3,"Cargando resultados..."),n()()),o&2){let e=c(2);r(),d("options",e._tools.optionslupa)}}function rt(o,t){if(o&1){let e=v();i(0,"button",73),f("click",function(){let l=u(e).$implicit,g=c(2);return _(g.seleccionarInscripcion(l))}),s(1),i(2,"span",58),s(3),n()()}if(o&2){let e=t.$implicit,a=c(2);oe("active",a.infoCtrl.value===e.id),d("disabled",a.isLoadingResultados)("hidden",a.isLoadingResultados),r(),K(" ",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre,"",a.esSuperAdmin?" | "+e.NombreInstitucion:""," | ",e.Anio," "),r(2),C("(#",e.id,")")}}function st(o,t){o&1&&(i(0,"small",58),s(1,"Busca y selecciona una inscripci\xF3n para registrar pagos."),n())}function lt(o,t){if(o&1&&(i(0,"span",58),s(1),n()),o&2){let e=c(3);r(),K(" (",e.infoSeleccionada.Ap_Paterno," ",e.infoSeleccionada.Ap_Materno," ",e.infoSeleccionada.Nombre,"",e.esSuperAdmin?" | "+e.infoSeleccionada.NombreInstitucion:""," | ",e.infoSeleccionada.Anio,") ")}}function dt(o,t){if(o&1){let e=v();i(0,"div",74)(1,"small",75),s(2," Inscripci\xF3n seleccionada: "),i(3,"b"),s(4),n(),p(5,lt,2,5,"span",69),n(),i(6,"button",76),f("click",function(){u(e);let l=c(2);return _(l.limpiarSeleccion())}),s(7,"Quitar selecci\xF3n"),n()()}if(o&2){let e=c(2);r(4),C("#",e.infoCtrl.value),r(),d("ngIf",e.infoSeleccionada)}}function ct(o,t){if(o&1){let e=v();i(0,"div",12)(1,"div",34)(2,"div",35)(3,"div",36)(4,"div",37)(5,"span",38),m(6,"i",39),n(),i(7,"div",40)(8,"input",64),f("input",function(l){u(e);let g=c();return _(g.filterInscripcion=l.target.value)})("keyup.enter",function(){u(e);let l=c();return _(l.buscarInscripciones(1))}),n(),i(9,"label"),s(10,"Buscar inscripci\xF3n (m\xEDn. 2 caracteres)"),n()(),i(11,"button",42),f("click",function(){u(e);let l=c();return _(l.buscarInscripciones(1))}),i(12,"span",43),p(13,nt,1,1,"ng-lottie",44),i(14,"span"),s(15),n()()()(),p(16,at,7,5,"div",45),i(17,"div",65),p(18,ot,4,1,"div",66)(19,rt,4,10,"button",67),n(),i(20,"div",68),p(21,st,2,0,"small",69)(22,dt,8,2,"div",70),n()(),i(23,"div",46)(24,"label",47),s(25,"Total registros"),n(),m(26,"input",48),n()()()()}if(o&2){let e=c();r(8),d("value",e.filterInscripcion),r(3),d("disabled",e.isLoadingResultados),r(2),d("ngIf",e.isLoadingResultados),r(2),h(e.isLoadingResultados?"Buscando...":"Buscar"),r(),d("ngIf",e.resMeta),r(2),d("ngIf",e.isLoadingResultados),r(),d("ngForOf",e.resultados),r(2),d("ngIf",!e.infoCtrl.value),r(),d("ngIf",e.infoCtrl.value),r(4),d("value",e.pagos.length)}}function mt(o,t){if(o&1){let e=v();i(0,"span",85),f("click",function(){let l=u(e).$implicit,g=c(3);return _(g.abrirPagadoresMes(l))}),s(1),n()}if(o&2){let e=t.$implicit,a=c(3);r(),h(a.mesLabel(e))}}function pt(o,t){if(o&1&&(k(0),p(1,mt,2,1,"span",84),L()),o&2){let e=c(2);r(),d("ngForOf",e.mesesPagadosGestion)}}function gt(o,t){o&1&&(i(0,"span",58),s(1,"-"),n())}function ut(o,t){if(o&1&&(i(0,"span",71),m(1,"ng-lottie",55),i(2,"span"),s(3,"Calculando..."),n()()),o&2){let e=c(2);r(),d("options",e._tools.optionsengranaje)}}function _t(o,t){if(o&1){let e=v();i(0,"span",87),f("click",function(){let l=u(e).$implicit,g=c(4);return _(g.abrirPagadoresMes(l))}),s(1),n()}if(o&2){let e=t.$implicit,a=c(4);r(),h(a.mesLabel(e))}}function ft(o,t){if(o&1&&(k(0),p(1,_t,2,1,"span",86),L()),o&2){let e=c(3);r(),d("ngForOf",e.deudaMeses)}}function ht(o,t){o&1&&(i(0,"span",58),s(1,"Sin deuda detectada"),n())}function xt(o,t){if(o&1&&(k(0),p(1,ft,2,1,"ng-container",83)(2,ht,2,0,"ng-template",null,4,w),L()),o&2){let e=G(3),a=c(2);r(),d("ngIf",a.deudaMeses.length>0)("ngIfElse",e)}}function vt(o,t){if(o&1&&(i(0,"small",58),s(1),n()),o&2){let e=c(2);r(),C(" Referencia: un estudiante lleg\xF3 a pagar hasta ",e.mesLabel(e.deudaMaxMesCompaneros),". ")}}function bt(o,t){if(o&1){let e=v();i(0,"div",12)(1,"div",28)(2,"span",29),s(3,"Registro de pagos"),n(),i(4,"button",77),f("click",function(){u(e);let l=c();return _(l.abrirModalNuevoPago())}),i(5,"span",78),m(6,"ng-lottie",79),n(),i(7,"span"),s(8,"REGISTRAR PAGO"),n(),m(9,"span",80),n()(),i(10,"div",34)(11,"div",74)(12,"small",58),s(13,"Gesti\xF3n:"),n(),i(14,"span",81),s(15),n(),i(16,"small",82),s(17,"Meses pagados (PAGADO):"),n(),p(18,pt,2,1,"ng-container",83)(19,gt,2,0,"ng-template",null,3,w),i(21,"small",82),s(22,"Meses adeudados (autodetecci\xF3n):"),n(),p(23,ut,4,1,"span",66)(24,xt,4,2,"ng-container",51),n(),p(25,vt,2,1,"small",69),n()()}if(o&2){let e,a=G(20),l=c();r(6),d("options",l._tools.optionsAdicionar),r(9),h(((e=l.frmPago.get("gestion"))==null?null:e.value)||"-"),r(3),d("ngIf",l.mesesPagadosGestion.length>0)("ngIfElse",a),r(5),d("ngIf",l.isLoadingDeuda),r(),d("ngIf",!l.isLoadingDeuda),r(),d("ngIf",l.deudaMaxMesCompaneros)}}function St(o,t){if(o&1&&(i(0,"option",54),s(1),n()),o&2){let e=t.$implicit;d("value",e.value),r(),h(e.label)}}function Ct(o,t){if(o&1&&(i(0,"option",130),s(1),n()),o&2){let e=t.$implicit;d("value",e.value)("disabled",e.disabled),r(),h(e.label)}}function Et(o,t){if(o&1&&(i(0,"option",130),s(1),n()),o&2){let e=t.$implicit;d("value",e.value)("disabled",e.disabled),r(),h(e.label)}}function Pt(o,t){if(o&1&&(i(0,"div",19)(1,"a",131),s(2,"Ver comprobante"),n()()),o&2){let e,a=c(2);r(),d("href",a.ruta+((e=a.frmPago.get("file"))==null?null:e.value),R)}}function yt(o,t){if(o&1&&(i(0,"div",68)(1,"div",132)(2,"div",133),s(3),n()()()),o&2){let e=c(2);r(2),ae("width",e.uploadProgress,"%"),r(),C("",e.uploadProgress,"%")}}function It(o,t){if(o&1&&(i(0,"div",68)(1,"div",71),m(2,"ng-lottie",72),i(3,"span"),s(4,"Subiendo comprobante..."),n()()()),o&2){let e=c(2);r(2),d("options",e._tools.optionsUpload)}}function Mt(o,t){if(o&1){let e=v();i(0,"div",134)(1,"button",135),f("click",function(){u(e);let l=c(2);return _(l.AutoCompletarLastPago())}),i(2,"span",125),m(3,"ng-lottie",129),n(),i(4,"span"),s(5,"AUTO COMPLETAR"),n(),m(6,"span",80),n()()}if(o&2){let e=c(2);r(),d("disabled",e.uploading||e.isSavingPago),r(2),d("options",e._tools.optionsautocompletar)}}function wt(o,t){if(o&1&&m(0,"ng-lottie",136),o&2){let e=c(2);d("options",e._tools.optionsengranaje)}}function At(o,t){if(o&1&&m(0,"ng-lottie",129),o&2){let e=c(2);d("options",e.editId?e._tools.optionsEditar:e._tools.optionsAdicionar)}}function Tt(o,t){if(o&1){let e=v();i(0,"div",88)(1,"h5",89),s(2),n(),i(3,"button",90),f("click",function(){let l=u(e).$implicit;return _(l.dismiss("close"))}),n()(),i(4,"div",91)(5,"form",92)(6,"div",93)(7,"div")(8,"span",94),s(9,"Inscripci\xF3n"),n(),i(10,"span",95),s(11),n()(),i(12,"div",96),s(13),n()(),i(14,"div",97)(15,"div",98)(16,"select",99),p(17,St,2,2,"option",33),n(),i(18,"label"),s(19,"Mes"),n(),i(20,"div",100),s(21,"Este campo es obligatorio*"),n()(),i(22,"div",98),m(23,"input",101),i(24,"label"),s(25,"Gesti\xF3n"),n(),i(26,"div",100),s(27,"Este campo es obligatorio*"),n()(),i(28,"div",98),m(29,"input",102),i(30,"label"),s(31,"Nro. documento"),n()()(),i(32,"div",97)(33,"div",98),m(34,"input",103),i(35,"label"),s(36,"Monto"),n(),i(37,"div",100),s(38,"Este campo es obligatorio*"),n()(),i(39,"div",98),m(40,"input",104),i(41,"label"),s(42,"A cuenta"),n()(),i(43,"div",98),m(44,"input",105),i(45,"label"),s(46,"Saldo"),n()()(),i(47,"div",97)(48,"div",106)(49,"label",47),s(50,"Moneda"),n(),i(51,"div",107),m(52,"input",108),i(53,"label",109),s(54,"Bs"),n(),m(55,"input",110),i(56,"label",109),s(57,"$"),n()()(),i(58,"div",98)(59,"select",111)(60,"option",112),s(61,"Seleccione una opci\xF3n"),n(),p(62,Ct,2,3,"option",113),n(),i(63,"label"),s(64,"Medio de pago"),n(),i(65,"div",100),s(66,"Este campo es obligatorio*"),n()(),i(67,"div",98)(68,"select",114),p(69,Et,2,3,"option",113),n(),i(70,"label"),s(71,"Estado pago"),n(),i(72,"div",100),s(73,"Este campo es obligatorio*"),n()()(),i(74,"div",97)(75,"div",98),m(76,"input",115),i(77,"label"),s(78,"Fecha de pago"),n()(),i(79,"div",98),m(80,"input",116),i(81,"label"),s(82,"Hora"),n()(),i(83,"div",106)(84,"label",47),s(85,"Comprobante"),n(),i(86,"input",117),f("change",function(l){u(e);let g=c();return _(g.onFileSelected(l))}),n(),p(87,Pt,3,1,"div",118)(88,yt,4,3,"div",119)(89,It,5,1,"div",119),n()(),i(90,"div",120)(91,"label"),s(92,"Observaci\xF3n"),n(),m(93,"quill-editor",121),n()()(),i(94,"div",122),p(95,Mt,7,2,"div",123),i(96,"button",124),f("click",function(){u(e);let l=c();return _(l.guardar())}),i(97,"span",125),p(98,wt,1,1,"ng-lottie",126)(99,At,1,1,"ng-lottie",127),n(),i(100,"span"),s(101),n(),m(102,"span",80),n(),i(103,"button",128),f("click",function(){let l=u(e).$implicit;return _(l.dismiss("cancel"))}),i(104,"span",125),m(105,"ng-lottie",129),n(),i(106,"span"),s(107,"CANCELAR"),n(),m(108,"span",80),n()()}if(o&2){let e,a=c();r(2),h(a.editId?"Editar pago":"Registrar pago"),r(3),d("formGroup",a.frmPago),r(6),C("#",a.infoCtrl.value),r(2),h(a.editId?"Editando registro":"Nuevo registro"),r(3),d("ngClass",a.ValidacionPagoxElemento("mes")),r(),d("ngForOf",a.meses),r(6),d("ngClass",a.ValidacionPagoxElemento("gestion")),r(11),d("ngClass",a.ValidacionPagoxElemento("monto")),r(18),d("id",a.monedaUid+"-bs")("formControl",a.frmPago.get("dolarboliviano")),r(),d("for",a.monedaUid+"-bs"),r(2),d("id",a.monedaUid+"-usd")("formControl",a.frmPago.get("dolarboliviano")),r(),d("for",a.monedaUid+"-usd"),r(3),d("ngClass",a.ValidacionPagoxElemento("mediopago")),r(),d("value",""),r(2),d("ngForOf",a.medioPagoOptions),r(6),d("ngClass",a.ValidacionPagoxElemento("estadopago")),r(),d("ngForOf",a.estadoPagoOptions),r(18),d("ngIf",(e=a.frmPago.get("file"))==null?null:e.value),r(),d("ngIf",a.uploadProgress!==null),r(),d("ngIf",a.uploading),r(4),d("formControl",a.frmPago.get("observacion"))("modules",a.modulesQuillEdicion),r(2),d("ngIf",!a.editId),r(),d("disabled",a.uploading||a.isSavingPago),r(2),d("ngIf",a.isSavingPago),r(),d("ngIf",!a.isSavingPago),r(2),h(a.isSavingPago?"GUARDANDO...":a.editId?"GUARDAR":"REGISTRAR"),r(4),d("options",a._tools.optionscancelar)}}function Ot(o,t){o&1&&(i(0,"span"),s(1,"Buscar"),n())}function Vt(o,t){o&1&&(i(0,"span"),s(1,"Buscando..."),n())}function Ft(o,t){if(o&1){let e=v();i(0,"div",143)(1,"button",57),f("click",function(){u(e);let l=c(2);return _(l.pagadoresPrev())}),s(2,"Anterior"),n(),i(3,"small",58),s(4),n(),i(5,"button",57),f("click",function(){u(e);let l=c(2);return _(l.pagadoresNext())}),s(6,"Siguiente"),n()()}if(o&2){let e=c(2);r(),d("disabled",!e.pagadoresTienePrev()||e.isLoadingPagadores),r(3),Y("P\xE1gina ",e.pagadoresMeta.current_page," / ",e.pagadoresMeta.last_page),r(),d("disabled",!e.pagadoresTieneNext()||e.isLoadingPagadores)}}function Nt(o,t){if(o&1&&(i(0,"tr")(1,"td",144)(2,"div",60),m(3,"ng-lottie",72),i(4,"span",82),s(5,"Cargando..."),n()()()()),o&2){let e=c(2);r(3),d("options",e._tools.optionsengranaje)}}function Rt(o,t){if(o&1&&(i(0,"tr",62)(1,"td"),s(2),n(),i(3,"td"),s(4),n(),i(5,"td"),s(6),n(),i(7,"td"),s(8),n()()),o&2){let e=t.$implicit,a=c(2);d("hidden",a.isLoadingPagadores),r(2),C("#",e.infoestudiantesifas_id),r(2),V("",e.Ap_Paterno," ",e.Ap_Materno," ",e.Nombre),r(2),h(e.CI||"-"),r(2),h(e.Matricula||"-")}}function Dt(o,t){o&1&&(i(0,"tr")(1,"td",144),s(2,"Sin registros"),n()())}function kt(o,t){if(o&1){let e=v();i(0,"div",88)(1,"h5",89),s(2),n(),i(3,"button",90),f("click",function(){let l=u(e).$implicit;return _(l.dismiss("close"))}),n()(),i(4,"div",91)(5,"div",137)(6,"div",138)(7,"label",47),s(8,"Buscar estudiante"),n(),i(9,"div",37)(10,"span",38),m(11,"i",39),n(),i(12,"input",139),f("input",function(l){u(e);let g=c();return _(g.pagadoresSearch=l.target.value)})("keyup.enter",function(){u(e);let l=c();return _(l.cargarPagadores(1))}),n(),i(13,"button",42),f("click",function(){u(e);let l=c();return _(l.cargarPagadores(1))}),p(14,Ot,2,0,"span",51)(15,Vt,2,0,"span",51),n()()(),i(16,"div",140)(17,"label",47),s(18,"Total"),n(),m(19,"input",48),n()(),p(20,Ft,7,4,"div",141),i(21,"div",49)(22,"table",50)(23,"thead")(24,"tr")(25,"th"),s(26,"#"),n(),i(27,"th"),s(28,"Estudiante"),n(),i(29,"th"),s(30,"CI"),n(),i(31,"th"),s(32,"Matr\xEDcula"),n()()(),i(33,"tbody"),p(34,Nt,6,1,"tr",51)(35,Rt,9,7,"tr",53)(36,Dt,3,0,"tr",51),n()()()(),i(37,"div",122)(38,"button",142),f("click",function(){let l=u(e).$implicit;return _(l.dismiss("close"))}),s(39,"Cerrar"),n()()}if(o&2){let e=c();r(2),Y("Pagos realizados: ",e.mesLabel(e.pagadoresMes)," (",e.pagadoresGestionPago,")"),r(10),d("value",e.pagadoresSearch),r(),d("disabled",e.isLoadingPagadores),r(),d("ngIf",!e.isLoadingPagadores),r(),d("ngIf",e.isLoadingPagadores),r(4),d("value",(e.pagadoresMeta==null?null:e.pagadoresMeta.total)||0),r(),d("ngIf",e.pagadoresMeta),r(14),d("ngIf",e.isLoadingPagadores),r(),d("ngForOf",e.pagadores),r(),d("ngIf",!e.isLoadingPagadores&&e.pagadores.length===0)}}function Lt(o,t){if(o&1&&(i(0,"tr")(1,"td",147)(2,"div",60),m(3,"ng-lottie",61),i(4,"span",58),s(5,"Cargando pagos..."),n()()()()),o&2){let e=c(2);r(3),d("options",e._tools.optionsengranaje)}}function Gt(o,t){if(o&1&&(i(0,"a",131),s(1,"Ver"),n()),o&2){let e=c().$implicit,a=c(2);d("href",a.ruta+e.file,R)}}function jt(o,t){o&1&&(i(0,"span"),s(1,"-"),n())}function $t(o,t){if(o&1){let e=v();i(0,"tr",62)(1,"td"),s(2),n(),i(3,"td"),s(4),re(5,"dateFormat"),n(),i(6,"td"),s(7),n(),i(8,"td"),s(9),n(),i(10,"td"),s(11),n(),i(12,"td"),s(13),n(),i(14,"td"),p(15,Gt,2,1,"a",148)(16,jt,2,0,"span",51),n(),i(17,"td")(18,"div",149)(19,"button",150),f("click",function(){let l=u(e).$implicit,g=c(2);return _(g.iniciarEditar(l))}),s(20,"Editar"),n(),i(21,"button",151),f("click",function(){let l=u(e).$implicit,g=c(2);return _(g.eliminar(l))}),s(22,"Eliminar"),n()()()()}if(o&2){let e=t.$implicit,a=c(2);d("hidden",a.isLoadingPagos),r(2),h(e.gestion),r(2),h(se(5,9,e.fechapago)),r(3),h(a.mesLabel(e.mes)),r(2),h(e.monto),r(2),h(e.horapago),r(2),h(e.estadopago),r(2),d("ngIf",e.file),r(),d("ngIf",!e.file)}}function Ut(o,t){o&1&&(i(0,"tr")(1,"td",147),s(2,"Sin registros"),n()())}function Bt(o,t){if(o&1&&(i(0,"div",145)(1,"div",146),s(2,"Pagos registrados"),n(),i(3,"div",49)(4,"table",50)(5,"thead")(6,"tr")(7,"th"),s(8,"Gesti\xF3n"),n(),i(9,"th"),s(10,"Fecha"),n(),i(11,"th"),s(12,"Mes"),n(),i(13,"th"),s(14,"Monto"),n(),i(15,"th"),s(16,"Hora"),n(),i(17,"th"),s(18,"Estado"),n(),i(19,"th"),s(20,"Comprobante"),n(),i(21,"th",52),s(22,"Acciones"),n()()(),i(23,"tbody"),p(24,Lt,6,1,"tr",51)(25,$t,23,11,"tr",53)(26,Ut,3,0,"tr",51),n()()()()),o&2){let e=c();r(24),d("ngIf",e.isLoadingPagos),r(),d("ngForOf",e.pagos),r(),d("ngIf",e.pagos.length===0&&!e.isLoadingPagos)}}var T=class T{constructor(t,e,a,l,g,b){this._info=t;this._pagos=e;this._tools=a;this._controles=l;this._auth=g;this._modal=b;this.ruta=j.ruta;this.NO_MENSUALIDAD_MES=0;this.monedaUid=`moneda-${Math.random().toString(36).slice(2,9)}`;this.modo="general";this.infoId=null;this.estudianteId=null;this.nombreEstudiante=null;this.fotoEstudiante=null;this.sexoEstudiante=null;this.gestionPredeterminada=null;this.modulesQuillEdicion={toolbar:[["bold","italic","underline","strike"],[{align:[]}],[{size:["small",!1,"large"]}],[{color:[]},{background:[]}],[{font:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","video"],["clean"]]};this.modulesQuillShow={toolbar:!1};this.infoCtrl=new x(null);this.filterInscripcion="";this.resultados=[];this.resMeta=null;this.resPage=1;this.resPerPage=10;this.isLoadingResultados=!1;this.infoSeleccionada=null;this.pagos=[];this.isLoadingPagos=!1;this.isSavingPago=!1;this.frmPago=this._pagos.createFormGroupPagoslcch();this.editId=null;this.modalRef=null;this.modalPagadoresRef=null;this.meses=[{value:0,label:"NO ES MENSUALIDAD"},{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}];this.estadoPagoOptions=[];this.medioPagoOptions=[];this.isLoadingDeuda=!1;this.deudaMeses=[];this.deudaMaxMesCompaneros=null;this.mesesPagadosGestion=[];this.deudaKey=null;this.gestionesAsignaciones=[];this.gestionDeudores=new x(String(new Date().getFullYear()));this.verDeudores=!1;this.filterDeudores="";this.deudores=[];this.deudoresMeta=null;this.deudoresPage=1;this.deudoresPerPage=10;this.isLoadingDeudores=!1;this.isLoadingPagadores=!1;this.pagadores=[];this.pagadoresMeta=null;this.pagadoresPage=1;this.pagadoresPerPage=10;this.pagadoresSearch="";this.pagadoresMes=null;this.pagadoresGestion="";this.pagadoresGestionPago="";this.uploading=!1;this.uploadProgress=null;this.tempFilePath=null;this.originalFilePath=null;this.ultimoPagoSnapshot=null;this.esSuperAdmin=!1}esMensualidad(t){let e=Number(t);return Number.isFinite(e)&&e>=1&&e<=12}ngOnInit(){if(this._auth.revisarSiEsSuperAdmin().subscribe(t=>this.esSuperAdmin=t),this.cargarEstadoPagoOptions(),this.cargarMedioPagoOptions(),this.cargarGestionesAsignaciones(),this.frmPago.get("mes")?.setValidators([A.required]),this.frmPago.get("gestion")?.setValidators([A.required]),this.frmPago.get("monto")?.setValidators([A.required]),this.frmPago.get("mediopago")?.setValidators([A.required]),this.frmPago.get("estadopago")?.setValidators([A.required]),this.frmPago.get("mes")?.updateValueAndValidity({emitEvent:!1}),this.frmPago.get("gestion")?.updateValueAndValidity({emitEvent:!1}),this.frmPago.get("monto")?.updateValueAndValidity({emitEvent:!1}),this.frmPago.get("mediopago")?.updateValueAndValidity({emitEvent:!1}),this.frmPago.get("estadopago")?.updateValueAndValidity({emitEvent:!1}),this.infoCtrl.valueChanges.subscribe(t=>{let e=Number(t||0);e>0?(this.resetFormForInfo(e),this.cargarPagos(e),this.cargarDeudaActual()):(this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.infoSeleccionada=null,this.resetFormForInfo(null))}),this.frmPago.get("gestion")?.valueChanges.subscribe(()=>{this.recalcularMesesPagadosGestion(),this.cargarDeudaActual()}),this.modo==="estudiante"){let t=Number(this.infoId??0);if(Number.isFinite(t)&&t>0){this.infoCtrl.setValue(t);let e=(this.gestionPredeterminada??"").toString().trim();e&&this.frmPago.patchValue({gestion:e},{emitEvent:!0})}}}ValidacionPagoxElemento(t){return this._tools.obtenerValidationClass(this.frmPago,t)}ValidacionTodoElementoPago(){Object.values(this.frmPago.controls).forEach(t=>{t.markAsTouched(),t.markAsDirty()})}hoyISO(){let t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${l}`}horaHHMM(){let t=new Date,e=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return`${e}:${a}`}mesActual(){return new Date().getMonth()+1}ngOnChanges(t){if((t.infoId||t.modo)&&this.modo==="estudiante"){let e=Number(this.infoId??0);Number.isFinite(e)&&e>0&&this.infoCtrl.value!==e&&this.infoCtrl.setValue(e)}if(t.gestionPredeterminada){let e=(this.gestionPredeterminada??"").toString().trim();e&&this.frmPago.patchValue({gestion:e},{emitEvent:!0})}}fotoUrl(){let t=(this.fotoEstudiante??"").toString().trim();return t?t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?`${this.ruta}${t}`:`${this.ruta}/${t}`:null}cargarGestionesAsignaciones(){this._pagos.ObtenerGestionesAsignaciones().subscribe({next:t=>{let e=Array.isArray(t?.data)?t.data:[];this.gestionesAsignaciones=e},error:()=>{this.gestionesAsignaciones=["SIN ASIGNAR"]}})}toggleVerDeudores(){this.verDeudores=!this.verDeudores,this.verDeudores&&this.cargarDeudores(1)}cargarDeudores(t=1){if(this.isLoadingDeudores)return;let e=String(this.gestionDeudores.value??"").trim()||String(new Date().getFullYear()),a=(this.filterDeudores??"").trim();this.isLoadingDeudores=!0,this._pagos.ObtenerDeudores({gestion:e,page:t,per_page:this.deudoresPerPage,search:a||void 0}).subscribe({next:l=>{this.deudores=Array.isArray(l?.data)?l.data:[],this.deudoresMeta=l?.meta??null,this.deudoresPage=this.deudoresMeta?.current_page??t},error:l=>{console.log("ERROR CARGANDO DEUDORES",l),this.deudores=[],this.deudoresMeta=null,this.deudoresPage=1},complete:()=>{this.isLoadingDeudores=!1}})}deudoresTienePrev(){return(this.deudoresMeta?.current_page??1)>1}deudoresTieneNext(){let t=this.deudoresMeta?.current_page??1,e=this.deudoresMeta?.last_page??1;return t<e}deudoresPrev(){this.deudoresTienePrev()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)-1)}deudoresNext(){this.deudoresTieneNext()&&this.cargarDeudores((this.deudoresMeta?.current_page??1)+1)}mesLabels(t){return(Array.isArray(t)?t:[]).map(a=>this.mesLabel(a)).filter(a=>!!a).join(", ")}abrirPagadoresMes(t){let e=Number(t);if(!Number.isFinite(e)||e<1||e>12)return;let a=String(this.frmPago.get("gestion")?.value??"").trim()||String(new Date().getFullYear()),l=a==="SIN ASIGNAR"?String(new Date().getFullYear()):a;this.pagadoresMes=e,this.pagadoresGestion=a,this.pagadoresGestionPago=l,this.pagadoresSearch="",this.pagadores=[],this.pagadoresMeta=null,this.pagadoresPage=1,this.modalPagadoresRef=this._modal.open(this.modalPagadoresTpl,{size:"lg",centered:!0,backdrop:"static",scrollable:!0}),this.cargarPagadores(1)}cargarPagadores(t=1){if(this.isLoadingPagadores)return;let e=Number(this.pagadoresMes??0);if(!e)return;let a=(this.pagadoresSearch??"").trim();this.isLoadingPagadores=!0,this._pagos.ObtenerPagadores({gestion:this.pagadoresGestion,gestion_pago:this.pagadoresGestionPago,mes:e,page:t,per_page:this.pagadoresPerPage,search:a||void 0}).subscribe({next:l=>{this.pagadores=Array.isArray(l?.data)?l.data:[],this.pagadoresMeta=l?.meta??null,this.pagadoresPage=this.pagadoresMeta?.current_page??t},error:l=>{console.log("ERROR CARGANDO PAGADORES",l),this.pagadores=[],this.pagadoresMeta=null,this.pagadoresPage=1},complete:()=>{this.isLoadingPagadores=!1}})}pagadoresTienePrev(){return(this.pagadoresMeta?.current_page??1)>1}pagadoresTieneNext(){let t=this.pagadoresMeta?.current_page??1,e=this.pagadoresMeta?.last_page??1;return t<e}pagadoresPrev(){this.pagadoresTienePrev()&&this.cargarPagadores((this.pagadoresMeta?.current_page??1)-1)}pagadoresNext(){this.pagadoresTieneNext()&&this.cargarPagadores((this.pagadoresMeta?.current_page??1)+1)}cargarEstadoPagoOptions(){this._controles.ObtenerOptionsSelectPorCategoria("ESTADO PAGO").subscribe({next:t=>this.estadoPagoOptions=t||[],error:()=>this.estadoPagoOptions=[]})}cargarMedioPagoOptions(){this._controles.ObtenerOptionsSelectPorCategoria("MEDIO PAGO").subscribe({next:t=>{let e=Array.isArray(t)?t:[];this.medioPagoOptions=e.length?e:[{value:"EFECTIVO",label:"EFECTIVO",disabled:!1},{value:"QR",label:"QR",disabled:!1},{value:"TRANSFERENCIA",label:"TRANSFERENCIA",disabled:!1}]},error:()=>{this.medioPagoOptions=[{value:"EFECTIVO",label:"EFECTIVO",disabled:!1},{value:"QR",label:"QR",disabled:!1},{value:"TRANSFERENCIA",label:"TRANSFERENCIA",disabled:!1}]}})}buscarInscripciones(t=1){if(this.isLoadingResultados)return;let e=(this.filterInscripcion??"").trim();if(!e||e.length<2){this.resultados=[],this.resMeta=null,this.resPage=1;return}this.isLoadingResultados=!0,this._info.Obtenerinfoestudiantesifas({page:t,per_page:this.resPerPage,search:e,sort_by:"Ap_Paterno",sort_dir:"asc"}).subscribe({next:a=>{this.resultados=Array.isArray(a?.data)?a.data:[],this.resMeta=a?.meta??null,this.resPage=this.resMeta?.current_page??t},error:a=>{console.log("ERROR BUSCANDO INSCRIPCIONES",a),this.resultados=[],this.resMeta=null,this.resPage=1},complete:()=>{this.isLoadingResultados=!1}})}resTienePrev(){return(this.resMeta?.current_page??1)>1}resTieneNext(){let t=this.resMeta?.current_page??1,e=this.resMeta?.last_page??1;return t<e}resPrev(){this.resTienePrev()&&this.buscarInscripciones((this.resMeta?.current_page??1)-1)}resNext(){this.resTieneNext()&&this.buscarInscripciones((this.resMeta?.current_page??1)+1)}seleccionarInscripcion(t){let e=Number(t?.id??0);e&&(this.infoSeleccionada=t,this.infoCtrl.setValue(e))}limpiarSeleccion(){this.infoCtrl.setValue(null),this.infoSeleccionada=null,this.pagos=[],this.mesesPagadosGestion=[],this.deudaMeses=[],this.deudaMaxMesCompaneros=null,this.resetFormForInfo(null)}cargarPagos(t){this.isLoadingPagos=!0,this._pagos.ObtenerPagoslcchPorInfo(t).subscribe({next:a=>{this.pagos=Array.isArray(a?.data)?a.data:[],this.recalcularMesesPagadosGestion()},error:a=>{console.log("ERROR CARGANDO PAGOS LCCH",a),this.pagos=[],this.mesesPagadosGestion=[]}}).add(()=>{this.isLoadingPagos=!1})}recalcularMesesPagadosGestion(){let t=String(this.frmPago.get("gestion")?.value??"").trim();if(!t){this.mesesPagadosGestion=[];return}let e=(this.pagos??[]).filter(a=>String(a?.gestion??"").trim()===t).filter(a=>String(a?.estadopago??"").trim().toUpperCase()==="PAGADO").map(a=>Number(a?.mes??0)).filter(a=>Number.isFinite(a)&&a>=1&&a<=12);this.mesesPagadosGestion=Array.from(new Set(e)).sort((a,l)=>a-l)}cargarDeudaActual(){let t=Number(this.infoCtrl.value??0);if(!t)return;let e=String(this.frmPago.get("gestion")?.value??"").trim()||String(new Date().getFullYear()),a=`${t}|${e}`;this.deudaKey!==a&&(this.deudaKey=a,this.isLoadingDeuda=!0,this._pagos.ObtenerDeudaPorInfo(t,e).subscribe({next:l=>{let g=l?.data;this.deudaMeses=Array.isArray(g?.meses_deuda)?g.meses_deuda:[],this.deudaMaxMesCompaneros=Number.isFinite(Number(g?.max_mes_companeros))?Number(g?.max_mes_companeros):null},error:l=>{console.log("ERROR CARGANDO DEUDA",l),this.deudaMeses=[],this.deudaMaxMesCompaneros=null},complete:()=>{this.isLoadingDeuda=!1}}))}resetFormForInfo(t){this.cancelarEdicion(),this.frmPago.reset({id:0,infoestudiantesifas_id:t,nrodocumento:"",mes:this.mesActual(),gestion:String(new Date().getFullYear()),monto:"",acuenta:"",saldo:"",dolarboliviano:"BOLIVIANO",mediopago:"EFECTIVO",fechapago:this.hoyISO(),horapago:this.horaHHMM(),estadopago:"PAGADO",observacion:"",file:""}),this.deudaKey=null}limpiarFormulario(){let t=this.infoCtrl.value??null;this.cancelarEdicion(),this.resetFormForInfo(t?Number(t):null)}abrirModalNuevoPago(){let t=Number(this.infoCtrl.value??0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}this.cancelarEdicion(),this.resetFormForInfo(t),this.abrirModalPago()}AutoCompletarLastPago(){if(!this.ultimoPagoSnapshot){this._tools.MostrarMensaje("warning","No hay informaci\xF3n previa para autocompletar");return}let t=Number(this.infoCtrl.value??0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}let e=O({},this.ultimoPagoSnapshot);e.id=0,e.infoestudiantesifas_id=t,e.fechapago=this.hoyISO(),e.horapago=this.horaHHMM(),e.file="",this.frmPago.patchValue(e)}abrirModalPago(){this.modalRef=this._modal.open(this.modalPagoTpl,{size:"lg",centered:!0,backdrop:"static",scrollable:!0}),this.modalRef.result.catch(()=>{}).finally(()=>{this.modalRef=null,this.limpiarFormulario()})}cerrarModalPago(){this.modalRef?.close()}iniciarEditar(t){this.cancelarEdicion(),this.editId=t?.id??null,this.originalFilePath=t?.file??null,this.frmPago.reset({id:t?.id??0,infoestudiantesifas_id:t?.infoestudiantesifas_id??this.infoCtrl.value,nrodocumento:t?.nrodocumento??"",mes:t?.mes??1,gestion:t?.gestion??String(new Date().getFullYear()),monto:t?.monto??"",acuenta:t?.acuenta??"",saldo:t?.saldo??"",dolarboliviano:t?.dolarboliviano??"",mediopago:t?.mediopago??"",fechapago:t?.fechapago??"",horapago:t?.horapago??"",estadopago:t?.estadopago??"PAGADO",observacion:t?.observacion??"",file:t?.file??""}),this.abrirModalPago()}cancelarEdicion(){this.tempFilePath&&this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null,this.originalFilePath=null,this.uploading=!1,this.uploadProgress=null,this.editId=null}onFileSelected(t){let e=t.target;if(!e?.files||e.files.length===0)return;let a=e.files[0];this.tempFilePath&&(this._tools.EliminarArchivo(this.tempFilePath),this.tempFilePath=null),this.uploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(a,"pagoslcchcomprobantes").subscribe({next:l=>{if(l.type===W.UploadProgress){let g=l.total??0;g>0&&(this.uploadProgress=Math.round(l.loaded/g*100))}if(l.type===W.Response){let g=l.body?.filePath;g&&(this.frmPago.patchValue({file:g}),this.tempFilePath=g),this.uploading=!1,this.uploadProgress=100}},error:l=>{console.log("ERROR SUBIENDO COMPROBANTE",l),this.uploading=!1,this.uploadProgress=null,this._tools.MostrarMensaje("error","Error al subir comprobante")}})}guardar(){let t=Number(this.infoCtrl.value||0);if(!t){this._tools.MostrarMensaje("warning","Seleccione una inscripci\xF3n");return}if(this.uploading){this._tools.MostrarMensaje("warning","Espere a que termine la subida");return}if(this.isSavingPago)return;let e=O({},this.frmPago.value);if(e.infoestudiantesifas_id=t,e.fechapago||(e.fechapago=this.hoyISO()),e.horapago||(e.horapago=this.horaHHMM()),this.frmPago.invalid){this.ValidacionTodoElementoPago(),this._tools.MostrarMensajeFrmIncompleto();return}let a=Number(e.mes??this.NO_MENSUALIDAD_MES);if(this.esMensualidad(a)){let b=String(e.gestion??"").trim();if((this.pagos??[]).some(E=>!E||this.editId&&Number(E?.id)===Number(this.editId)?!1:String(E?.gestion??"").trim()===b&&Number(E?.mes??-999)===a&&Number(E?.infoestudiantesifas_id??0)===t)){this._tools.MostrarMensaje("warning","No se puede repetir el mismo mes de pago en la misma gesti\xF3n.");return}}let l=b=>{if(b===""||b===null||b===void 0)return null;let S=Number(b);return Number.isFinite(S)?Math.trunc(S):null};if(e.nrodocumento=l(e.nrodocumento),e.monto=l(e.monto),e.acuenta=l(e.acuenta),e.saldo=l(e.saldo),!this.editId){delete e.id,this.isSavingPago=!0,this._pagos.AgregarPagoslcch(e).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago registrado"),this.ultimoPagoSnapshot=O({},e),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual(),this.cerrarModalPago()},error:S=>{console.log("ERROR CREANDO PAGO",S);let E=S?.error?.error||S?.error?.message;S?.status===422&&E?this._tools.MostrarMensaje("warning",E):this._tools.MostrarMensaje("error","Error al guardar")}}).add(()=>{this.isSavingPago=!1});return}this.isSavingPago=!0,this._pagos.ModificarPagoslcch(e,this.editId).subscribe({next:()=>{this._tools.MostrarMensaje("success","Pago actualizado"),this.ultimoPagoSnapshot=O({},e),this.tempFilePath&&this.originalFilePath&&this.tempFilePath!==this.originalFilePath&&this._tools.EliminarArchivo(this.originalFilePath),this.tempFilePath=null,this.cancelarEdicion(),this.resetFormForInfo(t),this.cargarPagos(t),this.cargarDeudaActual(),this.cerrarModalPago()},error:b=>{console.log("ERROR ACTUALIZANDO PAGO",b);let S=b?.error?.error||b?.error?.message;b?.status===422&&S?this._tools.MostrarMensaje("warning",S):this._tools.MostrarMensaje("error","Error al actualizar")}}).add(()=>{this.isSavingPago=!1})}eliminar(t){return X(this,null,function*(){if(!(yield this._tools.mostrarMensajeConfirm("Eliminar","\xBFEliminar este pago?","warning","Eliminar")))return;let a=Number(this.infoCtrl.value||0);this._pagos.EliminarPagoslcch(t.id).subscribe({next:()=>{t?.file&&this._tools.EliminarArchivo(t.file),this._tools.MostrarMensaje("success","Eliminado"),this.cargarPagos(a),this.cargarDeudaActual()},error:l=>{console.log("ERROR ELIMINANDO PAGO",l),this._tools.MostrarMensaje("error","Error al eliminar")}})})}mesLabel(t){let e=this.meses.find(a=>a.value===Number(t));return e?e.label:String(t??"")}};T.\u0275fac=function(e){return new(e||T)(P(De),P($),P(Te),P(Oe),P(Me),P(Ae))},T.\u0275cmp=ne({type:T,selectors:[["app-sistemapagoslcch"]],viewQuery:function(e,a){if(e&1&&(q(Ge,7),q(je,7)),e&2){let l;Q(l=z())&&(a.modalPagoTpl=l.first),Q(l=z())&&(a.modalPagadoresTpl=l.first)}},inputs:{modo:"modo",infoId:"infoId",estudianteId:"estudianteId",nombreEstudiante:"nombreEstudiante",fotoEstudiante:"fotoEstudiante",sexoEstudiante:"sexoEstudiante",gestionPredeterminada:"gestionPredeterminada"},standalone:!1,features:[ie],decls:14,vars:6,consts:[["modalPago",""],["modalPagadores",""],["sinFoto",""],["sinPagados",""],["sinDeuda",""],[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"m-0"],["class","btn btn-outline-primary","type","button",3,"click",4,"ngIf"],["class","card mb-3",4,"ngIf"],["class","card",4,"ngIf"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card","mb-3"],[1,"card-body","d-flex","align-items-center","gap-3"],[1,"flex-shrink-0"],["alt","Foto estudiante","style","width: 64px; height: 64px; object-fit: cover; border-radius: 12px;",3,"src",4,"ngIf","ngIfElse"],[1,"flex-grow-1"],[1,"fw-semibold"],["class","text-muted small",4,"ngIf"],[1,"mt-1"],["class","badge bg-primary",4,"ngIf"],["class","badge bg-secondary ms-2",4,"ngIf"],["alt","Foto estudiante",2,"width","64px","height","64px","object-fit","cover","border-radius","12px",3,"src"],[1,"bg-light","d-flex","align-items-center","justify-content-center","text-muted",2,"width","64px","height","64px","border-radius","12px"],[1,"bi","bi-person",2,"font-size","26px"],[1,"text-muted","small"],[1,"badge","bg-primary"],[1,"badge","bg-secondary","ms-2"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-danger"],[1,"d-flex","align-items-center","gap-2"],[1,"form-label","m-0"],[1,"form-select","form-select-sm",2,"width","180px",3,"change","formControl"],[3,"value",4,"ngFor","ngForOf"],[1,"card-body"],[1,"row","align-items-end","g-2"],[1,"col-lg-8"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],[1,"form-floating","flex-grow-1"],["type","text","placeholder","Buscar deudores",1,"form-control",3,"input","keyup.enter","value"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],[1,"d-inline-flex","align-items-center","gap-2"],["width","22px","height","22px",3,"options",4,"ngIf"],["class","mt-2 d-flex align-items-center gap-2",4,"ngIf"],[1,"col-lg-4"],[1,"form-label"],["readonly","",1,"form-control",3,"value"],[1,"table-responsive"],[1,"table","table-sm","table-striped","align-middle","mb-0"],[4,"ngIf"],[2,"width","160px"],[3,"hidden",4,"ngFor","ngForOf"],[3,"value"],["width","22px","height","22px",3,"options"],[1,"mt-2","d-flex","align-items-center","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"text-muted"],[1,"text-center","py-3"],[1,"loading-row"],["width","34px","height","34px",3,"options"],[3,"hidden"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"click"],["type","text","placeholder","Buscar inscripci\xF3n",1,"form-control",3,"input","keyup.enter","value"],[1,"mt-2","d-flex","flex-wrap","gap-2"],["class","loading-inline text-muted",4,"ngIf"],["class","btn btn-outline-secondary btn-sm","type","button",3,"active","disabled","hidden","click",4,"ngFor","ngForOf"],[1,"mt-2"],["class","text-muted",4,"ngIf"],["class","d-flex flex-wrap align-items-center gap-2",4,"ngIf"],[1,"loading-inline","text-muted"],["width","28px","height","28px",3,"options"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled","hidden"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"text-success"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["type","button","title","Registrar pago",1,"btn","mouse-dir","success","d-flex","align-items-center",2,"gap","8px",3,"click"],[2,"display","flex","align-items","center","justify-content","center","width","26px","height","26px"],["width","40px","height","40px",3,"options"],[1,"dir-part"],[1,"badge","bg-secondary"],[1,"text-muted","ms-2"],[4,"ngIf","ngIfElse"],["class","badge bg-success","style","cursor: pointer;","title","Ver estudiantes que pagaron este mes",3,"click",4,"ngFor","ngForOf"],["title","Ver estudiantes que pagaron este mes",1,"badge","bg-success",2,"cursor","pointer",3,"click"],["class","badge bg-danger","style","cursor: pointer;","title","Ver estudiantes que pagaron este mes",3,"click",4,"ngFor","ngForOf"],["title","Ver estudiantes que pagaron este mes",1,"badge","bg-danger",2,"cursor","pointer",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["novalidate","",3,"formGroup"],[1,"mb-3","d-flex","align-items-center","justify-content-between","flex-wrap","gap-2"],[1,"text-secondary"],[1,"badge","bg-primary","ms-2"],[1,"text-secondary","small"],[1,"row"],[1,"form-floating","mb-3","col-12","col-sm-4"],["formControlName","mes",1,"form-select",3,"ngClass"],[1,"invalid-feedback"],["type","text","placeholder"," ","formControlName","gestion",1,"form-control",3,"ngClass"],["type","number","placeholder"," ","formControlName","nrodocumento",1,"form-control"],["type","number","placeholder"," ","formControlName","monto",1,"form-control",3,"ngClass"],["type","number","placeholder"," ","formControlName","acuenta",1,"form-control"],["type","number","placeholder"," ","formControlName","saldo",1,"form-control"],[1,"mb-3","col-12","col-sm-4"],["role","group","aria-label","Moneda",1,"btn-group","w-100"],["type","radio","value","BOLIVIANO",1,"btn-check",3,"id","formControl"],[1,"btn","btn-outline-primary",3,"for"],["type","radio","value","DOLAR",1,"btn-check",3,"id","formControl"],["formControlName","mediopago",1,"form-select",3,"ngClass"],["disabled","",3,"value"],[3,"value","disabled",4,"ngFor","ngForOf"],["formControlName","estadopago",1,"form-select",3,"ngClass"],["type","date","placeholder"," ","formControlName","fechapago",1,"form-control"],["type","time","placeholder"," ","formControlName","horapago",1,"form-control"],["type","file",1,"form-control",3,"change"],["class","mt-1",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"mb-3","col-sm-12"],["placeholder","",1,"quill-container-wrapper",3,"formControl","modules"],[1,"modal-footer"],["class","me-auto",4,"ngIf"],["title","Guardar",1,"btn","mouse-dir","primary","d-flex","align-items-center",2,"gap","8px",3,"click","disabled"],[2,"display","flex","align-items","center","justify-content","center","width","30px","height","30px"],["width","42px","height","42px",3,"options",4,"ngIf"],["width","50px","height","50px",3,"options",4,"ngIf"],["title","Cancelar y cerrar",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click"],["width","50px","height","50px",3,"options"],[3,"value","disabled"],["target","_blank","rel","noopener noreferrer",3,"href"],[1,"progress"],["role","progressbar",1,"progress-bar"],[1,"me-auto"],["title","Se autocompletar\xE1 la \xFAltima informaci\xF3n",1,"btn","mouse-dir","secondary","d-flex","align-items-center",2,"gap","8px",3,"click","disabled"],["width","42px","height","42px",3,"options"],[1,"row","align-items-end","g-2","mb-3"],[1,"col-12","col-lg-8"],["placeholder","CI, apellidos o nombre",1,"form-control",3,"input","keyup.enter","value"],[1,"col-12","col-lg-4"],["class","d-flex align-items-center gap-2 mb-2",4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"d-flex","align-items-center","gap-2","mb-2"],["colspan","4",1,"text-center","py-3"],[1,"card"],[1,"card-header","text-danger"],["colspan","8",1,"text-center","py-3"],["target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"]],template:function(e,a){e&1&&(i(0,"div",5)(1,"div",6)(2,"h4",7),s(3,"Sistema de Pagos"),n(),p(4,$e,2,1,"button",8),n(),p(5,ze,13,6,"div",9)(6,it,52,12,"div",9)(7,ct,27,10,"div",9)(8,bt,26,7,"div",9)(9,Tt,109,30,"ng-template",null,0,w)(11,kt,40,11,"ng-template",null,1,w)(13,Bt,27,3,"div",10),n()),e&2&&(r(4),d("ngIf",a.modo!=="estudiante"),r(),d("ngIf",a.modo==="estudiante"),r(),d("ngIf",a.verDeudores&&a.modo!=="estudiante"),r(),d("ngIf",a.modo!=="estudiante"),r(),d("ngIf",a.infoCtrl.value),r(5),d("ngIf",a.infoCtrl.value))},dependencies:[le,de,ce,he,Pe,ye,ge,xe,Ee,ve,ue,_e,be,Se,Ce,we,Ve,Re],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}.quill-container-wrapper[_ngcontent-%COMP%]{min-height:120px}.modal-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}.loading-row[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:10px}.loading-inline[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px}"]});var U=T;var Ht=[{path:"sistemapagoslcch",component:U}],I=class I{};I.\u0275fac=function(e){return new(e||I)},I.\u0275mod=D({type:I}),I.\u0275inj=N({imports:[J.forChild(Ht),J]});var B=I;var M=class M{};M.\u0275fac=function(e){return new(e||M)},M.\u0275mod=D({type:M}),M.\u0275inj=N({imports:[me,Ne,Ie,Fe,B]});var ke=M;export{$ as a,U as b,ke as c};
