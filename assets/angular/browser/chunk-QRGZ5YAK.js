import{a as k}from"./chunk-KFXCIGMC.js";import{Da as m,Ea as p,Fa as r,Qa as x,Qb as b,Sa as d,Zb as I,ab as C,ea as s,eb as l,fb as g,fc as y,gb as _,la as u,lc as M,na as v,sa as h}from"./chunk-LW4OU2FI.js";import"./chunk-ATDPNAVO.js";function w(i,n){if(i&1&&(p(0,"div",7)(1,"div",8)(2,"div",9),l(3),r()(),p(4,"div",10),l(5,"Subiendo\u2026"),r()()),i&2){let t=d();s(2),C("width",t.progress,"%"),s(),_("",t.progress,"%")}}function P(i,n){if(i&1&&(p(0,"div",11),l(1),r()),i&2){let t=d();s(),g(t.message)}}function E(i,n){if(i&1&&(p(0,"div",12),l(1),r()),i&2){let t=d();s(),g(t.error)}}var c=class c{constructor(n,t){this.route=n;this.http=t;this.ruta="";this.token=null;this.uploading=!1;this.progress=0;this.message=null;this.error=null;this.ruta=this.resolveBackendBaseUrl(),this.token=this.route.snapshot.paramMap.get("token")}resolveBackendBaseUrl(){let n=new URL(".",document.baseURI).toString(),t=(k.ruta??"").trim();if(!t)return n;try{let o=new URL(t,n),a=(o.hostname||"").toLowerCase(),e=(window.location.hostname||"").toLowerCase();if((a==="localhost"||a==="127.0.0.1"||a==="::1")&&e&&e!==a){let f=new URL(o.toString());return f.hostname=e,f.toString()}return o.toString()}catch{return n}}onFileSelected(n){let t=n.target,o=t.files?.item(0);if(t.value="",!o||!this.token)return;this.uploading=!0,this.progress=0,this.message=null,this.error=null;let a=new FormData;a.append("file",o),this.http.post(this.ruta+"api/capture-sessions/"+this.token+"/upload",a,{reportProgress:!0,observe:"events"}).subscribe({next:e=>{if(e?.type===1&&e.total){this.progress=Math.round(e.loaded/e.total*100);return}e?.type===4&&(this.uploading=!1,this.message="Foto enviada. Ya puedes cerrar esta pantalla.")},error:e=>{this.uploading=!1,this.progress=0,this.error=e?.error?.error??"No se pudo subir la foto"}})}};c.\u0275fac=function(t){return new(t||c)(u(M),u(y))},c.\u0275cmp=v({type:c,selectors:[["app-captura-foto"]],decls:10,vars:3,consts:[[1,"page"],[1,"muted"],[1,"box"],["type","file","accept","image/*","capture","environment",3,"change"],["class","mt",4,"ngIf"],["class","ok mt",4,"ngIf"],["class","err mt",4,"ngIf"],[1,"mt"],[1,"progress"],[1,"progress-bar"],[1,"muted","mt2"],[1,"ok","mt"],[1,"err","mt"]],template:function(t,o){t&1&&(p(0,"div",0)(1,"h3"),l(2,"Captura de foto"),r(),p(3,"p",1),l(4," Toca el bot\xF3n para abrir la c\xE1mara del celular y enviar la foto. "),r(),p(5,"div",2)(6,"input",3),x("change",function(e){return o.onFileSelected(e)}),r(),h(7,w,6,3,"div",4)(8,P,2,1,"div",5)(9,E,2,1,"div",6),r()()),t&2&&(s(7),m("ngIf",o.uploading),s(),m("ngIf",o.message),s(),m("ngIf",o.error))},dependencies:[I,b],styles:[".page[_ngcontent-%COMP%]{max-width:520px;margin:24px auto;padding:0 16px}.muted[_ngcontent-%COMP%]{color:#666}.box[_ngcontent-%COMP%]{border:1px solid #e5e5e5;border-radius:12px;padding:16px}.mt[_ngcontent-%COMP%]{margin-top:12px}.mt2[_ngcontent-%COMP%]{margin-top:8px}.progress[_ngcontent-%COMP%]{height:10px;background:#f1f1f1;border-radius:999px;overflow:hidden}.progress-bar[_ngcontent-%COMP%]{height:10px;background:#0d6efd;color:transparent}.ok[_ngcontent-%COMP%]{color:#0a7f2e}.err[_ngcontent-%COMP%]{color:#b00020}"]});var S=c;export{S as CapturaFotoComponent};
