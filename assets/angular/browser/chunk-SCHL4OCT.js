import{a as ke}from"./chunk-FP75KMDZ.js";import{b as Ae}from"./chunk-2XFHIHYO.js";import"./chunk-OXONTOT5.js";import{k as ye}from"./chunk-2UZ5XJOB.js";import{b as re}from"./chunk-5XGECW57.js";import{g as oe}from"./chunk-3IGMLI3N.js";import{c as J,e as C,f as Q,g as K,h as I,j as p,k as Z,l as X,m as ge,o as Ve,p as Y,q as ee,r as te,s as ie,t as ne,x as Oe,y as De}from"./chunk-F4JB6MJU.js";import{a as M}from"./chunk-5RMZ5E5A.js";import{Ab as G,Bb as B,Ca as l,Cc as W,Dc as $,F as Me,Gb as _e,Jb as o,Ka as w,Kb as E,Lb as F,Lc as Te,Mb as ce,Nb as Pe,Ob as Ne,Pa as j,Qa as fe,Qb as x,Rb as S,Rc as H,Sb as y,Tc as Se,Ua as h,Vc as U,Wb as xe,Z as R,_ as pe,ba as L,ec as q,ga as u,gb as d,ha as f,hb as n,ib as i,jb as _,k as we,nb as Ie,ob as Fe,qb as b,tb as v,vb as m,za as ue,zb as z}from"./chunk-4IB5NCLX.js";import{a as k,m as P}from"./chunk-GG76335P.js";var N=class N{constructor(t){this.http=t;this.ruta=M.ruta}Obtenereventos(t){let e=new H;return t&&Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(e=e.set(r,String(a)))}),this.http.get(this.ruta+"api/eventos",{params:e})}Agregareventos(t){return this.http.post(this.ruta+"api/eventos",t)}Modificareventos(t,e){return this.http.put(this.ruta+"api/eventos/"+e,t)}Seleccionareventos(t){return this.http.get(this.ruta+"api/eventos/"+t)}Eliminareventos(t){return this.http.delete(this.ruta+"api/eventos/"+t)}createFormGroupeventos(){return new I({id:new p(0),instituciones_id:new p(""),Anio:new p(null,[C.required]),NombreEvento:new p("",[C.required]),Descripcion:new p(""),Lugar:new p(""),FechaInicio:new p(""),FechaFin:new p(""),ModoInscripcion:new p("NORMAL",[C.required]),PublicoWeb:new p(0),Activo:new p(1),Requisitos:new p(""),Parametros:new p(""),InputsEspecial:new p(""),TienePago:new p(0),Monto:new p(null),Moneda:new p("BS"),diseniocertificadopdfs_id:new p(null),CertificadoConfig:new p(""),Observacion:new p("")})}};N.\u0275fac=function(e){return new(e||N)(L(U))},N.\u0275prov=R({token:N,factory:N.\u0275fac,providedIn:"root"});var ae=N;var V=class V{constructor(t){this.http=t;this.ruta=M.ruta}Obtenerdiseniocertificadopdfs(t){let e=new H;return t&&Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(e=e.set(r,String(a)))}),this.http.get(this.ruta+"api/diseniocertificadopdfs",{params:e})}Agregardiseniocertificadopdfs(t){return this.http.post(this.ruta+"api/diseniocertificadopdfs",t)}Modificardiseniocertificadopdfs(t,e){return this.http.put(this.ruta+"api/diseniocertificadopdfs/"+e,t)}Seleccionardiseniocertificadopdfs(t){return this.http.get(this.ruta+"api/diseniocertificadopdfs/"+t)}Eliminardiseniocertificadopdfs(t){return this.http.delete(this.ruta+"api/diseniocertificadopdfs/"+t)}createFormGroupdiseniocertificadopdfs(){return new I({id:new p(0),instituciones_id:new p(""),Nombre:new p("",[C.required]),ArchivoPdf:new p("",[C.required]),Parametros:new p(""),Activo:new p(1),Observacion:new p("")})}};V.\u0275fac=function(e){return new(e||V)(L(U))},V.\u0275prov=R({token:V,factory:V.\u0275fac,providedIn:"root"});var se=V;var Ue=["modalEvento"];function Je(s,t){if(s&1&&(n(0,"option",19),o(1),i()),s&2){let e=t.$implicit;d("value",e),l(),F("",e," por p\xE1gina")}}function Qe(s,t){s&1&&(n(0,"div",4),o(1,"Cargando..."),i())}function Ke(s,t){if(s&1&&(n(0,"small",4),o(1),i()),s&2){let e=m().$implicit;l(),E(e==null?null:e.Lugar)}}function Ze(s,t){if(s&1&&(n(0,"span"),o(1),i()),s&2){let e=m().$implicit;l(),ce("S\xED (",e==null?null:e.Monto," ",(e==null?null:e.Moneda)||"BS",")")}}function Xe(s,t){s&1&&(n(0,"span"),o(1,"No"),i())}function Ye(s,t){if(s&1){let e=b();n(0,"tr")(1,"td"),o(2),i(),n(3,"td"),o(4),i(),n(5,"td")(6,"div",24),o(7),i(),h(8,Ke,2,1,"small",16),i(),n(9,"td"),o(10),i(),n(11,"td"),h(12,Ze,2,2,"span",25)(13,Xe,2,0,"span",25),i(),n(14,"td")(15,"span",26),o(16),i()(),n(17,"td",27)(18,"button",28),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.abrirEditar(a))}),o(19,"Editar"),i(),n(20,"button",29),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.eliminar(a))}),o(21,"Eliminar"),i()()()}if(s&2){let e=t.$implicit;l(2),E(e==null?null:e.id),l(2),E(e==null?null:e.Anio),l(3),E(e==null?null:e.NombreEvento),l(),d("ngIf",e==null?null:e.Lugar),l(2),E(e==null?null:e.ModoInscripcion),l(2),d("ngIf",(e==null?null:e.TienePago)==1),l(),d("ngIf",(e==null?null:e.TienePago)!=1),l(2),_e("bg-success",(e==null?null:e.Activo)==1)("bg-secondary",(e==null?null:e.Activo)!=1),l(),E((e==null?null:e.Activo)==1?"Activo":"Inactivo")}}function et(s,t){if(s&1&&(n(0,"div",20)(1,"table",21)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),i(),n(6,"th"),o(7,"A\xF1o"),i(),n(8,"th"),o(9,"Nombre"),i(),n(10,"th"),o(11,"Modo"),i(),n(12,"th"),o(13,"Pago"),i(),n(14,"th"),o(15,"Activo"),i(),_(16,"th",22),i()(),n(17,"tbody"),h(18,Ye,22,12,"tr",23),i()()()),s&2){let e=m();l(18),d("ngForOf",e.eventosPaginados)}}function tt(s,t){if(s&1&&(n(0,"option",53),o(1),i()),s&2){let e=t.$implicit;d("ngValue",e==null?null:e.id),l(),E(e==null?null:e.Nombre)}}function it(s,t){if(s&1){let e=b();n(0,"div",30)(1,"h5",31),o(2),i(),n(3,"button",32),v("click",function(){u(e);let a=m();return f(a.modalEventoRef.close())}),i()(),n(4,"div",33)(5,"form",34)(6,"div",35)(7,"label",36),o(8,"A\xF1o"),i(),_(9,"input",37),i(),n(10,"div",7)(11,"label",36),o(12,"Nombre"),i(),_(13,"input",38),i(),n(14,"div",39)(15,"label",36),o(16,"Modo"),i(),n(17,"select",40)(18,"option",41),o(19,"NORMAL"),i(),n(20,"option",42),o(21,"FASES"),i(),n(22,"option",43),o(23,"CONVOCATORIA"),i(),n(24,"option",44),o(25,"OTRO"),i()()(),n(26,"div",7)(27,"label",36),o(28,"Lugar"),i(),_(29,"input",45),i(),n(30,"div",9)(31,"label",36),o(32,"Fecha inicio"),i(),_(33,"input",46),i(),n(34,"div",9)(35,"label",36),o(36,"Fecha fin"),i(),_(37,"input",47),i(),n(38,"div",48)(39,"label",36),o(40,"Descripci\xF3n"),i(),_(41,"textarea",49),i(),n(42,"div",48)(43,"label",36),o(44,"Requisitos"),i(),_(45,"textarea",50),i(),n(46,"div",48)(47,"label",36),o(48,"Par\xE1metros (JSON opcional)"),i(),_(49,"textarea",51),i(),n(50,"div",9)(51,"label",36),o(52,"\xBFTiene pago?"),i(),n(53,"select",52)(54,"option",53),o(55,"No"),i(),n(56,"option",53),o(57,"S\xED"),i()()(),n(58,"div",9)(59,"label",36),o(60,"Monto"),i(),_(61,"input",54),i(),n(62,"div",9)(63,"label",36),o(64,"Moneda"),i(),_(65,"input",55),i(),n(66,"div",9)(67,"label",36),o(68,"Activo"),i(),n(69,"select",56)(70,"option",53),o(71,"S\xED"),i(),n(72,"option",53),o(73,"No"),i()()(),n(74,"div",9)(75,"label",36),o(76,"P\xFAblico web"),i(),n(77,"select",57)(78,"option",53),o(79,"No"),i(),n(80,"option",53),o(81,"S\xED"),i()()(),n(82,"div",48)(83,"label",36),o(84,"InputsEspecial (JSON opcional)"),i(),_(85,"textarea",58),n(86,"small",59),o(87),i()(),n(88,"div",48),_(89,"hr",60),n(90,"h6",61),o(91,"Certificaci\xF3n"),i()(),n(92,"div",7)(93,"label",36),o(94,"Dise\xF1o de certificado (PDF)"),i(),n(95,"select",62)(96,"option",53),o(97,"-- Sin certificado --"),i(),h(98,tt,2,2,"option",63),i(),n(99,"small",59),o(100,"Administre dise\xF1os en la pantalla \u201Cdiseniocertificadopdfs\u201D."),i()(),n(101,"div",48)(102,"label",36),o(103,"CertificadoConfig (JSON de posiciones)"),i(),_(104,"textarea",64),n(105,"small",59),o(106,"Keys: NOMBRE_COMPLETO, CARNET, EVENTO, ANIO, FECHA (o keys del Dise\xF1o especial/DatosEspeciales)."),i()(),n(107,"div",48)(108,"label",36),o(109,"Observaci\xF3n"),i(),_(110,"textarea",65),i()()(),n(111,"div",66)(112,"button",67),v("click",function(){u(e);let a=m();return f(a.modalEventoRef.close())}),o(113,"Cerrar"),i(),n(114,"button",5),v("click",function(){u(e);let a=m();return f(a.guardar())}),o(115,"Guardar"),i()()}if(s&2){let e=m();l(2),E(e.editId?"Editar evento":"Nuevo evento"),l(3),d("formGroup",e.frm),l(49),d("ngValue",0),l(2),d("ngValue",1),l(14),d("ngValue",1),l(2),d("ngValue",0),l(6),d("ngValue",0),l(2),d("ngValue",1),l(7),E(e.schemaPreview),l(9),d("ngValue",null),l(2),d("ngForOf",e.diseniosCertificado)}}var le=class le{constructor(t,e,r){this._svc=t;this._certDis=e;this._tools=r;this.eventos=[];this.diseniosCertificado=[];this.isLoading=!1;this.filterTxt="";this.pagin=1;this.pageSize=10;this.pageSizeOptions=[5,10,20,50];this.editId=null;this.frm=this._svc.createFormGroupeventos()}ngOnInit(){this.cargarEventos(),this.cargarDiseniosCertificado()}cargarDiseniosCertificado(){this._certDis.Obtenerdiseniocertificadopdfs({activos:1}).subscribe({next:t=>{this.diseniosCertificado=t?.data??[]},error:()=>{this.diseniosCertificado=[]}})}cargarEventos(){this.isLoading=!0,this._svc.Obtenereventos().subscribe({next:t=>{this.eventos=t?.data??[],this.isLoading=!1},error:()=>{this.isLoading=!1,this._tools.MostrarMensajeErrordeCarga()}})}get eventosFiltrados(){let t=(this.filterTxt??"").toString().trim().toUpperCase();return t?(this.eventos??[]).filter(e=>{let r=(e?.NombreEvento??"").toString().toUpperCase(),a=(e?.Anio??"").toString().toUpperCase(),c=(e?.ModoInscripcion??"").toString().toUpperCase();return r.includes(t)||a.includes(t)||c.includes(t)}):this.eventos}get collectionSize(){return this.eventosFiltrados?.length??0}get eventosPaginados(){let t=this.eventosFiltrados||[],r=(Math.min(Math.max(1,this.pagin),Math.max(1,Math.ceil(t.length/this.pageSize)||1))-1)*this.pageSize;return t.slice(r,r+this.pageSize)}onFilterTxtChange(){this.pagin=1}onPageSizeChange(){this.pagin=1}abrirNuevo(){this.editId=null,this.frm.reset(this._svc.createFormGroupeventos().value),this.frm.patchValue({Activo:1,PublicoWeb:0,ModoInscripcion:"NORMAL",TienePago:0,Moneda:"BS"}),this.modalEventoRef=this._tools.openModal(this.modalEventoTpl,"lg")}abrirEditar(t){this.editId=t?.id??null,this.frm.reset(this._svc.createFormGroupeventos().value),this.frm.patchValue(t??{}),this.frm.get("Parametros")?.value==null&&this.frm.patchValue({Parametros:""}),this.frm.get("InputsEspecial")?.value==null&&this.frm.patchValue({InputsEspecial:""}),this.frm.get("CertificadoConfig")?.value==null&&this.frm.patchValue({CertificadoConfig:""}),this.modalEventoRef=this._tools.openModal(this.modalEventoTpl,"lg")}parseSchema(t){let e=(t??"").toString().trim();if(!e)return null;try{return JSON.parse(e)}catch{return null}}parseJsonAny(t){let e=(t??"").toString().trim();if(!e)return null;try{return JSON.parse(e)}catch{return null}}get schemaPreview(){let t=this.parseSchema(this.frm.get("InputsEspecial")?.value);if(!t)return(this.frm.get("InputsEspecial")?.value??"").toString().trim()?"JSON inv\xE1lido (revise InputsEspecial)":"Sin dise\xF1o especial (OK)";let e=t?.phases??[],r=t?.fields??[];if(e.length>0){let a=e.reduce((c,g)=>c+(g?.fields??[]).length,0);return`Esquema por fases: ${e.length} fase(s), ${a} campo(s)`}return`Esquema simple: ${r.length} campo(s)`}guardar(){if(this.frm.invalid){this._tools.MostrarMensajeFrmIncompleto();return}let t=(this.frm.get("InputsEspecial")?.value??"").toString().trim();if(t&&!this.parseSchema(t)){this._tools.MostrarMensaje("warning","InputsEspecial: JSON inv\xE1lido");return}let e=(this.frm.get("CertificadoConfig")?.value??"").toString().trim();if(e&&!this.parseJsonAny(e)){this._tools.MostrarMensaje("warning","CertificadoConfig: JSON inv\xE1lido");return}let r=k({},this.frm.value);this._tools.MostrarMensajeLoading(),(this.editId?this._svc.Modificareventos(r,this.editId):this._svc.Agregareventos(r)).subscribe({next:()=>{this.modalEventoRef?.close(),this._tools.MostrarMensajeSuccess(),this.cargarEventos()},error:()=>{this._tools.MostrarMensajeError()}})}eliminar(t){return P(this,null,function*(){(yield this._tools.mostrarMensajeConfirm("Eliminar evento","\xBFEst\xE1 seguro?","warning","S\xED, eliminar","Cancelar"))&&this._svc.Eliminareventos(t?.id).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.cargarEventos()},error:()=>this._tools.MostrarMensajeError()})})}};le.\u0275fac=function(e){return new(e||le)(w(ae),w(se),w(re))},le.\u0275cmp=j({type:le,selectors:[["app-eventos"]],viewQuery:function(e,r){if(e&1&&z(Ue,7),e&2){let a;G(a=B())&&(r.modalEventoTpl=a.first)}},standalone:!1,decls:25,vars:9,consts:[["modalEvento",""],[1,"container-fluid"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"mb-0"],[1,"text-muted"],[1,"btn","btn-primary",3,"click"],[1,"row","g-2","mb-2"],[1,"col-md-6"],["placeholder","Buscar por nombre/a\xF1o/modo...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3","d-flex","align-items-center","justify-content-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"card"],[1,"card-body"],["class","text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"d-flex","justify-content-center",3,"pageChange","page","pageSize","collectionSize","boundaryLinks"],[3,"value"],[1,"table-responsive"],[1,"table","table-sm","table-hover","align-middle"],[2,"width","160px"],[4,"ngFor","ngForOf"],[1,"fw-semibold"],[4,"ngIf"],[1,"badge"],[1,"text-end"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-2",3,"formGroup"],[1,"col-md-2"],[1,"form-label"],["type","number","formControlName","Anio",1,"form-control"],["formControlName","NombreEvento",1,"form-control"],[1,"col-md-4"],["formControlName","ModoInscripcion",1,"form-select"],["value","NORMAL"],["value","FASES"],["value","CONVOCATORIA"],["value","OTRO"],["formControlName","Lugar",1,"form-control"],["type","date","formControlName","FechaInicio",1,"form-control"],["type","date","formControlName","FechaFin",1,"form-control"],[1,"col-12"],["rows","2","formControlName","Descripcion",1,"form-control"],["rows","2","formControlName","Requisitos","placeholder","Ej: CI, foto, etc",1,"form-control"],["rows","2","formControlName","Parametros","placeholder",'{"cupos":100,"categorias":["A","B"]}',1,"form-control"],["formControlName","TienePago",1,"form-select"],[3,"ngValue"],["type","number","formControlName","Monto",1,"form-control"],["formControlName","Moneda",1,"form-control"],["formControlName","Activo",1,"form-select"],["formControlName","PublicoWeb",1,"form-select"],["rows","6","formControlName","InputsEspecial","placeholder",'{"version":1,"phases":[{"title":"Fase 1","fields":[{"key":"nombre1","label":"Nombre 1","type":"text","required":true}]}]}',1,"form-control"],[1,"text-muted","d-block","mt-1"],[1,"my-2"],[1,"mb-2"],["formControlName","diseniocertificadopdfs_id",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],["rows","6","formControlName","CertificadoConfig","placeholder",'{"page":1,"fields":[{"key":"NOMBRE_COMPLETO","x":40,"y":120,"fontSize":28,"align":"C","w":200}]}',1,"form-control"],["rows","2","formControlName","Observacion",1,"form-control"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"]],template:function(e,r){if(e&1){let a=b();n(0,"div",1)(1,"div",2)(2,"div")(3,"h4",3),o(4,"Eventos"),i(),n(5,"small",4),o(6,"Crear y configurar eventos (incluye dise\xF1o de inputs din\xE1micos)"),i()(),n(7,"button",5),v("click",function(){return u(a),f(r.abrirNuevo())}),o(8,"Nuevo evento"),i()(),n(9,"div",6)(10,"div",7)(11,"input",8),y("ngModelChange",function(g){return u(a),S(r.filterTxt,g)||(r.filterTxt=g),f(g)}),v("ngModelChange",function(){return u(a),f(r.onFilterTxtChange())}),i()(),n(12,"div",9)(13,"select",10),y("ngModelChange",function(g){return u(a),S(r.pageSize,g)||(r.pageSize=g),f(g)}),v("change",function(){return u(a),f(r.onPageSizeChange())}),h(14,Je,2,2,"option",11),i()(),n(15,"div",12)(16,"button",13),v("click",function(){return u(a),f(r.cargarEventos())}),o(17,"Refrescar"),i()()(),n(18,"div",14)(19,"div",15),h(20,Qe,2,0,"div",16)(21,et,19,1,"div",17),n(22,"ngb-pagination",18),y("pageChange",function(g){return u(a),S(r.pagin,g)||(r.pagin=g),f(g)}),i()()(),h(23,it,116,11,"ng-template",null,0,q),i()}e&2&&(l(11),x("ngModel",r.filterTxt),l(2),x("ngModel",r.pageSize),l(),d("ngForOf",r.pageSizeOptions),l(6),d("ngIf",r.isLoading),l(),d("ngIf",!r.isLoading),l(),x("page",r.pagin),d("pageSize",r.pageSize)("collectionSize",r.collectionSize)("boundaryLinks",!0))},dependencies:[W,$,X,ie,ne,J,ge,te,Q,K,Z,Y,ee,oe],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var ve=le;var O=class O{constructor(t){this.http=t;this.ruta=M.ruta}Obtenerestudianteseventos(t){let e=new H;return t&&Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(e=e.set(r,String(a)))}),this.http.get(this.ruta+"api/estudianteseventos",{params:e})}ObtenerporEvento(t){return this.http.get(this.ruta+"api/estudianteseventos/by-evento/"+t)}Agregarestudianteseventos(t){return this.http.post(this.ruta+"api/estudianteseventos",t)}Modificarestudianteseventos(t,e){return this.http.put(this.ruta+"api/estudianteseventos/"+e,t)}Seleccionarestudianteseventos(t){return this.http.get(this.ruta+"api/estudianteseventos/"+t)}Eliminarestudianteseventos(t){return this.http.delete(this.ruta+"api/estudianteseventos/"+t)}GenerarCertificado(t){return this.http.post(this.ruta+"api/estudianteseventos/"+t+"/generar-certificado",{})}createFormGroupestudianteseventos(){return new I({id:new p(0),instituciones_id:new p(""),eventos_id:new p(null,[C.required]),estudiantesifas_id:new p(null),Ap_Paterno:new p("",[C.required]),Ap_Materno:new p("",[C.required]),Nombres:new p("",[C.required]),Carnet:new p("",[C.required]),Celular:new p(""),Correo:new p(""),DatosEspeciales:new p(""),TienePago:new p(0),Monto:new p(null),MetodoPago:new p(""),FechaPago:new p(""),ComprobantePago:new p(""),EstadoPago:new p("NO_APLICA"),EstadoInscripcion:new p("PENDIENTE"),CertificadoPdf:new p(""),CertificadoGeneradoAt:new p(""),Observacion:new p("")})}};O.\u0275fac=function(e){return new(e||O)(L(U))},O.\u0275prov=R({token:O,factory:O.\u0275fac,providedIn:"root"});var he=O;var ot=["modalRegistro"],$e=()=>[];function rt(s,t){if(s&1&&(n(0,"option",10),o(1),i()),s&2){let e=t.$implicit;d("ngValue",e==null?null:e.id),l(),ce("",e==null?null:e.Anio," - ",e==null?null:e.NombreEvento)}}function at(s,t){if(s&1&&(n(0,"option",21),o(1),i()),s&2){let e=t.$implicit;d("value",e),l(),F("",e," por p\xE1gina")}}function st(s,t){s&1&&(n(0,"div",4),o(1,"Seleccione un evento para ver/registrar inscripciones."),i())}function lt(s,t){s&1&&(n(0,"div",4),o(1,"Cargando..."),i())}function dt(s,t){if(s&1&&(n(0,"div")(1,"div",26),o(2),i(),n(3,"small",4),o(4),i()()),s&2){let e=m().$implicit;l(2),E(e==null?null:e.EstadoPago),l(2),E(e==null?null:e.Monto)}}function mt(s,t){s&1&&(n(0,"div",4),o(1,"No aplica"),i())}function ct(s,t){if(s&1&&(n(0,"a",34),o(1,"Ver certificado"),i()),s&2){let e=m().$implicit,r=m(2);d("href",r.ruta+e.CertificadoPdf,ue)}}function pt(s,t){if(s&1){let e=b();n(0,"tr")(1,"td"),o(2),i(),n(3,"td")(4,"div",26),o(5),i(),n(6,"small",4),o(7),i()(),n(8,"td"),o(9),i(),n(10,"td")(11,"span",27),o(12),i()(),n(13,"td"),h(14,dt,5,2,"div",28)(15,mt,2,0,"div",18),i(),n(16,"td",29),h(17,ct,2,1,"a",30),n(18,"button",31),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.generarCertificado(a))}),o(19,"Generar"),i(),n(20,"button",32),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.abrirEditar(a))}),o(21,"Editar"),i(),n(22,"button",33),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.eliminar(a))}),o(23,"Eliminar"),i()()()}if(s&2){let e=t.$implicit;l(2),E(e==null?null:e.id),l(3),Pe("",e==null?null:e.Ap_Paterno," ",e==null?null:e.Ap_Materno," ",e==null?null:e.Nombres),l(2),ce("",e==null?null:e.Celular," ",e!=null&&e.Correo?"\xB7 "+(e==null?null:e.Correo):""),l(2),E(e==null?null:e.Carnet),l(3),E(e==null?null:e.EstadoInscripcion),l(2),d("ngIf",(e==null?null:e.TienePago)==1),l(),d("ngIf",(e==null?null:e.TienePago)!=1),l(2),d("ngIf",e==null?null:e.CertificadoPdf)}}function ut(s,t){if(s&1&&(n(0,"div",22)(1,"table",23)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),i(),n(6,"th"),o(7,"Estudiante"),i(),n(8,"th"),o(9,"Carnet"),i(),n(10,"th"),o(11,"Estado"),i(),n(12,"th"),o(13,"Pago"),i(),_(14,"th",24),i()(),n(15,"tbody"),h(16,pt,24,11,"tr",25),i()()()),s&2){let e=m();l(16),d("ngForOf",e.registrosPaginados)}}function ft(s,t){if(s&1){let e=b();n(0,"ngb-pagination",35),y("pageChange",function(a){u(e);let c=m();return S(c.pagin,a)||(c.pagin=a),f(a)}),i()}if(s&2){let e=m();x("page",e.pagin),d("pageSize",e.pageSize)("collectionSize",e.collectionSize)("boundaryLinks",!0)}}function _t(s,t){s&1&&(n(0,"div",68),o(1,"Buscando..."),i())}function gt(s,t){if(s&1){let e=b();n(0,"button",69),v("click",function(){let a=u(e).$implicit,c=m(3);return f(c.seleccionarEstudiante(a))}),o(1),i()}if(s&2){let e=t.$implicit;l(),Ne(" ",e==null?null:e.Ap_Paterno," ",e==null?null:e.Ap_Materno," ",e==null?null:e.Nombre," (",e==null?null:e.CI,") ")}}function vt(s,t){if(s&1){let e=b();n(0,"div",64),h(1,_t,2,0,"div",65)(2,gt,2,4,"button",66),n(3,"button",67),v("click",function(){u(e);let a=m(2);return f(a.mostrarListaEstudiantes=!1)}),o(4,"Cerrar lista"),i()()}if(s&2){let e=m(2);l(),d("ngIf",e.isBuscandoEstudiante),l(),d("ngForOf",e.estudiantesBuscados)}}function ht(s,t){if(s&1&&_(0,"input",79),s&2){let e=m().$implicit,r=m(5);d("type",e.type||"text")("formControl",r.dynamicForm.get(e.key))}}function Et(s,t){if(s&1&&_(0,"textarea",80),s&2){let e=m().$implicit,r=m(5);d("formControl",r.dynamicForm.get(e.key))}}function bt(s,t){if(s&1&&(n(0,"option",10),o(1),i()),s&2){let e=t.$implicit;d("ngValue",e),l(),E(e)}}function Ct(s,t){if(s&1&&(n(0,"select",81)(1,"option",10),o(2,"--"),i(),h(3,bt,2,2,"option",11),i()),s&2){let e=m().$implicit,r=m(5);d("formControl",r.dynamicForm.get(e.key)),l(),d("ngValue",""),l(2),d("ngForOf",e.options||xe(3,$e))}}function xt(s,t){if(s&1&&(n(0,"div",46)(1,"label",8),o(2),i(),h(3,ht,1,2,"input",76)(4,Et,1,1,"textarea",77)(5,Ct,4,4,"select",78),i()),s&2){let e=t.$implicit;l(2),E(e.label||e.key),l(),d("ngIf",!e.type||e.type==="text"||e.type==="number"||e.type==="date"),l(),d("ngIf",e.type==="textarea"),l(),d("ngIf",e.type==="select")}}function St(s,t){if(s&1&&(n(0,"div",72)(1,"div",73)(2,"strong"),o(3),i()(),n(4,"div",17)(5,"div",74),h(6,xt,6,4,"div",75),i()()()),s&2){let e=t.$implicit;l(3),E(e.title),l(3),d("ngForOf",e.fields)}}function yt(s,t){if(s&1&&(n(0,"div"),h(1,St,7,2,"div",71),i()),s&2){let e=m(3);l(),d("ngForOf",e.dynamicPhases)}}function wt(s,t){if(s&1&&_(0,"input",79),s&2){let e=m().$implicit,r=m(4);d("type",e.type||"text")("formControl",r.dynamicForm.get(e.key))}}function Mt(s,t){if(s&1&&_(0,"textarea",80),s&2){let e=m().$implicit,r=m(4);d("formControl",r.dynamicForm.get(e.key))}}function It(s,t){if(s&1&&(n(0,"option",10),o(1),i()),s&2){let e=t.$implicit;d("ngValue",e),l(),E(e)}}function Ft(s,t){if(s&1&&(n(0,"select",81)(1,"option",10),o(2,"--"),i(),h(3,It,2,2,"option",11),i()),s&2){let e=m().$implicit,r=m(4);d("formControl",r.dynamicForm.get(e.key)),l(),d("ngValue",""),l(2),d("ngForOf",e.options||xe(3,$e))}}function Pt(s,t){if(s&1&&(n(0,"div",46)(1,"label",8),o(2),i(),h(3,wt,1,2,"input",76)(4,Mt,1,1,"textarea",77)(5,Ft,4,4,"select",78),i()),s&2){let e=t.$implicit;l(2),E(e.label||e.key),l(),d("ngIf",!e.type||e.type==="text"||e.type==="number"||e.type==="date"),l(),d("ngIf",e.type==="textarea"),l(),d("ngIf",e.type==="select")}}function Nt(s,t){if(s&1&&(n(0,"div",74),h(1,Pt,6,4,"div",75),i()),s&2){let e=m(3);l(),d("ngForOf",e.dynamicFields)}}function Tt(s,t){if(s&1&&(n(0,"div",41),_(1,"hr",58),n(2,"h6",59),o(3,"Dise\xF1o especial"),i(),h(4,yt,2,1,"div",28)(5,Nt,2,1,"div",70),i()),s&2){let e=m(2);l(4),d("ngIf",e.dynamicPhases.length>0),l(),d("ngIf",e.dynamicPhases.length===0&&e.dynamicFields.length>0)}}function Vt(s,t){s&1&&(Ie(0),n(1,"div",14)(2,"label",8),o(3,"Monto"),i(),_(4,"input",82),i(),n(5,"div",14)(6,"label",8),o(7,"M\xE9todo"),i(),_(8,"input",83),i(),n(9,"div",14)(10,"label",8),o(11,"Fecha pago"),i(),_(12,"input",84),i(),n(13,"div",46)(14,"label",8),o(15,"Comprobante (ruta/URL)"),i(),_(16,"input",85),i(),n(17,"div",14)(18,"label",8),o(19,"Estado pago"),i(),n(20,"select",86)(21,"option",54),o(22,"PENDIENTE"),i(),n(23,"option",87),o(24,"PAGADO"),i(),n(25,"option",88),o(26,"ANULADO"),i()()(),Fe())}function Ot(s,t){if(s&1){let e=b();n(0,"div",36)(1,"h5",37),o(2),i(),n(3,"button",38),v("click",function(){u(e);let a=m();return f(a.modalRegistroRef.close())}),i()(),n(4,"div",39)(5,"form",40)(6,"div",41)(7,"label",8),o(8,"Buscar estudiante (IFAS) (opcional)"),i(),n(9,"div",42)(10,"input",43),v("focus",function(){u(e);let a=m();return f(a.mostrarListaEstudiantes=!0)}),i(),n(11,"button",44),v("click",function(){u(e);let a=m();return f(a.buscarEstudiante())}),o(12,"Buscar"),i()(),h(13,vt,5,2,"div",45),i(),n(14,"div",46)(15,"label",8),o(16,"Apellido paterno"),i(),_(17,"input",47),i(),n(18,"div",46)(19,"label",8),o(20,"Apellido materno"),i(),_(21,"input",48),i(),n(22,"div",46)(23,"label",8),o(24,"Nombres"),i(),_(25,"input",49),i(),n(26,"div",14)(27,"label",8),o(28,"Carnet"),i(),_(29,"input",50),i(),n(30,"div",14)(31,"label",8),o(32,"Celular"),i(),_(33,"input",51),i(),n(34,"div",46)(35,"label",8),o(36,"Correo"),i(),_(37,"input",52),i(),n(38,"div",14)(39,"label",8),o(40,"Estado inscripci\xF3n"),i(),n(41,"select",53)(42,"option",54),o(43,"PENDIENTE"),i(),n(44,"option",55),o(45,"APROBADO"),i(),n(46,"option",56),o(47,"RECHAZADO"),i()()(),h(48,Tt,6,2,"div",57),n(49,"div",41),_(50,"hr",58),n(51,"h6",59),o(52,"Pago (si aplica)"),i()(),n(53,"div",14)(54,"label",8),o(55,"\xBFTiene pago?"),i(),n(56,"select",60)(57,"option",10),o(58,"No"),i(),n(59,"option",10),o(60,"S\xED"),i()()(),h(61,Vt,27,0,"ng-container",28),n(62,"div",41)(63,"label",8),o(64,"Observaci\xF3n"),i(),_(65,"textarea",61),i()()(),n(66,"div",62)(67,"button",63),v("click",function(){u(e);let a=m();return f(a.modalRegistroRef.close())}),o(68,"Cerrar"),i(),n(69,"button",5),v("click",function(){u(e);let a=m();return f(a.guardar())}),o(70,"Guardar"),i()()}if(s&2){let e=m();l(2),E(e.editId?"Editar inscripci\xF3n":"Nueva inscripci\xF3n"),l(3),d("formGroup",e.frm),l(5),d("formControl",e.estudianteInput),l(3),d("ngIf",e.mostrarListaEstudiantes),l(35),d("ngIf",e.dynamicPhases.length>0||e.dynamicFields.length>0),l(9),d("ngValue",0),l(2),d("ngValue",1),l(2),d("ngIf",e.tienePagoSeleccionado)}}var de=class de{constructor(t,e,r,a){this._eventos=t;this._svc=e;this._est=r;this._tools=a;this.ruta=M.ruta;this.eventos=[];this.eventoSeleccionadoId=null;this.registros=[];this.isLoading=!1;this.filterTxt="";this.pagin=1;this.pageSize=10;this.pageSizeOptions=[5,10,20,50];this.editId=null;this.estudianteInput=new p("");this.mostrarListaEstudiantes=!1;this.isBuscandoEstudiante=!1;this.estudiantesBuscados=[];this.estudianteSeleccionado=null;this.schema=null;this.dynamicForm=new I({});this.dynamicPhases=[];this.dynamicFields=[];this.frm=this._svc.createFormGroupestudianteseventos()}ngOnInit(){this.cargarEventos(),this.setupBuscadorEstudiantes()}setupBuscadorEstudiantes(){this.estudianteInput.valueChanges.subscribe(t=>{if(!(t??"").toString().trim()){this.estudiantesBuscados=[],this.mostrarListaEstudiantes=!1,this.estudianteSeleccionado=null;return}})}cargarEventos(){this._eventos.Obtenereventos({activos:1}).subscribe({next:t=>{this.eventos=t?.data??[]},error:()=>this._tools.MostrarMensajeErrordeCarga()})}onChangeEvento(){this.pagin=1,this.cargarRegistros()}cargarRegistros(){if(!this.eventoSeleccionadoId){this.registros=[];return}this.isLoading=!0,this._svc.Obtenerestudianteseventos({eventos_id:this.eventoSeleccionadoId}).subscribe({next:t=>{this.registros=t?.data??[],this.isLoading=!1},error:()=>{this.isLoading=!1,this._tools.MostrarMensajeErrordeCarga()}})}get registrosFiltrados(){let t=(this.filterTxt??"").toString().trim().toUpperCase();return t?(this.registros??[]).filter(e=>{let r=`${e?.Ap_Paterno??""} ${e?.Ap_Materno??""} ${e?.Nombres??""}`.toUpperCase(),a=(e?.Carnet??"").toString().toUpperCase(),c=(e?.EstadoInscripcion??"").toString().toUpperCase(),g=(e?.EstadoPago??"").toString().toUpperCase();return r.includes(t)||a.includes(t)||c.includes(t)||g.includes(t)}):this.registros}get collectionSize(){return this.registrosFiltrados?.length??0}get registrosPaginados(){let t=this.registrosFiltrados||[],r=(Math.min(Math.max(1,this.pagin),Math.max(1,Math.ceil(t.length/this.pageSize)||1))-1)*this.pageSize;return t.slice(r,r+this.pageSize)}onFilterTxtChange(){this.pagin=1}onPageSizeChange(){this.pagin=1}buscarEstudiante(){let t=(this.estudianteInput.value??"").toString().trim();if(!t)return;this.isBuscandoEstudiante=!0,this.mostrarListaEstudiantes=!0;let e={page:1,per_page:10,search:t,search_mode:"any",relevance:!0};this._est.Obtenerestudiantesifas(e).pipe(Me(()=>(this.isBuscandoEstudiante=!1,this.estudiantesBuscados=[],we({data:[]})))).subscribe(r=>{this.isBuscandoEstudiante=!1,this.estudiantesBuscados=r?.data??[]})}seleccionarEstudiante(t){this.estudianteSeleccionado=t,this.mostrarListaEstudiantes=!1,this.frm.patchValue({estudiantesifas_id:t?.id??null,Ap_Paterno:t?.Ap_Paterno??"",Ap_Materno:t?.Ap_Materno??"",Nombres:t?.Nombre??"",Carnet:t?.CI??t?.Carnet??"",Celular:t?.Celular??"",Correo:t?.Correo??""});let e=`${t?.Ap_Paterno??""} ${t?.Ap_Materno??""} ${t?.Nombre??""} (${t?.CI??""})`;this.estudianteInput.setValue(e,{emitEvent:!1})}abrirNuevo(){if(!this.eventoSeleccionadoId){this._tools.MostrarMensaje("warning","Seleccione un evento");return}this.editId=null,this.frm.reset(this._svc.createFormGroupestudianteseventos().value),this.estudianteInput.setValue("",{emitEvent:!1}),this.estudianteSeleccionado=null,this.frm.patchValue({eventos_id:this.eventoSeleccionadoId,EstadoInscripcion:"PENDIENTE",EstadoPago:"NO_APLICA",TienePago:0}),this.configurarSegunEvento(),this.modalRegistroRef=this._tools.openModal(this.modalRegistroTpl,"xl")}abrirEditar(t){this.editId=t?.id??null,this.frm.reset(this._svc.createFormGroupestudianteseventos().value),this.frm.patchValue(t??{}),this.estudianteSeleccionado=null;let e=`${t?.Ap_Paterno??""} ${t?.Ap_Materno??""} ${t?.Nombres??""} (${t?.Carnet??""})`;this.estudianteInput.setValue(e,{emitEvent:!1}),this.configurarSegunEvento(),this.cargarDynamicDesdeRow(t),this.modalRegistroRef=this._tools.openModal(this.modalRegistroTpl,"xl")}getEventoSeleccionado(){let t=this.frm.get("eventos_id")?.value??this.eventoSeleccionadoId,e=t?Number(t):null;return e?(this.eventos??[]).find(r=>Number(r?.id)===e)??null:null}parseSchema(t){let e=(t??"").toString().trim();if(!e)return null;try{return JSON.parse(e)}catch{return null}}configurarSegunEvento(){let t=this.getEventoSeleccionado(),e=t?.TienePago==1?1:0;this.frm.patchValue({TienePago:e,Monto:e?t?.Monto??null:null,EstadoPago:e?this.frm.get("EstadoPago")?.value||"PENDIENTE":"NO_APLICA"}),this.schema=this.parseSchema(t?.InputsEspecial),this.buildDynamicForm(this.schema)}buildDynamicForm(t){if(this.dynamicForm=new I({}),this.dynamicPhases=[],this.dynamicFields=[],!t)return;let e=t?.phases??[];if(e.length>0){this.dynamicPhases=e.map(a=>({title:(a?.title??"Fase").toString(),fields:(a?.fields??[]).filter(c=>!!c?.key)}));for(let a of this.dynamicPhases)for(let c of a.fields)this.addControlForField(c);return}let r=(t?.fields??[]).filter(a=>!!a?.key);this.dynamicFields=r;for(let a of r)this.addControlForField(a)}addControlForField(t){let e=(t?.key??"").toString().trim();if(!e)return;let a=!!t?.required?[C.required]:[];this.dynamicForm.addControl(e,new p("",a))}cargarDynamicDesdeRow(t){let e=t?.DatosEspeciales;if(!e)return;let r=null;try{r=typeof e=="string"?JSON.parse(e):e}catch{r=null}r&&Object.keys(this.dynamicForm.controls).forEach(a=>{r[a]!==void 0&&this.dynamicForm.get(a)?.setValue(r[a])})}get tienePagoSeleccionado(){return this.frm.get("TienePago")?.value==1}buildPayload(){let t=this.dynamicForm.value,e=k({},this.frm.value);return e.DatosEspeciales=JSON.stringify(t??{}),!e.TienePago||e.TienePago==0?(e.Monto=null,e.MetodoPago="",e.FechaPago="",e.ComprobantePago="",e.EstadoPago="NO_APLICA"):e.EstadoPago||(e.EstadoPago="PENDIENTE"),e}guardar(){if(this.frm.invalid){this._tools.MostrarMensajeFrmIncompleto();return}if(this.dynamicForm.invalid){this._tools.MostrarMensaje("warning","Complete los campos del dise\xF1o especial");return}let t=this.buildPayload();this._tools.MostrarMensajeLoading(),(this.editId?this._svc.Modificarestudianteseventos(t,this.editId):this._svc.Agregarestudianteseventos(t)).subscribe({next:()=>{this.modalRegistroRef?.close(),this._tools.MostrarMensajeSuccess(),this.cargarRegistros()},error:()=>this._tools.MostrarMensajeError()})}eliminar(t){return P(this,null,function*(){(yield this._tools.mostrarMensajeConfirm("Eliminar inscripci\xF3n","\xBFEst\xE1 seguro?","warning","S\xED, eliminar","Cancelar"))&&this._svc.Eliminarestudianteseventos(t?.id).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.cargarRegistros()},error:()=>this._tools.MostrarMensajeError()})})}generarCertificado(t){return P(this,null,function*(){(yield this._tools.mostrarMensajeConfirm("Generar certificado","Se generar\xE1 un PDF usando el dise\xF1o asignado al evento. \xBFContinuar?","info","S\xED, generar","Cancelar"))&&(this._tools.MostrarMensajeLoading(),this._svc.GenerarCertificado(t?.id).subscribe({next:r=>{this._tools.MostrarMensajeSuccess();let a=r?.data?.url;a&&window.open(a,"_blank"),this.cargarRegistros()},error:r=>{let a=r?.error?.error||"No se pudo generar el certificado";this._tools.MostrarMensaje("error",a)}}))})}};de.\u0275fac=function(e){return new(e||de)(w(ae),w(he),w(ke),w(re))},de.\u0275cmp=j({type:de,selectors:[["app-estudianteseventos"]],viewQuery:function(e,r){if(e&1&&z(ot,7),e&2){let a;G(a=B())&&(r.modalRegistroTpl=a.first)}},standalone:!1,decls:34,vars:10,consts:[["modalRegistro",""],[1,"container-fluid"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"mb-0"],[1,"text-muted"],[1,"btn","btn-primary",3,"click"],[1,"row","g-2","mb-2"],[1,"col-md-5"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-4"],["placeholder","Nombre / carnet / estado...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],[3,"value",4,"ngFor","ngForOf"],[1,"card"],[1,"card-body"],["class","text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","d-flex justify-content-center",3,"page","pageSize","collectionSize","boundaryLinks","pageChange",4,"ngIf"],[3,"value"],[1,"table-responsive"],[1,"table","table-sm","table-hover","align-middle"],[2,"width","260px"],[4,"ngFor","ngForOf"],[1,"fw-semibold"],[1,"badge","bg-secondary"],[4,"ngIf"],[1,"text-end"],["class","btn btn-sm btn-outline-success me-2","target","_blank",3,"href",4,"ngIf"],[1,"btn","btn-sm","btn-outline-success","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],["target","_blank",1,"btn","btn-sm","btn-outline-success","me-2",3,"href"],[1,"d-flex","justify-content-center",3,"pageChange","page","pageSize","collectionSize","boundaryLinks"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-2",3,"formGroup"],[1,"col-12"],[1,"input-group"],["placeholder","Apellidos / nombre / CI...",1,"form-control",3,"focus","formControl"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","list-group mt-1",4,"ngIf"],[1,"col-md-6"],["formControlName","Ap_Paterno",1,"form-control"],["formControlName","Ap_Materno",1,"form-control"],["formControlName","Nombres",1,"form-control"],["formControlName","Carnet",1,"form-control"],["formControlName","Celular",1,"form-control"],["formControlName","Correo",1,"form-control"],["formControlName","EstadoInscripcion",1,"form-select"],["value","PENDIENTE"],["value","APROBADO"],["value","RECHAZADO"],["class","col-12",4,"ngIf"],[1,"my-2"],[1,"mb-2"],["formControlName","TienePago",1,"form-select"],["rows","2","formControlName","Observacion",1,"form-control"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"list-group","mt-1"],["class","list-group-item",4,"ngIf"],["type","button","class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","text-muted",3,"click"],[1,"list-group-item"],["type","button",1,"list-group-item","list-group-item-action",3,"click"],["class","row g-2",4,"ngIf"],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-header","py-2"],[1,"row","g-2"],["class","col-md-6",4,"ngFor","ngForOf"],["class","form-control",3,"type","formControl",4,"ngIf"],["class","form-control","rows","2",3,"formControl",4,"ngIf"],["class","form-select",3,"formControl",4,"ngIf"],[1,"form-control",3,"type","formControl"],["rows","2",1,"form-control",3,"formControl"],[1,"form-select",3,"formControl"],["type","number","formControlName","Monto",1,"form-control"],["formControlName","MetodoPago","placeholder","Efectivo / QR / Dep\xF3sito",1,"form-control"],["type","date","formControlName","FechaPago",1,"form-control"],["formControlName","ComprobantePago",1,"form-control"],["formControlName","EstadoPago",1,"form-select"],["value","PAGADO"],["value","ANULADO"]],template:function(e,r){if(e&1){let a=b();n(0,"div",1)(1,"div",2)(2,"div")(3,"h4",3),o(4,"Inscripciones (estudianteseventos)"),i(),n(5,"small",4),o(6,"Registro + pago (si aplica) en una sola tabla"),i()(),n(7,"button",5),v("click",function(){return u(a),f(r.abrirNuevo())}),o(8,"Nueva inscripci\xF3n"),i()(),n(9,"div",6)(10,"div",7)(11,"label",8),o(12,"Evento"),i(),n(13,"select",9),y("ngModelChange",function(g){return u(a),S(r.eventoSeleccionadoId,g)||(r.eventoSeleccionadoId=g),f(g)}),v("change",function(){return u(a),f(r.onChangeEvento())}),n(14,"option",10),o(15,"-- Seleccione --"),i(),h(16,rt,2,3,"option",11),i()(),n(17,"div",12)(18,"label",8),o(19,"Buscar"),i(),n(20,"input",13),y("ngModelChange",function(g){return u(a),S(r.filterTxt,g)||(r.filterTxt=g),f(g)}),v("ngModelChange",function(){return u(a),f(r.onFilterTxtChange())}),i()(),n(21,"div",14)(22,"label",8),o(23,"Tama\xF1o"),i(),n(24,"select",9),y("ngModelChange",function(g){return u(a),S(r.pageSize,g)||(r.pageSize=g),f(g)}),v("change",function(){return u(a),f(r.onPageSizeChange())}),h(25,at,2,2,"option",15),i()()(),n(26,"div",16)(27,"div",17),h(28,st,2,0,"div",18)(29,lt,2,0,"div",18)(30,ut,17,1,"div",19)(31,ft,1,4,"ngb-pagination",20),i()(),h(32,Ot,71,8,"ng-template",null,0,q),i()}e&2&&(l(13),x("ngModel",r.eventoSeleccionadoId),l(),d("ngValue",null),l(2),d("ngForOf",r.eventos),l(4),x("ngModel",r.filterTxt),l(4),x("ngModel",r.pageSize),l(),d("ngForOf",r.pageSizeOptions),l(3),d("ngIf",!r.eventoSeleccionadoId),l(),d("ngIf",r.isLoading),l(),d("ngIf",r.eventoSeleccionadoId&&!r.isLoading),l(),d("ngIf",r.eventoSeleccionadoId))},dependencies:[W,$,X,ie,ne,J,ge,te,Q,K,Z,Ve,Y,ee,oe],styles:[".list-group[_ngcontent-%COMP%]{max-height:260px;overflow:auto}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var Ee=de;var Dt=["modalDisenio"];function At(s,t){if(s&1&&(n(0,"option",19),o(1),i()),s&2){let e=t.$implicit;d("value",e),l(),F("",e," por p\xE1gina")}}function kt(s,t){s&1&&(n(0,"div",4),o(1,"Cargando..."),i())}function Rt(s,t){if(s&1&&(n(0,"small",4),o(1),i()),s&2){let e=m().$implicit;l(),E(e==null?null:e.Observacion)}}function Lt(s,t){if(s&1&&(n(0,"a",30),o(1,"Ver PDF"),i()),s&2){let e=m().$implicit,r=m(2);d("href",r.ruta+e.ArchivoPdf,ue)}}function jt(s,t){s&1&&(n(0,"span",4),o(1,"(sin archivo)"),i())}function zt(s,t){if(s&1){let e=b();n(0,"tr")(1,"td"),o(2),i(),n(3,"td")(4,"div",24),o(5),i(),h(6,Rt,2,1,"small",16),i(),n(7,"td"),h(8,Lt,2,1,"a",25)(9,jt,2,0,"span",16),i(),n(10,"td")(11,"span",26),o(12),i()(),n(13,"td",27)(14,"button",28),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.abrirEditar(a))}),o(15,"Editar"),i(),n(16,"button",29),v("click",function(){let a=u(e).$implicit,c=m(2);return f(c.eliminar(a))}),o(17,"Eliminar"),i()()()}if(s&2){let e=t.$implicit;l(2),E(e==null?null:e.id),l(3),E(e==null?null:e.Nombre),l(),d("ngIf",e==null?null:e.Observacion),l(2),d("ngIf",e==null?null:e.ArchivoPdf),l(),d("ngIf",!(e!=null&&e.ArchivoPdf)),l(2),_e("bg-success",(e==null?null:e.Activo)==1)("bg-secondary",(e==null?null:e.Activo)!=1),l(),E((e==null?null:e.Activo)==1?"Activo":"Inactivo")}}function Gt(s,t){if(s&1&&(n(0,"div",20)(1,"table",21)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),i(),n(6,"th"),o(7,"Nombre"),i(),n(8,"th"),o(9,"PDF"),i(),n(10,"th"),o(11,"Activo"),i(),_(12,"th",22),i()(),n(13,"tbody"),h(14,zt,18,10,"tr",23),i()()()),s&2){let e=m();l(14),d("ngForOf",e.diseniosPaginados)}}function Bt(s,t){if(s&1&&(n(0,"div",53),o(1),i()),s&2){let e,r=m(2);l(),F("Ruta: ",(e=r.frm.get("ArchivoPdf"))==null?null:e.value)}}function qt(s,t){if(s&1&&(n(0,"div",54),o(1),i()),s&2){let e=m(2);l(),F("Subiendo... ",e.uploadProgress,"%")}}function Wt(s,t){if(s&1){let e=b();n(0,"div",31)(1,"h5",32),o(2),i(),n(3,"button",33),v("click",function(){u(e);let a=m();return f(a.modalDisenioRef.close())}),i()(),n(4,"div",34)(5,"form",35)(6,"div",36)(7,"label",37),o(8,"Nombre"),i(),_(9,"input",38),i(),n(10,"div",39)(11,"label",37),o(12,"Activo"),i(),n(13,"select",40)(14,"option",41),o(15,"S\xED"),i(),n(16,"option",41),o(17,"No"),i()()(),n(18,"div",42)(19,"label",37),o(20,"PDF de dise\xF1o"),i(),n(21,"div",43)(22,"input",44),v("change",function(a){u(e);let c=m();return f(c.onSelectPdf(a))}),i(),n(23,"button",45),v("click",function(){u(e);let a=m();return f(a.verPdf())}),o(24,"Ver"),i()(),h(25,Bt,2,1,"div",46)(26,qt,2,1,"div",47),i(),n(27,"div",42)(28,"label",37),o(29,"Par\xE1metros / posiciones (JSON)"),i(),_(30,"textarea",48),n(31,"small",49),o(32,"Keys soportadas por defecto: NOMBRE_COMPLETO, CARNET, EVENTO, ANIO, FECHA (o cualquier key de DatosEspeciales)"),i()(),n(33,"div",42)(34,"label",37),o(35,"Observaci\xF3n"),i(),_(36,"textarea",50),i()()(),n(37,"div",51)(38,"button",52),v("click",function(){u(e);let a=m();return f(a.modalDisenioRef.close())}),o(39,"Cerrar"),i(),n(40,"button",5),v("click",function(){u(e);let a=m();return f(a.guardar())}),o(41,"Guardar"),i()()}if(s&2){let e,r,a=m();l(2),E(a.editId?"Editar dise\xF1o":"Nuevo dise\xF1o"),l(3),d("formGroup",a.frm),l(9),d("ngValue",1),l(2),d("ngValue",0),l(7),d("disabled",!((e=a.frm.get("ArchivoPdf"))!=null&&e.value)),l(2),d("ngIf",(r=a.frm.get("ArchivoPdf"))==null?null:r.value),l(),d("ngIf",a.isUploading)}}var me=class me{constructor(t,e){this._svc=t;this._tools=e;this.ruta=M.ruta;this.disenios=[];this.isLoading=!1;this.filterTxt="";this.pagin=1;this.pageSize=10;this.pageSizeOptions=[5,10,20,50];this.editId=null;this.isUploading=!1;this.uploadProgress=0;this.tempFilePath=null;this.frm=this._svc.createFormGroupdiseniocertificadopdfs()}ngOnInit(){this.cargar()}cargar(){this.isLoading=!0,this._svc.Obtenerdiseniocertificadopdfs().subscribe({next:t=>{this.disenios=t?.data??[],this.isLoading=!1},error:()=>{this.isLoading=!1,this._tools.MostrarMensajeErrordeCarga()}})}get diseniosFiltrados(){let t=(this.filterTxt??"").toString().trim().toUpperCase();return t?(this.disenios??[]).filter(e=>{let r=(e?.Nombre??"").toString().toUpperCase(),a=(e?.Observacion??"").toString().toUpperCase();return r.includes(t)||a.includes(t)}):this.disenios}get collectionSize(){return this.diseniosFiltrados?.length??0}get diseniosPaginados(){let t=this.diseniosFiltrados||[],r=(Math.min(Math.max(1,this.pagin),Math.max(1,Math.ceil(t.length/this.pageSize)||1))-1)*this.pageSize;return t.slice(r,r+this.pageSize)}onFilterTxtChange(){this.pagin=1}onPageSizeChange(){this.pagin=1}abrirNuevo(){this.editId=null,this.tempFilePath=null,this.frm.reset(this._svc.createFormGroupdiseniocertificadopdfs().value),this.frm.patchValue({Activo:1,Parametros:""}),this.modalDisenioRef=this._tools.openModal(this.modalDisenioTpl,"lg")}abrirEditar(t){this.editId=t?.id??null,this.tempFilePath=null,this.frm.reset(this._svc.createFormGroupdiseniocertificadopdfs().value),this.frm.patchValue(t??{}),this.frm.get("Parametros")?.value==null&&this.frm.patchValue({Parametros:""}),this.modalDisenioRef=this._tools.openModal(this.modalDisenioTpl,"lg")}onSelectPdf(t){let e=t?.target?.files?.[0]??null;if(!e)return;if((e.name.split(".").pop()??"").toLowerCase()!=="pdf"){this._tools.MostrarMensaje("warning","Solo se permite PDF");return}this.isUploading=!0,this.uploadProgress=0,this._tools.SubirArchivo(e,"certificadoPdf").subscribe({next:a=>{if(a.type===Se.UploadProgress&&a.total&&(this.uploadProgress=Math.round(100*a.loaded/a.total)),a.type===Se.Response){let c=a.body?.filePath;c&&(this.frm.patchValue({ArchivoPdf:c}),this.tempFilePath=c,this._tools.MostrarMensaje("success","PDF subido")),this.isUploading=!1}},error:()=>{this.isUploading=!1,this._tools.MostrarMensajeError()}})}verPdf(){let t=(this.frm.get("ArchivoPdf")?.value??"").toString().trim();t&&window.open(this.ruta+t,"_blank")}guardar(){if(this.frm.invalid){this._tools.MostrarMensajeFrmIncompleto();return}let t=k({},this.frm.value);this._tools.MostrarMensajeLoading(),(this.editId?this._svc.Modificardiseniocertificadopdfs(t,this.editId):this._svc.Agregardiseniocertificadopdfs(t)).subscribe({next:()=>{this.modalDisenioRef?.close(),this._tools.MostrarMensajeSuccess(),this.cargar()},error:()=>this._tools.MostrarMensajeError()})}eliminar(t){return P(this,null,function*(){(yield this._tools.mostrarMensajeConfirm("Eliminar dise\xF1o","\xBFEst\xE1 seguro?","warning","S\xED, eliminar","Cancelar"))&&this._svc.Eliminardiseniocertificadopdfs(t?.id).subscribe({next:()=>{this._tools.MostrarMensajeSuccess(),this.cargar()},error:()=>this._tools.MostrarMensajeError()})})}};me.\u0275fac=function(e){return new(e||me)(w(se),w(re))},me.\u0275cmp=j({type:me,selectors:[["app-diseniocertificadopdfs"]],viewQuery:function(e,r){if(e&1&&z(Dt,7),e&2){let a;G(a=B())&&(r.modalDisenioTpl=a.first)}},standalone:!1,decls:25,vars:9,consts:[["modalDisenio",""],[1,"container-fluid"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"mb-0"],[1,"text-muted"],[1,"btn","btn-primary",3,"click"],[1,"row","g-2","mb-2"],[1,"col-md-6"],["placeholder","Buscar...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3","d-flex","align-items-center","justify-content-end"],[1,"btn","btn-outline-secondary",3,"click"],[1,"card"],[1,"card-body"],["class","text-muted",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"d-flex","justify-content-center",3,"pageChange","page","pageSize","collectionSize","boundaryLinks"],[3,"value"],[1,"table-responsive"],[1,"table","table-sm","table-hover","align-middle"],[2,"width","200px"],[4,"ngFor","ngForOf"],[1,"fw-semibold"],["target","_blank",3,"href",4,"ngIf"],[1,"badge"],[1,"text-end"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],["target","_blank",3,"href"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-2",3,"formGroup"],[1,"col-md-8"],[1,"form-label"],["formControlName","Nombre",1,"form-control"],[1,"col-md-4"],["formControlName","Activo",1,"form-select"],[3,"ngValue"],[1,"col-12"],[1,"d-flex","gap-2"],["type","file","accept","application/pdf",1,"form-control",3,"change"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["class","small text-muted mt-1",4,"ngIf"],["class","small text-muted",4,"ngIf"],["rows","6","formControlName","Parametros","placeholder",'{"page":1,"fields":[{"key":"NOMBRE_COMPLETO","x":40,"y":120,"fontSize":28,"align":"C","w":200}]}',1,"form-control"],[1,"text-muted","d-block","mt-1"],["rows","2","formControlName","Observacion",1,"form-control"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"small","text-muted","mt-1"],[1,"small","text-muted"]],template:function(e,r){if(e&1){let a=b();n(0,"div",1)(1,"div",2)(2,"div")(3,"h4",3),o(4,"Dise\xF1os de certificado (PDF)"),i(),n(5,"small",4),o(6,"Plantillas PDF + par\xE1metros de posiciones (JSON)"),i()(),n(7,"button",5),v("click",function(){return u(a),f(r.abrirNuevo())}),o(8,"Nuevo dise\xF1o"),i()(),n(9,"div",6)(10,"div",7)(11,"input",8),y("ngModelChange",function(g){return u(a),S(r.filterTxt,g)||(r.filterTxt=g),f(g)}),v("ngModelChange",function(){return u(a),f(r.onFilterTxtChange())}),i()(),n(12,"div",9)(13,"select",10),y("ngModelChange",function(g){return u(a),S(r.pageSize,g)||(r.pageSize=g),f(g)}),v("change",function(){return u(a),f(r.onPageSizeChange())}),h(14,At,2,2,"option",11),i()(),n(15,"div",12)(16,"button",13),v("click",function(){return u(a),f(r.cargar())}),o(17,"Refrescar"),i()()(),n(18,"div",14)(19,"div",15),h(20,kt,2,0,"div",16)(21,Gt,15,1,"div",17),n(22,"ngb-pagination",18),y("pageChange",function(g){return u(a),S(r.pagin,g)||(r.pagin=g),f(g)}),i()()(),h(23,Wt,42,7,"ng-template",null,0,q),i()}e&2&&(l(11),x("ngModel",r.filterTxt),l(2),x("ngModel",r.pageSize),l(),d("ngForOf",r.pageSizeOptions),l(6),d("ngIf",r.isLoading),l(),d("ngIf",!r.isLoading),l(),x("page",r.pagin),d("pageSize",r.pageSize)("collectionSize",r.collectionSize)("boundaryLinks",!0))},dependencies:[W,$,X,ie,ne,J,te,Q,K,Z,Y,ee,oe],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}"]});var be=me;var $t=[{path:"eventos",component:ve},{path:"estudianteseventos",component:Ee},{path:"diseniocertificadopdfs",component:be}],D=class D{};D.\u0275fac=function(e){return new(e||D)},D.\u0275mod=fe({type:D}),D.\u0275inj=pe({imports:[ye.forChild($t),ye]});var Ce=D;var A=class A{};A.\u0275fac=function(e){return new(e||A)},A.\u0275mod=fe({type:A}),A.\u0275inj=pe({imports:[Te,Ae,Oe,De,Ce]});var He=A;export{He as InformacioneventosModule};
