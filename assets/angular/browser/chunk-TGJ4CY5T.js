import{a as le}from"./chunk-C6O7D6BX.js";import{a as oe,b as y}from"./chunk-2G4CJVZI.js";import{b as re}from"./chunk-DAWVYIHI.js";import{b as ie}from"./chunk-4WRFG2J2.js";import{a as ne,b as ae}from"./chunk-UD6YX65Z.js";import{e as z,h as Y,k as J}from"./chunk-LEW5N4EV.js";import{c as K,f as X,k as Z,m as ee,x as te}from"./chunk-TKGN7DBU.js";import{a as v}from"./chunk-5RMZ5E5A.js";import{Aa as L,Ea as r,Ec as Q,F as g,Fc as q,Lb as o,Ma as b,Mb as $,Nb as u,Nc as G,Pb as U,Ra as N,Sb as M,Tb as k,U as f,Ub as R,Wa as p,Xc as P,Yb as H,Z as w,Zb as D,ba as A,ga as h,ha as x,i as _,ib as l,jb as a,kb as n,lb as E,pb as B,qb as W,sb as j,vb as F,xb as s}from"./chunk-SGF3PIFW.js";import"./chunk-GG76335P.js";var C=class C{constructor(t){this.http=t;this.base=`${v.apiUrl}${v.apiRoutes.lchaula.base}`}getById(t){return this.http.get(`${this.base}/tareas/${t}`).pipe(y())}update(t,e){return this.http.put(`${this.base}/tareas/${t}`,e).pipe(y())}};C.\u0275fac=function(e){return new(e||C)(A(P))},C.\u0275prov=w({token:C,factory:C.\u0275fac,providedIn:"root"});var O=C;var T=class T{constructor(t){this.http=t;this.base=`${v.apiUrl}${v.apiRoutes.lchaula.base}`}listByTarea(t){return this.http.get(`${this.base}/tareas/${t}/entregas`).pipe(y())}submit(t,e){return this.http.post(`${this.base}/tareas/${t}/entregar`,e).pipe(y())}calificar(t,e){return this.http.post(`${this.base}/entregas/${t}/calificar`,e).pipe(y())}};T.\u0275fac=function(e){return new(e||T)(A(P))},T.\u0275prov=w({token:T,factory:T.\u0275fac,providedIn:"root"});var V=T;var ue=i=>["/lchaula/aula",i],ve=()=>({standalone:!0});function _e(i,t){i&1&&(a(0,"div",3),E(1,"app-spinner-local",4),n())}function ge(i,t){if(i&1&&(a(0,"span",14),o(1),n()),i&2){let e=s(2);r(),u("Deadline: ",e.tarea==null?null:e.tarea.fecha_entrega)}}function fe(i,t){if(i&1&&(a(0,"a",24),E(1,"i",25),o(2," Volver "),n()),i&2){let e=s(2);l("routerLink",D(1,ue,e.tarea.publicacion.aulas_virtuales_id))}}function he(i,t){if(i&1&&(a(0,"div",26),o(1),n()),i&2){let e=s(2);r(),u(" ",e.tarea.publicacion.descripcion," ")}}function xe(i,t){i&1&&(a(0,"div",10),o(1," Sin descripci\xF3n. "),n())}function be(i,t){i&1&&(a(0,"div",36),o(1," A\xFAn no entregaste. "),n())}function Ee(i,t){if(i&1&&(a(0,"div",30)(1,"div",12)(2,"span",14),o(3),n(),a(4,"span",14),o(5),n(),a(6,"span",14),o(7),n()()()),i&2){let e=s(3);r(3),u("Estado: ",e.entregaPropia.estado),r(2),u("Fecha: ",e.entregaPropia.fecha_entrega||"-"),r(2),u("Reentregas: ",e.entregaPropia.numero_reentrega||0)}}function ye(i,t){i&1&&(a(0,"div",43),o(1,"Sin archivos."),n())}function Ce(i,t){if(i&1&&(a(0,"a",48)(1,"span",49),E(2,"i",50),o(3),n(),E(4,"i",51),n()),i&2){let e=s().$implicit,d=s(5);l("href",d.publicBaseUrl+e.archivo.ruta,L),r(3),u(" ",(e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo"," ")}}function Te(i,t){if(i&1&&(a(0,"div",52)(1,"span",49),E(2,"i",50),o(3),n(),a(4,"span",10),o(5,"sin ruta"),n()()),i&2){let e=s().$implicit;r(3),u(" ",(e==null||e.archivo==null?null:e.archivo.nombre_original)||"archivo"," ")}}function Ie(i,t){if(i&1&&(B(0),p(1,Ce,5,2,"a",46)(2,Te,6,1,"div",47),W()),i&2){let e=t.$implicit;r(),l("ngIf",e==null||e.archivo==null?null:e.archivo.ruta),r(),l("ngIf",!(!(e==null||e.archivo==null)&&e.archivo.ruta))}}function Se(i,t){if(i&1&&(a(0,"div",44),p(1,Ie,3,2,"ng-container",45),n()),i&2){let e=s(4);r(),l("ngForOf",e.archivosEntrega)}}function we(i,t){if(i&1){let e=j();a(0,"div",37)(1,"div",38),o(2,"Adjuntos"),n(),p(3,ye,2,0,"div",39)(4,Se,2,1,"div",40),a(5,"div",41)(6,"input",42),F("change",function(c){h(e);let m=s(3);return x(m.onUploadEntregaFile(m.entregaPropia.id,c))}),n()()()}if(i&2){let e=s(3);r(3),l("ngIf",e.archivosEntrega.length===0),r(),l("ngIf",e.archivosEntrega.length>0)}}function Ae(i,t){if(i&1){let e=j();a(0,"div",27)(1,"div",17)(2,"div",18)(3,"div",19),o(4,"Tu trabajo"),n()(),a(5,"div",8),p(6,be,2,0,"div",28)(7,Ee,8,3,"div",29),a(8,"div",30)(9,"label",31),o(10,"Comentario"),n(),a(11,"quill-editor",32),R("ngModelChange",function(c){h(e);let m=s(2);return k(m.comentarioEntrega,c)||(m.comentarioEntrega=c),x(c)}),n()(),a(12,"button",33),F("click",function(){h(e);let c=s(2);return x(c.submitEntrega())}),E(13,"i",34),o(14," Enviar / Reentregar "),n(),p(15,we,7,2,"div",35),n()()()}if(i&2){let e=s(2);r(6),l("ngIf",!e.entregaPropia),r(),l("ngIf",e.entregaPropia),r(4),M("ngModel",e.comentarioEntrega),l("ngModelOptions",H(6,ve))("modules",e.modulesQuillEdicion),r(4),l("ngIf",e.entregaPropia)}}function je(i,t){i&1&&(a(0,"div",8)(1,"div",10),o(2,"No hay entregas."),n()())}function Fe(i,t){if(i&1&&(a(0,"div",61),o(1),n()),i&2){let e=s().$implicit;r(),u("Comentario: ",e.comentario_estudiante)}}function Me(i,t){if(i&1){let e=j();a(0,"div",58)(1,"div",59)(2,"div",60)(3,"div",19),o(4),n(),a(5,"div",61),o(6),n(),p(7,Fe,2,1,"div",62),n(),a(8,"span",14),o(9),n()(),a(10,"div",63)(11,"div",64)(12,"label",31),o(13,"Puntaje"),n(),a(14,"input",65),R("ngModelChange",function(c){let m=h(e).$implicit,I=s(4);return k(I.califForm[m.id].puntaje,c)||(I.califForm[m.id].puntaje=c),x(c)}),n()(),a(15,"div",66)(16,"label",31),o(17,"Feedback"),n(),a(18,"input",67),R("ngModelChange",function(c){let m=h(e).$implicit,I=s(4);return k(I.califForm[m.id].comentario,c)||(I.califForm[m.id].comentario=c),x(c)}),n()(),a(19,"div",68)(20,"button",69),F("click",function(){let c=h(e).$implicit,m=s(4);return x(m.calificar(c.id))}),o(21," Guardar "),n()()()()}if(i&2){let e=t.$implicit,d=s(4);r(4),u("Entrega #",e.id),r(2),U("Estado: ",e.estado," \u2022 Fecha: ",e.fecha_entrega||"-"," \u2022 Reentregas: ",e.numero_reentrega||0),r(),l("ngIf",e.comentario_estudiante),r(2),$(e.estado),r(5),M("ngModel",d.califForm[e.id].puntaje),r(4),M("ngModel",d.califForm[e.id].comentario)}}function ke(i,t){if(i&1&&(a(0,"div",56),p(1,Me,22,8,"div",57),n()),i&2){let e=s(3);r(),l("ngForOf",e.entregas)}}function Re(i,t){if(i&1&&(a(0,"div",6)(1,"div",17)(2,"div",53)(3,"div",19),o(4,"Entregas"),n(),a(5,"div",43),o(6),n()(),p(7,je,3,0,"div",54)(8,ke,2,1,"div",55),n()()),i&2){let e=s(2);r(6),u("",e.entregas.length," registros"),r(),l("ngIf",e.entregas.length===0),r(),l("ngIf",e.entregas.length>0)}}function Pe(i,t){if(i&1&&(a(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"div")(6,"div",10),o(7,"Tarea"),n(),a(8,"h2",11),o(9),n(),a(10,"div",12),p(11,ge,2,1,"span",13),a(12,"span",14),o(13),n()()(),p(14,fe,3,3,"a",15),n()()()(),a(15,"div",16)(16,"div",17)(17,"div",18)(18,"div",19),o(19,"Instrucciones"),n()(),a(20,"div",8),p(21,he,2,1,"div",20)(22,xe,2,0,"div",21),n()()(),p(23,Ae,16,7,"div",22)(24,Re,9,3,"div",23),n()),i&2){let e=s();r(9),$((e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.titulo)||"Tarea #"+(e.tarea==null?null:e.tarea.id)),r(2),l("ngIf",e.tarea==null?null:e.tarea.fecha_entrega),r(2),u("Puntaje m\xE1x: ",e.tarea==null?null:e.tarea.puntaje_maximo),r(),l("ngIf",e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.aulas_virtuales_id),r(7),l("ngIf",e.tarea==null||e.tarea.publicacion==null?null:e.tarea.publicacion.descripcion),r(),l("ngIf",!(!(e.tarea==null||e.tarea.publicacion==null)&&e.tarea.publicacion.descripcion)),r(),l("ngIf",!e.isAdminLike),r(),l("ngIf",e.isAdminLike)}}var S=class S{constructor(t,e,d,c,m,I){this.route=t;this.tareasService=e;this.entregasService=d;this.archivosService=c;this.auth=m;this.toast=I;this.publicBaseUrl=v.ruta||v.apiUrl||"";this.loading=!1;this.tareaId=0;this.isAdminLike=!1;this.tarea=null;this.entregas=[];this.comentarioEntrega="";this.entregaPropia=null;this.modulesQuillEdicion={toolbar:[["bold","italic","underline","strike"],[{align:[]}],[{size:["small",!1,"large"]}],[{color:[]},{background:[]}],[{font:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","video"],["clean"]]};this.modulesQuillShow={toolbar:!1};this.archivosEntrega=[];this.califForm={}}ngOnInit(){if(this.tareaId=Number(this.route.snapshot.paramMap.get("id")||0),!this.tareaId){this.toast.error("Tarea inv\xE1lida");return}this.auth.revisarSiesAdmin().subscribe({next:t=>{this.isAdminLike=t,this.load()},error:()=>{this.isAdminLike=!1,this.load()}})}load(){this.loading=!0,this.tareasService.getById(this.tareaId).pipe(f(t=>{this.tarea=t}),g(t=>(this.loading=!1,this.toast.error(t.message),_))).subscribe(()=>{this.loadEntregas()})}loadEntregas(){this.entregasService.listByTarea(this.tareaId).pipe(f(t=>{this.entregas=t,this.loading=!1,this.isAdminLike?(this.entregaPropia=null,this.archivosEntrega=[]):(this.entregaPropia=this.entregas.length>0?this.entregas[0]:null,this.entregaPropia&&this.loadArchivosEntrega(this.entregaPropia.id)),this.entregas.forEach(e=>{this.califForm[e.id]||(this.califForm[e.id]={puntaje:null,comentario:""})})}),g(t=>(this.loading=!1,this.toast.error(t.message),_))).subscribe()}submitEntrega(){this.entregasService.submit(this.tareaId,{comentario_estudiante:this.comentarioEntrega}).pipe(f(t=>{this.toast.success("Entrega registrada"),this.entregaPropia=t,this.comentarioEntrega="",this.loadEntregas()}),g(t=>(this.toast.error(t.message),_))).subscribe()}calificar(t){let e={puntaje_obtenido:this.califForm[t]?.puntaje,comentario_docente:this.califForm[t]?.comentario};this.entregasService.calificar(t,e).pipe(f(()=>{this.toast.success("Calificaci\xF3n guardada"),this.loadEntregas()}),g(d=>(this.toast.error(d.message),_))).subscribe()}loadArchivosEntrega(t){this.archivosService.list("ENTREGA",t).pipe(f(e=>{this.archivosEntrega=e}),g(()=>_)).subscribe()}onUploadEntregaFile(t,e){let d=e.target,c=d.files?.[0];c&&this.archivosService.upload(c,"ENTREGA",t).pipe(f(()=>{this.toast.success("Archivo subido"),d.value="",this.loadArchivosEntrega(t)}),g(m=>(this.toast.error(m.message),_))).subscribe()}};S.\u0275fac=function(e){return new(e||S)(b(z),b(O),b(V),b(le),b(ie),b(re))},S.\u0275cmp=N({type:S,selectors:[["app-lchaula-tarea"]],decls:3,vars:2,consts:[[1,"container-fluid"],["class","py-4",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"py-4"],["textShow","Cargando tarea..."],[1,"row","g-3"],[1,"col-12"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"d-flex","align-items-start","align-items-md-center","justify-content-between","gap-3"],[1,"text-muted","small"],[1,"h4","mb-1"],[1,"d-flex","flex-wrap","gap-2"],["class","badge text-bg-light border",4,"ngIf"],[1,"badge","text-bg-light","border"],["class","btn btn-sm btn-outline-secondary",3,"routerLink",4,"ngIf"],[1,"col-12","col-lg-8"],[1,"card","shadow-sm"],[1,"card-header","bg-light"],[1,"fw-semibold"],["class","small","style","white-space: pre-wrap;",4,"ngIf"],["class","text-muted small",4,"ngIf"],["class","col-12 col-lg-4",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"btn","btn-sm","btn-outline-secondary",3,"routerLink"],[1,"bi","bi-arrow-left"],[1,"small",2,"white-space","pre-wrap"],[1,"col-12","col-lg-4"],["class","alert alert-light border small mb-3",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[1,"form-label","small"],["placeholder","",1,"quill-container-wrapper",3,"ngModelChange","ngModel","ngModelOptions","modules"],[1,"btn","btn-primary","w-100",3,"click"],[1,"bi","bi-upload"],["class","mt-4",4,"ngIf"],[1,"alert","alert-light","border","small","mb-3"],[1,"mt-4"],[1,"fw-semibold","small","mb-2"],["class","small text-muted",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"mt-2"],["type","file",1,"form-control","form-control-sm",3,"change"],[1,"small","text-muted"],[1,"list-group"],[4,"ngFor","ngForOf"],["class","list-group-item list-group-item-action d-flex align-items-center justify-content-between","target","_blank","rel","noopener",3,"href",4,"ngIf"],["class","list-group-item d-flex justify-content-between",4,"ngIf"],["target","_blank","rel","noopener",1,"list-group-item","list-group-item-action","d-flex","align-items-center","justify-content-between",3,"href"],[1,"text-truncate"],[1,"bi","bi-paperclip"],[1,"bi","bi-box-arrow-up-right"],[1,"list-group-item","d-flex","justify-content-between"],[1,"card-header","bg-light","d-flex","align-items-center","justify-content-between"],["class","card-body",4,"ngIf"],["class","list-group list-group-flush",4,"ngIf"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","flex-wrap","align-items-center","justify-content-between","gap-2"],[1,"small"],[1,"text-muted"],["class","text-muted",4,"ngIf"],[1,"row","g-2","mt-2"],[1,"col-12","col-md-3"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-7"],[1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-2","d-flex","align-items-end"],[1,"btn","btn-success","w-100",3,"click"]],template:function(e,d){e&1&&(a(0,"div",0),p(1,_e,2,0,"div",1)(2,Pe,25,8,"div",2),n()),e&2&&(r(),l("ngIf",d.loading),r(),l("ngIf",!d.loading&&d.tarea))},dependencies:[G,Q,q,te,K,ee,X,Z,J,Y,oe,ae,ne],styles:["[_nghost-%COMP%]{display:block}"]});var ce=S;export{ce as TareaComponent};
