import{g as y}from"./chunk-O3DH7IF3.js";import{a as i}from"./chunk-JISGPZ2J.js";import{F as c,S as f,U as g,Yc as b,Z as u,ba as p,g as h,k as r,pa as v,q as l}from"./chunk-K6WFP5KF.js";var n=class n{constructor(){this.storageKey="theme.colorInstitucional";this.storageKeyMode="theme.mode";this.darkMode=v(!1);this.defaultHex="#890000";this.defaultRgb="137, 0, 0"}init(){let e=localStorage.getItem(this.storageKey);e&&this.isValidHexColor(e)?this.applyColor(e):this.applyColor(this.defaultHex);let t=(localStorage.getItem(this.storageKeyMode)??"").toLowerCase().trim();this.setDarkMode(t==="dark")}toggleDarkMode(){this.setDarkMode(!this.darkMode())}setDarkMode(e){this.darkMode.set(!!e),localStorage.setItem(this.storageKeyMode,e?"dark":"light"),document.documentElement.classList.toggle("theme-dark",e)}setInstitutionColor(e){if(!e||!this.isValidHexColor(e)){this.resetToDefault();return}let t=this.normalizeHex(e);localStorage.setItem(this.storageKey,t),this.applyColor(t)}resetToDefault(){localStorage.removeItem(this.storageKey),this.applyColor(this.defaultHex)}applyColor(e){let t=document.documentElement;t.style.setProperty("--color-basico-institucional",e);let o=this.hexToRgbCsv(e)??this.defaultRgb;t.style.setProperty("--color-basico-institucional-rgb",o)}isValidHexColor(e){let t=e.trim();return/^#?([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(t)}normalizeHex(e){let t=e.trim();return t.startsWith("#")?t:`#${t}`}hexToRgbCsv(e){let t=this.normalizeHex(e).replace("#","");if(t.length===3){let o=parseInt(t[0]+t[0],16),s=parseInt(t[1]+t[1],16),m=parseInt(t[2]+t[2],16);return`${o}, ${s}, ${m}`}if(t.length===6){let o=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),m=parseInt(t.slice(4,6),16);return`${o}, ${s}, ${m}`}return null}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"});var d=n;var a=class a{constructor(e,t,o){this.http=e;this.router=t;this.theme=o;this.ruta=i.ruta;this.loggedInSubject=new h(!1);this.loggedIn$=this.loggedInSubject.asObservable();this.SESSION_401_SHOWN_KEY="auth401Shown";this.brandingLoaded=!1}loginConLaravel(e){return this.http.post(`${this.ruta}api/v1/auth/login`,e)}setToken(e){localStorage.setItem("token",e),this.loggedInSubject.next(!0),this.brandingLoaded=!1;try{sessionStorage.removeItem(this.SESSION_401_SHOWN_KEY)}catch{}}clearSession(){localStorage.removeItem("token"),this.loggedInSubject.next(!1),this.theme.resetToDefault();try{i.ifa="",i.logo="",i.ministerio="",i.ministerioEscudo=""}catch{}this.brandingLoaded=!1;try{sessionStorage.removeItem(this.SESSION_401_SHOWN_KEY)}catch{}}aplicarBrandingEnEnvironment(e,t){let o=(t?.nameInst||e?.nameInst||"").toString();try{i.ifa=o,t?.logo&&(i.logo=t.logo),t?.ministerio&&(i.ministerio=t.ministerio),t?.ministerioEscudo&&(i.ministerioEscudo=t.ministerioEscudo)}catch{}}syncSession(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(()=>!0),g(t=>this.loggedInSubject.next(t)),c(()=>(this.clearSession(),r(!1)))):(this.loggedInSubject.next(!1),r(!1))}logout(){let e=localStorage.getItem("token");console.log("valorToken: ",e);var t={token:e};this.clearSession(),e?this.http.post(this.ruta+"api/v1/auth/logout",t).subscribe(o=>{this.router.navigate(["/login"])},o=>{console.error("Error al cerrar sesi\xF3n:",o),this.router.navigate(["/login"])}):this.router.navigate(["/login"])}pedirPerfil(){let e=localStorage.getItem("token");if(!e||String(e).trim()===""||String(e).toLowerCase()==="null")return r(null);let t={Authorization:`Bearer ${e}`};return this.http.get(`${this.ruta}api/v1/auth/user`,{headers:t}).pipe(g(o=>{this.aplicarBrandingEnEnvironment(o,null)}),f(o=>this.brandingLoaded?r(o):this.http.get(`${this.ruta}api/v1/branding/assets`,{headers:t}).pipe(g(s=>{this.brandingLoaded=!0,this.aplicarBrandingEnEnvironment(o,s)}),l(()=>o),c(()=>r(o)))))}cambiarClave(e){let t=localStorage.getItem("token");return this.http.post(`${this.ruta}api/v1/auth/cambiar-clave`,e,{headers:{Authorization:`Bearer ${t}`}})}resetPass(e){return this.http.post(`${this.ruta}api/reset-password`,e)}revisarSiesAdmin(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(t=>!!(t&&t.name!="ESTUDIANTE")),c(t=>r(!1))):r(!1)}revisarSiEsSuperAdmin(){let e=localStorage.getItem("token");return e?this.http.post(`${this.ruta}api/verify-token`,{token:e}).pipe(l(t=>!!(t&&t.name==="LCCH")),c(()=>r(!1))):r(!1)}};a.\u0275fac=function(t){return new(t||a)(p(b),p(y),p(d))},a.\u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"});var S=a;export{d as a,S as b};
